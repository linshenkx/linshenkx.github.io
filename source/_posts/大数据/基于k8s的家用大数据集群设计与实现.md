---
title: 基于k8s的家用大数据集群设计与实现
id: household_k8s_bigdata
permalink: household_k8s_bigdata/
date: 2021-07-13 22:54:20
categories: 程序员杂记
top: true
tags:
- 生产力
- 大数据  
- WSL
---
使用3台废旧笔记本搭建k8s集群，部署大数据组件，利用路由器进行异地组网，配合wsl作为管理和客户端，
实现随时随地，在工作笔记本上以本地访问的体验使用自建家庭大数据平台进行学习、开发、测试。
<!-- more -->
## 前言
### 起因
最近换了电脑，之前的机器闲置着浪费，又刚好看到了https://github.com/geekyouth/SZT-bigdata 这个项目，不错不错，让我来可以做得更好。

索性自己在家里搭个大数据集群来玩。而且女朋友的笔记本也闲置着，再搜刮一台来组个集群，就可以为所欲为了。
### 最初目标
在主力机的wsl里可以提交flink任务，在idea的单元测试里可以配置wsl执行hadoop操作。
这样基本就可以满足日常的开发测试需求了。

## 物理配置及组网
### 机器
服务器：lian1、lian2、lian3 

蒲公英家用路由器（带内网异地组网功能）

客户端：工作用笔记本（win11，带wsl）

### 网络配置
3台服务器利用网线连接路由器，组成一个局域网。

在家的时候笔记本直接通过wifi连接到局域网，在外也还可以通过蒲公英的异地组网功能连接。忽略网速的话体验一致。

注意：也可以通过一些内网穿透的软件达到相同效果，不推荐专门去买路由器。

## 技术选型
### 大数据平台选型
本来只是出于实验目的，想直接用cdh，方便管理一些。

CDH6.3.3之后没有免费社区版了。我之前还部署了一套6.3.2的。
但是从2021年2月开始下载之前的版本也要订阅了，很麻烦。
算了，人家就是不想让你用免费的，而且免费的组件版本还老，不用也罢。

然后我就开始物色其他的，hdp也早被cdh收编了，mapr本来就是主打商用的。

国内的华为阿里腾讯都是云服务，不会提供这种社区版。

倒是有看到UCloud出了一个USDP的大数据平台免费版。有点意思。
然后看了一遍部署教程和操作文档。嗯。。。再看一眼组件版本，嗯。。。

算了，还是用我自己的基于pod的方法部署吧，不过这样就还需要多一层k8s支撑
### k8s部署管理平台选型
kubernetes相关部署管理工具较多，我是不推荐自己手动一步步部署的

这里我用的是： kubeoperator

使用wsl-docker作为kubeoperator的管理端，将k8s部署到3台机器上
平时需要用的时候再启动win11上的docker就行 

按公网教程一步步操作即可，这里有个坑：
主机的ip只能填ip不能填hostname，虽然填的时候不会报错，但是在生成k8s证书的时候会失败！