<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æˆ‘çš„æœåŠ¡å™¨ç³»åˆ—ï¼šæ€»ä½“è®¾è®¡</title>
      <link href="//my-server-overall-design/"/>
      <url>//my-server-overall-design/</url>
      
        <content type="html"><![CDATA[<p>ä¸å®šæœŸæ›´æ–°çš„æœåŠ¡å™¨æ”»ç•¥æŒ‡å—ã€‚<br>è®°å½•æœåŠ¡å™¨çš„é…ç½®ç®¡ç†ã€è½¯ä»¶å®‰è£…ç­‰ä¿¡æ¯ï¼Œå’Œé™„å¸¦æ–‡ç« ç´¢å¼•ã€‚</p><span id="more"></span><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>2022.4æ›´æ–°ï¼šæŠŠç¬”è®°æœ¬æ‰”äº†ï¼Œä¹°äº†nasæœåŠ¡å™¨ï¼ˆå¹¶å‡çº§åˆ°16gå†…å­˜ï¼‰<br>æœ¬æ–‡è®°å½•å¯¹æœåŠ¡å™¨ï¼ˆ2äº‘+1NASï¼‰çš„è§„åˆ’ã€ç®¡ç†è¿‡ç¨‹ï¼Œå¹¶åˆ†äº«ä¸€äº›ç»éªŒå¿ƒå¾—ã€‚</p><h2 id="ä¸€-èµ„æºæ€»è§ˆ"><a href="#ä¸€-èµ„æºæ€»è§ˆ" class="headerlink" title="ä¸€ èµ„æºæ€»è§ˆ"></a>ä¸€ èµ„æºæ€»è§ˆ</h2><h3 id="1-åŸŸå"><a href="#1-åŸŸå" class="headerlink" title="1 åŸŸå"></a>1 åŸŸå</h3><p>åŸŸåå³å…¥å£ï¼Œç°æœ‰å·²å¤‡æ¡ˆåŸŸåä¸€ä¸ªï¼š linshenkx.cn </p><h3 id="2-äº‘æœåŠ¡å™¨"><a href="#2-äº‘æœåŠ¡å™¨" class="headerlink" title="2 äº‘æœåŠ¡å™¨"></a>2 äº‘æœåŠ¡å™¨</h3><p>äº‘æœåŠ¡å™¨éƒ½æ˜¯ä¹°äº†3å¹´çš„ï¼Œæœ‰å…¬ç½‘ip</p><table><thead><tr><th>åç§°</th><th>èµ„æº</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>uc</td><td>2c8g1m,40g</td><td>ä¸»æœåŠ¡å™¨</td></tr><tr><td>tx</td><td>2c4g3m,50g+400g</td><td>å­˜å‚¨æœåŠ¡å™¨</td></tr></tbody></table><h3 id="3-æœåŠ¡å™¨"><a href="#3-æœåŠ¡å™¨" class="headerlink" title="3 æœåŠ¡å™¨"></a>3 æœåŠ¡å™¨</h3><p>é—²ç½®ç¬”è®°æœ¬å› ä¸ºæ€§èƒ½å­±å¼±ï¼Œä¸”å¹´ä¹…å¤±ä¿®ï¼Œä¸ç»æŠ˜è…¾ï¼Œä¾¿é¢†äº†ç›’é¥­å…‰è£é€€ä¼‘äº†ã€‚</p><p>æ–°ä¸Šä»»çš„æ˜¯å¨è”é€šçš„ts262cï¼Œé»˜è®¤2c2gæˆ‘ç»™å®ƒå‡çº§åˆ°16gï¼Œèƒ½è£…dockerï¼ŒåŠŸè€—åˆä½ï¼Œå°±å½“æ˜¯è¿·ä½ æœåŠ¡å™¨äº†ã€‚</p><h2 id="äºŒ-ç»„ç½‘æ–¹æ¡ˆï¼ˆVPNï¼‰"><a href="#äºŒ-ç»„ç½‘æ–¹æ¡ˆï¼ˆVPNï¼‰" class="headerlink" title="äºŒ ç»„ç½‘æ–¹æ¡ˆï¼ˆVPNï¼‰"></a>äºŒ ç»„ç½‘æ–¹æ¡ˆï¼ˆVPNï¼‰</h2><p>ä»¥å‰æ˜¯ç”¨è’²å…¬è‹±çš„è·¨ç½‘ç»„ç½‘ï¼Œç°åœ¨å…¨éƒ¨å‡çº§åˆ° TailScaleã€‚æ–¹ä¾¿åˆå¥½ç”¨ã€‚<br>å¼€æºç‰ˆæœ¬å¯ä»¥ä½¿ç”¨ HeadScale,å‚è€ƒï¼š<a href="https://fuckcloudnative.io/posts/how-to-set-up-or-migrate-headscale">https://fuckcloudnative.io/posts/how-to-set-up-or-migrate-headscale</a> ã€‚<br><img src="https://lian-gallery.oss-cn-guangzhou.aliyuncs.com/img/20220327172113.png"></p><h2 id="ä¸‰-åŸŸåç®¡ç†ï¼ˆdnsï¼‰"><a href="#ä¸‰-åŸŸåç®¡ç†ï¼ˆdnsï¼‰" class="headerlink" title="ä¸‰ åŸŸåç®¡ç†ï¼ˆdnsï¼‰"></a>ä¸‰ åŸŸåç®¡ç†ï¼ˆdnsï¼‰</h2><h3 id="åŸŸåè§£æé…ç½®"><a href="#åŸŸåè§£æé…ç½®" class="headerlink" title="åŸŸåè§£æé…ç½®"></a>åŸŸåè§£æé…ç½®</h3><ol><li>ä¸»åŸŸå<br>æŒ‡å‘ä¸ªäººç½‘ç«™</li><li>tailscaleæ¬¡çº§åŸŸå<br>å¦‚ tx.linshenkx.cnã€uc.linshenkx.cnç­‰é…ç½®ä¸ºtailscaleåˆ†é…çš„IPï¼Œåªèƒ½é€šè¿‡vpnè®¿é—®ã€‚</li><li>å…¬ç½‘æœåŠ¡æ¬¡çº§åŸŸå<br>å¦‚ derperã€wiznoteç­‰éƒ½æŒ‡å‘äº‘æœåŠ¡çš„å…¬ç½‘ip</li><li>å…¶ä»–é€šé…ç¬¦åŸŸå<br>æŒ‡å‘ä¸ªäººç½‘ç«™</li></ol><h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><p>ç”±swagè´Ÿè´£è¯ä¹¦ç”³è¯·ã€ä½¿ç”¨ä»¥åŠç»­ç­¾ç­‰ï¼Œå¹¶å†…ç½®nginxå®ç°ä»£ç†ã€è·³è½¬ç­‰ã€‚</p><p>NginxæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œç»Ÿä¸€å°†http 301è·³åˆ°httpsè®¿é—®ã€‚<br>è€Œåœ¨httpså†…ï¼Œåˆ™æ ¹æ®äºŒçº§åŸŸåçš„å…·ä½“åç§°è½¬å‘åˆ°å¯¹åº”çš„æœåŠ¡ã€‚</p><p>æ•´ä¸ªè¿‡ç¨‹å¯¹äºæœåŠ¡åº”ç”¨æ¥è¯´æ˜¯é€æ˜çš„ï¼Œåº”ç”¨åªéœ€ç¡®ä¿ç›‘å¬ç«¯å£å³å¯ï¼Œæ— éœ€è€ƒè™‘åŸŸåå’Œsslé…ç½®ã€‚</p><h2 id="äºŒ-è§’è‰²åˆ†é…"><a href="#äºŒ-è§’è‰²åˆ†é…" class="headerlink" title="äºŒ è§’è‰²åˆ†é…"></a>äºŒ è§’è‰²åˆ†é…</h2><p>ç¦»çº¿æœåŠ¡å™¨ä¸»è¦ç”¨äºæ­å»ºå¤§æ•°æ®å¹³å°ï¼Œåšå®éªŒç”¨ï¼Œæš‚ä¸åˆ—å…¥</p><table><thead><tr><th>æœºå™¨</th><th>è§’è‰²ï¼ˆè½¯ä»¶ï¼‰</th><th>è¯´æ˜ï¼ˆåšå®¢é“¾æ¥ï¼‰</th></tr></thead><tbody><tr><td>nas</td><td>nasæœåŠ¡å™¨</td><td>å®¶ç”¨æœåŠ¡å™¨ï¼Œæœ‰è¾ƒé«˜çš„ç½‘ç»œå¸¦å®½ï¼Œè´Ÿè´£æ–‡ä»¶å­˜å‚¨ã€å®¶åº­å½±éŸ³ç­‰</td></tr><tr><td></td><td>clash(clash-web)</td><td>ç½‘ç»œç•…é€šæ˜¯ä¸€åˆ‡è¡ŒåŠ¨çš„å‰æï¼š<a href="https://www.linshenkx.cn/archives/clashdocker">æˆ‘çš„æœåŠ¡å™¨ç³»åˆ—ï¼šclash-dockerä½¿ç”¨å¹¶å®ç°è®¢é˜…é“¾æ¥è‡ªåŠ¨æ›´æ–°</a></td></tr><tr><td></td><td>swag</td><td>letsencrypt+nginx,å†ä¹Ÿä¸è¦çœ‹åˆ°ipå’Œç«¯å£ï¼Œä¸‡ç‰©çš†åœ¨https+åŸŸåä¹‹ä¸‹ï¼šæ–‡ç« å¾…æ•´ç†</td></tr><tr><td></td><td>ddns</td><td>åŠ¨æ€åŸŸåè§£æ</td></tr><tr><td></td><td>docker-registry</td><td>dockerç§æœ‰ä»“åº“ï¼ˆåŸæœ¬ä½¿ç”¨nexusï¼Œå¤ªé‡äº†ï¼Œæ²¡å¿…è¦ï¼‰</td></tr><tr><td></td><td>git-lfs-server</td><td>gitå¤§æ–‡ä»¶å­˜å‚¨ï¼ˆåŸæœ¬ä½¿ç”¨nexusï¼Œå¤ªé‡äº†ï¼Œæ²¡å¿…è¦ï¼‰</td></tr><tr><td></td><td>jellyfin</td><td>å®¶åº­å½±éŸ³</td></tr><tr><td>tx</td><td>ä¸»äº‘æœåŠ¡å™¨</td><td>ç½‘ç»œå¸¦å®½å’Œç£ç›˜ç©ºé—´è¾ƒå¤§ï¼Œä½†cpuå’Œå†…å­˜ä¸é«˜ï¼Œå­˜æ”¾ä¾›å…¬ç½‘è®¿é—®çš„æœåŠ¡ï¼Œå¦‚ï¼šä¸ªäººç½‘ç«™ã€æ•°æ®åº“ã€httpæ–‡ä»¶æœåŠ¡å™¨ç­‰ï¼Œ</td></tr><tr><td></td><td>swag</td><td>å¸¸è§„å¿…å¤‡ï¼Œå‚è€ƒå¦‚ä¸Š</td></tr><tr><td></td><td>http-file-server</td><td><a href="https://github.com/patrickdappollonio/http-server">ç®€å•å¥½ç”¨çš„httpæ–‡ä»¶æœåŠ¡å™¨</a></td></tr><tr><td></td><td>derper</td><td>tailscaleè‡ªå®šä¹‰derperæœåŠ¡å™¨</td></tr><tr><td></td><td>halo</td><td>ä¸ªäººåšå®¢:  <a href="https://www.linshenkx.cn/archives/myblogsystemdesign">ä¸ªäººåšå®¢ç³»ç»Ÿè®¾è®¡(æ”¯æŒhexoå’ŒhaloåŒæ­¥) </a></td></tr><tr><td></td><td>mysql</td><td>è‡ªåŠ¨å¤‡ä»½çš„æ•°æ®åº“ï¼š<a href="https://github.com/linshenkx/mysql-cron">é¢„è£…cronæœåŠ¡çš„mysqlé•œåƒ</a></td></tr><tr><td>uc</td><td>å¤‡ç”¨äº‘æœåŠ¡å™¨</td><td>å­˜æ”¾ä¸ªäººç¬”è®°ç­‰</td></tr><tr><td></td><td>swag</td><td>å¸¸è§„å¿…å¤‡ï¼Œå‚è€ƒå¦‚ä¸Š</td></tr><tr><td></td><td>halo</td><td>å¤‡ç”¨</td></tr><tr><td></td><td>mysql</td><td>å¤‡ç”¨</td></tr><tr><td></td><td>haloSyncServer</td><td><a href="https://www.linshenkx.cn/s/open-source-project">Haloåšå®¢åŒæ­¥å™¨ </a></td></tr><tr><td></td><td>wiznote</td><td>ä»å°è±¡ç¬”è®°åˆ°å¯ä»¥ç§æœ‰éƒ¨ç½²çš„ä¸ºçŸ¥ç¬”è®°ï¼šæ–‡ç« å¾…æ•´ç† ï¼ˆä¹Ÿå¯ä»¥çœ‹çœ‹joplinï¼Œä¼˜ç‚¹æ˜¯æ”¯æŒwebdavå¤‡ä»½ï¼Œæ”¯æŒè£å‰ªï¼Œç¼ºç‚¹æ˜¯ä¸‘ï¼Œå¯¼å…¥å°è±¡ç¬”è®°ç›®å½•ç»“æ„ä¼šä¸¢å¤±ï¼‰</td></tr><tr><td></td><td>random-image-api</td><td>é¢œå€¼å³æ­£ä¹‰ï¼š<a href="https://github.com/linshenkx/random-image-api">å¯¹æ¥äº†é˜¿é‡Œossçš„éšæœºå›¾api</a></td></tr></tbody></table><h2 id="ä¸‰-ç®¡ç†å·¥ç¨‹"><a href="#ä¸‰-ç®¡ç†å·¥ç¨‹" class="headerlink" title="ä¸‰ ç®¡ç†å·¥ç¨‹"></a>ä¸‰ ç®¡ç†å·¥ç¨‹</h2><p>ä¸ºäº†ä½¿æ¯ä¸ªæœåŠ¡å™¨ä½¿ç”¨çš„è½¯ä»¶åŠå…¶éƒ¨ç½²è¿‡ç¨‹æœ‰è¿¹å¯å¾ªï¼Œæˆ‘å¼€äº†ä¸€ä¸ªç§æœ‰ä»“åº“æ¥è·Ÿè¸ªè®°å½•ã€‚</p><p>å› ä¸ºæˆ‘å‡ ä¹æ‰€æœ‰è½¯ä»¶éƒ½æ˜¯ä»¥dockerå®¹å™¨å½¢å¼å®‰è£…è¿è¡Œçš„ï¼Œ<br>æ‰€ä»¥å®‰è£…ã€ç®¡ç†è¿‡ç¨‹éƒ½å¯ä»¥ç®€åŒ–ä¸ºdockerå‘½ä»¤è®°å½•åœ¨readme.mdé‡Œé¢ã€‚<br>è€Œä¸ªåˆ«éœ€è¦é¢å¤–é…ç½®æ–‡ä»¶çš„ä¹Ÿæ”¾åœ¨åŒçº§ç›®å½•ä¸‹ã€‚<br>è¿™æ ·ä»¥åæœåŠ¡å™¨è¿ç§»çš„æ—¶å€™ååˆ†æ–¹ä¾¿ï¼Œ<br>åªéœ€è¦æ ¹æ®dockerç›®å½•æŠŠæŒ‚è½½ç›®å½•è¿›è¡Œè¿ç§»å†è¿è¡Œdockerå‘½ä»¤å³å¯ã€‚<br>å¦å¤–dockerå‘½ä»¤ä¹Ÿå¯ä»¥ä½¿ç”¨docker-composeé…ç½®æ–‡ä»¶è¿›è¡Œå–ä»£ï¼Œæœ¬è´¨ä¸€æ ·ã€‚</p><p>å…¶ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">myserver:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">æœåŠ¡å™¨1:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">server.md</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">è½¯ä»¶1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">readme.md</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">è½¯ä»¶1çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">è½¯ä»¶2</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">readme.md</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">è½¯ä»¶2çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">è½¯ä»¶3</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">readme.md</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">æœåŠ¡å™¨2:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">è½¯ä»¶4</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">readme.md</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æˆ‘çš„æœåŠ¡å™¨ç³»åˆ— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç”Ÿäº§åŠ› </tag>
            
            <tag> æˆ‘çš„æœåŠ¡å™¨ç³»åˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘çš„æœåŠ¡å™¨ç³»åˆ—ï¼štailscaleä½¿ç”¨è‡ªå®šä¹‰derperæœåŠ¡å™¨ï¼ˆdockeréƒ¨ç½²ï¼‰</title>
      <link href="//tailscale-derper-docker/"/>
      <url>//tailscale-derper-docker/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨dockeréƒ¨ç½²tailscaleç§æœ‰ä¸­ç»§æœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨nginxå››å±‚ä»£ç†ä¸åŸæœ‰æœåŠ¡å…±ç”¨443ç«¯å£ï¼Œæœ€åé…ç½®ä½¿ç”¨å¹¶æ£€æµ‹ã€‚<br>derper-dockeréƒ¨ç½²åŠä½¿ç”¨è¾ƒéº»çƒ¦ï¼Œæœ¬æ–‡åˆ†äº«è¸©å‘è®°å½•åŠç»éªŒï¼Œå»ºè®®é˜…è¯»ã€‚</p><span id="more"></span><h2 id="ä¸€-è®¾è®¡åŠå‚è€ƒ"><a href="#ä¸€-è®¾è®¡åŠå‚è€ƒ" class="headerlink" title="ä¸€ è®¾è®¡åŠå‚è€ƒ"></a>ä¸€ è®¾è®¡åŠå‚è€ƒ</h2><h3 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h3><ol><li>ä½¿ç”¨DockerHubä¸Šé¢å”¯ä¸€ä¸»æµçš„derperé•œåƒè¿›è¡Œéƒ¨ç½²ï¼Œä¿è¯å¯é æ€§</li><li>ä½¿ç”¨nginxå››å±‚ä»£ç†è½¬å‘443ç«¯å£è¯·æ±‚åˆ°derperå®¹å™¨</li><li>åœ¨tailscaleä¸Šé¢é…ç½®ä½¿ç”¨derperæœåŠ¡å™¨</li><li>æµ‹è¯•derperçš„è¿é€š<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3>æ¨èé˜…è¯»ï¼š<br>å®˜æ–¹è¯´æ˜ï¼ˆ<a href="https://tailscale.com/kb/1118/custom-derp-servers/%EF%BC%89">https://tailscale.com/kb/1118/custom-derp-servers/ï¼‰</a><br>TAILSCALE çš„ä¸€äº›ä½¿ç”¨å¿ƒå¾—ï¼ˆ<a href="https://leitalk.com/12245%EF%BC%89">https://leitalk.com/12245ï¼‰</a><br>Tailscale åŸºç¡€æ•™ç¨‹ï¼šéƒ¨ç½²ç§æœ‰ DERP ä¸­ç»§æœåŠ¡å™¨ï¼ˆ<a href="https://icloudnative.io/posts/custom-derp-servers%EF%BC%89">https://icloudnative.io/posts/custom-derp-serversï¼‰</a></li></ol><h2 id="äºŒ-éƒ¨ç½²derperå®¹å™¨"><a href="#äºŒ-éƒ¨ç½²derperå®¹å™¨" class="headerlink" title="äºŒ éƒ¨ç½²derperå®¹å™¨"></a>äºŒ éƒ¨ç½²derperå®¹å™¨</h2><p>å‚è€ƒï¼š<a href="https://hub.docker.com/r/fredliang/derper">https://hub.docker.com/r/fredliang/derper</a><br>ä¸‹é¢æ˜¯æˆ‘ä¸ªäººçš„é…ç½®<br>æ³¨æ„ï¼š</p><ol><li>sslè¯ä¹¦<br>sslè¯ä¹¦å¯å¤–éƒ¨æŒ‚è½½æˆ–ç”±å®¹å™¨è‡ªåŠ¨ç”³è¯·å¹¶ç»´æŠ¤è¯ä¹¦æ›´æ–°ï¼ˆåŸºäºLetsEncryptï¼‰<br>å› ä¸ºderperä½¿ç”¨çš„sslè¯ä¹¦æœ‰æ ¼å¼å’Œå‘½åè¦æ±‚ï¼ŒæŒ‚è½½ä½¿ç”¨å¾ˆä¸ä¼˜é›…ï¼Œæ•…æ”¾å¼ƒè¯¥æ–¹æ¡ˆ<br>è€Œè‡ªåŠ¨ç”³è¯·éœ€è¦ä½¿ç”¨443ç«¯å£ï¼Œå› ä¸ºæˆ‘443ç«¯å£å·²ç»ä½¿ç”¨äº†ï¼Œæ‰€ä»¥éœ€è¦ç”¨nginx streamåå‘ä»£ç†çš„å½¢å¼åš443ç«¯å£4å±‚è½¬å‘ã€‚<br>åæ–‡ä¼šè¿›è¡Œè¯¦ç»†è¯´æ˜ã€‚</li><li>3478ç«¯å£ä¸èƒ½ä¿®æ”¹ï¼Œå› ä¸ºèµ°udpæ‰€ä»¥ä¹Ÿä¸å»ºè®®è½¬å‘ã€‚</li><li>å¦‚æœä½¿ç”¨DERP_VERIFY_CLIENTSåˆ™éœ€è¦æŒ‚è½½tailscaled.sockï¼Œä½¿å®¹å™¨èƒ½è®¿é—®åˆ°å¤–éƒ¨æœºå™¨derperè¿›ç¨‹ã€‚<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/derper/certs</span><br><span class="line">docker rm -f derper</span><br><span class="line"></span><br><span class="line">docker run -d \</span><br><span class="line">-p 3443:443 \</span><br><span class="line">-p 3478:3478/udp \</span><br><span class="line">--name derper \</span><br><span class="line">--restart=always \</span><br><span class="line">-v /data/derper/certs:/app/certs \</span><br><span class="line">-v /var/run/tailscale/tailscaled.sock:/var/run/tailscale/tailscaled.sock \</span><br><span class="line">-e DERP_ADDR=&quot;:443&quot; \</span><br><span class="line">-e DERP_VERIFY_CLIENTS=true \</span><br><span class="line">-e DERP_DOMAIN=&quot;derper.linshenkx.cn&quot; \</span><br><span class="line">fredliang/derper</span><br><span class="line"></span><br><span class="line">docker logs -f derper</span><br><span class="line"></span><br></pre></td></tr></table></figure><img src="https://lian-gallery.oss-cn-guangzhou.aliyuncs.com/img/1652431206.png" alt="derperæœåŠ¡å™¨"><h3 id="ä¸‰-nginxä»£ç†é…ç½®"><a href="#ä¸‰-nginxä»£ç†é…ç½®" class="headerlink" title="ä¸‰ nginxä»£ç†é…ç½®"></a>ä¸‰ nginxä»£ç†é…ç½®</h3>è™½ç„¶æœ‰äº›äººè¯´derperè¿è¡Œä¸€æ®µæ—¶é—´å°±ä¼šå´©æºƒï¼ˆ<a href="https://github.com/tailscale/tailscale/issues/4082">Derper TLS handshake error: remote error: tls: internal error </a>ï¼‰ï¼Œ<br>ä½†æˆ‘æ²¡æœ‰é‡åˆ°è¿‡ï¼ŒæŒ‰ç…§<a href="https://github.com/tailscale/tailscale/issues/4082">å®˜æ–¹issue</a>å’Œ<a href="https://leitalk.com/12245">TAILSCALE çš„ä¸€äº›ä½¿ç”¨å¿ƒå¾—</a>é‡Œçš„è¯´æ³•ï¼Œå¯èƒ½å’Œå¢™/å¤‡æ¡ˆæœ‰å…³ã€‚</li></ol><blockquote><p>é¡ºå¸¦ä¸€æï¼Œå¦‚è…¾è®¯äº‘è¿™æ ·çš„å›½å†…äº‘æœåŠ¡å™¨æä¾›å•†ï¼Œä¼šå®¡æŸ¥ TLS handshake é‡Œçš„ SNI ä¿¡æ¯ï¼Œ å¦‚æœå‘ç° SNI åŸŸåæœªå¤‡æ¡ˆï¼Œä¼šé˜»æ–­ TLS æ¡æ‰‹ã€‚ æ‰€ä»¥ï¼Œæˆ‘æ›¾ç»ä¹Ÿå°è¯•è¿‡ç”¨ä¸€ä¸ªå¢ƒå¤–æœåŠ¡å™¨çš„åŸŸåï¼Œç„¶åæŒ‡å‘åˆ°å¢ƒå†…æœåŠ¡å™¨ IP çš„å½¢å¼å°è¯•ç»•è¿‡å¤‡æ¡ˆï¼Œ ç„¶è€ŒçŸ­æš‚çš„ç”¨äº†å‡ åˆ†é’Ÿåï¼Œå°±é‡åˆ°äº† tls handshake reset çš„é—®é¢˜ã€‚ ç›®å‰çœ‹æ¥ï¼Œåªè¦ä½ æƒ³ç”¨å¢ƒå†…æœåŠ¡å™¨ï¼Œé‚£ä¹ˆå¤‡æ¡ˆå°±æ˜¯ç»•ä¸è¿‡çš„é—®é¢˜ã€‚<br>Ps. å¦‚æœä½ æœ‰å¤‡æ¡ˆåŸŸåï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ nginx stream åå‘ä»£ç†çš„å½¢å¼åš 443 ç«¯å£ 4 å±‚è½¬å‘ã€‚ nginx stream å¯ä»¥åœ¨å››å±‚æ¢æµ‹ SNI ä¿¡æ¯ï¼Œç„¶ååˆ†å‘åˆ°ä¸åŒçš„åç«¯ï¼Œè¿™æ ·ä½  derper çš„ 443 å’Œå…¶ä»–åŸŸåçš„ 443 å°±å¯ä»¥å…±å­˜åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šäº†ã€‚</p></blockquote><p>è¿™é‡Œä¸»è¦çŸ¥è¯†ç‚¹æ˜¯ï¼š</p><ol><li>TLS handshake é‡Œçš„ SNI ä¿¡æ¯</li><li>nginxå››å±‚è´Ÿè½½å‡è¡¡</li></ol><p>å…·ä½“é…ç½®å‚è€ƒæˆ‘çš„å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼šTODO</p><h3 id="å››-tailscaleé…ç½®"><a href="#å››-tailscaleé…ç½®" class="headerlink" title="å›› tailscaleé…ç½®"></a>å›› tailscaleé…ç½®</h3><p>Access Controsé…ç½®å†…å®¹å‚è€ƒå¦‚ä¸‹ï¼š<br>ä¸»è¦æ˜¯æ·»åŠ äº†derpMapï¼Œå…¶ä»–éƒ½ä¿æŒé»˜è®¤ã€‚<br>å¦‚æœæœ‰å¤šä¸ªderperæœåŠ¡å™¨ï¼Œå»ºè®®é…ç½®ä¸ºå¤šä¸ªregionè€Œénodeã€‚<br>å› ä¸ºå»¶è¿Ÿçš„æ¯”è¾ƒæ˜¯ä»¥regionä¸ºå•ä½çš„ï¼Œä¼šæ–¹ä¾¿æµ‹è¯•ã€‚</p><p>ä¸€å¼€å§‹ä¸ç¡®å®šderperæ˜¯å¦è¿è¡Œæ­£å¸¸çš„æ—¶å€™ï¼Œå»ºè®®å…ˆæŠŠOmitDefaultRegionsè®¾ç½®ä¸ºtrueï¼Œå…³é—­é»˜è®¤çš„regionã€‚</p><p>å¦å¤–ï¼Œä¿®æ”¹Access Controsåï¼Œéœ€è¦é‡å¯tailscaleæœåŠ¡æ‰èƒ½ç”Ÿæ•ˆï¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">// Example/default ACLs for unrestricted connections.</span><br><span class="line">&#123;</span><br><span class="line">  // Declare static groups of users beyond those in the identity service.</span><br><span class="line">  &quot;groups&quot;: &#123;</span><br><span class="line">    &quot;group:example&quot;: [ &quot;user1@example.com&quot;, &quot;user2@example.com&quot; ],</span><br><span class="line">  &#125;,</span><br><span class="line">  // Declare convenient hostname aliases to use in place of IP addresses.</span><br><span class="line">  &quot;hosts&quot;: &#123;</span><br><span class="line">    &quot;example-host-1&quot;: &quot;100.100.100.100&quot;,</span><br><span class="line">  &#125;,</span><br><span class="line">  // Access control lists.</span><br><span class="line">  &quot;acls&quot;: [</span><br><span class="line">    // Match absolutely everything. Comment out this section if you want</span><br><span class="line">    // to define specific ACL restrictions.</span><br><span class="line">    &#123; &quot;action&quot;: &quot;accept&quot;, &quot;users&quot;: [&quot;*&quot;], &quot;ports&quot;: [&quot;*:*&quot;] &#125;,</span><br><span class="line">  ]</span><br><span class="line">  ,</span><br><span class="line">  &quot;derpMap&quot;: &#123;</span><br><span class="line">    &quot;OmitDefaultRegions&quot;: false</span><br><span class="line">    ,</span><br><span class="line">    &quot;Regions&quot;: &#123;</span><br><span class="line">      &quot;900&quot;: &#123;</span><br><span class="line">      &quot;RegionID&quot;: 900,</span><br><span class="line">      &quot;RegionCode&quot;: &quot;lian&quot;,</span><br><span class="line">      &quot;RegionName&quot;: &quot;LIAN&quot;,</span><br><span class="line">      &quot;Nodes&quot;: [&#123;</span><br><span class="line">          &quot;Name&quot;: &quot;tx&quot;,</span><br><span class="line">          &quot;RegionID&quot;: 900,</span><br><span class="line">          &quot;HostName&quot;: &quot;derper.linshenkx.cn&quot;,</span><br><span class="line">          &quot;DERPPort&quot;: 443</span><br><span class="line">      &#125;</span><br><span class="line">     ]</span><br><span class="line">    &#125;</span><br><span class="line">    //   ,</span><br><span class="line">    //   &quot;901&quot;: &#123;</span><br><span class="line">    //   &quot;RegionID&quot;: 901,</span><br><span class="line">    //   &quot;RegionCode&quot;: &quot;lian2&quot;,</span><br><span class="line">    //   &quot;RegionName&quot;: &quot;LIAN2&quot;,</span><br><span class="line">    //   &quot;Nodes&quot;: [&#123;</span><br><span class="line">    //       &quot;Name&quot;: &quot;uc&quot;,</span><br><span class="line">    //       &quot;RegionID&quot;: 901,</span><br><span class="line">    //       &quot;HostName&quot;: &quot;derper2.linshenkx.cn&quot;,</span><br><span class="line">    //       &quot;DERPPort&quot;: 443</span><br><span class="line">    //   &#125;</span><br><span class="line">    //  ]</span><br><span class="line">    // &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äº”-æµ‹è¯•ä½¿ç”¨derper"><a href="#äº”-æµ‹è¯•ä½¿ç”¨derper" class="headerlink" title="äº” æµ‹è¯•ä½¿ç”¨derper"></a>äº” æµ‹è¯•ä½¿ç”¨derper</h3><p>ç›¸å…³å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ˜¾ç¤ºé›†ç¾¤çŠ¶æ€</span></span><br><span class="line">tailscale status</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¾ç¤ºç½‘ç»œçŠ¶æ€</span></span><br><span class="line">tailscale netcheck</span><br><span class="line">tailscale ping èŠ‚ç‚¹</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹å›¾ï¼Œè‡ªå®šä¹‰çš„derperæ¯”é»˜è®¤çš„å»¶è¿Ÿè¦ä½ä¸ä¸Šã€‚<br>ï¼ˆä¸è¿‡åªæœ‰åœ¨æç«¯æƒ…å†µä¸‹æµé‡æ‰ä¼šèµ°derperï¼Œé€šå¸¸derperåªè¦è¿å¾—ä¸Šå°±è¡Œï¼Œæ‰€ä»¥å»¶è¿Ÿå½±å“ä¸å¤§ï¼‰<br><img src="https://lian-gallery.oss-cn-guangzhou.aliyuncs.com/img/1652430906(1).png" alt="tailscale netcheck"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæ˜¾ç¤ºä¸€åˆ‡æ­£å¸¸ï¼Œä¸ä»£è¡¨derperå°±æ˜¯åœ¨æ­£å¸¸å·¥ä½œäº†ã€‚<br>åªæ˜¯è¯´èƒ½è®¿é—®åˆ° <a href="https://derper.linshenkx.cn/">https://derper.linshenkx.cn</a> è€Œå·²ã€‚</p><p>å…³é”®è¿˜æ˜¯è¦çœ‹pingã€‚<br><img src="https://lian-gallery.oss-cn-guangzhou.aliyuncs.com/img/1652431460(1).png" alt="tailscale ping"><br>å¦‚å›¾ï¼Œä»£è¡¨äº†å‡ ç§æƒ…å†µï¼š</p><ol><li>tx.linshenkx.cn<br>å…ˆé€šè¿‡DERP(sfo)è¿æ¥ï¼Œç„¶åæ‰“æ´æˆåŠŸï¼Œè¿›åŒ–ä¸ºip:ç«¯å£ç›´è¿</li><li>uc.linshenkx.cn<br>è¯†åˆ«åˆ°æ˜¯æœ¬æœº</li><li>lian.linshenkx.cn<br>å°è¯•é€šè¿‡DERP(lian)è¿æ¥ï¼Œä½†å¤±è´¥ï¼ˆå› ä¸ºå¯¹æ–¹tailscaleæœåŠ¡å¼‚å¸¸ï¼‰</li><li>nas.linshenkx.cn<br>å…ˆé€šè¿‡DERP(lian)è¿æ¥ï¼Œç„¶åæ‰“æ´æˆåŠŸï¼Œè¿›åŒ–ä¸ºip:ç«¯å£ç›´è¿</li></ol><p>derperæ—¥å¿—ç±»ä¼¼å¦‚ä¸‹<br><img src="https://lian-gallery.oss-cn-guangzhou.aliyuncs.com/img/1652431977(1).png" alt="docker logs -f derper"></p>]]></content>
      
      
      <categories>
          
          <category> æˆ‘çš„æœåŠ¡å™¨ç³»åˆ— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> æˆ‘çš„æœåŠ¡å™¨ç³»åˆ— </tag>
            
            <tag> tailscale </tag>
            
            <tag> derper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘çš„æœåŠ¡å™¨ç³»åˆ—ï¼šclash-dockerä½¿ç”¨å¹¶å®ç°è®¢é˜…é“¾æ¥è‡ªåŠ¨æ›´æ–°</title>
      <link href="//clash_docker/"/>
      <url>//clash_docker/</url>
      
        <content type="html"><![CDATA[<p>clash dockeré•œåƒä½¿ç”¨ç¬”è®°ï¼Œä»¥åŠå¸¸ç”¨ä»£ç†é…ç½®æ–¹æ³•ã€‚<br>2022.5æœˆæ›´æ–°ï¼šæ›´æ–°ä½¿ç”¨è®¢é˜…é“¾æ¥æ•™ç¨‹ï¼Œå®Œå–„é…ç½®å¹¶è‡ªåŠ¨é€‰æ‹©æœ€å¿«èŠ‚ç‚¹<br>2022.3æœˆæ›´æ–°ï¼šä½¿ç”¨è®¢é˜…é“¾æ¥å¹¶è‡ªåŠ¨æ›´æ–°é˜²æ­¢ä»£ç†å¤±æ•ˆï¼Œå¹¶å¢åŠ webç«¯ç®¡ç†åŠŸèƒ½</p><span id="more"></span><h2 id="ä¸€-è®¾è®¡æ€è·¯åŠæ­¥éª¤"><a href="#ä¸€-è®¾è®¡æ€è·¯åŠæ­¥éª¤" class="headerlink" title="ä¸€ è®¾è®¡æ€è·¯åŠæ­¥éª¤"></a>ä¸€ è®¾è®¡æ€è·¯åŠæ­¥éª¤</h2><h3 id="1-è·å–clashè®¢é˜…é“¾æ¥"><a href="#1-è·å–clashè®¢é˜…é“¾æ¥" class="headerlink" title="1. è·å–clashè®¢é˜…é“¾æ¥"></a>1. è·å–clashè®¢é˜…é“¾æ¥</h3><p>   ï¼ˆä¸è¦é—®æˆ‘æ€ä¹ˆè·å–ï¼‰</p><h3 id="2-å°†clashè®¢é˜…é“¾æ¥è½¬æ¢æˆClashçš„Proxy-Provider"><a href="#2-å°†clashè®¢é˜…é“¾æ¥è½¬æ¢æˆClashçš„Proxy-Provider" class="headerlink" title="2. å°†clashè®¢é˜…é“¾æ¥è½¬æ¢æˆClashçš„Proxy Provider"></a>2. å°†clashè®¢é˜…é“¾æ¥è½¬æ¢æˆClashçš„Proxy Provider</h3><p>   å‚è€ƒ <a href="https://github.com/qier222/proxy-provider-converter">https://github.com/qier222/proxy-provider-converter</a><br>   æ‡’å¾—éƒ¨ç½²çš„è¯å¯ä»¥ç”¨ä½œè€…çš„ <a href="https://proxy-provider-converter.vercel.app/">https://proxy-provider-converter.vercel.app</a><br>   æˆ–è€…æ˜¯æˆ‘çš„ <a href="https://proxy-provider-converter-sooty.vercel.app/">https://proxy-provider-converter-sooty.vercel.app</a><br>   ç”¨æˆ‘çš„ä¼šå®‰å…¨ä¸€ç‚¹ï¼Œå› ä¸ºæˆ‘è¿˜ä¸çŸ¥é“æ€ä¹ˆæŸ¥çœ‹åˆ°ä¸Šé¢çš„è®¢é˜…åœ°å€</p><h3 id="3-é…ç½®Proxy-Provider"><a href="#3-é…ç½®Proxy-Provider" class="headerlink" title="3. é…ç½®Proxy Provider"></a>3. é…ç½®Proxy Provider</h3><p>   åœ¨clashé…ç½®æ–‡ä»¶ä¸­é…ç½®Proxy Providerï¼Œå®ç°ä»£ç†æœåŠ¡å™¨åˆ—è¡¨çš„è‡ªåŠ¨æ›´æ–°<br>   clashé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ä»è®¢é˜…é“¾æ¥ä¸‹è½½å¾—åˆ°ï¼Œå†ä¿®æ”¹å³å¯ã€‚æˆ–è€…æˆ‘åé¢è´´å‡ºæ¥è‡ªç”¨çš„ã€‚</p><h3 id="4-å¯åŠ¨clash"><a href="#4-å¯åŠ¨clash" class="headerlink" title="4. å¯åŠ¨clash"></a>4. å¯åŠ¨clash</h3><p>å¯åŠ¨dreamacro/clashå®¹å™¨ï¼ŒåŠ è½½é…ç½®æ–‡ä»¶ï¼Œè¿›è¡ŒclashæœåŠ¡</p><h3 id="5-å¯åŠ¨clash-web"><a href="#5-å¯åŠ¨clash-web" class="headerlink" title="5. å¯åŠ¨clash-web"></a>5. å¯åŠ¨clash-web</h3><p>   å¯åŠ¨haishanh/yacdå®¹å™¨ï¼Œå¯¹clashè¿›è¡Œwebç®¡ç†<br>   å¯ä»¥ç›´æ¥ç”¨ä½œè€…éƒ¨ç½²çš„ï¼š<a href="http://yacd.haishan.me/">http://yacd.haishan.me</a></p><h2 id="äºŒ-clashé…ç½®æ–‡ä»¶"><a href="#äºŒ-clashé…ç½®æ–‡ä»¶" class="headerlink" title="äºŒ clashé…ç½®æ–‡ä»¶"></a>äºŒ clashé…ç½®æ–‡ä»¶</h2><p>ä¸»è¦ä¿®æ”¹åœ°æ–¹æ˜¯åœ¨proxy-providerså’Œproxy-groupsã€‚</p><p>rulesæ˜¯æ ¹æ®proxy-groupsé…ç½®çš„ï¼Œæ•°é‡æ¯”è¾ƒå¤šï¼Œå…·ä½“å‚è€ƒä»è®¢é˜…åœ°å€å¾—åˆ°çš„clashé…ç½®æ–‡ä»¶ã€‚æˆ–è€…è‡ªå·±ä»ç½‘ä¸Šè·å–ï¼Œè¿™äº›æ˜¯æ¯”è¾ƒé€šç”¨çš„ã€‚</p><p>å¯ä»¥çœ‹åˆ°proxy-groupsä¸­çš„é…ç½®éƒ½å¼•ç”¨äº†<code>use: [&#39;LIAN&#39;]</code>æ¥å¯¼å…¥èŠ‚ç‚¹é…ç½®ã€‚<br>ä¸”ä½¿ç”¨äº† url-test æ¥è‡ªåŠ¨é€‰å‡ºæœ€å¿«çš„ä»£ç†ã€‚</p><p>é»˜è®¤clashé…ç½®æ–‡ä»¶ï¼š<br><img src="https://lian-gallery.oss-cn-guangzhou.aliyuncs.com/img/1652843670(1).png" alt="é»˜è®¤clashé…ç½®æ–‡ä»¶"></p><p>ä¿®æ”¹ä¹‹åçš„clashé…ç½®æ–‡ä»¶ï¼š<br><img src="https://lian-gallery.oss-cn-guangzhou.aliyuncs.com/img/1652845276(1).png" alt="ä¿®æ”¹ä¹‹åçš„clashé…ç½®æ–‡ä»¶"></p><p>ä½¿ç”¨æ•ˆæœï¼Œä»¥<strong>ç”µæŠ¥æ¶ˆæ¯</strong>ä¸ºä¾‹ï¼Œé»˜è®¤ä½¿ç”¨ä»£ç†æ˜¯<strong>èŠ‚ç‚¹é€‰æ‹©</strong>ï¼Œ<br>è€Œ<strong>èŠ‚ç‚¹é€‰æ‹©</strong>ä½¿ç”¨çš„ä»£ç†æ˜¯<strong>è‡ªåŠ¨é€‰æ‹©</strong>ï¼Œæ‰€ä»¥<strong>ç”µæŠ¥æ¶ˆæ¯</strong>é»˜è®¤ä½¿ç”¨çš„ä»£ç†æ˜¯èŠ‚ç‚¹æ± æœ€å¿«çš„èŠ‚ç‚¹ã€‚<br><img src="https://lian-gallery.oss-cn-guangzhou.aliyuncs.com/img/1652845859(1).png" alt="ä½¿ç”¨æ•ˆæœ"></p><p>å‚è€ƒé…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#port: 7890</span></span><br><span class="line"><span class="comment">#socks-port: 7891</span></span><br><span class="line"><span class="comment">#redir-port: 7892</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ··åˆç«¯å£</span></span><br><span class="line"><span class="attr">mixed-port:</span> <span class="number">7890</span></span><br><span class="line"><span class="comment"># éƒ¨ç½²åœ¨å…¬ç½‘ï¼Œå…³é—­lan</span></span><br><span class="line"><span class="attr">allow-lan:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">bind-address:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">mode:</span> <span class="string">Rule</span></span><br><span class="line"><span class="attr">log-level:</span> <span class="string">info</span></span><br><span class="line"><span class="attr">ipv6:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">hosts:</span></span><br><span class="line">  <span class="attr">services.googleapis.cn:</span> <span class="number">216.58</span><span class="number">.200</span><span class="number">.67</span></span><br><span class="line">  <span class="attr">www.google.cn:</span> <span class="number">216.58</span><span class="number">.200</span><span class="number">.67</span></span><br><span class="line"><span class="comment"># å¤–éƒ¨ç®¡ç†IPå’Œç«¯å£</span></span><br><span class="line"><span class="attr">external-controller:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:29090</span></span><br><span class="line"><span class="comment"># å¤–éƒ¨ç®¡ç†å¯†ç </span></span><br><span class="line"><span class="attr">secret:</span> <span class="string">&#x27;123456&#x27;</span></span><br><span class="line"><span class="attr">clash-for-android:</span></span><br><span class="line">  <span class="attr">append-system-dns:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">profile:</span></span><br><span class="line">  <span class="attr">tracing:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">dns:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">listen:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8853</span></span><br><span class="line">  <span class="attr">default-nameserver:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">223.5</span><span class="number">.5</span><span class="number">.5</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">1.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">ipv6:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">enhanced-mode:</span> <span class="string">fake-ip</span></span><br><span class="line">  <span class="attr">fake-ip-filter:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;*.lan&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">stun.*.*.*</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">stun.*.*</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time.windows.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time.nist.gov</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time.apple.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time.asia.apple.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;*.ntp.org.cn&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;*.openwrt.pool.ntp.org&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time1.cloud.tencent.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time.ustc.edu.cn</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">pool.ntp.org</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ntp.ubuntu.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ntp.aliyun.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ntp1.aliyun.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ntp2.aliyun.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ntp3.aliyun.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ntp4.aliyun.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ntp5.aliyun.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ntp6.aliyun.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ntp7.aliyun.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time1.aliyun.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time2.aliyun.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time3.aliyun.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time4.aliyun.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time5.aliyun.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time6.aliyun.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time7.aliyun.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;*.time.edu.cn&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time1.apple.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time2.apple.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time3.apple.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time4.apple.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time5.apple.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time6.apple.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time7.apple.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time1.google.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time2.google.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time3.google.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">time4.google.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">music.163.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;*.music.163.com&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;*.126.net&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">musicapi.taihe.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">music.taihe.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">songsearch.kugou.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">trackercdn.kugou.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;*.kuwo.cn&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">api-jooxtt.sanook.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">api.joox.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">joox.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">y.qq.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;*.y.qq.com&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">streamoc.music.tc.qq.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mobileoc.music.tc.qq.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">isure.stream.qqmusic.qq.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">dl.stream.qqmusic.qq.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">aqqmusic.tc.qq.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">amobile.music.tc.qq.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;*.xiami.com&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;*.music.migu.cn&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">music.migu.cn</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;*.msftconnecttest.com&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;*.msftncsi.com&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">localhost.ptlogin2.qq.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;*.*.*.srv.nintendo.net&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;*.*.stun.playstation.net&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">xbox.*.*.microsoft.com</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;*.ipv6.microsoft.com&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;*.*.xboxlive.com&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">speedtest.cros.wr.pvp.net</span></span><br><span class="line">  <span class="attr">nameserver:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">https://223.6.6.6/dns-query</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">https://rubyfish.cn/dns-query</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">https://dns.pub/dns-query</span></span><br><span class="line">  <span class="attr">fallback:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">https://dns.rubyfish.cn/dns-query</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">https://public.dns.iij.jp/dns-query</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tls://8.8.4.4</span></span><br><span class="line">  <span class="attr">fallback-filter:</span></span><br><span class="line">    <span class="attr">geoip:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">ipcidr:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">240.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/4</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/32</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">/32</span></span><br><span class="line">    <span class="attr">domain:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">+.google.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">+.facebook.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">+.twitter.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">+.youtube.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">+.xn--ngstr-lra8j.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">+.google.cn</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">+.googleapis.cn</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">+.googleapis.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">+.gvt1.com</span></span><br><span class="line"><span class="attr">proxy-providers:</span></span><br><span class="line">  <span class="attr">LIAN:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œå¡«proxy-provider-converterè½¬æ¢å¾—åˆ°çš„é“¾æ¥</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://proxy-provider-converter-sooty.vercel.app/api/convert?url=***&amp;target=clash</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="number">3600</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./sub.paasmi.com.yaml</span></span><br><span class="line">    <span class="attr">health-check:</span></span><br><span class="line">      <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">interval:</span> <span class="number">600</span></span><br><span class="line">      <span class="comment"># lazy: true</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">http://www.gstatic.com/generate_204</span></span><br><span class="line"><span class="attr">proxy-groups:</span></span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;â™»ï¸ è‡ªåŠ¨é€‰æ‹©&#x27;</span>, <span class="attr">type:</span> <span class="string">url-test</span>, <span class="attr">url:</span> <span class="string">&#x27;http://www.gstatic.com/generate_204&#x27;</span>, <span class="attr">interval:</span> <span class="number">300</span>, <span class="attr">tolerance:</span> <span class="number">50</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;ğŸš€ èŠ‚ç‚¹é€‰æ‹©&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">&#x27;â™»ï¸ è‡ªåŠ¨é€‰æ‹©&#x27;</span>, <span class="string">DIRECT</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;ğŸ“² ç”µæŠ¥æ¶ˆæ¯&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">&#x27;ğŸš€ èŠ‚ç‚¹é€‰æ‹©&#x27;</span>, <span class="string">&#x27;â™»ï¸ è‡ªåŠ¨é€‰æ‹©&#x27;</span>, <span class="string">DIRECT</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;ğŸ“¹ æ²¹ç®¡è§†é¢‘&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">&#x27;ğŸš€ èŠ‚ç‚¹é€‰æ‹©&#x27;</span>, <span class="string">&#x27;â™»ï¸ è‡ªåŠ¨é€‰æ‹©&#x27;</span>, <span class="string">DIRECT</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;ğŸ¥ å¥ˆé£è§†é¢‘&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">&#x27;ğŸš€ èŠ‚ç‚¹é€‰æ‹©&#x27;</span>, <span class="string">&#x27;â™»ï¸ è‡ªåŠ¨é€‰æ‹©&#x27;</span>, <span class="string">DIRECT</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;ğŸ“º å·´å“ˆå§†ç‰¹&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">&#x27;ğŸš€ èŠ‚ç‚¹é€‰æ‹©&#x27;</span>, <span class="string">&#x27;â™»ï¸ è‡ªåŠ¨é€‰æ‹©&#x27;</span>, <span class="string">DIRECT</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;ğŸ“º å“”å“©å“”å“©&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">&#x27;ğŸš€ èŠ‚ç‚¹é€‰æ‹©&#x27;</span>, <span class="string">&#x27;â™»ï¸ è‡ªåŠ¨é€‰æ‹©&#x27;</span>, <span class="string">DIRECT</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;ğŸŒ å›½å¤–åª’ä½“&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">&#x27;ğŸš€ èŠ‚ç‚¹é€‰æ‹©&#x27;</span>, <span class="string">&#x27;â™»ï¸ è‡ªåŠ¨é€‰æ‹©&#x27;</span>, <span class="string">DIRECT</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;ğŸŒ å›½å†…åª’ä½“&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">DIRECT</span>, <span class="string">&#x27;ğŸš€ èŠ‚ç‚¹é€‰æ‹©&#x27;</span>, <span class="string">&#x27;â™»ï¸ è‡ªåŠ¨é€‰æ‹©&#x27;</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;ğŸ“¢ è°·æ­ŒFCM&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">&#x27;ğŸš€ èŠ‚ç‚¹é€‰æ‹©&#x27;</span>, <span class="string">&#x27;â™»ï¸ è‡ªåŠ¨é€‰æ‹©&#x27;</span>, <span class="string">DIRECT</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;â“‚ï¸ å¾®è½¯äº‘ç›˜&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">DIRECT</span>, <span class="string">&#x27;ğŸš€ èŠ‚ç‚¹é€‰æ‹©&#x27;</span>, <span class="string">&#x27;â™»ï¸ è‡ªåŠ¨é€‰æ‹©&#x27;</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;â“‚ï¸ å¾®è½¯æœåŠ¡&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">DIRECT</span>, <span class="string">&#x27;ğŸš€ èŠ‚ç‚¹é€‰æ‹©&#x27;</span>, <span class="string">&#x27;â™»ï¸ è‡ªåŠ¨é€‰æ‹©&#x27;</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;ğŸ è‹¹æœæœåŠ¡&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">DIRECT</span>, <span class="string">&#x27;ğŸš€ èŠ‚ç‚¹é€‰æ‹©&#x27;</span>, <span class="string">&#x27;â™»ï¸ è‡ªåŠ¨é€‰æ‹©&#x27;</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;ğŸ® æ¸¸æˆå¹³å°&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">DIRECT</span>, <span class="string">&#x27;ğŸš€ èŠ‚ç‚¹é€‰æ‹©&#x27;</span>, <span class="string">&#x27;â™»ï¸ è‡ªåŠ¨é€‰æ‹©&#x27;</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;ğŸ¶ ç½‘æ˜“éŸ³ä¹&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">DIRECT</span>, <span class="string">&#x27;ğŸš€ èŠ‚ç‚¹é€‰æ‹©&#x27;</span>, <span class="string">&#x27;â™»ï¸ è‡ªåŠ¨é€‰æ‹©&#x27;</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;ğŸ¯ å…¨çƒç›´è¿&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">DIRECT</span>, <span class="string">&#x27;ğŸš€ èŠ‚ç‚¹é€‰æ‹©&#x27;</span>, <span class="string">&#x27;â™»ï¸ è‡ªåŠ¨é€‰æ‹©&#x27;</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;ğŸƒ åº”ç”¨å‡€åŒ–&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">REJECT</span>, <span class="string">DIRECT</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;ğŸ›‘ å¹¿å‘Šæ‹¦æˆª&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">REJECT</span>, <span class="string">DIRECT</span>, <span class="string">&#x27;ğŸ¯ å…¨çƒç›´è¿&#x27;</span>] &#125;</span><br><span class="line">    <span class="bullet">-</span> &#123; <span class="attr">name:</span> <span class="string">&#x27;ğŸŸ æ¼ç½‘ä¹‹é±¼&#x27;</span>, <span class="attr">type:</span> <span class="string">select</span>, <span class="attr">use:</span> [<span class="string">&#x27;LIAN&#x27;</span>], <span class="attr">proxies:</span> [<span class="string">&#x27;ğŸ¯ å…¨çƒç›´è¿&#x27;</span>, <span class="string">&#x27;ğŸš€ èŠ‚ç‚¹é€‰æ‹©&#x27;</span>, <span class="string">DIRECT</span>] &#125;</span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;DOMAIN-SUFFIX,acl4.ssr,ğŸ¯ å…¨çƒç›´è¿&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;DOMAIN-SUFFIX,ip6-localhost,ğŸ¯ å…¨çƒç›´è¿&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;DOMAIN-SUFFIX,ip6-loopback,ğŸ¯ å…¨çƒç›´è¿&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;DOMAIN-SUFFIX,local,ğŸ¯ å…¨çƒç›´è¿&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;DOMAIN-SUFFIX,localhost,ğŸ¯ å…¨çƒç›´è¿&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="ä¸‰-å¯åŠ¨clash"><a href="#ä¸‰-å¯åŠ¨clash" class="headerlink" title="ä¸‰ å¯åŠ¨clash"></a>ä¸‰ å¯åŠ¨clash</h2><h3 id="dockerå¯åŠ¨"><a href="#dockerå¯åŠ¨" class="headerlink" title="dockerå¯åŠ¨"></a>dockerå¯åŠ¨</h3><p>éœ€è‡ªè¡Œæä¾›config.yaml æ–‡ä»¶ï¼Œè¿™é‡Œæ¨èç›´æ¥ä½¿ç”¨hostç½‘ç»œï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨127.0.0.1 7890ä½œä¸ºä»£ç†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run --name clash --network host --restart=always  -v /opt/clash/config.yaml:/root/.config/clash/config.yaml -d dreamacro/clash </span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¸¸è§„å®‰è£…"><a href="#å¸¸è§„å®‰è£…" class="headerlink" title="å¸¸è§„å®‰è£…"></a>å¸¸è§„å®‰è£…</h3><p>å¦‚æœæ²¡æœ‰å®‰è£…dockerçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å¸¸è§„æ–¹æ³•å¯åŠ¨</p><ol><li>ä¸‹è½½<br><a href="https://github.com/Dreamacro/clash/releases">https://github.com/Dreamacro/clash/releases</a></li><li>é…ç½®<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gzip -d clash-linux-amd64-v1.5.0.gz</span><br><span class="line">mkdir /opt/clash</span><br><span class="line">mv clash-linux-amd64-v1.5.0 /opt/clash/clash</span><br><span class="line">echo &quot;/opt/clash/clash &gt;/opt/clash/start.out 2&gt;&amp;1  &amp;&quot; &gt;&gt; /opt/clash/start.sh</span><br><span class="line">chmod -R +x  /opt/clash/</span><br><span class="line"></span><br></pre></td></tr></table></figure>æŠŠé…ç½®æ–‡ä»¶æ”¾åˆ°/root/.config/clash ä¸‹å–ä»£é»˜è®¤çš„config.yaml</li><li>å¯åŠ¨<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh /opt/clash/start.sh </span><br></pre></td></tr></table></figure></li><li>æŸ¥çœ‹clashå¯åŠ¨æ—¥å¿—<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -n 100 -f /opt/clash/start.out</span><br></pre></td></tr></table></figure></li></ol><h2 id="å››-å®‰è£…clash-web-haishanh-yacd"><a href="#å››-å®‰è£…clash-web-haishanh-yacd" class="headerlink" title="å›› å®‰è£…clash-web(haishanh/yacd)"></a>å›› å®‰è£…clash-web(haishanh/yacd)</h2><p>è¿æ¥çš„æ—¶å€™å¡«å†™ <a href="http://clashæœºå™¨ip:clash-controllerç«¯å£ï¼Œä»¥åŠsecretå¯†ç ã€‚">http://clashæœºå™¨ip:clash-controllerç«¯å£ï¼Œä»¥åŠsecretå¯†ç ã€‚</a><br>å¯†ç å’Œç«¯å£éƒ½åœ¨ä¸Šé¢clashé…ç½®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run --restart=always  -p 7880:80 -d  --name clash-web haishanh/yacd</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="äº”-ä½¿ç”¨ä»£ç†æœåŠ¡"><a href="#äº”-ä½¿ç”¨ä»£ç†æœåŠ¡" class="headerlink" title="äº” ä½¿ç”¨ä»£ç†æœåŠ¡"></a>äº” ä½¿ç”¨ä»£ç†æœåŠ¡</h2><h3 id="1-linuxç³»ç»Ÿè®¾ç½®ä»£ç†"><a href="#1-linuxç³»ç»Ÿè®¾ç½®ä»£ç†" class="headerlink" title="1 linuxç³»ç»Ÿè®¾ç½®ä»£ç†"></a>1 linuxç³»ç»Ÿè®¾ç½®ä»£ç†</h3><p>åœ¨ /etc/profile æ·»åŠ all_proxyé…ç½®<br>no_proxyåˆ™é…ç½®ä¸èµ°ä»£ç†ï¼Œæ³¨æ„è¿™å’Œclashçš„ç›´è¿è¿˜ä¸ä¸€æ ·ã€‚<br>å¦‚ *.linshenkx.cnå¯¹åº”ipä¸ºtailscaleå†…ç½‘ipï¼Œå¤–éƒ¨æ— æ³•è®¿é—®<br>è¿™æ—¶å¦‚æœä½¿ç”¨clashçš„ç›´è¿åˆ™ä¼šæé†’è¿æ¥å¤±è´¥ï¼Œè€Œé…ç½®åœ¨no_proxyåˆ™ä¼šè®©å…¶èµ°tailscaleçš„ä»£ç†æˆåŠŸè®¿é—®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;export all_proxy=&quot;http://127.0.0.1:7890&quot;&#x27;&gt;&gt; /etc/profile</span><br><span class="line">echo &#x27;export no_proxy=&quot;127.0.0.1,*.linshenkx.cn&quot;&#x27;&gt;&gt; /etc/profile</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-javaç¨‹åºè®¾ç½®ä»£ç†"><a href="#2-javaç¨‹åºè®¾ç½®ä»£ç†" class="headerlink" title="2 javaç¨‹åºè®¾ç½®ä»£ç†"></a>2 javaç¨‹åºè®¾ç½®ä»£ç†</h3><p>æµ‹è¯•æ—¶ï¼Œåœ¨é€šè¿‡ä»£ç æ–¹å¼æ·»åŠ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.setProperty(<span class="string">&quot;proxyHost&quot;</span>, <span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line">System.setProperty(<span class="string">&quot;proxyPort&quot;</span>, <span class="string">&quot;7890&quot;</span>);</span><br></pre></td></tr></table></figure><p>å‘å¸ƒæ—¶ï¼Œå»ºè®®é€šè¿‡jvmå‚æ•°é…ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-DsocksProxyHost=127.0.0.1 -DsocksProxyPort=7890</span><br><span class="line">-Dhttp.proxyHost=127.0.0.1 -Dhttp.proxyPort=7890</span><br><span class="line">-Dhttps.proxyHost=127.0.0.1 -Dhttps.proxyPort=7890</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹ï¼Œä¸ºä½¿ç”¨ç³»ç»Ÿä»£ç†æ–¹å¼å¯åŠ¨haloï¼Œè¿™æ ·å°±å¯ä»¥åœ¨haloçš„ç®¡ç†ç•Œé¢ä½¿ç”¨åœ¨çº¿ä¸‹è½½ã€æ›´æ–°ä¸»é¢˜åŠŸèƒ½äº†ï¼Œå¦åˆ™githubè¿æ¥è¿‡æ…¢ä¸»é¢˜åŸºæœ¬æ— æ³•åœ¨çº¿ä¸‹è½½</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -d --name halo --network host -e JVM_OPTS=&quot;-Dhttp.proxyHost=127.0.0.1 -Dhttp.proxyPort=7890 -Dhttps.proxyHost=127.0.0.1 -Dhttps.proxyPort=7890&quot; -v /opt/halo/workspace:/root/.halo --restart=always halohub/halo</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æˆ‘çš„æœåŠ¡å™¨ç³»åˆ— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> ç”Ÿäº§åŠ› </tag>
            
            <tag> clash </tag>
            
            <tag> æˆ‘çš„æœåŠ¡å™¨ç³»åˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PySparkè‡ªå®šä¹‰Transformer</title>
      <link href="//pyspark-transformer/"/>
      <url>//pyspark-transformer/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨pythonå®ç°è‡ªå®šä¹‰Transformerä»¥å¯¹pysparkçš„pipelineè¿›è¡Œå¢å¼º</p><span id="more"></span><h3 id="ä¸€-ç¤ºä¾‹"><a href="#ä¸€-ç¤ºä¾‹" class="headerlink" title="ä¸€ ç¤ºä¾‹"></a>ä¸€ ç¤ºä¾‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> keyword_only</span><br><span class="line"><span class="keyword">from</span> pyspark.ml <span class="keyword">import</span> Transformer</span><br><span class="line"><span class="keyword">from</span> pyspark.ml.param.shared <span class="keyword">import</span> HasOutputCols, Param, Params</span><br><span class="line"><span class="keyword">from</span> pyspark.ml.util <span class="keyword">import</span> DefaultParamsReadable, DefaultParamsWritable</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SelectColsTransformer</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="class">    Transformer, DefaultParamsReadable, DefaultParamsWritable</span></span></span><br><span class="line"><span class="params"><span class="class"></span>):</span></span><br><span class="line">    cols = Param(</span><br><span class="line">        Params._dummy(),</span><br><span class="line">        <span class="string">&quot;cols&quot;</span>,</span><br><span class="line">        <span class="string">&quot;cols to select&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="meta">    @keyword_only</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, cols:<span class="built_in">list</span>[<span class="built_in">float</span>]=[<span class="string">&#x27;*&#x27;</span>]</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(SelectColsTransformer, self).__init__()</span><br><span class="line">        self._setDefault(cols=[<span class="string">&#x27;*&#x27;</span>])</span><br><span class="line">        kwargs = self._input_kwargs</span><br><span class="line">        self.setParams(**kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">    @keyword_only</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setParams</span>(<span class="params">self, cols:<span class="built_in">list</span>[<span class="built_in">float</span>]=[<span class="string">&#x27;*&#x27;</span>]</span>):</span></span><br><span class="line">        kwargs = self._input_kwargs</span><br><span class="line">        <span class="keyword">return</span> self._<span class="built_in">set</span>(**kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_transform</span>(<span class="params">self, dataset</span>):</span></span><br><span class="line">        <span class="keyword">return</span> dataset.select(self.getOrDefault(self.cols));</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pyspark </tag>
            
            <tag> transformer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PySparkå­¦ä¹ ç¬”è®°</title>
      <link href="//pyspark-notes/"/>
      <url>//pyspark-notes/</url>
      
        <content type="html"><![CDATA[<p>pysparkä½¿ç”¨ç¬”è®°ï¼Œå«1.jupyter-dockerç¯å¢ƒæ­å»º 2.dataframe2jdbc,jdbc2dataframe 3.æ¨¡å‹è®­ç»ƒåŠä¿å­˜ 4.æ¨¡å‹å¯¼å…¥åŠä½¿ç”¨ ç­‰ã€‚</p><span id="more"></span><h3 id="ä¸€-ç¯å¢ƒéƒ¨ç½²"><a href="#ä¸€-ç¯å¢ƒéƒ¨ç½²" class="headerlink" title="ä¸€ ç¯å¢ƒéƒ¨ç½²"></a>ä¸€ ç¯å¢ƒéƒ¨ç½²</h3><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè®¿é—® ip:18804å³å¯ï¼Œå¯†ç ä¸ºï¼šmy-password<br>é•œåƒä½¿ç”¨å‚è€ƒï¼š<a href="https://jupyter-docker-stacks.readthedocs.io/en/latest">https://jupyter-docker-stacks.readthedocs.io/en/latest</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/pyspark &amp;&amp; chmod 777 -R /data/pyspark</span><br><span class="line"></span><br><span class="line">docker run -d \</span><br><span class="line">--name my-spark-notebook \</span><br><span class="line">--restart=always \</span><br><span class="line">-e GRANT_SUDO=yes \</span><br><span class="line">-v /data/pyspark:/home/jovyan \</span><br><span class="line">--network host \</span><br><span class="line">jupyter/all-spark-notebook \</span><br><span class="line">start.sh jupyter lab \</span><br><span class="line">--NotebookApp.password=&#x27;sha1:7cca89c48283:e3c1f9fbc06d1d2aa59555dfd5beed925e30dd2c&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="äºŒ-dataframeå¯¼å‡ºæ•°æ®åº“"><a href="#äºŒ-dataframeå¯¼å‡ºæ•°æ®åº“" class="headerlink" title="äºŒ dataframeå¯¼å‡ºæ•°æ®åº“"></a>äºŒ dataframeå¯¼å‡ºæ•°æ®åº“</h3><p>å‚è€ƒï¼š</p><ol><li><a href="https://spark.apache.org/docs/latest/api/python/user_guide/pandas_on_spark/from_to_dbms.html">https://spark.apache.org/docs/latest/api/python/user_guide/pandas_on_spark/from_to_dbms.html</a></li><li><a href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.sql.DataFrameWriter.jdbc.html?highlight=dataframewriter">https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.sql.DataFrameWriter.jdbc.html?highlight=dataframewriter</a></li></ol><p>åœ¨jupyteræ‰“å¼€çš„ç»ˆç«¯ç•Œé¢ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä¸‹è½½mysqlé©±åŠ¨åŒ…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.28/mysql-connector-java-8.0.28.jar</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹ï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkContext</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SQLContext</span><br><span class="line"><span class="keyword">from</span> pyspark.ml.feature <span class="keyword">import</span> VectorAssembler</span><br><span class="line"><span class="keyword">from</span> pyspark.ml.regression <span class="keyword">import</span> LinearRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_boston</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd </span><br><span class="line"><span class="keyword">from</span> pyspark.ml <span class="keyword">import</span> Pipeline</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.master(<span class="string">&#x27;local&#x27;</span>) \</span><br><span class="line">.appName(<span class="string">&quot;pyspark-lian&quot;</span>) \</span><br><span class="line">.config(<span class="string">&quot;spark.jars&quot;</span>,<span class="string">&quot;&#123;&#125;/mysql-connector-java-8.0.28.jar&quot;</span>.<span class="built_in">format</span>(os.getcwd())) \</span><br><span class="line">.config(<span class="string">&quot;spark.driver.extraClassPath&quot;</span>,<span class="string">&quot;&#123;&#125;/mysql-connector-java-8.0.28.jar&quot;</span>.<span class="built_in">format</span>(os.getcwd())) \</span><br><span class="line">.getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">boston = load_boston()</span><br><span class="line">df_boston = pd.DataFrame(boston.data,columns=boston.feature_names)</span><br><span class="line">df_boston[<span class="string">&#x27;target&#x27;</span>] = pd.Series(boston.target)</span><br><span class="line"><span class="built_in">print</span>(df_boston.head())</span><br><span class="line"></span><br><span class="line">sqlContext = SQLContext(sc)</span><br><span class="line"></span><br><span class="line">data = sqlContext.createDataFrame(df_boston)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(data))</span><br><span class="line"><span class="built_in">print</span>(data.printSchema())</span><br><span class="line"></span><br><span class="line">data.write.jdbc(table=<span class="string">&#x27;df_boston&#x27;</span>,mode=<span class="string">&#x27;overwrite&#x27;</span>,url=<span class="string">&#x27;jdbc:mysql://localhost:3306/test?createDatabaseIfNotExist=true&amp;useSSL=false&#x27;</span>,properties=&#123;<span class="string">&#x27;user&#x27;</span>:<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;123456&#x27;</span>&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ä¸‰-è¯»å–mysqlæ•°æ®å®Œæˆçº¿æ€§å›å½’å¹¶å¯¼å‡ºæ¨¡å‹æ–‡ä»¶"><a href="#ä¸‰-è¯»å–mysqlæ•°æ®å®Œæˆçº¿æ€§å›å½’å¹¶å¯¼å‡ºæ¨¡å‹æ–‡ä»¶" class="headerlink" title="ä¸‰ è¯»å–mysqlæ•°æ®å®Œæˆçº¿æ€§å›å½’å¹¶å¯¼å‡ºæ¨¡å‹æ–‡ä»¶"></a>ä¸‰ è¯»å–mysqlæ•°æ®å®Œæˆçº¿æ€§å›å½’å¹¶å¯¼å‡ºæ¨¡å‹æ–‡ä»¶</h3><p>å‚è€ƒï¼š<a href="https://www.datatechnotes.com/2021/05/mllib-linear-regression-example-with.html">https://www.datatechnotes.com/2021/05/mllib-linear-regression-example-with.html</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">from pyspark.sql import SparkSession</span><br><span class="line">import pyspark.pandas as ps</span><br><span class="line">import os</span><br><span class="line">from pyspark import SparkContext</span><br><span class="line">from pyspark.sql import SQLContext</span><br><span class="line">from pyspark.ml.feature import VectorAssembler</span><br><span class="line">from pyspark.ml.regression import LinearRegression</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">from sklearn.datasets import load_boston</span><br><span class="line">import pandas as pd </span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.master(&#x27;local&#x27;) \</span><br><span class="line">.appName(&quot;pyspark-lian&quot;) \</span><br><span class="line">.config(&quot;spark.jars&quot;,&quot;&#123;&#125;/mysql-connector-java-8.0.28.jar&quot;.format(os.getcwd())) \</span><br><span class="line">.config(&quot;spark.driver.extraClassPath&quot;,&quot;&#123;&#125;/mysql-connector-java-8.0.28.jar&quot;.format(os.getcwd())) \</span><br><span class="line">.getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">df_boston = ps.read_sql(&#x27;df_boston&#x27;, &#x27;jdbc:mysql://localhost:3306/test?createDatabaseIfNotExist=true&amp;useSSL=false&amp;user=root&amp;password=123456&#x27;)</span><br><span class="line">print(type(df_boston))</span><br><span class="line">print(df_boston.head())</span><br><span class="line">data = df_boston.to_spark()</span><br><span class="line">print(type(data))</span><br><span class="line">print(data.printSchema()) </span><br><span class="line"> </span><br><span class="line">columns=data.columns</span><br><span class="line">print(columns)</span><br><span class="line">columns.remove(&#x27;target&#x27;)</span><br><span class="line">print(columns)</span><br><span class="line"></span><br><span class="line">va = VectorAssembler(inputCols=columns, outputCol=&#x27;features&#x27;)</span><br><span class="line">print(data.count())</span><br><span class="line">va_df = va.transform(data.limit(200))</span><br><span class="line">va_df = va_df.select([&#x27;features&#x27;, &#x27;target&#x27;])</span><br><span class="line">va_df.show(3)</span><br><span class="line"> </span><br><span class="line">lr=LinearRegression(featuresCol=&#x27;features&#x27;, labelCol=&#x27;target&#x27;,</span><br><span class="line">                    regParam=0.3, elasticNetParam=0.8)</span><br><span class="line"></span><br><span class="line">lr_model = lr.fit(va_df)</span><br><span class="line">print(type(lr_model))</span><br><span class="line">print(&quot;Coefficients: &quot;, lr_model.coefficients)</span><br><span class="line">print(&quot;Intercept: &quot;, lr_model.intercept)</span><br><span class="line"></span><br><span class="line">print(&quot;MSE: &quot;, lr_model.summary.meanSquaredError)</span><br><span class="line">print(&quot;MAE: &quot;, lr_model.summary.meanAbsoluteError)</span><br><span class="line">print(&quot;R-squared: &quot;, lr_model.summary.r2) </span><br><span class="line">  </span><br><span class="line">lr_model.save(&#x27;LinearRegressionModel_model&#x27;)</span><br><span class="line"></span><br><span class="line">mdata = lr_model.transform(va_df)</span><br><span class="line">mdata.show(3) </span><br><span class="line"> </span><br><span class="line">x_ax = range(0, mdata.count())</span><br><span class="line">y_pred = mdata.select(&quot;prediction&quot;).collect()</span><br><span class="line">y_orig = mdata.select(&quot;target&quot;).collect()  </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Stop session</span> </span><br><span class="line">sc.stop()  </span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å››-åŠ è½½æ¨¡å‹å¹¶è¿›è¡Œé¢„æµ‹"><a href="#å››-åŠ è½½æ¨¡å‹å¹¶è¿›è¡Œé¢„æµ‹" class="headerlink" title="å›› åŠ è½½æ¨¡å‹å¹¶è¿›è¡Œé¢„æµ‹"></a>å›› åŠ è½½æ¨¡å‹å¹¶è¿›è¡Œé¢„æµ‹</h3><p>æ³¨æ„ LinearRegressionModel å’Œ LinearRegression çš„å…³ç³»ã€‚<br>åœ¨ä¸Šä¸€æ­¥ LinearRegression fitä¹‹åäº§ç”ŸLinearRegressionModelå¹¶ä¿å­˜ä¸ºæ–‡ä»¶ã€‚<br>ç°åœ¨å†ä½¿ç”¨ LinearRegressionModelçš„loadæ–¹æ³•ä»æ–‡ä»¶é‡æ–°åŠ è½½å›æ¥è¿›è¡Œ transform ã€‚</p><p>å‚è€ƒpipelineçš„æ¦‚å¿µçš„è¯ï¼š<br>LinearRegression æ˜¯ Estimator<br>è€Œ LinearRegressionModel æ˜¯ Transformer</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">import</span> pyspark.pandas <span class="keyword">as</span> ps</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkContext</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SQLContext</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_boston</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> pyspark.ml <span class="keyword">as</span> ml</span><br><span class="line"><span class="keyword">import</span> pyspark <span class="keyword">as</span> pyspark</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.master(<span class="string">&#x27;local&#x27;</span>) \</span><br><span class="line">.appName(<span class="string">&quot;pyspark-lian&quot;</span>) \</span><br><span class="line">.config(<span class="string">&quot;spark.jars&quot;</span>,<span class="string">&quot;&#123;&#125;/mysql-connector-java-8.0.28.jar&quot;</span>.<span class="built_in">format</span>(os.getcwd())) \</span><br><span class="line">.config(<span class="string">&quot;spark.driver.extraClassPath&quot;</span>,<span class="string">&quot;&#123;&#125;/mysql-connector-java-8.0.28.jar&quot;</span>.<span class="built_in">format</span>(os.getcwd())) \</span><br><span class="line">.getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">result_mysqlSource = ps.read_sql(<span class="string">&#x27;df_boston&#x27;</span>, <span class="string">&#x27;jdbc:mysql://localhost:3306/test?createDatabaseIfNotExist=true&amp;useSSL=false&amp;user=root&amp;password=123456&#x27;</span>).to_spark()</span><br><span class="line">result_transition0=result_mysqlSource</span><br><span class="line"></span><br><span class="line">va = pyspark.ml.feature.VectorAssembler()</span><br><span class="line">va.setParams(inputCols=[<span class="string">&#x27;CRIM&#x27;</span>,<span class="string">&#x27;ZN&#x27;</span>,<span class="string">&#x27;INDUS&#x27;</span>,<span class="string">&#x27;CHAS&#x27;</span>,<span class="string">&#x27;NOX&#x27;</span>,<span class="string">&#x27;RM&#x27;</span>,<span class="string">&#x27;AGE&#x27;</span>,<span class="string">&#x27;DIS&#x27;</span>,<span class="string">&#x27;RAD&#x27;</span>,<span class="string">&#x27;TAX&#x27;</span>,<span class="string">&#x27;PTRATIO&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;LSTAT&#x27;</span>])</span><br><span class="line">va.setParams(outputCol=<span class="string">&#x27;features&#x27;</span>)</span><br><span class="line">result_va=va.transform(result_transition0)</span><br><span class="line"></span><br><span class="line">lr_model = pyspark.ml.regression.LinearRegressionModel.load(<span class="string">&#x27;file:///home/jovyan/LinearRegressionModel_model_2&#x27;</span>)</span><br><span class="line">result_lr_model=lr_model.transform(result_va)</span><br><span class="line"></span><br><span class="line">result_lr_model.select([<span class="string">&#x27;CRIM&#x27;</span>,<span class="string">&#x27;ZN&#x27;</span>,<span class="string">&#x27;INDUS&#x27;</span>,<span class="string">&#x27;CHAS&#x27;</span>,<span class="string">&#x27;NOX&#x27;</span>,<span class="string">&#x27;RM&#x27;</span>,<span class="string">&#x27;AGE&#x27;</span>,<span class="string">&#x27;DIS&#x27;</span>,<span class="string">&#x27;RAD&#x27;</span>,<span class="string">&#x27;TAX&#x27;</span>,<span class="string">&#x27;PTRATIO&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;LSTAT&#x27;</span>,<span class="string">&#x27;target&#x27;</span>,<span class="string">&#x27;prediction&#x27;</span>]) \</span><br><span class="line">.write.jdbc(table=<span class="string">&#x27;df_boston_result&#x27;</span>,mode=<span class="string">&#x27;overwrite&#x27;</span>,url=<span class="string">&#x27;jdbc:mysql://localhost:3306/test?createDatabaseIfNotExist=true&amp;useSSL=false&#x27;</span>,properties=&#123;<span class="string">&#x27;user&#x27;</span>:<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;123456&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">sc.stop()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="äº”-ä½¿ç”¨-pipeline-æ”¹é€ "><a href="#äº”-ä½¿ç”¨-pipeline-æ”¹é€ " class="headerlink" title="äº” ä½¿ç”¨ pipeline æ”¹é€ "></a>äº” ä½¿ç”¨ pipeline æ”¹é€ </h3><p>å‚è€ƒï¼š<a href="https://spark.apache.org/docs/latest/ml-pipeline.html">https://spark.apache.org/docs/latest/ml-pipeline.html</a><br>éƒ¨åˆ†ä¸­æ–‡ç¿»è¯‘å‚è€ƒï¼š <a href="https://zhuanlan.zhihu.com/p/33619687">https://zhuanlan.zhihu.com/p/33619687</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">import</span> pyspark.pandas <span class="keyword">as</span> ps</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkContext</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SQLContext</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_boston</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> pyspark.ml <span class="keyword">as</span> ml</span><br><span class="line"><span class="keyword">import</span> pyspark <span class="keyword">as</span> pyspark</span><br><span class="line"><span class="keyword">from</span> pyspark.ml <span class="keyword">import</span> Pipeline</span><br><span class="line"><span class="keyword">from</span> pyspark.ml <span class="keyword">import</span> PipelineModel</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">spark = SparkSession.builder.master(<span class="string">&#x27;local&#x27;</span>) \</span><br><span class="line">.appName(<span class="string">&quot;pyspark-lin&quot;</span>) \</span><br><span class="line">.config(<span class="string">&quot;spark.jars&quot;</span>,<span class="string">&quot;&#123;&#125;/mysql-connector-java-8.0.28.jar&quot;</span>.<span class="built_in">format</span>(os.getcwd())) \</span><br><span class="line">.config(<span class="string">&quot;spark.driver.extraClassPath&quot;</span>,<span class="string">&quot;&#123;&#125;/mysql-connector-java-8.0.28.jar&quot;</span>.<span class="built_in">format</span>(os.getcwd())) \</span><br><span class="line">.getOrCreate()</span><br><span class="line">sc = spark.sparkContext</span><br><span class="line"></span><br><span class="line">result_mysqlSource = ps.read_sql(<span class="string">&#x27;df_boston&#x27;</span>, <span class="string">&#x27;jdbc:mysql://localhost:3306/test?createDatabaseIfNotExist=true&amp;useSSL=false&amp;user=root&amp;password=123456&#x27;</span>).to_spark()</span><br><span class="line">result_transition0=result_mysqlSource</span><br><span class="line"></span><br><span class="line">va = pyspark.ml.feature.VectorAssembler(inputCols=[<span class="string">&#x27;CRIM&#x27;</span>,<span class="string">&#x27;ZN&#x27;</span>,<span class="string">&#x27;INDUS&#x27;</span>,<span class="string">&#x27;CHAS&#x27;</span>,<span class="string">&#x27;NOX&#x27;</span>,<span class="string">&#x27;RM&#x27;</span>,<span class="string">&#x27;AGE&#x27;</span>,<span class="string">&#x27;DIS&#x27;</span>,<span class="string">&#x27;RAD&#x27;</span>,<span class="string">&#x27;TAX&#x27;</span>,<span class="string">&#x27;PTRATIO&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;LSTAT&#x27;</span>],outputCol=<span class="string">&#x27;features&#x27;</span>)</span><br><span class="line">lr_model = pyspark.ml.regression.LinearRegressionModel.load(<span class="string">&#x27;file:///home/jovyan/LinearRegressionModel_model&#x27;</span>)</span><br><span class="line">pipelineModel = PipelineModel(stages=[va, lr_model])</span><br><span class="line"></span><br><span class="line">result=pipelineModel.transform(result_mysqlSource);</span><br><span class="line"></span><br><span class="line">result.select([<span class="string">&#x27;CRIM&#x27;</span>,<span class="string">&#x27;ZN&#x27;</span>,<span class="string">&#x27;INDUS&#x27;</span>,<span class="string">&#x27;CHAS&#x27;</span>,<span class="string">&#x27;NOX&#x27;</span>,<span class="string">&#x27;RM&#x27;</span>,<span class="string">&#x27;AGE&#x27;</span>,<span class="string">&#x27;DIS&#x27;</span>,<span class="string">&#x27;RAD&#x27;</span>,<span class="string">&#x27;TAX&#x27;</span>,<span class="string">&#x27;PTRATIO&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;LSTAT&#x27;</span>,<span class="string">&#x27;target&#x27;</span>,<span class="string">&#x27;prediction&#x27;</span>]) \</span><br><span class="line">    .write.jdbc(table=<span class="string">&#x27;df_boston_result2&#x27;</span>,mode=<span class="string">&#x27;overwrite&#x27;</span>,url=<span class="string">&#x27;jdbc:mysql://localhost:3306/test?createDatabaseIfNotExist=true&amp;useSSL=false&#x27;</span>,properties=&#123;<span class="string">&#x27;user&#x27;</span>:<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;123456&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">sc.stop()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> pyspark </tag>
            
            <tag> jupyter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vbså®ç°winccæˆ–mysqlæ•°æ®å¯¼å‡ºæˆcsv</title>
      <link href="//vbs-wincc-mysql-csv/"/>
      <url>//vbs-wincc-mysql-csv/</url>
      
        <content type="html"><![CDATA[<p>å·¥ä½œè¦æ±‚ï¼Œéœ€è¦ç¼–å†™vbså®ç°å°†winccæ•°æ®å¯¼å‡ºï¼Œä¼°è®¡ä»¥åä¹Ÿæ²¡æœºä¼šå†æ¥è§¦è¿™é—¨å¤è‘£è¯­è¨€äº†ï¼Œæ‰€ä»¥å°±è®°å½•ä¸€ä¸‹ã€‚<br>å› ä¸ºwinccç”¨å¾—å¤ªå°‘äº†ï¼Œæµ‹è¯•ä¸­ä¼šä½¿ç”¨mysqlä»£æ›¿ã€‚</p><span id="more"></span><h3 id="ä¸šåŠ¡é€»è¾‘"><a href="#ä¸šåŠ¡é€»è¾‘" class="headerlink" title="ä¸šåŠ¡é€»è¾‘"></a>ä¸šåŠ¡é€»è¾‘</h3><ol><li>è¯»å–sql.txtæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­æ¯ä¸€è¡Œçš„æ ¼å¼ä¸º <strong>id:selectè¯­å¥</strong>ã€‚</li><li>è¿æ¥æ•°æ®åº“ï¼ŒæŒ‰è¡Œéå†æ‰§è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥è¯¢åˆ°çš„ç»“æœè¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹ï¼Œå¾—åˆ°ä»¥idå‘½åçš„csvæ–‡ä»¶ã€‚</li><li>å°†æ‰§è¡Œè¿‡ç¨‹ã€èŠ±è´¹æ—¶é—´è®°å½•èµ·æ¥ã€‚</li></ol><h3 id="æ“ä½œè¿‡ç¨‹"><a href="#æ“ä½œè¿‡ç¨‹" class="headerlink" title="æ“ä½œè¿‡ç¨‹"></a>æ“ä½œè¿‡ç¨‹</h3><ol><li>å‡†å¤‡sqlæ–‡æœ¬æ–‡ä»¶</li><li>å°†ä»£ç å¤åˆ¶åˆ°æ–‡æœ¬ç¼–è¾‘å™¨ä¸­ï¼Œä¿®æ”¹æ•°æ®åº“è¿æ¥å‚æ•°ã€sqlæ–‡æœ¬æ–‡ä»¶ä½ç½®ï¼Œè¾“å‡ºæ–‡ä»¶å¤¹ä½ç½®ï¼Œæ—¥å¿—æ–‡ä»¶ä½ç½®ç­‰</li><li>ä¿®æ”¹ä»£ç æ–‡ä»¶åç¼€ä¸ºvbs</li><li>ç›´æ¥æ‰§è¡Œè¯¥æ–‡ä»¶å³å¯</li><li>å¾—åˆ°csvæ–‡ä»¶<br><img src="https://lian-gallery.oss-cn-guangzhou.aliyuncs.com/img/1642602647(1).png" alt="ç¤ºä¾‹"></li></ol><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight vbs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">Sub</span> Main</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> fs =<span class="built_in">createobject</span>(<span class="string">&quot;scripting.filesystemobject&quot;</span>)</span><br><span class="line"><span class="keyword">set</span> sqlTxt=fs.opentextfile(<span class="string">&quot;C:\Users\15588\Desktop\vscode\sql.txt&quot;</span>,<span class="number">1</span>,<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">do</span> <span class="keyword">while</span> sqlTxt.atendofstream&lt;&gt;<span class="literal">true</span></span><br><span class="line">StartTime=Timer</span><br><span class="line">queryStr=sqlTxt.readline</span><br><span class="line">logs(<span class="string">&quot;å¼€å§‹æ‰§è¡Œ: &quot;</span> &amp; queryStr &amp; <span class="string">&quot;------------------------------&quot;</span>)</span><br><span class="line">queryStrArray=<span class="built_in">split</span>(queryStr,<span class="string">&quot;:&quot;</span>)</span><br><span class="line">id=queryStr<span class="built_in">Array</span>(<span class="number">0</span>)</span><br><span class="line">sSql=queryStr<span class="built_in">Array</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">Dim</span> db</span><br><span class="line"><span class="keyword">Set</span> db = <span class="keyword">New</span> MySQLDB</span><br><span class="line">db.Connect <span class="string">&quot;æ•°æ®åº“å&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;æ•°æ®åº“å¯†ç &quot;</span>, <span class="string">&quot;ip&quot;</span>, <span class="number">3306</span></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27; Set db = New WinccDB</span></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27; db.Connect &quot;WinCCOLEDBProvider.1&quot;, &quot;CC_wincctes_18_07_11_22_23_06R&quot;, &quot;WINCC-PC\WinCC&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> Err <span class="keyword">Then</span></span><br><span class="line">MsgBox Err.Description</span><br><span class="line">db.UnConnect</span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Call</span> queryToCsv(id, db.oConn,sSql,<span class="string">&quot;C:\Users\15588\Desktop\vscode\halodb\&quot;</span> &amp; id &amp; <span class="string">&quot;.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> Err <span class="keyword">Then</span></span><br><span class="line">MsgBox Err.Description</span><br><span class="line">db.UnConnect</span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">db.UnConnect</span><br><span class="line"><span class="keyword">Set</span> db = <span class="literal">Nothing</span></span><br><span class="line"></span><br><span class="line">EndTime=Timer</span><br><span class="line">Timelt=EndTime-StartTime</span><br><span class="line">logs(<span class="string">&quot;ç»“æŸæ‰§è¡Œ,è€—æ—¶ï¼ˆç§’ï¼‰:&quot;</span>&amp; Timelt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">loop</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Call</span> Main</span><br><span class="line"></span><br><span class="line"><span class="keyword">Class</span> WinccDB</span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;Current Error Code:</span></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;- 1</span></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;- 2</span></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;- 3</span></span><br><span class="line"><span class="keyword">Public</span> oConn</span><br><span class="line"><span class="keyword">Private</span> oRecSet</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> <span class="keyword">Class_Initialize</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> <span class="keyword">Class_Terminate</span></span><br><span class="line">UnConnect</span><br><span class="line"><span class="keyword">Set</span> dictErrDef = <span class="literal">Nothing</span></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;logs( &quot;Clean works complete.&quot;)</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;&#x27; Public Methods &#x27;&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Sub</span> Connect(provider,cataloge,ds)</span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">Err.Clear</span><br><span class="line"></span><br><span class="line"><span class="keyword">Dim</span> sConnStr</span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;Create CONNECTION STRING</span></span><br><span class="line">sConnStr =<span class="string">&quot;Provider=&quot;</span> &amp; provider &amp; <span class="string">&quot;;Catalog=&quot;</span> &amp; cataloge &amp; <span class="string">&quot;;Data Source=&quot;</span> &amp; ds</span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;logs( &quot;sConnStr:&quot; &amp; sConnStr)</span></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;Create CONNECTION</span></span><br><span class="line"><span class="keyword">Set</span> oConn = <span class="built_in">CreateObject</span>(<span class="string">&quot;ADODB.Connection&quot;</span>)</span><br><span class="line">oConn.ConnectionString = sConnStr</span><br><span class="line">oConn.CursorLocation = <span class="number">3</span></span><br><span class="line">oConn.Open</span><br><span class="line"><span class="keyword">If</span> Err <span class="keyword">Then</span></span><br><span class="line">MsgBox <span class="string">&quot;Connection error&quot;</span></span><br><span class="line">MsgBox Err.Source</span><br><span class="line">MsgBox Err.Description</span><br><span class="line">Err.Raise vbObjectError + <span class="number">1</span></span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">If</span> oConn.State = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">MsgBox <span class="string">&quot;oConn.State = 0 &quot;</span></span><br><span class="line">Err.Raise vbObjectError + <span class="number">1</span></span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;MsgBox &quot;Connection created.&quot;</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Sub</span> UnConnect()</span><br><span class="line"><span class="keyword">If</span> oConn <span class="keyword">Is</span> <span class="literal">Nothing</span> <span class="keyword">Then</span></span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">oConn.Close</span><br><span class="line"><span class="keyword">Set</span> oConn = <span class="literal">Nothing</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Class</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Class</span> MySQLDB</span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;Current Error Code:</span></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;- 1</span></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;- 2</span></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;- 3</span></span><br><span class="line"><span class="keyword">Public</span> oConn</span><br><span class="line"><span class="keyword">Private</span> oRecSet</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> <span class="keyword">Class_Initialize</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> <span class="keyword">Class_Terminate</span></span><br><span class="line">UnConnect</span><br><span class="line"><span class="keyword">Set</span> dictErrDef = <span class="literal">Nothing</span></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;logs( &quot;Clean works complete.&quot;)</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;&#x27; Public Methods &#x27;&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Sub</span> Connect(db,uid,pwd,host,port)</span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">Err.Clear</span><br><span class="line"></span><br><span class="line"><span class="keyword">Dim</span> sConnStr</span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;Create CONNECTION STRING</span></span><br><span class="line">sConnStr = <span class="string">&quot;DRIVER=&#123;MySQL ODBC 8.0 Unicode Driver&#125;;&quot;</span></span><br><span class="line"><span class="comment">&#x27;sConnStr = &quot;DRIVER=&#123;MySQL ODBC 5.2 ANSI Driver&#125;;&quot;</span></span><br><span class="line">sConnStr = sConnStr &amp; <span class="string">&quot;Database=&quot;</span> &amp; db &amp; <span class="string">&quot;;&quot;</span></span><br><span class="line">sConnStr = sConnStr &amp; <span class="string">&quot;User=&quot;</span> &amp; uid &amp; <span class="string">&quot;;&quot;</span></span><br><span class="line">sConnStr = sConnStr &amp; <span class="string">&quot;Password=&quot;</span> &amp; pwd &amp; <span class="string">&quot;;&quot;</span></span><br><span class="line">sConnStr = sConnStr &amp; <span class="string">&quot;Server=&quot;</span> &amp; host &amp; <span class="string">&quot;;&quot;</span></span><br><span class="line">sConnStr = sConnStr &amp; <span class="string">&quot;Port=&quot;</span> &amp; port &amp; <span class="string">&quot;;&quot;</span></span><br><span class="line">sConnStr = sConnStr &amp; <span class="string">&quot;Option=3;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;Create CONNECTION</span></span><br><span class="line"><span class="keyword">Set</span> oConn = <span class="built_in">CreateObject</span>(<span class="string">&quot;ADODB.Connection&quot;</span>)</span><br><span class="line">oConn.Open sConnStr</span><br><span class="line"><span class="keyword">If</span> Err <span class="keyword">Or</span> oConn.State = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">MsgBox <span class="string">&quot;oConn.State = 0 &quot;</span></span><br><span class="line">Err.Raise vbObjectError + <span class="number">1</span></span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;MsgBox &quot;Connection created.&quot;</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Sub</span> UnConnect()</span><br><span class="line"><span class="keyword">If</span> oConn <span class="keyword">Is</span> <span class="literal">Nothing</span> <span class="keyword">Then</span></span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">oConn.Close</span><br><span class="line"><span class="keyword">Set</span> oConn = <span class="literal">Nothing</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Class</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Function</span> queryToCsv(id,oConn,sql,path)</span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">Err.Clear</span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;CREATE RECORDSET</span></span><br><span class="line"><span class="keyword">Set</span> oRecSet = <span class="built_in">CreateObject</span>(<span class="string">&quot;ADODB.Recordset&quot;</span>)</span><br><span class="line">oRecSet.CursorLocation = <span class="number">3</span></span><br><span class="line">oRecSet.Open sql, oConn</span><br><span class="line"><span class="keyword">If</span> Err <span class="keyword">Then</span></span><br><span class="line">MsgBox <span class="string">&quot;query error&quot;</span></span><br><span class="line">MsgBox Err.Source</span><br><span class="line">MsgBox Err.Description</span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Function</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">logs( <span class="string">&quot;oRecSet.RecordCount:&quot;</span> &amp; oRecSet.RecordCount)</span><br><span class="line"><span class="keyword">Call</span> RecordSet2Csv(id,oRecSet,path)</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Function</span> RecordSet2Csv(id,rs,path)</span><br><span class="line"><span class="keyword">Dim</span> field</span><br><span class="line"><span class="keyword">Dim</span> tmpStr</span><br><span class="line"><span class="keyword">Dim</span> c</span><br><span class="line">c = <span class="number">1</span></span><br><span class="line"><span class="keyword">Set</span> outFile = <span class="built_in">CreateObject</span>(<span class="string">&quot;Scripting.FileSystemObject&quot;</span>).CreateTextFile(path)</span><br><span class="line">tmpStr=CsvValue_(<span class="string">&quot;id&quot;</span>) &amp; <span class="string">&quot;,&quot;</span></span><br><span class="line"><span class="keyword">For</span> <span class="keyword">Each</span> field <span class="keyword">In</span> rs.Fields</span><br><span class="line"><span class="keyword">If</span> field.Name = <span class="string">&quot;&quot;</span> <span class="keyword">Then</span></span><br><span class="line">tmpStr=tmpStr &amp;  CsvValue_(<span class="string">&quot;(computed&quot;</span> &amp; c &amp; <span class="string">&quot;)&quot;</span>) &amp; <span class="string">&quot;,&quot;</span></span><br><span class="line">c = c + <span class="number">1</span></span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">tmpStr=tmpStr &amp;  CsvValue_(field.Name) &amp; <span class="string">&quot;,&quot;</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">Next</span></span><br><span class="line">outFile.WriteLine   RTrimOne_(tmpStr)</span><br><span class="line">    c = <span class="number">1</span></span><br><span class="line"><span class="keyword">Do</span> <span class="keyword">While</span> <span class="keyword">Not</span> rs.EOF</span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;If c=65535 Then</span></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;    MsgBox &quot;è®°å½•æ•°è¶…è¿‡65535ï¼è¯·ç¼©å°å¯¼å‡ºæ—¶é—´èŒƒå›´ï¼&quot;</span></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;    Exit Do</span></span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;End If</span></span><br><span class="line">tmpStr =  CsvValue_(id) &amp; <span class="string">&quot;,&quot;</span></span><br><span class="line"><span class="keyword">For</span> <span class="keyword">Each</span> field <span class="keyword">In</span> rs.Fields</span><br><span class="line"><span class="comment">&#x27;&#x27;&#x27;tmpStr=tmpStr &amp;   CsvValue_(field.Value) &amp; &quot;,&quot;</span></span><br><span class="line">tmpStr=tmpStr &amp;   field.Value &amp; <span class="string">&quot;,&quot;</span></span><br><span class="line"><span class="keyword">Next</span></span><br><span class="line">outFile.WriteLine   RTrimOne_(tmpStr)</span><br><span class="line">rs.MoveNext</span><br><span class="line">        c = c+<span class="number">1</span></span><br><span class="line"><span class="keyword">Loop</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Function</span> CsvValue_(val)</span><br><span class="line"><span class="keyword">If</span> <span class="built_in">IsNull</span>(val) <span class="keyword">Then</span></span><br><span class="line">CsvValue_ = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">CsvValue_ = <span class="string">&quot;&quot;&quot;&quot;</span> &amp; <span class="built_in">Replace</span>(val, <span class="string">&quot;&quot;&quot;&quot;</span>, <span class="string">&quot;&quot;&quot;&quot;&quot;&quot;</span>) &amp; <span class="string">&quot;&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Function</span> RTrimOne_(str)</span><br><span class="line">RTrimOne_ = <span class="built_in">Left</span>(str, <span class="built_in">Len</span>(str) - <span class="number">1</span>)</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Function</span> logs(logdetail)</span><br><span class="line"></span><br><span class="line">FilePath = <span class="string">&quot;C:\Users\15588\Desktop\vscode\mysql2csv.log&quot;</span>  <span class="comment">&#x27;LOGæ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">LOGDetail = logdetail  <span class="comment">&#x27;LOGçš„å†…å®¹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Set</span> fso = <span class="built_in">CreateObject</span>(<span class="string">&quot;scripting.FileSystemObject&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27;åˆ¤æ–­LOGæ–‡ä»¶æ˜¯å¦å­˜åœ¨,å¦‚ä¸å­˜åœ¨,åˆ™æŒ‰æŒ‡å®šè·¯å¾„æ–°å»º</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> fso.FileExists(FilePath) = <span class="literal">False</span>  <span class="keyword">Then</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Set</span> LOGFile = fso.CreateTextFile(FilePath, <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">LOGFile.Close</span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Set</span> LOGFile = fso.OpenTextFile(FilePath, <span class="number">8</span>, <span class="literal">True</span>)  <span class="comment">&#x27;8ä¸ºè¿½åŠ </span></span><br><span class="line"></span><br><span class="line">LOGFile.WriteLine   <span class="built_in">Cstr</span>(Now) &amp; <span class="string">&quot; : &quot;</span> &amp; LOGDetail</span><br><span class="line"></span><br><span class="line">LOGFile.Close</span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> vbs </tag>
            
            <tag> wincc </tag>
            
            <tag> csv </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºhdfsçš„ftpæœåŠ¡å™¨çš„è®¾è®¡ä¸å®ç°</title>
      <link href="//hdfs-ftp-server-design-and-implementation/"/>
      <url>//hdfs-ftp-server-design-and-implementation/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦è®°å½•hdfs-ftp-serverçš„è®¾è®¡æ€è·¯ã€å®ç°è¿‡ç¨‹ï¼Œä½¿ç”¨çš„è¯ç›´æ¥çœ‹githubé¡¹ç›®æ–‡æ¡£å³å¯ã€‚<br>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/linshenkx/hdfs-ftp-server">https://github.com/linshenkx/hdfs-ftp-server</a></p><span id="more"></span><h2 id="ç¬¬ä¸€ç‰ˆ"><a href="#ç¬¬ä¸€ç‰ˆ" class="headerlink" title="ç¬¬ä¸€ç‰ˆ"></a>ç¬¬ä¸€ç‰ˆ</h2><p>hdfs-ftp-serverè¿™ä¸ªé¡¹ç›®æˆ‘åœ¨20å¹´çš„æ—¶å€™å°±å¼€æºè¿‡ä¸€ç‰ˆäº†ï¼Œå…ˆåšä¸€ä¸‹å‰æä»‹ç»ã€‚</p><h3 id="1-éœ€æ±‚"><a href="#1-éœ€æ±‚" class="headerlink" title="1 éœ€æ±‚"></a>1 éœ€æ±‚</h3><p>å› ä¸ºæˆ‘ä»¬å¤§æ•°æ®å¹³å°æ˜¯å®¹å™¨åŒ–çš„ï¼Œä¸€äº›ç®€å•çš„æ“ä½œä¹Ÿéœ€è¦è¿›å…¥å®¹å™¨é‡Œé¢æ‰èƒ½æ‰§è¡Œï¼Œè€Œä¸”ä¼ é€’æ–‡ä»¶ä¹Ÿå¾ˆç¹çã€‚<br>æ‰€ä»¥é‚£æ—¶å€™çš„ä¸»è¦éœ€æ±‚å°±æ˜¯<strong>å®ç°åŠŸèƒ½</strong>ï¼Œå³é€šè¿‡ftpçš„æ–¹å¼å®ç°å¯¹hdfsæ–‡ä»¶ç³»ç»Ÿçš„æ“ä½œï¼Œæ–¹ä¾¿æ—¥å¸¸æ“ä½œã€‚</p><h3 id="2-æ€è·¯"><a href="#2-æ€è·¯" class="headerlink" title="2 æ€è·¯"></a>2 æ€è·¯</h3><p>é‚£æ—¶å€™ä¸»è¦æ˜¯å‚è€ƒgithubä¸Šä¸€äº›è€ä¸€ç‚¹çš„é¡¹ç›®è¿›è¡Œæ”¹é€ å‡çº§ï¼Œä»¥é€‚é…é«˜å¯ç”¨ã€kerberosè®¤è¯è¿æ¥ã€‚<br>ç„¶åå†è¿›è¡Œæ˜“ç”¨æ€§æ”¹é€ ï¼Œæ›´é€‚åˆç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚</p><p>æ ¸å¿ƒæ€è·¯æ˜¯å¯¹å¤–ä½œä¸ºftpæœåŠ¡å™¨ï¼Œå†…éƒ¨ä½¿ç”¨hdfså®ç°æ¥å£åŠŸèƒ½å³å¯ï¼Œå¾ˆç®€å•çš„åŠŸèƒ½ã€‚</p><h3 id="3-å­˜åœ¨é—®é¢˜"><a href="#3-å­˜åœ¨é—®é¢˜" class="headerlink" title="3 å­˜åœ¨é—®é¢˜"></a>3 å­˜åœ¨é—®é¢˜</h3><p>é‚£æ—¶å€™ç”¨çš„hadoopæ˜¯å®˜æ–¹çš„2.9.2ï¼Œåé¢hadoopå‡çº§åˆ°3.3.1äº†ï¼Œ<br>è€Œä¸”æœ‰æ—¶å€™è¿˜å¾—å¯¹æ¥cdhçš„hadoopï¼Œè¿™ä¸ªæ—¶å€™è¿™ä¸ªå·¥ç¨‹å°±ä¸èƒ½ç›´æ¥æ‹¿æ¥ç”¨äº†ã€‚</p><p>è¿™ç§æ—¶å€™å¸¸è§„è§£å†³åŠæ³•å°±æ˜¯ä¿®æ”¹ä¸€ä¸‹ä¾èµ–ï¼Œé‡æ–°ç¼–è¯‘ã€‚</p><p>ä½†æ˜¯æˆ‘è§‰å¾—å¤ªéº»çƒ¦äº†ï¼Œè¿™æ ·ä¹Ÿä¸åˆ©äºä»£ç çš„ç®¡ç†ã€‚<br>æ‰€ä»¥å°±ä¸€ç›´æƒ³ç€è¦æŠŠè¿™ä¸ªå·¥ç¨‹æ¨¡å—åŒ–ï¼Œæ ¸å¿ƒå·¥ç¨‹ç‹¬ç«‹ä¸”ä¸å¸¸å˜ï¼Œå…¶ä»–çš„ä½œä¸ºæ¨¡å—å·¥ç¨‹å¯¹æ¥å„ä¸ªç‰ˆæœ¬çš„hadoopå®¢æˆ·ç«¯ã€‚</p><h2 id="ç¬¬äºŒç‰ˆ"><a href="#ç¬¬äºŒç‰ˆ" class="headerlink" title="ç¬¬äºŒç‰ˆ"></a>ç¬¬äºŒç‰ˆ</h2><p>é’ˆå¯¹ç¬¬ä¸€ç‰ˆå­˜åœ¨çš„é—®é¢˜ï¼Œç¬¬äºŒç‰ˆä¸»è¦æ˜¯å¯¹é¡¹ç›®è¿›è¡Œæ¨¡å—åŒ–æ”¹é€ </p><h3 id="æŠ€æœ¯è°ƒç ”åŠé€‰å‹"><a href="#æŠ€æœ¯è°ƒç ”åŠé€‰å‹" class="headerlink" title="æŠ€æœ¯è°ƒç ”åŠé€‰å‹"></a>æŠ€æœ¯è°ƒç ”åŠé€‰å‹</h3><p>æœ€å¼€å§‹æˆ‘ç›®æ ‡æ˜¯å¾ˆæ˜ç¡®çš„ï¼Œå°±æ˜¯ç”¨èš‚èšé‡‘æœçš„<a href="https://github.com/sofastack/sofa-ark">arkæ¡†æ¶</a>æ¥å®ç°ç±»éš”ç¦»ï¼Œ<br>æ¯•ç«Ÿä¸åŒå¤§ç‰ˆæœ¬/å‘è¡Œç‰ˆæœ¬çš„hdfsä¾èµ–å¤šå°‘ä¼šæœ‰ç±»å†²çªï¼Œç›´æ¥ç”¨æ˜¯è‚¯å®šä¸æ”¾å¿ƒçš„ã€‚</p><p>arkæˆ‘ä¹‹å‰å°±ä¸€ç›´æœ‰åœ¨ç•™æ„ï¼Œä¹Ÿè·‘è¿‡demoï¼Œè§‰å¾—è¿˜æ˜¯å¯ä»¥å¯„äºˆåšæœ›çš„ã€‚<br>äº‹å®ä¸Šè¿™ä¸ªå·¥ç¨‹é‡æ„æ‰€ç”¨çš„æ—¶é—´ä¸€å¤§åŠéƒ½èŠ±åœ¨arkä¸Šã€‚<br>æœ¬æ¥æ˜¯æƒ³æŠŠå„ä¸ªå®ç°æ¨¡å—ä½œä¸ºarkçš„æ’ä»¶çš„ï¼Œå‘ç°arkçš„æ’ä»¶åˆä¸æ”¯æŒåŠ¨æ€æ’æ‹”ï¼Œå…¶æ ¸å¿ƒæ˜¯ç±»éš”ç¦»è€Œä¸æ˜¯æ¨¡å—åŒ–ã€‚<br>é‚£å°±æŠŠæ¯ä¸ªæ¨¡å—ä½œä¸ºserviceï¼Œæ¥å®ç°åŠ¨æ€å¼•ç”¨ï¼Œè¿™ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¹Ÿç¡®å®æ”¹å¥½ä»£ç æ‰“åŒ…å¥½äº†ã€‚<br>ä½†æœ€ç»ˆè¿è¡Œçš„æ—¶å€™è¿˜æ˜¯æœ‰bugï¼Œç±»ä¼¼äºï¼š<a href="https://github.com/sofastack/sofa-ark/issues/421%E3%80%82">https://github.com/sofastack/sofa-ark/issues/421ã€‚</a></p><p>ç»ˆäºè¿˜æ˜¯æŠ˜è…¾ä¸ä¸‹å»ï¼Œæ”¾å¼ƒarkäº†ï¼Œå¼€æºæ”¯æŒå¤ªå·®äº†ï¼Œæˆ‘æ°´å¹³æœ‰é™ï¼Œç©ä¸åŠ¨ã€‚</p><p>ä¸ç”¨arkï¼Œosgiåˆå¤ªé‡äº†ï¼Œæ²¡å¿…è¦ï¼Œé‚£å°±è¿˜æ˜¯è€è€å®å®ç”¨javaçš„spiå§ã€‚<br>ç±»ä¼¼äºjdbcçš„ç”¨æ³•ï¼Œæ·»åŠ å¯¹åº”jaråŒ…ï¼ŒæŒ‡å®šç±»åè¿›è¡ŒåŠ è½½ã€‚</p><p>ä½†spiå¹¶ä¸èƒ½å®ç°ç±»éš”ç¦»ï¼Œæ‰€ä»¥å°±é¢„å…ˆæ‰“åŒ…å¥½å„ä¸ªjaråŒ…ï¼Œè¿è¡Œæ—¶å†æ ¹æ®å¯¹æ¥hadoopç‰ˆæœ¬è¿›è¡ŒåŠ è½½ã€‚</p><p>å³æ¯ä¸ªæ¨¡å—å½¢æˆä¸€ä¸ªfatjarï¼Œå¦‚cdh632.jarï¼Œofficial331.jarã€‚<br>åœ¨å¯¹æ¥cdh6.3.2çš„æ—¶å€™å°†cdh632.jaræ·»åŠ åˆ°ç±»è·¯å¾„ä¸‹å³å¯ï¼Œå¦‚æœæ˜¯å¯¹æ¥å®˜æ–¹3.3.1åˆ™æ·»åŠ official331.jarã€‚</p><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¦ä¸è¦æŠŠhadoopçš„ä¾èµ–åŒ…ä¹Ÿä¸€å¹¶æ‰“åŒ…å‘¢ï¼Ÿ<br>è¿™ä¸ªå€’æ²¡çº ç»“å¤ªä¹…ï¼Œè¿˜æ˜¯æ‰“åŒ…äº†ã€‚ç¼ºç‚¹æ˜¯ä½“ç§¯å¤§å¾ˆå¤šï¼Œä¼˜ç‚¹æ˜¯æ‘†è„±ä¾èµ–ã€‚<br>ä½ åªéœ€è¦ç»™æˆ‘hadoopçš„è¿æ¥é…ç½®æ–‡ä»¶å°±è¡Œäº†ï¼Œè€Œä¸éœ€è¦æ•´ä¸ªhadoopå®¢æˆ·ç«¯ç¯å¢ƒã€‚<br>è‡³äºåŒ…å¤§ç‚¹å°±å¤§ç‚¹ï¼Œä¸å·®é‚£ç‚¹æµé‡ã€ç©ºé—´ã€‚</p><p>ä¸ºäº†ç®€åŒ–ã€ç»Ÿä¸€å­æ¨¡å—çš„å¼€å‘ï¼Œæˆ‘åˆæŠŠgradleä»»åŠ¡ç»Ÿä¸€å®šä¹‰åœ¨çˆ¶å·¥ç¨‹çš„build.gradleé‡Œé¢ã€‚<br>è®©å­æ¨¡å—æ›´åŠ çš„ç®€å•æ˜“æ‡‚ã€‚</p><h3 id="æˆæœæ€»ç»“"><a href="#æˆæœæ€»ç»“" class="headerlink" title="æˆæœæ€»ç»“"></a>æˆæœæ€»ç»“</h3><p><a href="https://github.com/linshenkx/hdfs-ftp-server">https://github.com/linshenkx/hdfs-ftp-server</a></p><p>åº”è¯¥è¯´è¿˜æ˜¯æ¯”è¾ƒæ»¡æ„çš„ã€‚</p><p>è™½ç„¶å°±æŠ€æœ¯æ¥è¯´å¾ˆç®€å•ï¼Œæ¯•ç«Ÿåˆ«äººåå¹´å‰å°±åšè¿‡çš„ä¸œè¥¿ï¼Œ<br>ä½†è¿˜æ˜¯èŠ±äº†å¾ˆå¤šæ—¶é—´ã€å¿ƒæ€åœ¨ä¸Šé¢æŠ˜è…¾ï¼ŒæŠŠè¿™ä¸ªå°ä¸œè¥¿åšå¾—å¥½ç”¨ä¸€äº›ã€‚<br>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¹Ÿç®—æœ‰ç‚¹æ”¶è·å§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ftp </tag>
            
            <tag> hdfs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºkube-prometheusçš„å¤§æ•°æ®å¹³å°ç›‘æ§ç³»ç»Ÿè®¾è®¡</title>
      <link href="//kube-prometheus-bigdata/"/>
      <url>//kube-prometheus-bigdata/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•åŸºäºkube-prometheusè®¾è®¡ä¸€ä¸ªç›‘æ§ç³»ç»Ÿï¼Œ ä»¥çµæ´»ç®€å•çš„æ–¹å¼å¯¹kubernetesä¸Šçš„åº”ç”¨è¿›è¡ŒæŒ‡æ ‡é‡‡é›†ï¼Œå¹¶å®ç°ç›‘æ§æŠ¥è­¦åŠŸèƒ½ã€‚<br>æœ¬æ–‡æä¾›äº†ä½œè€…çš„åº”ç”¨ç¤ºä¾‹ï¼Œå¦å¤–è¿˜è®°å½•äº†ä½œè€…åœ¨å­¦ä¹ ã€ä½¿ç”¨Prometheusè¿‡ç¨‹ä¸­çš„ä¸€äº›ç¬”è®°ï¼Œå¦‚armç‰ˆé•œåƒè·å–ã€ä¸€äº›å·¥å…·çš„ä½¿ç”¨ç­‰ã€‚</p><span id="more"></span><h2 id="é›¶-å‰è¨€"><a href="#é›¶-å‰è¨€" class="headerlink" title="é›¶ å‰è¨€"></a>é›¶ å‰è¨€</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œå¤§æ•°æ®äº§å“ä½œä¸ºåº•å±‚å¹³å°ï¼Œå…¶è¿ç»´ç›‘æ§ä¸€ç›´æ˜¯ç”Ÿäº§å®è·µçš„ç—›ç‚¹éš¾ç‚¹ï¼Œä¸”åœ¨ç¨³å®šè¿è¡Œçš„åŸºç¡€ä¹‹ä¸Š<br>å¾€å¾€è¿˜éœ€è¦å¯¹æ€§èƒ½è¿›è¡Œè¯„ä¼°ä¼˜åŒ–ï¼Œæ‰€ä»¥å…¶ç›‘æ§ç³»ç»Ÿçš„å»ºè®¾æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚</p><p>Prometheusä½œä¸ºäº‘åŸç”Ÿæ—¶ä»£æœ€ç«çš„ç›‘æ§è½¯ä»¶ï¼Œå¾ˆå¤šå¤§æ•°æ®ç»„ä»¶æˆ–åŸç”Ÿæˆ–ä»¥ç¬¬ä¸‰æ–¹æ’ä»¶/exporterçš„å½¢å¼å¯¹Prometheusåšäº†æ”¯æŒã€‚</p><p>æˆ‘ä½¿ç”¨çš„å¤§æ•°æ®å¹³å°æ˜¯åŸºäºkubernetesè¿è¡Œçš„ï¼Œæœ‰éƒ¨ç½²çµæ´»ç®¡ç†æ–¹ä¾¿çš„ä¼˜ç‚¹ï¼Œæ›´å®¹æ˜“ä¸Prometheusè¿›è¡Œç»“åˆã€‚</p><p>ä¸‹é¢å°†å¯¹è®¾è®¡æ€è·¯å’ŒæŠ€æœ¯å®ç°è¿›è¡Œé˜è¿°æ¢è®¨ã€‚</p><h2 id="ä¸€-è®¾è®¡æ€è·¯"><a href="#ä¸€-è®¾è®¡æ€è·¯" class="headerlink" title="ä¸€ è®¾è®¡æ€è·¯"></a>ä¸€ è®¾è®¡æ€è·¯</h2><p>ç›‘æ§ç³»ç»Ÿçš„æ ¸å¿ƒä»»åŠ¡æ˜¯å°†æš´éœ²å‡ºæ¥çš„æŒ‡æ ‡æ•°æ®è¿›è¡ŒæŠ“å–ï¼Œåœ¨æ­¤ä¹‹ä¸Šè¿›è¡Œåˆ†æã€å‘Šè­¦<br>æ‰€ä»¥æœ‰ä»¥ä¸‹å‡ ä¸ªè¦æ˜ç¡®çš„é—®é¢˜ï¼š</p><ol><li>ç›‘æ§å¯¹è±¡æ˜¯ä»€ä¹ˆ</li><li>ç›‘æ§å¯¹è±¡å¦‚ä½•æš´éœ²æŒ‡æ ‡æ•°æ®</li><li>ç›‘æ§ç³»ç»Ÿå¦‚ä½•å¯¹æŒ‡æ ‡è¿›è¡ŒæŠ“å–</li><li>å¦‚ä½•å®ç°å‘Šè­¦è§„åˆ™åŠ¨æ€é…ç½®ã€ç®¡ç†</li></ol><h3 id="1-ç›‘æ§å¯¹è±¡"><a href="#1-ç›‘æ§å¯¹è±¡" class="headerlink" title="1. ç›‘æ§å¯¹è±¡"></a>1. ç›‘æ§å¯¹è±¡</h3><p>ä»¥podï¼ˆå®¹å™¨ï¼‰å½¢å¼è¿è¡Œåœ¨kubernetesé›†ç¾¤ä¸Šçš„å„ä¸ªå¤§æ•°æ®ç»„ä»¶ã€‚</p><h3 id="2-æŒ‡æ ‡æš´éœ²æ–¹å¼"><a href="#2-æŒ‡æ ‡æš´éœ²æ–¹å¼" class="headerlink" title="2. æŒ‡æ ‡æš´éœ²æ–¹å¼"></a>2. æŒ‡æ ‡æš´éœ²æ–¹å¼</h3><p>å„ç»„ä»¶æ ¹æ®å¯¹Prometheusçš„æ”¯æŒç¨‹åº¦ï¼Œå¯åˆ†ä¸º3ç§ç±»å‹çš„æŒ‡æ ‡æš´éœ²æ–¹å¼ï¼š</p><ol><li>ç›´æ¥æš´éœ²PrometheusæŒ‡æ ‡æ•°æ®(ç›´æ¥ï¼Œæ‹‰)</li><li>ä¸»åŠ¨å°†æŒ‡æ ‡æ•°æ®æ¨é€åˆ°prometheus-pushGatewayï¼Œç”±pushGatewayæš´éœ²æ•°æ®ï¼ˆé—´æ¥ï¼Œæ¨ï¼‰</li><li>è‡ªå®šä¹‰exporterå°†å…¶ä»–å½¢å¼çš„æŒ‡æ ‡æ•°æ®è½¬æ¢ä¸ºç¬¦åˆPrometheusæ ‡å‡†çš„æ ¼å¼è¿›è¡Œæš´éœ²ï¼ˆexporterï¼Œç›´æ¥ï¼Œæ‹‰ï¼‰</li></ol><p>ä¸ªåˆ«ç»„ä»¶åŒæ—¶æ”¯æŒå¤šç§æ–¹å¼ï¼Œå¦‚flinkæ”¯æŒç›´æ¥å’Œé—´æ¥æ–¹å¼ï¼Œsparkæ”¯æŒç›´æ¥æ–¹å¼è€Œä¸”ä¹Ÿæœ‰ç¬¬ä¸‰æ–¹exporterã€‚<br>å¤§éƒ¨åˆ†ç»„ä»¶éƒ½æœ‰å®˜æ–¹/ç¬¬ä¸‰æ–¹çš„exporterï¼Œæå°‘æ•°éœ€è¦è‡ªå·±å¼€å‘ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ç›´æ¥æ–¹å¼å°±å¯ä»¥äº†<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåƒflinkï¼ˆsparkï¼‰ on yarnæ¨¡å¼è¿è¡Œçš„æ—¶å€™ï¼ŒflinkèŠ‚ç‚¹æ˜¯è·‘åœ¨yarnå®¹å™¨é‡Œé¢çš„ã€‚<br>è¿™ç§æƒ…å†µä¸‹Prometheuså¾ˆéš¾å¯¹å…¶ç›´æ¥è¿›è¡ŒæŠ“å–ï¼Œè¿™ç§æ—¶å€™å°±åªèƒ½ç”¨é—´æ¥æ–¹å¼ï¼Œä¸»åŠ¨å°†æ•°æ®æ¨é€åˆ°pushGatewayã€‚</p><p>å¦å¤–é‚£äº›çŸ­æš‚ç”Ÿå‘½å‘¨æœŸçš„ç»„ä»¶ä¹Ÿå»ºè®®ç”¨ä¸»åŠ¨pushåˆ°pushGatewayã€‚</p><h3 id="3-æŒ‡æ ‡æŠ“å–æ–¹å¼"><a href="#3-æŒ‡æ ‡æŠ“å–æ–¹å¼" class="headerlink" title="3. æŒ‡æ ‡æŠ“å–æ–¹å¼"></a>3. æŒ‡æ ‡æŠ“å–æ–¹å¼</h3><p>ä¸ç®¡æ˜¯exporterè¿˜æ˜¯pushGatewayï¼Œåˆ°æœ€åå¿…ç„¶æ˜¯ç”±Prometheusä¸»åŠ¨å¯¹è¿™äº›ç›®æ ‡è¿›è¡ŒæŠ“å–ã€‚</p><blockquote><p>Prometheus ä¸»è¦é€šè¿‡ Pull çš„æ–¹å¼æ¥æŠ“å–ç›®æ ‡æœåŠ¡æš´éœ²å‡ºæ¥çš„ç›‘æ§æ¥å£ï¼Œ<br>å› æ­¤éœ€è¦é…ç½®å¯¹åº”çš„æŠ“å–ä»»åŠ¡æ¥è¯·æ±‚ç›‘æ§æ•°æ®å¹¶å†™å…¥åˆ° Prometheus æä¾›çš„å­˜å‚¨ä¸­ï¼Œ<br>ç›®å‰ Prometheus æœåŠ¡æä¾›äº†å¦‚ä¸‹å‡ ä¸ªä»»åŠ¡çš„é…ç½®ï¼š</p><ul><li>åŸç”Ÿ Job é…ç½®ï¼šæä¾› Prometheus åŸç”ŸæŠ“å– Job çš„é…ç½®ã€‚</li><li>Pod Monitorï¼šåœ¨ K8S ç”Ÿæ€ä¸‹ï¼ŒåŸºäº Prometheus Operator æ¥æŠ“å– Pod ä¸Šå¯¹åº”çš„ç›‘æ§æ•°æ®ã€‚</li><li>Service Monitorï¼šåœ¨ K8S ç”Ÿæ€ä¸‹ï¼ŒåŸºäº Prometheus Operator æ¥æŠ“å– Service å¯¹åº” Endpoints ä¸Šçš„ç›‘æ§æ•°æ®ã€‚</li></ul><p>å‚è€ƒï¼š<a href="https://cloud.tencent.com/document/product/1416/55995">https://cloud.tencent.com/document/product/1416/55995</a></p></blockquote><p>æ—¢ç„¶éƒ½ä¸Šäº†kubernetesç¯å¢ƒäº†ï¼Œä¸€èˆ¬å½“ç„¶æ˜¯æ¨èç›´æ¥ç”¨ podMonitorã€‚é…ç½®æ›´ç®€æ´æ˜“æ‡‚ã€‚<br>podMonitorSelectorçš„è¿‡æ»¤åœ¨prometheus-prometheus.yamlé…ç½®ã€‚</p><blockquote><p>prometheus-prometheus.yamlæ˜¯æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œä¸å®œé¢‘ç¹ä¿®æ”¹(ä¼šå¯¼è‡´Prometheusé‡å¯)ã€‚<br>ä¸»è¦é…ç½®é¡¹ä¸ºï¼šserviceMonitorSelectorï¼ŒpodMonitorSelectorï¼ŒruleSelectorï¼Œalertmanagersã€‚<br>å…¶ä¸­serviceç›‘æ§é€‰æ‹©å™¨å’Œpodç›‘æ§é€‰æ‹©å™¨é»˜è®¤é€‰æ‹©æ‰€æœ‰ï¼Œè¿™é‡Œå»ºè®®æŠŠ ruleSelector ä¹Ÿä¿®æ”¹ä¸ºé€‰æ‹©æ‰€æœ‰</p></blockquote><p>ä¸è¿‡ä¸€ä¸ªpodMonitorä¸€èˆ¬åªå¯¹åº”ä¸€ç§ç±»å‹çš„podï¼Œåœ¨å·²æœ‰podç±»å‹è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œ<br>è¿˜å¯ä»¥è€ƒè™‘ä¸€ç§æ›´å–å·§çš„æ–¹æ³•å°±æ˜¯Prometheusçš„kubernetesæœåŠ¡å‘ç°åŠŸèƒ½ã€‚å³kubernetes_sd_configã€‚<br>è¿™ç§å±äº<em>åŸç”ŸJobé…ç½®</em>ï¼Œå»ºè®®ä½¿ç”¨<a href="https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/additional-scrape-config.md">additional-scrape-config</a><br>è¿›è¡Œé…ç½®ã€‚</p><p><a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#kubernetes_sd_config">kubernetes_sd_config</a>èµ‹äºˆäº†Prometheusé€šè¿‡kubernetes rest apiæ„ŸçŸ¥kubernetesèµ„æºçš„åŠŸèƒ½ï¼Œ<br>åˆ©ç”¨è¯¥èƒ½åŠ›ï¼Œå¯ä»¥ä½¿ç”¨<em>åŸç”ŸJobé…ç½®</em>è‡ªåŠ¨å‘ç°podï¼Œå°†å…¶ä½œä¸ºç›‘æ§ç›®æ ‡ã€‚<br>å†åˆ©ç”¨Prometheusçš„<a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#relabel_config">RelabelåŠŸèƒ½</a>å¯ä»¥æ”¹å†™å‘ç°çš„æ ‡ç­¾ï¼Œè¿›è¡Œå‰ç½®å¤„ç†ã€è½¬æ¢ã€‚å®ç°podç­›é€‰ï¼Œä¿®æ”¹æŠ“å–é…ç½®çš„æ•ˆæœã€‚<br>è€Œè‡ªåŠ¨å‘ç°çš„podçš„æ ‡ç­¾çš„æ¥æºåˆå¯ä»¥æ˜¯podèµ„æºçš„label/annotationç­‰ã€‚<br>æœ€ç»ˆå®ç°çš„æ•ˆæœå¦‚ä¸‹ï¼Œ<br>è¿™æ˜¯ä¸€ä¸ªpushGatewayçš„podçš„é…ç½®,åˆ™Prometheusä¼šé€šè¿‡å…¶19091ç«¯å£è®¿é—®/metricsè·¯å¾„è·å–å…¶æŒ‡æ ‡æ•°æ®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">annotations:</span></span><br><span class="line">  <span class="attr">prometheus.io/scrape:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">  <span class="attr">prometheus.io/scheme:</span> <span class="string">&quot;http&quot;</span></span><br><span class="line">  <span class="attr">prometheus.io/path:</span> <span class="string">&quot;/metrics&quot;</span></span><br><span class="line">  <span class="attr">prometheus.io/port:</span> <span class="string">&quot;19091&quot;</span></span><br></pre></td></tr></table></figure><p>è¿™éƒ¨åˆ†çš„å†…å®¹ä¸»è¦å‚è€ƒï¼š</p><ol><li><a href="https://godleon.github.io/blog/Prometheus/Prometheus-Relabel">https://godleon.github.io/blog/Prometheus/Prometheus-Relabel</a></li><li><a href="https://yunlzheng.gitbook.io/prometheus-book/part-iii-prometheus-shi-zhan/readmd/service-discovery-with-kubernetes">https://yunlzheng.gitbook.io/prometheus-book/part-iii-prometheus-shi-zhan/readmd/service-discovery-with-kubernetes</a></li></ol><p>podMonitoræ˜¯å®˜æ–¹æ”¯æŒï¼Œç®€æ´æ˜“æ‡‚ã€‚<br>kubernetes_sd_config+relabelçš„æ–¹æ¡ˆè¾ƒå¤æ‚ï¼Œéš¾åº¦è¾ƒé«˜ï¼Œä½†ä¸ç”¨å†™é‚£ä¹ˆå¤šçš„podMonitorã€‚<br>è‡ªè¡ŒæŠ‰æ‹©å°±è¡Œï¼Œä¹Ÿå¯ä»¥ä¸€èµ·ç”¨ã€‚</p><h3 id="4-å‘Šè­¦è®¾è®¡"><a href="#4-å‘Šè­¦è®¾è®¡" class="headerlink" title="4. å‘Šè­¦è®¾è®¡"></a>4. å‘Šè­¦è®¾è®¡</h3><h4 id="å‘Šè­¦æµç¨‹"><a href="#å‘Šè­¦æµç¨‹" class="headerlink" title="å‘Šè­¦æµç¨‹"></a>å‘Šè­¦æµç¨‹</h4><p>prometheusçš„ç›‘æ§å‘Šè­¦åŸºæœ¬æµç¨‹æ˜¯ï¼š</p><ol><li>æœåŠ¡å‘ç”Ÿå¼‚å¸¸</li><li>è§¦å‘prometheusæœåŠ¡å™¨å‘å‡ºå‘Šè­¦ä¿¡æ¯ï¼ˆalertï¼‰</li><li>alertmanageræ”¶åˆ°å‘Šè­¦ä¿¡æ¯</li><li>alertmanageræ ¹æ®é¢„é…ç½®çš„è§„åˆ™å¯¹å‘Šè­¦ä¿¡æ¯è¿›è¡Œå¤„ç†ï¼Œå®ç°ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚åˆ†ç»„ã€æŠ‘åˆ¶ã€è§¦å‘çŸ­ä¿¡é‚®ç®±ç­‰</li></ol><p>å½“ç„¶å…·ä½“çš„æµç¨‹æ²¡é‚£ä¹ˆç®€å•ï¼Œæœ‰å¾ˆå¤šç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œç‰¹åˆ«æ˜¯è§¦å‘å‘Šè­¦æ—¶æœºï¼Œæ˜¯ä¸ªé‡ç‚¹ã€‚<br>è¿™äº›å±äºPrometheusçš„æœºåˆ¶å®ç°ï¼Œè¿™é‡Œå°±ä¸å±•å¼€èµ˜è¿°ï¼Œæ¨èé˜…è¯»ä»¥ä¸‹æ–‡ç« ï¼š<br><a href="https://my.oschina.net/u/4400455/blog/3442101">Prometheus ä¸€æ¡å‘Šè­¦çš„è§¦å‘æµç¨‹ã€ç­‰å¾…æ—¶é—´</a><br><a href="https://www.qikqiak.com/post/alertmanager-when-alert/">AlertManager ä½•æ—¶æŠ¥è­¦</a></p><p>åè¾¹ä¼šç»™å‡ºä¸€ä¸ªæœ¬äººå®é™…åº”ç”¨æµ‹è¯•çš„ä¾‹å­ï¼Œå¯ä¾›å‚è€ƒï¼Œä¼šç›´è§‚ä¸€äº›ã€‚</p><h4 id="å‘Šè­¦çš„åŠ¨æ€é…ç½®"><a href="#å‘Šè­¦çš„åŠ¨æ€é…ç½®" class="headerlink" title="å‘Šè­¦çš„åŠ¨æ€é…ç½®"></a>å‘Šè­¦çš„åŠ¨æ€é…ç½®</h4><p>kube-prometheusçš„å‘Šè­¦è§„åˆ™åˆ†ä¸¤éƒ¨åˆ†ï¼š</p><ol><li>alertmanager: å³å¯¹å‘Šè­¦ä¿¡æ¯çš„å¤„ç†ç­–ç•¥<br>é…ç½®å‚è€ƒï¼š<a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/alert/alert-manager-config">https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/alert/alert-manager-config</a><br>æ ¸å¿ƒæ˜¯alertmanager-secret.yamlé…ç½®æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä»¥ secret çš„å½¢å¼è¢« Alertmanager è¯»å–ã€‚<br>Alertmanagerä¼šè‡ªåŠ¨è¯»å–secretä¸­çš„é…ç½®è¿›è¡Œæ›´æ–°ã€‚</li><li>alertRule: å³å…·ä½“çš„å‘Šè­¦è§„åˆ™<br>é…ç½®å‚è€ƒï¼š<a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/alert/prometheus-alert-rule">https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/alert/prometheus-alert-rule</a><br>åœ¨kubernetesä¸­æ˜¯ä»¥PrometheusRuleç±»å‹æ“ä½œï¼Œæ‰€ä»¥ç®¡ç†èµ·æ¥è·Ÿpodä¸€æ ·ï¼Œç›´æ¥ä½¿ç”¨kubeletå¢åˆ æ”¹å³å¯</li></ol><h4 id="æ¥å…¥è‡ªå®šä¹‰å‘Šè­¦å¹³å°"><a href="#æ¥å…¥è‡ªå®šä¹‰å‘Šè­¦å¹³å°" class="headerlink" title="æ¥å…¥è‡ªå®šä¹‰å‘Šè­¦å¹³å°"></a>æ¥å…¥è‡ªå®šä¹‰å‘Šè­¦å¹³å°</h4><p>ä»ä¸ªäººå®è·µçš„è§’åº¦æ¥çœ‹ï¼ŒAlertManagerå¤„ç†web hookä¹‹å¤–çš„å‘Šè­¦æ¥æ”¶æ’ä»¶ï¼Œå¦‚çŸ­ä¿¡ã€é‚®ç®±ç­‰åªé€‚åˆæµ‹ç€ç©ã€‚<br>ç”Ÿäº§ä½¿ç”¨è¿˜æ˜¯è¦é€šè¿‡web hookå°†å‘Šè­¦ä¿¡æ¯å‘é€åˆ°è‡ªå·±çš„å‘Šè­¦å¹³å°ã€‚å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦å¯¹å‘Šè­¦ä¿¡æ¯åšé«˜åº¦å®šåˆ¶åŒ–å¤„ç†ã€è®°å½•ç­‰ã€‚<br>å¦å¤–å¯ä»¥åœ¨å‘Šè­¦ä¿¡æ¯ä¸­æºå¸¦å…·ä½“å‘Šè­¦è§„åˆ™ç­‰ä¿¡æ¯æŒ‡å¯¼å‘Šè­¦å¹³å°è¿›è¡Œå¤„ç†ã€‚</p><p>è¿™é‡Œè¦åšä¸ªåŒºåˆ†ï¼ŒAlertManageræ˜¯å‘Šè­¦ä¿¡æ¯çš„å‰ç½®å¤„ç†ï¼Œè´Ÿè´£éä¸šåŠ¡æ€§å‰ç½®æ“ä½œï¼Œå¦‚å‘Šè­¦ä¿¡æ¯åˆ†ç»„ã€å¹³æŠ‘ç­‰ã€‚<br>è€Œè‡ªå®šä¹‰å‘Šè­¦å¹³å°åˆ™è´Ÿè´£å‘Šè­¦ä¿¡æ¯çš„ä¸šåŠ¡å¤„ç†ï¼Œå¦‚è®°å½•ã€å»æ•ã€å‘é€åˆ°å¤šç»ˆç«¯ç­‰ã€‚</p><p>AlertManagerå¯èƒ½æ”¶åˆ°1wæ¡å‘Šè­¦ä¿¡æ¯ï¼Œç»è¿‡å¤„ç†æœ€ç»ˆåªå‘äº†1æ¡åˆ°è‡ªå®šä¹‰å‘Šè­¦å¹³å°ã€‚<br>è€Œè‡ªå®šä¹‰å‘Šè­¦å¹³å°å¯ä»¥å°†è¿™1æ¡å‘Šè­¦ä¿¡æ¯è®°å½•èµ·æ¥ï¼Œä¿®æ”¹å†…å®¹ï¼ŒåŒæ—¶ä½¿ç”¨é‚®ç®±ã€çŸ­ä¿¡é€šçŸ¥åˆ°å¤šä¸ªè´Ÿè´£äººã€‚</p><h4 id="å‘Šè­¦å±‚çº§æ ‡ç­¾è®¾è®¡"><a href="#å‘Šè­¦å±‚çº§æ ‡ç­¾è®¾è®¡" class="headerlink" title="å‘Šè­¦å±‚çº§æ ‡ç­¾è®¾è®¡"></a>å‘Šè­¦å±‚çº§æ ‡ç­¾è®¾è®¡</h4><p>ç›‘æ§å¯¹è±¡çš„ç²’åº¦å†³å®šå‘Šè­¦çš„å±‚çº§ï¼Œä½“ç°åœ¨é…ç½®ä¸Šåˆ™æ˜¯å‘Šè­¦è§„åˆ™çš„åˆ†ç»„ã€‚<br>åˆ†ç»„ä¿¡æ¯å†³å®šalertManagerçš„å¤„ç†æ–¹å¼ã€‚<br>alertManagerå¯¹å‘Šè­¦ä¿¡æ¯çš„è·¯ç”±ç­–ç•¥æ˜¯æ ‘çŠ¶çš„ï¼Œæ‰€ä»¥å¯é€šè¿‡å¤šä¸ªåˆ†ç»„æ ‡ç­¾å®ç°å¤šå±‚çº§è·¯ç”±å¤„ç†ã€‚<br>å…·ä½“è®¾è®¡åº”ç»“åˆä¸šåŠ¡éœ€æ±‚ï¼Œä¸åœ¨è¿™é‡Œå±•å¼€ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹æˆ‘ä¸‹é¢çš„å®ç°ä¸¾ä¾‹ã€‚</p><h2 id="äºŒ-æŠ€æœ¯å®ç°"><a href="#äºŒ-æŠ€æœ¯å®ç°" class="headerlink" title="äºŒ æŠ€æœ¯å®ç°"></a>äºŒ æŠ€æœ¯å®ç°</h2><p>æŠ€æœ¯å®ç°ä¸»è¦åˆ†ä»¥ä¸‹å‡ éƒ¨åˆ†ï¼š</p><ol><li>kubernetesç¯å¢ƒä¸‹prometheusçš„éƒ¨ç½²(kube-prometheus)</li><li>kube-prometheusçš„å¢å¼ºé…ç½®:å³kubernetes_sd_config+relabelæ–¹æ¡ˆçš„å®ç°</li><li>bigdata-exporterçš„å®ç°</li><li>å‘Šè­¦è®¾è®¡å®ä¾‹</li></ol><h3 id="1-kubernetesç¯å¢ƒä¸‹prometheusçš„éƒ¨ç½²"><a href="#1-kubernetesç¯å¢ƒä¸‹prometheusçš„éƒ¨ç½²" class="headerlink" title="1. kubernetesç¯å¢ƒä¸‹prometheusçš„éƒ¨ç½²"></a>1. kubernetesç¯å¢ƒä¸‹prometheusçš„éƒ¨ç½²</h3><h4 id="1-kube-prometheus-vs-prometheus-operator"><a href="#1-kube-prometheus-vs-prometheus-operator" class="headerlink" title="1) kube-prometheus vs prometheus-operator"></a>1) kube-prometheus vs prometheus-operator</h4><p>github ä¸Š coreos ä¸‹æœ‰ä¸¤ä¸ªé¡¹ç›®ï¼š kube-prometheus å’Œ prometheus-operatorï¼Œ<br>ä¸¤è€…éƒ½å¯ä»¥å®ç° prometheus çš„åˆ›å»ºåŠç®¡ç†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œkube-prometheus ä¸Šçš„é…ç½®æ“ä½œä¹Ÿæ˜¯åŸºäº prometheus-operator çš„ï¼Œ<br>å¹¶æä¾›äº†å¤§é‡çš„é»˜è®¤é…ç½®ï¼Œæ•…è¿™é‡Œä½¿ç”¨çš„æ˜¯ kube-prometheus é¡¹ç›®çš„é…ç½®ã€‚</p><p>å¦å¤–ä½¿ç”¨å‰éœ€æ³¨æ„k8sç‰ˆæœ¬è¦æ±‚ï¼Œæ‰¾åˆ°å¯¹åº”çš„kube-prometheusç‰ˆæœ¬ï¼Œå¼„æ¸…æ¥šå¯¹åº”çš„prometheus-operatorç‰ˆæœ¬<br>å¦‚ï¼šk8s1.14ç‰ˆæœ¬æœ€é«˜å¯ä½¿ç”¨ kube-prometheus 0.3ï¼Œå¯¹åº”çš„ prometheus-operator ç‰ˆæœ¬æ˜¯ 0.32<br>é˜…è¯»æ–‡æ¡£æ—¶æ³¨æ„å¯¹åº”ç‰ˆæœ¬ã€‚</p><h4 id="2-kube-prometheus-ä½¿ç”¨å‰è¯´æ˜"><a href="#2-kube-prometheus-ä½¿ç”¨å‰è¯´æ˜" class="headerlink" title="2) kube-prometheus ä½¿ç”¨å‰è¯´æ˜"></a>2) kube-prometheus ä½¿ç”¨å‰è¯´æ˜</h4><p>kube-prometheus ä½¿ç”¨ jsonnet ç¼–å†™é…ç½®æ¨¡æ¿æ–‡ä»¶ï¼Œç”Ÿæˆk8sé…ç½®æ¸…å•<br>å·²æä¾›é»˜è®¤æ¸…å•æ–‡ä»¶ï¼Œåœ¨ manifests æ–‡ä»¶å¤¹ä¸‹<br>å¦‚æœéœ€è¦ä¿®æ”¹é»˜è®¤æ¸…å•é…ç½®ï¼Œéœ€è¦åœ¨goç¯å¢ƒä¸‹ä½¿ç”¨jpç¼–è¯‘æ¸…å•<br>ä¸‹é¢éƒ½ä»¥é»˜è®¤é…ç½®ä¸ºä¾‹</p><h4 id="3-å®‰è£…æ•™ç¨‹"><a href="#3-å®‰è£…æ•™ç¨‹" class="headerlink" title="3) å®‰è£…æ•™ç¨‹"></a>3) å®‰è£…æ•™ç¨‹</h4><p>å‚è€ƒå®˜æ–¹è¯´æ˜å³å¯</p><ol><li>git clone é¡¹ç›® å¹¶åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯</li><li>kubectl create<br>æ¸…å•æ–‡ä»¶ä¸­å„é…ç½®å·²é™„å¸¦namespaceä¿¡æ¯ï¼Œæ•…æ‰§è¡Œæ—¶ä¸éœ€è¦æŒ‡å®šnamespaceï¼Œå¦åˆ™å¯èƒ½å‡ºé”™ã€‚<br>å®˜æ–¹å‘½ä»¤å¦‚ä¸‹ï¼š <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">Create the namespace and CRDs, and <span class="keyword">then</span> <span class="built_in">wait</span> <span class="keyword">for</span> them to be availble before creating the remaining resources</span></span><br><span class="line"></span><br><span class="line">kubectl create -f manifests/setup</span><br><span class="line">until kubectl get servicemonitors --all-namespaces ; do date; sleep 1; echo &quot;&quot;; done</span><br><span class="line">kubectl create -f manifests/</span><br></pre></td></tr></table></figure></li></ol><h3 id="2-kubernetes-sd-config-relabelæ–¹æ¡ˆçš„å®ç°"><a href="#2-kubernetes-sd-config-relabelæ–¹æ¡ˆçš„å®ç°" class="headerlink" title="2. kubernetes_sd_config+relabelæ–¹æ¡ˆçš„å®ç°"></a>2. kubernetes_sd_config+relabelæ–¹æ¡ˆçš„å®ç°</h3><p>è§ï¼š <a href="https://github.com/linshenkx/kube-prometheus-enhance">https://github.com/linshenkx/kube-prometheus-enhance</a></p><h3 id="3-bigdata-exporterçš„å®ç°"><a href="#3-bigdata-exporterçš„å®ç°" class="headerlink" title="3. bigdata-exporterçš„å®ç°"></a>3. bigdata-exporterçš„å®ç°</h3><p>hdfsã€yarnã€hbaseã€yarnç­‰ç»„ä»¶éƒ½æä¾›äº†webè·å–jmxæŒ‡æ ‡çš„æ–¹å¼ã€‚</p><p>è¿™é‡Œçš„æ€è·¯æ˜¯ä½¿ç”¨ä¸€ä¸ªbigdata-exporterï¼Œå»é‡‡é›†å¤šä¸ªç»„ä»¶å¤šä¸ªèŠ‚ç‚¹çš„æŒ‡æ ‡æ•°æ®ï¼Œå¹¶è¿›è¡Œè½¬æ¢ï¼Œç„¶åä»¥Prometheusè§„å®šçš„æ ¼å¼å¯¹å¤–å…¬å¼€ã€‚</p><p>æŒ‡æ ‡æ•°æ®çš„è½¬æ¢è§„åˆ™å¯ä»¥æŸ¥çœ‹githubä¸Šçš„ä¸€äº›é¡¹ç›®ï¼Œè¦æ³¨æ„ç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥åƒæˆ‘ä¸€æ ·è‡ªå·±å†™ï¼Œæ›´å¯é ã€‚</p><p>bigdata-exporterå¦‚ä½•æ„ŸçŸ¥åˆ°é‡‡é›†ç›®æ ‡ï¼Ÿ</p><p>é™¤äº†éƒ¨ç½²ipä¸åŒï¼Œä¸åŒç»„ä»¶ä¸åŒè§’è‰²çš„æŒ‡æ ‡å¯¹å¤–ç«¯å£ã€è·¯å¾„ã€å†…å®¹ï¼ˆè§£æè§„åˆ™ï¼‰ä¹Ÿéƒ½ä¸ä¸€æ ·ã€‚<br>è¿™é‡Œå¯ä»¥å‚è€ƒä¸Šé¢kubernetes_sd_config+relabelçš„æ–¹æ¡ˆï¼Œåšå¾—ä¼˜é›…ä¸€äº›ï¼š</p><ol><li>æˆäºˆbigdata-exporterè°ƒç”¨kubernetes appçš„èƒ½åŠ›ï¼Œ</li><li>åˆ©ç”¨labelå’Œannotationsè¿›è¡Œç­›é€‰å’Œä¿¡æ¯ä¼ é€’ï¼Œç¡®å®šæ•æ‰ç›®æ ‡å’Œé€”å¾„ã€‚</li><li>ä½¿ç”¨roleä»£è¡¨è§£æå†…å®¹çš„ç±»å‹ï¼Œæ ¹æ®roleç¡®å®šè§£æè§„åˆ™<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">labels:</span></span><br><span class="line">  <span class="attr">bigData.metrics.object:</span> <span class="string">pod</span></span><br><span class="line"><span class="attr">annotations:</span></span><br><span class="line">  <span class="attr">bigData.metrics/scrape:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">  <span class="attr">bigData.metrics/scheme:</span> <span class="string">&quot;https&quot;</span></span><br><span class="line">  <span class="attr">bigData.metrics/path:</span> <span class="string">&quot;/jmx&quot;</span></span><br><span class="line">  <span class="attr">bigData.metrics/port:</span> <span class="string">&quot;29871&quot;</span></span><br><span class="line">  <span class="attr">bigData.metrics/role:</span> <span class="string">&quot;hdfs-nn,common&quot;</span></span><br></pre></td></tr></table></figure><h3 id="4-å‘Šè­¦è®¾è®¡ç¤ºä¾‹"><a href="#4-å‘Šè­¦è®¾è®¡ç¤ºä¾‹" class="headerlink" title="4. å‘Šè­¦è®¾è®¡ç¤ºä¾‹"></a>4. å‘Šè­¦è®¾è®¡ç¤ºä¾‹</h3>è¿™é‡Œä»¥<em>ç»„</em>å’Œ<em>å®ä¾‹</em>ä¸¤ä¸ªç»´åº¦ä¸ºä¾‹ï¼Œç”¨groupIdå’ŒinstanceIdè¡¨ç¤ºã€‚</li></ol><h4 id="1-alertManageré…ç½®ç¤ºä¾‹"><a href="#1-alertManageré…ç½®ç¤ºä¾‹" class="headerlink" title="1) alertManageré…ç½®ç¤ºä¾‹"></a>1) alertManageré…ç½®ç¤ºä¾‹</h4><p>ä»¥ä¸‹æ˜¯alertmanagerçš„è§„åˆ™é…ç½®ï¼Œæœ‰ä¸¤ä¸ªæ¥æ”¶è€…ï¼Œ<br>å…¶ä¸­ test.web.hook æŒ‡å‘è‡ªå®šä¹‰å‘Šè­¦å¹³å°<br>default æ˜¯ç©ºç™½æ¥æ”¶è€…ï¼Œä¸åšå¤„ç†ã€‚<br>è·¯ç”±ç­–ç•¥æ˜¯æ ¹æ®groupId,instanceIdåˆ†ç»„ï¼Œå¯¹èŠ‚ç‚¹ç£ç›˜ä½¿ç”¨ç‡ã€kafkaé˜Ÿåˆ—å †ç§¯ä¸¤ä¸ªç»„å¤„ç†ï¼ŒinstanceIdè¿˜æ²¡æœ‰å±•å¼€ã€‚</p><p>æ—§ç‰ˆæœ¬æ˜¯ç”¨secretçš„dataå­—æ®µï¼Œéœ€è¦å°†é…ç½®å†…å®¹è½¬æˆbase64ç¼–ç æ ¼å¼ã€‚<br>æ–°ç‰ˆæœ¬ç›´æ¥ç”¨stringDataå­—æ®µã€‚æ¨èç”¨stringDataå­—æ®µé…ç½®ã€‚<br>å…¶å®åªè¦çœ‹ä¸€ä¸‹kube-prometheusçš„alertmanager-secret.yamlæ–‡ä»¶å°±çŸ¥é“æ€ä¹ˆå›äº‹äº†ã€‚</p><p>ä½¿ç”¨dataå­—æ®µçš„é…ç½®æ–¹æ³•ï¼š<br>å†™å¥½configæ–‡ä»¶ï¼Œä»¥ alertmanager.yaml å‘½åï¼ˆä¸èƒ½ä½¿ç”¨å…¶ä»–åç§°ï¼‰ã€‚<br>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤,å³å¯æ›´æ–°secretã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n monitoring create secret generic alertmanager-main --from-file=alertmanager.yaml --dry-run -o yaml  |  kubectl -n=monitoring apply -f -</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">resolve_timeout:</span> <span class="string">5m</span></span><br><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;default&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;test.web.hook&#x27;</span></span><br><span class="line">    <span class="attr">webhook_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">url:</span> <span class="string">&#x27;http://alert-url&#x27;</span></span><br><span class="line"><span class="attr">route:</span></span><br><span class="line">  <span class="attr">receiver:</span> <span class="string">&#x27;default&#x27;</span></span><br><span class="line">  <span class="attr">group_wait:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">group_interval:</span> <span class="string">5m</span></span><br><span class="line">  <span class="attr">repeat_interval:</span> <span class="string">2h</span></span><br><span class="line">  <span class="attr">group_by:</span> [<span class="string">groupId</span>,<span class="string">instanceId</span>]</span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">receiver:</span> <span class="string">&#x27;test.web.hook&#x27;</span></span><br><span class="line">      <span class="attr">continue:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">match:</span></span><br><span class="line">        <span class="attr">groupId:</span> <span class="string">node-disk-usage</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">receiver:</span> <span class="string">&#x27;test.web.hook&#x27;</span></span><br><span class="line">      <span class="attr">continue:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">match:</span></span><br><span class="line">        <span class="attr">groupId:</span> <span class="string">kafka-topic-highstore</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-alertRuleé…ç½®ç¤ºä¾‹"><a href="#2-alertRuleé…ç½®ç¤ºä¾‹" class="headerlink" title="2) alertRuleé…ç½®ç¤ºä¾‹"></a>2) alertRuleé…ç½®ç¤ºä¾‹</h4><p>ç»„ä»£è¡¨ä¸€ä¸ªç±»å‹çš„æ‰€æœ‰ç›®æ ‡ï¼šå³æ‰€æœ‰èŠ‚ç‚¹<br>å®ä¾‹åˆ™ä»£è¡¨å…·ä½“çš„æŸä¸ªèŠ‚ç‚¹</p><p>disk-usage.yaml.ftlç£ç›˜ä½¿ç”¨ç‡å‘Šè­¦é…ç½®ç¤ºä¾‹å¦‚ä¸‹ï¼š<br>æ³¨æ„ï¼š${path}ä¸ºç›‘æ§çš„ç£ç›˜è·¯å¾„ï¼Œ${thresholdValue}ä¸ºä½¿ç”¨ç‡é˜ˆå€¼ï¼Œéœ€è‡ªè¡Œæ›¿æ¢<br>labelsä¸­çš„userIdså’Œreceiversä¸ºä¼ é€’ç»™è‡ªå®šä¹‰å‘Šè­¦å¹³å°çš„å‚æ•°ï¼Œä»¥æŒ‡å¯¼å‘Šè­¦å¹³å°å¦‚ä½•æ“ä½œã€‚<br>åœ¨è¿™ä¸ªä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç»„ç²’åº¦çš„ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰ï¼Œæ‰€ä»¥ä¸éœ€è¦è®¾ç½®instanceIdã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">monitoring.coreos.com/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PrometheusRule</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">   <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">   <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">role:</span> <span class="string">alert-rules</span></span><br><span class="line">   <span class="attr">name:</span> <span class="string">node-disk-usage</span></span><br><span class="line">   <span class="attr">namespace:</span> <span class="string">monitoring</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">   <span class="attr">groups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">node-disk-usage</span></span><br><span class="line">        <span class="attr">rules:</span></span><br><span class="line">           <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">node-disk-usage</span></span><br><span class="line">             <span class="attr">expr:</span> <span class="number">100</span><span class="string">*(1-node_filesystem_avail_bytes&#123;mountpoint=&quot;$&#123;path&#125;&quot;&#125;/node_filesystem_size_bytes&#123;mountpoint=&quot;$&#123;path&#125;&quot;&#125;</span> <span class="string">)</span> <span class="string">&gt;</span> <span class="string">$&#123;thresholdValue&#125;</span></span><br><span class="line">             <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">             <span class="attr">labels:</span></span><br><span class="line">                <span class="attr">groupId:</span> <span class="string">node-disk-usage</span></span><br><span class="line">                <span class="attr">userIds:</span> <span class="string">super</span></span><br><span class="line">                <span class="attr">receivers:</span> <span class="string">SMS</span></span><br><span class="line">             <span class="attr">annotations:</span></span><br><span class="line">                <span class="attr">title:</span> <span class="string">&quot;ç£ç›˜è­¦å‘Šï¼šèŠ‚ç‚¹<span class="template-variable">&#123;&#123;$labels.instance&#125;&#125;</span>çš„ $&#123;path&#125; ç›®å½•ä½¿ç”¨ç‡å·²è¾¾åˆ°<span class="template-variable">&#123;&#123;$value&#125;&#125;</span>%&quot;</span></span><br><span class="line">                <span class="attr">content:</span> <span class="string">&quot;ç£ç›˜è­¦å‘Šï¼šèŠ‚ç‚¹<span class="template-variable">&#123;&#123;$labels.instance&#125;&#125;</span>çš„ $&#123;path&#125; ç›®å½•ä½¿ç”¨ç‡å·²è¾¾åˆ°<span class="template-variable">&#123;&#123;$value&#125;&#125;</span>%&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>kafka-topic-highstore.yaml.ftl kafkaé˜Ÿåˆ—æ¶ˆè´¹å †ç§¯å‘Šè­¦é…ç½®ç¤ºä¾‹å¦‚ä¸‹ï¼š<br>æˆ‘ä»¬åªå…³å¿ƒä¸ªåˆ«é˜Ÿåˆ—çš„æ¶ˆè´¹æƒ…å†µï¼Œæ‰€ä»¥è¿™é‡Œçš„ç²’åº¦ä¸ºinstanceã€‚<br>æ³¨æ„ï¼š${uniqueName}ä¸ºé˜Ÿåˆ—åï¼Œ${consumergroup}ä¸ºæ¶ˆè´¹ç»„åç§°ï¼Œ${thresholdValue}ä¸ºå †ç§¯æ•°é‡é˜ˆå€¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">monitoring.coreos.com/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PrometheusRule</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">role:</span> <span class="string">alert-rules</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kafka-topic-highstore-$&#123;uniqueName&#125;</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">monitoring</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">groups:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kafka-topic-highstore</span></span><br><span class="line">      <span class="attr">rules:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">kafka-topic-highstore-$&#123;uniqueName&#125;</span></span><br><span class="line">        <span class="attr">expr:</span> <span class="string">sum(kafka_consumergroup_lag&#123;exporterType=&quot;kafka&quot;,consumergroup=&quot;$&#123;consumergroup&#125;&quot;&#125;)</span> <span class="string">&gt;</span> <span class="string">$&#123;thresholdValue&#125;</span></span><br><span class="line">        <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">groupId:</span> <span class="string">kafka-topic-highstore</span></span><br><span class="line">          <span class="attr">instanceId:</span> <span class="string">$&#123;uniqueName&#125;</span></span><br><span class="line">          <span class="attr">userIds:</span> <span class="string">super</span></span><br><span class="line">          <span class="attr">receivers:</span> <span class="string">SMS</span></span><br><span class="line">        <span class="attr">annotations:</span></span><br><span class="line">          <span class="attr">title:</span> <span class="string">&quot;KAFKAè­¦å‘Šï¼šæ¶ˆè´¹ç»„$&#123;consumergroup&#125;çš„å †ç§¯æ•°é‡è¾¾åˆ°:<span class="template-variable">&#123;&#123;$value&#125;&#125;</span>&quot;</span></span><br><span class="line">          <span class="attr">content:</span> <span class="string">&quot;KAFKAè­¦å‘Šï¼šæ¶ˆè´¹ç»„$&#123;consumergroup&#125;çš„å †ç§¯æ•°é‡è¾¾åˆ°:<span class="template-variable">&#123;&#123;$value&#125;&#125;</span>&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ä¸‰-å…¶ä»–"><a href="#ä¸‰-å…¶ä»–" class="headerlink" title="ä¸‰ å…¶ä»–"></a>ä¸‰ å…¶ä»–</h2><h3 id="å‘Šè­¦æµç¨‹ç¤ºä¾‹"><a href="#å‘Šè­¦æµç¨‹ç¤ºä¾‹" class="headerlink" title="å‘Šè­¦æµç¨‹ç¤ºä¾‹"></a>å‘Šè­¦æµç¨‹ç¤ºä¾‹</h3><p>è¿™é‡Œä»¥ä¸¤ä¸ªèŠ‚ç‚¹node1å’Œnode2é…ç½®äº†ç£ç›˜ç©ºé—´ç›‘æ§ä¸ºä¾‹ï¼Œç©ºé—´ä½¿ç”¨åˆ°è¾¾é˜ˆå€¼åˆ™è§¦å‘å‘Šè­¦ã€‚<br>ï¼ˆæµ‹è¯•è¿‡ç¨‹ä¸­å¯é€šè¿‡ç”Ÿæˆã€åˆ é™¤æŒ‡å®šä½“ç§¯çš„æ–‡ä»¶æ¥æ§åˆ¶ç©ºé—´å ç”¨ï¼‰</p><p>å…¶ä¸­é…ç½®é¡¹å¦‚ä¸‹ï¼š</p><ul><li>å‘Šè­¦è§„åˆ™:node-disk-usage <ul><li>for ä¸º 1m</li></ul></li><li>å‘Šè­¦ä¸­å¿ƒ:alertManager <ul><li>group_wait: 30s</li><li>group_interval: 5m</li><li>repeat_interval: 10m</li></ul></li></ul><p>æ”¶åˆ°çš„å‘Šè­¦çŸ­ä¿¡å†…å®¹åŠæ—¶é—´çº¿å¦‚ä¸‹ï¼š</p><ul><li>10:23:14æ”¶åˆ°ç¬¬ä¸€æ¬¡è­¦æŠ¥ï¼š<br>node1äº 10:22:44 è¿›å…¥å¼‚å¸¸</li><li>10:28:14æ”¶åˆ°ç¬¬äºŒæ¬¡è­¦æŠ¥ï¼š<br>node1äº 10:22:44 è¿›å…¥å¼‚å¸¸<br>node2äº 10:24:44 è¿›å…¥å¼‚å¸¸</li><li>10:38:29æ”¶åˆ°ç¬¬ä¸‰æ¬¡è­¦æŠ¥ï¼š<br>node1äº 10:22:44 è¿›å…¥å¼‚å¸¸<br>node2äº 10:24:44 è¿›å…¥å¼‚å¸¸</li><li>10:48:44æ”¶åˆ°ç¬¬å››æ¬¡è­¦æŠ¥ï¼š<br>node1äº 10:22:44 è¿›å…¥å¼‚å¸¸<br>node2äº 10:24:44 è¿›å…¥å¼‚å¸¸</li><li>10:58:44æ”¶åˆ°ç¬¬äº”æ¬¡è­¦æŠ¥ï¼šæ¢å¤å‘Šè­¦<br>node1äº 10:22:44 è¿›å…¥å¼‚å¸¸ï¼Œå¹¶äº10:55:44æ¢å¤<br>node2äº 10:24:44 è¿›å…¥å¼‚å¸¸ï¼Œå¹¶äº10:49:14æ¢å¤</li></ul><p>æ€»å…±æ”¶åˆ°5æ¬¡çŸ­ä¿¡ï¼Œç¬¬1æ¬¡æ˜¯node1å¼‚å¸¸ï¼Œ<br>ç¬¬2åˆ°4æ¬¡æ˜¯node1å’Œnode2éƒ½å¼‚å¸¸ï¼Œå› ä¸ºå±äºåŒä¸ªåˆ†ç»„groupï¼Œæ‰€ä»¥åˆå¹¶å‘é€ã€‚<br>ç¬¬5æ¬¡æ˜¯å·²ç»æ¢å¤æ­£å¸¸äº†ã€‚<br>æ ¹æ®çŸ­ä¿¡å†…å®¹å’Œæ—¶é—´ï¼Œæ•´ç†å‡ºå‘Šè­¦é€»è¾‘æ—¶é—´çº¿å¦‚ä¸‹ï¼š</p><ol><li>node1ç­‰å¾…for <strong>1åˆ†é’Ÿ</strong> åè­¦æŠ¥è¿›å…¥group<br>node1è®°å½•å¼‚å¸¸æ—¶é—´ä¸º10:22:44ï¼Œå®é™…å¼‚å¸¸çŠ¶æ€è‡³å°‘åœ¨10:22:44çš„ä¸€åˆ†é’Ÿå‰</li><li>groupç­‰å¾…group_wait <strong>30s</strong> åå‘é€ç¬¬ä¸€æ¬¡å‘Šè­¦<br>firing:node1</li><li>node2ç­‰å¾…for <strong>1åˆ†é’Ÿ</strong> åè­¦æŠ¥è¿›å…¥group<br>node2è®°å½•å¼‚å¸¸æ—¶é—´ä¸º10:24:44ï¼Œå®é™…å¼‚å¸¸çŠ¶æ€è‡³å°‘åœ¨10:24:44çš„ä¸€åˆ†é’Ÿå‰<br>æ­¤æ—¶groupä¸­æœ‰ä¸¤ä¸ªå¼‚å¸¸ç›®æ ‡node1å’Œnode2</li><li>groupç­‰å¾…group_interval <strong>5m</strong> åå‘é€ç¬¬äºŒæ¬¡å‘Šè­¦<br>firing:node1,node2<br>æ³¨æ„ï¼šå› ä¸ºgroupå‘ç”Ÿäº†å˜åŒ–ï¼Œæ‰€ä»¥è¿™é‡Œç”¨çš„æ˜¯group_interval</li><li>groupç­‰å¾…repeat_interval <strong>10m</strong> åå‘é€ç¬¬ä¸‰æ¬¡å‘Šè­¦<br>firing:node1,node2<br>æ³¨æ„ï¼šå› ä¸ºgroupæ²¡æœ‰å˜åŒ–ï¼Œå±äºé‡å¤å‘Šè­¦ï¼Œç”¨çš„æ˜¯repeat_interval</li><li>groupç­‰å¾…repeat_interval <strong>10m</strong> åå‘é€ç¬¬å››æ¬¡å‘Šè­¦<br>firing:node1,node2<br>åŒä¸Šä¸€æ¬¡</li><li>ç¬¬å››æ¬¡å‘Šè­¦åçš„ å‰5åˆ†é’Ÿï¼š node2æ¢å¤æ­£å¸¸</li><li>ç¬¬å››æ¬¡å‘Šè­¦åçš„ å5åˆ†é’Ÿï¼š node1æ¢å¤æ­£å¸¸</li><li>groupç­‰å¾…repeat_interval <strong>10m</strong> åå‘é€ç¬¬äº”æ¬¡å‘Šè­¦<br>resolved:node1,node2<br>æ³¨æ„ï¼Œè¿™é‡Œnode1,node2éƒ½æ¢å¤æ­£å¸¸ç”¨çš„ä¹Ÿæ˜¯repeat_interval</li></ol><p>ç»¼ä¸Šï¼š</p><ul><li>for<br>æ˜¯å‘Šè­¦è§„åˆ™ä¸ªä½“çš„ç›‘æ§é…ç½®ï¼Œç”¨æ¥è¡¡é‡æœåŠ¡å¤šä¹…æ£€æµ‹ä¸é€šè¿‡æ‰ç®—å¼‚å¸¸</li><li>group_wait åˆæ¬¡å‘é€å‘Šè­¦çš„ç­‰å¾…æ—¶é—´<br>ç”¨äºgroupåˆ›å»ºåçš„ç­‰å¾…ï¼Œè¿™ä¸ªå€¼é€šå¸¸è®¾ç½®è¾ƒå°ï¼Œåœ¨å‡ åˆ†é’Ÿä»¥å†…</li><li>group_interval åŒä¸€ä¸ªç»„å…¶ä»–æ–°å‘ç”Ÿçš„å‘Šè­¦å‘é€æ—¶é—´é—´éš”<br>æ˜¯groupå†…å®¹å‘ç”Ÿå˜åŒ–åçš„å‘Šè­¦é—´éš”</li><li>repeat_interval é‡å¤å‘é€åŒä¸€ä¸ªå‘Šè­¦çš„æ—¶é—´é—´éš”<br>groupå†…å®¹æ²¡æœ‰å˜åŒ–ä¸”ä¸Šä¸€æ¬¡å‘ç”ŸæˆåŠŸæ—¶ç”¨çš„å‘ç”Ÿé—´éš”</li></ul><p>éœ€è¦æ³¨æ„ï¼Œæ¢å¤æ­£å¸¸ä¸å±äºgroupå˜åŒ–ï¼Œç”¨çš„æ˜¯repeat_intervalã€‚<br>è¿™æœ‰ç‚¹åç›´è§‰ï¼Œä¸”ä¸ªäººè®¤ä¸ºä¸æ˜¯å¾ˆåˆç†ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æµ‹è¯•æœ‰é—®é¢˜ï¼Œä¹Ÿæ²¡æœ‰æ‰¾åˆ°æ¯”è¾ƒå¥½çš„èµ„æ–™è¯´æ˜ã€‚<br>å¸Œæœ›çŸ¥é“çš„å¯ä»¥æŒ‡æ•™ä¸€ä¸‹ã€‚</p><h3 id="exporterçš„ä½ç½®"><a href="#exporterçš„ä½ç½®" class="headerlink" title="exporterçš„ä½ç½®"></a>exporterçš„ä½ç½®</h3><p>exporterå¯ä»¥ä»¥sidecarçš„å½¢å¼å’ŒåŸå®¹å™¨æ”¾åœ¨åŒä¸€ä¸ªpodå†…ï¼ˆ1å¯¹1ï¼‰ï¼Œä¹Ÿå¯ä»¥ä»¥ç‹¬ç«‹éƒ¨ç½²çš„å½¢å¼å­˜åœ¨ï¼ˆ1å¯¹1/1å¯¹å¤šï¼‰ã€‚<br>è¿™ä¸ªè§†å…·ä½“æƒ…å†µè€Œå®šï¼ŒæŠ€æœ¯ä¸Šæ²¡ä»€ä¹ˆä¸åŒï¼Œsidecarå¯ä»¥ç»‘å®šç”Ÿå‘½å‘¨æœŸï¼Œè§†ä¸ºå¯¹åŸæœ‰ç»„ä»¶çš„è¡¥å……ã€‚ç‹¬ç«‹éƒ¨ç½²åˆ™è€¦åˆåº¦æ›´ä½ï¼Œæ›´çµæ´»ã€‚<br>åƒå•èŠ‚ç‚¹çš„mysqlï¼Œç”¨sidecaråˆ™åªéœ€è¦1ä¸ªpodï¼Œä¸ä¼šå¤ªå¤æ‚ã€‚<br>è€Œå¦‚æœåƒå¤šèŠ‚ç‚¹çš„kafkaé›†ç¾¤ï¼Œç”¨ç‹¬ç«‹éƒ¨ç½²åˆ™åªéœ€è¦ä¸€ä¸ªexporterå°±å¯ä»¥å®ç°å¯¹å¤šä¸ªèŠ‚ç‚¹çš„é‡‡é›†ç›‘æ§ã€‚</p><p>è¿™é‡Œå‡ºäºå‡å°è€¦åˆã€èŠ‚çœèµ„æºçš„ç›®çš„ï¼Œæˆ‘ä¸»è¦ä½¿ç”¨çš„æ˜¯ç‹¬ç«‹éƒ¨ç½²å½¢å¼ã€‚</p><h3 id="ä½¿ç”¨promtoolæ£€æŸ¥æŒ‡æ ‡æ ¼å¼æ˜¯å¦æ­£ç¡®"><a href="#ä½¿ç”¨promtoolæ£€æŸ¥æŒ‡æ ‡æ ¼å¼æ˜¯å¦æ­£ç¡®" class="headerlink" title="ä½¿ç”¨promtoolæ£€æŸ¥æŒ‡æ ‡æ ¼å¼æ˜¯å¦æ­£ç¡®"></a>ä½¿ç”¨promtoolæ£€æŸ¥æŒ‡æ ‡æ ¼å¼æ˜¯å¦æ­£ç¡®</h3><p>promtool ä½¿ç”¨æ–¹æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥pod</span></span><br><span class="line"> kubectl -n=monitoring exec -it prometheus-k8s-0  sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å¸®åŠ©</span></span><br><span class="line">promtool -h</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ£€æŸ¥æŒ‡æ ‡æ ¼å¼</span></span><br><span class="line">curl -s http://ip:9999/metrics | promtool check metrics</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¯”æ–¹è¯´ æŒ‡æ ‡nameã€labelnameä¸èƒ½ä½¿ç”¨å°æ•°ç‚¹</p><h3 id="ä½¿ç”¨port-forwardä¸´æ—¶æä¾›Prometheuså¤–éƒ¨è®¿é—®"><a href="#ä½¿ç”¨port-forwardä¸´æ—¶æä¾›Prometheuså¤–éƒ¨è®¿é—®" class="headerlink" title="ä½¿ç”¨port-forwardä¸´æ—¶æä¾›Prometheuså¤–éƒ¨è®¿é—®"></a>ä½¿ç”¨port-forwardä¸´æ—¶æä¾›Prometheuså¤–éƒ¨è®¿é—®</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> prometheus</span></span><br><span class="line">nohup  kubectl port-forward --address 0.0.0.0 service/prometheus-k8s 19090:9090 -n=monitoring &amp;</span><br><span class="line"><span class="meta">#</span><span class="bash"> grafana</span></span><br><span class="line">nohup kubectl port-forward --address 0.0.0.0 service/grafana 13000:3000 -n=monitoring &amp;</span><br><span class="line"><span class="meta">#</span><span class="bash"> alertmanager</span></span><br><span class="line">nohup  kubectl port-forward --address 0.0.0.0 service/alertmanager-main 9093:9093 -n=monitoring &amp;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”¨ <code>jobs -l</code> å¯ä»¥æŸ¥çœ‹</p><h3 id="kube-prometheuså¯¹armçš„æ”¯æŒ"><a href="#kube-prometheuså¯¹armçš„æ”¯æŒ" class="headerlink" title="kube-prometheuså¯¹armçš„æ”¯æŒ"></a>kube-prometheuså¯¹armçš„æ”¯æŒ</h3><p>ç›®æ ‡æ˜¯æ‰¾åˆ°kube-prometheusç”¨åˆ°çš„é•œåƒçš„armç‰ˆæœ¬</p><p>å¯ä»¥ä½¿ç”¨ <a href="https://quay.io/">https://quay.io/</a> æœç´¢</p><p>ä»¥ä¸‹æ˜¯ç”¨åˆ°çš„é•œåƒå’Œå„è‡ªå¯¹armçš„æ”¯æŒæƒ…å†µã€‚<br>æ³¨æ„å¯¹ç…§è‡ªå·±ä½¿ç”¨çš„ç‰ˆæœ¬ï¼Œå¾ˆå¤šé•œåƒé«˜ç‰ˆæœ¬éƒ½æ”¯æŒarmäº†</p><p>æœªæ ‡è®°ï¼ˆä¸æ”¯æŒï¼‰å…¶å®ä¹Ÿæ˜¯å¯ä»¥ç”¨ï¼Œä½†ä¸ä¿è¯</p><p>quay.io/prometheus/prometheus:v2.11.0  æ”¯æŒarmï¼ˆv2.10.0å¼€å§‹ï¼‰<br>quay.io/prometheus/alertmanager:v0.18.0 æ”¯æŒarmï¼ˆv0.17.0å¼€å§‹ï¼‰<br>quay.io/coreos/kube-state-metrics:v1.8.0  æœªæ ‡è®°ï¼ˆä¸æ”¯æŒï¼‰<br>quay.io/coreos/kube-rbac-proxy:v0.4.1   æœªæ ‡è®°ï¼ˆä¸æ”¯æŒï¼‰<br>quay.io/prometheus/node-exporter:v0.18.1   æ”¯æŒarmï¼ˆv0.18.0å¼€å§‹ï¼‰<br>quay.io/coreos/prometheus-operator:v0.34.0  ä¸æ”¯æŒarmï¼ˆv0.39å¼€å§‹ï¼‰ ä¿®æ”¹æˆä½¿ç”¨0.39.0ï¼Œ0.39ä»¥åçš„prometheusè¦æ±‚k8så¿…é¡»&gt;=1.16<br>quay.io/coreos/configmap-reload:v0.0.1  æœªæ ‡è®°ï¼ˆä¸æ”¯æŒï¼‰<br>grafana/grafana:6.4.3 å®˜æ–¹è¯´æ”¯æŒarmï¼Œä½†å…¶å®ä¸æ”¯æŒï¼Œæœ‰bugï¼Œè§ï¼š<a href="https://bleepcoder.com/cn/grafana/501674494/docker-arm-images-doesn-t-work-since-v6-4-x">https://bleepcoder.com/cn/grafana/501674494/docker-arm-images-doesn-t-work-since-v6-4-x</a></p><p>quay.io/coreos/k8s-prometheus-adapter-amd64:v0.5.0 æœªæ‰¾åˆ°armç‰ˆæœ¬é•œåƒ<br>æœ€æ–°çš„å®˜æ–¹ç‰ˆæœ¬å·²ç»æ”¹ç”¨ directxman12/k8s-prometheus-adapter:v0.8.4<br>è€Œdirectxman12/k8s-prometheus-adapter:v0.5.0 å¼€å§‹æ”¯æŒarm<br>è§ï¼š<a href="https://hub.docker.com/r/directxman12/k8s-prometheus-adapter/tags">https://hub.docker.com/r/directxman12/k8s-prometheus-adapter/tags</a></p>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kubernetes </tag>
            
            <tag> prometheus </tag>
            
            <tag> bigdata </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºk8sçš„å®¶ç”¨å¤§æ•°æ®é›†ç¾¤è®¾è®¡ä¸å®ç°</title>
      <link href="//household_k8s_bigdata/"/>
      <url>//household_k8s_bigdata/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨3å°åºŸæ—§ç¬”è®°æœ¬æ­å»ºk8sé›†ç¾¤ï¼Œéƒ¨ç½²å¤§æ•°æ®ç»„ä»¶ï¼Œåˆ©ç”¨è·¯ç”±å™¨è¿›è¡Œå¼‚åœ°ç»„ç½‘ï¼Œé…åˆwslä½œä¸ºç®¡ç†å’Œå®¢æˆ·ç«¯ï¼Œ<br>å®ç°éšæ—¶éšåœ°ï¼Œåœ¨å·¥ä½œç¬”è®°æœ¬ä¸Šä»¥æœ¬åœ°è®¿é—®çš„ä½“éªŒä½¿ç”¨è‡ªå»ºå®¶åº­å¤§æ•°æ®å¹³å°è¿›è¡Œå­¦ä¹ ã€å¼€å‘ã€æµ‹è¯•ã€‚</p><span id="more"></span><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><h3 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h3><p>æœ€è¿‘æ¢äº†ç”µè„‘ï¼Œä¹‹å‰çš„æœºå™¨é—²ç½®ç€æµªè´¹ï¼Œåˆåˆšå¥½çœ‹åˆ°äº†<a href="https://github.com/geekyouth/SZT-bigdata">https://github.com/geekyouth/SZT-bigdata</a> è¿™ä¸ªé¡¹ç›®ï¼Œä¸é”™ä¸é”™ï¼Œè®©æˆ‘æ¥å¯ä»¥åšå¾—æ›´å¥½ã€‚</p><p>ç´¢æ€§è‡ªå·±åœ¨å®¶é‡Œæ­ä¸ªå¤§æ•°æ®é›†ç¾¤æ¥ç©ã€‚è€Œä¸”å¥³æœ‹å‹çš„ç¬”è®°æœ¬ä¹Ÿé—²ç½®ç€ï¼Œå†æœåˆ®ä¸€å°æ¥ç»„ä¸ªé›†ç¾¤ï¼Œå°±å¯ä»¥ä¸ºæ‰€æ¬²ä¸ºäº†ã€‚</p><h3 id="æœ€åˆç›®æ ‡"><a href="#æœ€åˆç›®æ ‡" class="headerlink" title="æœ€åˆç›®æ ‡"></a>æœ€åˆç›®æ ‡</h3><p>åœ¨ä¸»åŠ›æœºçš„wslé‡Œå¯ä»¥æäº¤flinkä»»åŠ¡ï¼Œåœ¨ideaçš„å•å…ƒæµ‹è¯•é‡Œå¯ä»¥é…ç½®wslæ‰§è¡Œhadoopæ“ä½œã€‚<br>è¿™æ ·åŸºæœ¬å°±å¯ä»¥æ»¡è¶³æ—¥å¸¸çš„å¼€å‘æµ‹è¯•éœ€æ±‚äº†ã€‚</p><h2 id="ç‰©ç†é…ç½®åŠç»„ç½‘"><a href="#ç‰©ç†é…ç½®åŠç»„ç½‘" class="headerlink" title="ç‰©ç†é…ç½®åŠç»„ç½‘"></a>ç‰©ç†é…ç½®åŠç»„ç½‘</h2><h3 id="æœºå™¨"><a href="#æœºå™¨" class="headerlink" title="æœºå™¨"></a>æœºå™¨</h3><p>æœåŠ¡å™¨ï¼šlian1ã€lian2ã€lian3 </p><p>è’²å…¬è‹±å®¶ç”¨è·¯ç”±å™¨ï¼ˆå¸¦å†…ç½‘å¼‚åœ°ç»„ç½‘åŠŸèƒ½ï¼‰</p><p>å®¢æˆ·ç«¯ï¼šå·¥ä½œç”¨ç¬”è®°æœ¬ï¼ˆwin11ï¼Œå¸¦wslï¼‰</p><h3 id="ç½‘ç»œé…ç½®"><a href="#ç½‘ç»œé…ç½®" class="headerlink" title="ç½‘ç»œé…ç½®"></a>ç½‘ç»œé…ç½®</h3><p>3å°æœåŠ¡å™¨åˆ©ç”¨ç½‘çº¿è¿æ¥è·¯ç”±å™¨ï¼Œç»„æˆä¸€ä¸ªå±€åŸŸç½‘ã€‚</p><p>åœ¨å®¶çš„æ—¶å€™ç¬”è®°æœ¬ç›´æ¥é€šè¿‡wifiè¿æ¥åˆ°å±€åŸŸç½‘ï¼Œåœ¨å¤–ä¹Ÿè¿˜å¯ä»¥é€šè¿‡è’²å…¬è‹±çš„å¼‚åœ°ç»„ç½‘åŠŸèƒ½è¿æ¥ã€‚å¿½ç•¥ç½‘é€Ÿçš„è¯ä½“éªŒä¸€è‡´ã€‚</p><p>æ³¨æ„ï¼šä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›å†…ç½‘ç©¿é€çš„è½¯ä»¶è¾¾åˆ°ç›¸åŒæ•ˆæœï¼Œä¸æ¨èä¸“é—¨å»ä¹°è·¯ç”±å™¨ã€‚</p><h2 id="æŠ€æœ¯é€‰å‹"><a href="#æŠ€æœ¯é€‰å‹" class="headerlink" title="æŠ€æœ¯é€‰å‹"></a>æŠ€æœ¯é€‰å‹</h2><h3 id="å¤§æ•°æ®å¹³å°é€‰å‹"><a href="#å¤§æ•°æ®å¹³å°é€‰å‹" class="headerlink" title="å¤§æ•°æ®å¹³å°é€‰å‹"></a>å¤§æ•°æ®å¹³å°é€‰å‹</h3><p>æœ¬æ¥åªæ˜¯å‡ºäºå®éªŒç›®çš„ï¼Œæƒ³ç›´æ¥ç”¨cdhï¼Œæ–¹ä¾¿ç®¡ç†ä¸€äº›ã€‚</p><p>CDH6.3.3ä¹‹åæ²¡æœ‰å…è´¹ç¤¾åŒºç‰ˆäº†ã€‚æˆ‘ä¹‹å‰è¿˜éƒ¨ç½²äº†ä¸€å¥—6.3.2çš„ã€‚<br>ä½†æ˜¯ä»2021å¹´2æœˆå¼€å§‹ä¸‹è½½ä¹‹å‰çš„ç‰ˆæœ¬ä¹Ÿè¦è®¢é˜…äº†ï¼Œå¾ˆéº»çƒ¦ã€‚<br>ç®—äº†ï¼Œäººå®¶å°±æ˜¯ä¸æƒ³è®©ä½ ç”¨å…è´¹çš„ï¼Œè€Œä¸”å…è´¹çš„ç»„ä»¶ç‰ˆæœ¬è¿˜è€ï¼Œä¸ç”¨ä¹Ÿç½¢ã€‚</p><p>ç„¶åæˆ‘å°±å¼€å§‹ç‰©è‰²å…¶ä»–çš„ï¼Œhdpä¹Ÿæ—©è¢«cdhæ”¶ç¼–äº†ï¼Œmapræœ¬æ¥å°±æ˜¯ä¸»æ‰“å•†ç”¨çš„ã€‚</p><p>å›½å†…çš„åä¸ºé˜¿é‡Œè…¾è®¯éƒ½æ˜¯äº‘æœåŠ¡ï¼Œä¸ä¼šæä¾›è¿™ç§ç¤¾åŒºç‰ˆã€‚</p><p>å€’æ˜¯æœ‰çœ‹åˆ°UCloudå‡ºäº†ä¸€ä¸ªUSDPçš„å¤§æ•°æ®å¹³å°å…è´¹ç‰ˆã€‚æœ‰ç‚¹æ„æ€ã€‚<br>ç„¶åçœ‹äº†ä¸€ééƒ¨ç½²æ•™ç¨‹å’Œæ“ä½œæ–‡æ¡£ã€‚å—¯ã€‚ã€‚ã€‚å†çœ‹ä¸€çœ¼ç»„ä»¶ç‰ˆæœ¬ï¼Œå—¯ã€‚ã€‚ã€‚</p><p>ç®—äº†ï¼Œè¿˜æ˜¯ç”¨æˆ‘è‡ªå·±çš„åŸºäºk8sçš„æ–¹æ³•éƒ¨ç½²å§</p><h3 id="k8séƒ¨ç½²ç®¡ç†å¹³å°é€‰å‹"><a href="#k8séƒ¨ç½²ç®¡ç†å¹³å°é€‰å‹" class="headerlink" title="k8séƒ¨ç½²ç®¡ç†å¹³å°é€‰å‹"></a>k8séƒ¨ç½²ç®¡ç†å¹³å°é€‰å‹</h3><p>kubernetesç›¸å…³éƒ¨ç½²ç®¡ç†å·¥å…·è¾ƒå¤šï¼Œæˆ‘æ˜¯ä¸æ¨èè‡ªå·±æ‰‹åŠ¨ä¸€æ­¥æ­¥éƒ¨ç½²çš„</p><p>è¿™é‡Œæˆ‘ç”¨çš„æ˜¯ï¼š kubeoperator</p><p>ä½¿ç”¨wsl-dockerä½œä¸ºkubeoperatorçš„ç®¡ç†ç«¯ï¼Œå°†k8séƒ¨ç½²åˆ°3å°æœºå™¨ä¸Š<br>å¹³æ—¶éœ€è¦ç”¨åˆ°ç®¡ç†åŠŸèƒ½çš„æ—¶å€™å†å¯åŠ¨win11ä¸Šçš„dockerå°±è¡Œï¼Œæ—¥å¸¸è¿è¡Œä¸éœ€è¦</p><p>æŒ‰å…¬ç½‘æ•™ç¨‹ä¸€æ­¥æ­¥æ“ä½œå³å¯ï¼Œè¿™é‡Œæœ‰ä¸ªå‘ï¼š<br>ä¸»æœºçš„ipåªèƒ½å¡«ipä¸èƒ½å¡«hostnameï¼Œè™½ç„¶å¡«çš„æ—¶å€™ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯åœ¨ç”Ÿæˆk8sè¯ä¹¦çš„æ—¶å€™ä¼šå¤±è´¥ï¼</p><h2 id="èµ„æºåˆ†é…"><a href="#èµ„æºåˆ†é…" class="headerlink" title="èµ„æºåˆ†é…"></a>èµ„æºåˆ†é…</h2><p>3å°æœºå™¨æœ¬æ¥å°±æ˜¯é—²ç½®æœºï¼Œå”¯ä¸€é…ç½®å¥½ä¸€ç‚¹çš„å‰ä¸»åŠ›æœºçš„32gå†…å­˜ä¹Ÿè¢«æˆ‘æ‹†åˆ°ç°åœ¨çš„ä¸»åŠ›æœºä¸Šäº†ã€‚<br>æœºå™¨é…ç½®éƒ½æ˜¯4æ ¸ï¼Œä½†å†…å­˜åŠ èµ·æ¥æ‰32gï¼Œå¯ä»¥è¯´æ˜¯éå¸¸åƒåœ¾ï¼Œä½†æ˜¯å—é™äºç»æµèƒ½åŠ›ï¼Œæ²¡åŠæ³•ã€‚<br>ä¸è¿‡ä¸€æƒ³åˆ°äº‘æœåŠ¡å™¨1c2gä¹Ÿè¢«æˆ‘è·‘äº†é‚£ä¹ˆå¤šæœåŠ¡ï¼Œ12c32gå¥½åƒä¹Ÿè¿˜ä¸é”™äº†ï¼Œè‡³å°‘æ¯”åœ¨è‡ªå·±ç¬”è®°æœ¬ä¸Šå¼€3å°è™šæ‹Ÿæœºå¼ºã€‚</p><p>ç»å¸¸çœ‹åˆ°ç¾¤é‡Œå‡ºäºå­¦ä¹ è¦æ­å¤§æ•°æ®çš„ï¼Œæ€•è‡ªå·±é…ç½®ä¸å¤Ÿã€‚<br>å¤Ÿä¸å¤Ÿå…¶å®çœ‹éœ€æ±‚ï¼Œåªæ˜¯åšåŠŸèƒ½æµ‹è¯•ã€éªŒè¯çš„ï¼Œæ²¡å¤šå¤§æ•°æ®é‡ï¼Œè€—ä¸äº†å¤šå°‘èµ„æºã€‚<br>å†è¯´ï¼Œå°±ç®—æ•°æ®é‡å¤§ï¼Œåªè¦æ§åˆ¶å¥½ï¼Œåæ­£æœ€åéƒ½æ˜¯åœ¨yarnä¸Šé¢è·‘ï¼Œæ— éå°±æ˜¯æ…¢ä¸€ç‚¹ï¼Œæ€»æ˜¯èƒ½è·‘å®Œï¼ŒæŒ‚ä¸äº†ã€‚<br>æ›´ä½•å†µæˆ‘è¿˜æ˜¯æ”¾åœ¨kubernetesä¸Šçš„ï¼Œå°±ç®—ä¸€ä¸ªæŒ‚äº†ä¹Ÿå½±å“ä¸äº†å…¶ä»–ã€‚è¿™ç‚¹æ¯”cdhè„šæœ¬éƒ¨ç½²å¼ºã€‚</p><p>ä¸‹é¢æ¥çœ‹å„ä¸ªç»„ä»¶çš„å®‰æ’</p><p>ç‰©ç†æœºä¸Šç›´æ¥å¯ç”¨çš„æœ‰ï¼š nfs<br>dockerç›´æ¥å¯ç”¨çš„æœ‰ï¼š dockeré•œåƒä»“åº“ï¼ˆdocker-registryã€docker-registry-web-serverï¼‰ã€mysqlã€ ldapï¼ˆopenldapã€ldapadminï¼‰<br>kubernetesç®¡ç†çš„æœ‰ï¼š</p><h3 id="1-kerberos"><a href="#1-kerberos" class="headerlink" title="1. kerberos"></a>1. kerberos</h3><p>ç”¨äºå¤§æ•°æ®ç»„ä»¶çš„è®¤è¯ï¼Œæ”¯æŒ1ä¸»å¤šä»ï¼Œè¿™é‡Œç»™1ä¸»1ä»ï¼Œæ¯•ç«Ÿæ˜¯æœ€åŸºç¡€çš„ç»„ä»¶ï¼Œå°±è±¡å¾æ€§åœ°é«˜å¯ç”¨å§<br>é…ç½®çš„è¯1c1gå°±å¤Ÿäº†ï¼Œè¿™é‡Œçš„èµ„æºå€¼æ˜¯æŒ‡limitè€Œérequestï¼Œå³æœ€é«˜èƒ½ç”³è¯·åˆ°çš„å†…å­˜ï¼Œå®é™…ç”¨åˆ°çš„ä¼šä½å¾ˆå¤š</p><h3 id="2-zookeeper"><a href="#2-zookeeper" class="headerlink" title="2. zookeeper"></a>2. zookeeper</h3><p>åˆ†å¸ƒå¼åè°ƒï¼Œä¸€èˆ¬æ˜¯å…¶ä»–ç»„ä»¶å®ç°é«˜å¯ç”¨çš„åŸºç¡€ã€‚è‡³å°‘3å°ï¼Œ1c1gã€‚</p><h3 id="3-elasticsearch"><a href="#3-elasticsearch" class="headerlink" title="3. elasticsearch"></a>3. elasticsearch</h3><p>æœç´¢å¼•æ“ï¼Œè¿™ä¸ªæ˜¯ç»™rangerå­˜å‚¨å®¡è®¡æ—¥å¿—ç”¨çš„ã€‚æ”¯æŒå¤šä¸ªï¼Œä½†1ä¸ªå°±å¤Ÿäº†ï¼Œ1c1gã€‚</p><h3 id="4-ranger"><a href="#4-ranger" class="headerlink" title="4. ranger"></a>4. ranger</h3><p>ç”¨äºå¤§æ•°æ®æƒé™ç®¡ç†ï¼Œä¸»è¦è·‘ä¸¤ä¸ªç¨‹åºï¼š<br>ranger-adminæä¾›rangeræ ¸å¿ƒæœåŠ¡å’Œwebç®¡ç†åŠŸèƒ½<br>ranger-usersyncè´Ÿè´£ä»ldapåŒæ­¥ç”¨æˆ·è´¦æˆ·ä¿¡æ¯</p><h3 id="5-hdfs"><a href="#5-hdfs" class="headerlink" title="5. hdfs"></a>5. hdfs</h3><p>å¤§æ•°æ®æœ€åŸºæœ¬çš„å­˜å‚¨ç»„ä»¶ï¼Œå› ä¸ºæ˜¯é«˜å¯ç”¨éƒ¨ç½²ï¼Œå¾—åŒºåˆ†å¥½å‡ ç§è§’è‰²ï¼ˆè¿™é‡Œç”¨çš„æ—¶hadoopæœ€æ–°ç‰ˆæœ¬3.3.1çš„æ¶æ„é…ç½®ï¼‰ã€‚</p><ul><li>zkfc-format:ç”¨äºç¬¬ä¸€æ¬¡è¿è¡Œæ—¶æ ¼å¼åŒ–hdfsåœ¨zookeeperä¸Šçš„å­˜å‚¨ï¼Œä¸€æ¬¡æ€§è¿è¡Œï¼Œæ•…é…ç½®ä¸é‡è¦</li><li>jn:journalnodeï¼Œæ—¥å¿—èŠ‚ç‚¹ï¼Œhdfså†…éƒ¨çš„é«˜å¯ç”¨æœºåˆ¶çš„å®ç°ï¼Œè‡³å°‘3å°ï¼Œ1c1g</li><li>nn-activeï¼šactive-namenodeï¼Œé»˜è®¤çŠ¶æ€ä¸ºactiveçš„åç§°èŠ‚ç‚¹ï¼Œå³é»˜è®¤ä¸»èŠ‚ç‚¹ï¼Œ1ä¸ªï¼Œåœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶è´Ÿè´£åšåˆå§‹åŒ–æ“ä½œï¼Œ1c2g</li><li>nn-standby:standby-namenodeï¼Œé»˜è®¤çŠ¶æ€ä¸ºstandbyçš„åç§°èŠ‚ç‚¹ï¼Œå³é»˜è®¤ä»èŠ‚ç‚¹ï¼Œæ”¯æŒå¤šä¸ªï¼Œå‚ä¸ä¸»èŠ‚ç‚¹é€‰ä¸¾ä»¥å®ç°é«˜å¯ç”¨ã€‚è¿™é‡Œä¹Ÿç»™1ä¸ªï¼Œ1c2g</li><li>nn-observer:observer-namenodeï¼ŒçŠ¶æ€ä¸ºobserverçš„åç§°èŠ‚ç‚¹ï¼Œå³è§‚å¯Ÿè€…èŠ‚ç‚¹ï¼Œè´Ÿè´£è¯»å†™åˆ†ç¦»çš„è¯»çš„éƒ¨åˆ†ï¼Œä¸å‚ä¸ä¸»èŠ‚ç‚¹é€‰ä¸¾ã€‚è¿™é‡Œç›´æ¥ä¸ç»™ï¼Œçœç‚¹èµ„æºã€‚</li><li>dn:datanodeï¼Œæ•°æ®èŠ‚ç‚¹ï¼Œè‡³å°‘3ä¸ªï¼Œ1c2gã€‚</li></ul><p>è™½ç„¶æŠŠnn-observerç»™çœç•¥äº†ï¼Œä½†å®é™…ä¸Šhadoop2çš„æ—¶å€™namenodeä¹Ÿåªæ”¯æŒä¸¤ä¸ªï¼Œæ‰€ä»¥å…¶å®ç°åœ¨è¿™æ ·ä»è®¾è®¡ä¸Šæ¥è¯´ä¹Ÿå¾ˆä¸é”™äº†ã€‚<br>ä¸€èˆ¬ç»™1c1gæ˜¯å› ä¸ºæˆ‘çŸ¥é“å®ƒè·‘ä¸åˆ°1gï¼Œ1c2gæ˜¯å› ä¸ºå†…éƒ¨è¿›ç¨‹jvmå‚æ•°å®¹æ˜“é…ç½®äº›ã€‚</p><h3 id="6-yarn"><a href="#6-yarn" class="headerlink" title="6. yarn"></a>6. yarn</h3><p>å¤§æ•°æ®æœ€åŸºæœ¬çš„èµ„æºè°ƒåº¦ç»„ä»¶</p><ul><li>rm:resource-manager,èµ„æºç®¡ç†å™¨ï¼Œæ”¯æŒä»»æ„å¤šä¸ªå®ç°é«˜å¯ç”¨ï¼Œè¿™é‡Œç»™2ä¸ªï¼Œ1c2g</li><li>nmï¼šnode-manager,èŠ‚ç‚¹ç®¡ç†å™¨ï¼Œæ”¯æŒä»»æ„å¤šä¸ªæ¨ªå‘æ‹“å±•ï¼Œè¿™é‡Œç»™1ä¸ªï¼Œ3c8gã€‚</li></ul><p>æ³¨æ„ï¼Œnmçš„3c8gé‡Œé¢2c6gæ˜¯ç»™yarnå¹³å°è°ƒåº¦ç”¨çš„ï¼Œ1gæ˜¯ç»™nmè¿›ç¨‹æœ¬èº«çš„ï¼Œå…¶ä»–çš„é¢„ç•™ç»™å®¹å™¨æœ¬èº«çš„ã€‚<br>æ‰€ä»¥2c6gå°±æ˜¯è¿™ä¸ªå¤§æ•°æ®å¹³å°çš„è®¡ç®—ä»»åŠ¡èƒ½è°ƒåº¦çš„æœ€å¤šèµ„æºäº†â€¦</p><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>åˆ°yarnå°±å·²ç»æŠŠå¤§æ•°æ®æœ€æœ€åŸºç¡€çš„éƒ¨åˆ†æ­å»ºå¥½äº†ã€‚<br>å…¶ä»–ç»„ä»¶æŒ‰éœ€å¯åŠ¨å°±è¡Œï¼Œåƒhiveã€hbaseè¿™äº›æœ‰ä¸»ä»å¤šèŠ‚ç‚¹é«˜å¯ç”¨ç»“æ„çš„æˆ‘æš‚æ—¶æ²¡ç”¨åˆ°ï¼Œåˆè€—èµ„æºï¼Œå°±å…ˆä¸ç®¡<br>åƒflinkã€sparkè¿™ç§æ”¯æŒæŠŠä»»åŠ¡æ”¾åˆ°yarnä¸Šé¢è·‘çš„ï¼Œæœ¬èº«ç•™ä¸ªä¸€ä¸ªå†å²æ—¥å¿—æœåŠ¡å™¨èŠ‚ç‚¹å°±å¤Ÿäº†ï¼Œç”šè‡³ä¸éœ€è¦ã€‚<br>å¦å¤–ç”¨å¾—æ¯”è¾ƒå¤šå°±æ˜¯kafkaï¼Œä¸€èˆ¬ä¹Ÿæ˜¯è‡³å°‘3å°ï¼Œ1å°ä¹Ÿå¯ä»¥ï¼Œå…ˆä¸ç®¡</p><h3 id="æ±‡æ€»"><a href="#æ±‡æ€»" class="headerlink" title="æ±‡æ€»"></a>æ±‡æ€»</h3><table><thead><tr><th>hostname</th><th>cpuæ ¸æ•°</th><th>å†…å­˜ï¼ˆgï¼‰</th><th>ç»„ä»¶</th><th>limitèµ„æºæ€»å’Œ</th></tr></thead><tbody><tr><td>lian1</td><td>4</td><td>16</td><td>kerberos-masterã€zookeeperã€esã€rangerã€hdfs-jnã€hdfs-nn-activeã€hdfs-dnã€yarn-rmã€yarn-nm</td><td>12c19g</td></tr><tr><td>lian2</td><td>4</td><td>12</td><td>kerberos-slaveã€zookeeperã€hdfs-jnã€hdfs-nn-standbyã€hdfs-dnã€yarn-rm</td><td>6c9g</td></tr><tr><td>lian3</td><td>4</td><td>4</td><td>zookeeperã€hdfs-jnã€hdfs-dn</td><td>3c3g</td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°limitçš„èµ„æºæ€»å’Œæ˜¯è¶…è¿‡å®é™…èµ„æºçš„ï¼Œä½†æ˜¯åªæ˜¯æˆ‘ä¸ºäº†æ–¹ä¾¿åˆ†é…å’Œè®¾ç½®è€Œå·²<br>å¤§éƒ¨åˆ†è¿›ç¨‹cpuç”¨å¾—éƒ½æ˜¯å¾ˆä½çš„ï¼Œå†…å­˜ä¸è·‘ä»»åŠ¡çš„æ—¶å€™ä¹Ÿä¸å¤š<br>æ¯•ç«Ÿæ¡ä»¶æ‰€é™ï¼Œè¿™æ ·å­ä¹Ÿä¸é”™äº†<br>æ¥ä¸‹æ¥å°±æ˜¯å®é™…æµ‹è¯•äº†</p>]]></content>
      
      
      <categories>
          
          <category> å¤§æ•°æ® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç”Ÿäº§åŠ› </tag>
            
            <tag> å¤§æ•°æ® </tag>
            
            <tag> WSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ªäººåšå®¢ç³»ç»Ÿè®¾è®¡(æ”¯æŒhexoå’ŒhaloåŒæ­¥)</title>
      <link href="//my-blog-system-design/"/>
      <url>//my-blog-system-design/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç»è‡ªå·±çš„åšå®¢ç³»ç»Ÿæ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Œå¹¶ä½¿ç”¨<a href="https://github.com/linshenkx/haloSyncServer">Haloåšå®¢åŒæ­¥å™¨</a> å°†hexoï¼ˆgit pages: <a href="https://linshenkx.github.io/">https://linshenkx.github.io</a> ï¼‰æ–‡ç« è‡ªåŠ¨åŒæ­¥åˆ°halo( <a href="http://linshenkx.cn/">http://linshenkx.cn</a> )ã€‚<br>å®ç°ä¸€æ¬¡ç¼–å†™ã€ä¸¤å¥—åšå®¢ç³»ç»Ÿå¹¶å­˜ã€å¤šä¸ªç½‘å€è®¿é—®çš„æ•ˆæœã€‚</p><span id="more"></span><h2 id="ä¸€-æ€»è§ˆ"><a href="#ä¸€-æ€»è§ˆ" class="headerlink" title="ä¸€ æ€»è§ˆ"></a>ä¸€ æ€»è§ˆ</h2><h3 id="è¾¾åˆ°æ•ˆæœ"><a href="#è¾¾åˆ°æ•ˆæœ" class="headerlink" title="è¾¾åˆ°æ•ˆæœ"></a>è¾¾åˆ°æ•ˆæœ</h3><table><thead><tr><th>ä¸ªäººåšå®¢ç½‘å€</th><th>ä»‹ç»</th><th>å¯¹åº”gitä»“åº“/ç®¡ç†ç•Œé¢</th></tr></thead><tbody><tr><td><a href="https://linshenkx.gitee.io/">https://linshenkx.gitee.io</a></td><td>hexo next gitee pages</td><td><a href="https://gitee.com/linshenkx/linshenkx">https://gitee.com/linshenkx/linshenkx</a></td></tr><tr><td><a href="https://linshenkx.github.io/">https://linshenkx.github.io</a></td><td>hexo next github pages</td><td><a href="https://github.com/linshenkx/linshenkx.github.io">https://github.com/linshenkx/linshenkx.github.io</a></td></tr><tr><td><a href="https://linshen.netlify.app/">https://linshen.netlify.app</a></td><td>netlifyåŠ é€Ÿï¼Œæ–‡ç« åŒæ­¥è‡ªblogæºç ä»“åº“</td><td><a href="https://app.netlify.com/teams/linshenkx">https://app.netlify.com/teams/linshenkx</a></td></tr><tr><td><a href="https://linshenkx.cn/">https://linshenkx.cn</a></td><td>haloä¸ªäººç½‘ç«™ï¼Œæ–‡ç« åŒæ­¥è‡ªblogæºç ä»“åº“</td><td><a href="https://linshenkx.cn/admin/index.html#/dashboard">https://linshenkx.cn/admin/index.html#/dashboard</a></td></tr></tbody></table><p>blogåšå®¢æºç ä»“åº“ï¼ˆæ ¸å¿ƒï¼Œç§æœ‰ï¼‰ï¼š<a href="https://github.com/linshenkx/blog">https://github.com/linshenkx/blog</a></p><h3 id="åšå®¢å‘å¸ƒæµç¨‹"><a href="#åšå®¢å‘å¸ƒæµç¨‹" class="headerlink" title="åšå®¢å‘å¸ƒæµç¨‹"></a>åšå®¢å‘å¸ƒæµç¨‹</h3><ol><li>ç¼–å†™åšå®¢<br>åœ¨blogå·¥ç¨‹ä¸‹å†™åšå®¢ï¼Œå·¥ç¨‹ä¸ºæ ‡å‡†hexoï¼Œåšå®¢ä¸ºmarkdownæ–‡ä»¶æ”¾åœ¨source/_postsç›®å½•ä¸‹ï¼Œä½¿ç”¨å¤šå±‚çº§åˆ†ç±»å­˜æ”¾</li><li>å‘å¸ƒåˆ°git pages<br>å®Œæˆåšå®¢çš„å¢åˆ æ”¹åï¼Œåœ¨å·¥ç¨‹ç›®å½•ä¸‹æ‰§è¡Œ<code>hexo clean &amp;&amp; hexo d -g</code>éƒ¨ç½²åˆ°git pagesã€‚<br>è¿™é‡Œæˆ‘é…ç½®äº†åŒæ—¶å‘å¸ƒåˆ°githubå’Œgiteeï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œgiteeçš„git pageséœ€è¦æ‰‹åŠ¨å»è§¦å‘æ›´æ–°æ‰èƒ½ç”Ÿæ•ˆã€‚</li><li>æäº¤å¹¶æ¨é€å·¥ç¨‹<br>æäº¤å¹¶æ¨é€blogå·¥ç¨‹çš„ä¿®æ”¹ã€‚<br>netlifyå°†è‡ªåŠ¨è·å–blogå·¥ç¨‹ï¼Œå¹¶æ‰§è¡Œhexoéƒ¨ç½²è„šæœ¬ï¼ˆæ•ˆæœå’Œgit pagesä¸€æ ·ï¼Œåªæ˜¯ç”¨netlifyè®¿é—®æ®è¯´ä¼šå¿«ä¸€ç‚¹ï¼‰<br>è‡ªå·±å¼€å‘çš„<a href="https://github.com/linshenkx/haloSyncServer">Haloåšå®¢åŒæ­¥å™¨</a>ä¹Ÿä¼šæ£€æµ‹åˆ°blogå·¥ç¨‹æ›´æ–°ï¼Œæ ¹æ®æ›´æ–°æƒ…å†µå°†å˜åŒ–åŒæ­¥åˆ°haloåšå®¢ç³»ç»Ÿä¸­ã€‚</li></ol><h2 id="äºŒ-è®¾è®¡æ€è·¯"><a href="#äºŒ-è®¾è®¡æ€è·¯" class="headerlink" title="äºŒ è®¾è®¡æ€è·¯"></a>äºŒ è®¾è®¡æ€è·¯</h2><h3 id="1-èµ·å› "><a href="#1-èµ·å› " class="headerlink" title="1 èµ·å› "></a>1 èµ·å› </h3><p>æœ¬æ¥æˆ‘ä¸€ç›´æ˜¯åœ¨ä½¿ç”¨csdnçš„ï¼Œä½†æ˜¯ç½‘é¡µç«¯å†™ä½œç¡®å®ä¸æ–¹ä¾¿ï¼Œè€Œä¸”è¿˜å¯èƒ½å—ç½‘ç»œæƒ…å†µé™åˆ¶ã€‚<br>æ‰€ä»¥æˆ‘åé¢ä¸€èˆ¬éƒ½æ˜¯ç”¨å°è±¡ç¬”è®°åšè®°å½•ï¼Œåœ¨å°è±¡ç¬”è®°å†™å¥½å†çœ‹å¿ƒæƒ…æ•´ç†åˆ°csdnä¸Šå»ã€‚<br>ä½†æ˜¯æ‚„ä¸æ³¨æ„çš„ï¼Œåœ¨21å¹´åˆcsdnæ”¹ç‰ˆï¼ŒåŒæ—¶ä¹Ÿæ”¹å˜äº†æ’åå’Œå¼•æµè§„åˆ™ã€‚<br>ä¹‹å‰ä¸€ä¸ªæ˜ŸæœŸ2500åˆ°3000çš„è®¿é—®é‡ç°åœ¨åªå‰©1500åˆ°2000äº†ã€‚</p><p>å—¯ï¼Œä¸å¯å¿ã€‚æ¢ã€‚</p><h3 id="2-è°ƒç ”"><a href="#2-è°ƒç ”" class="headerlink" title="2 è°ƒç ”"></a>2 è°ƒç ”</h3><p>å¸‚é¢ä¸Šçš„åšå®¢ç³»ç»Ÿå¯æ ¹æ®å¯¹Git Pagesçš„æ”¯æŒï¼ˆå³æ˜¯å¦æ”¯æŒç”Ÿæˆé™æ€ç½‘ç«™ï¼‰åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p><p>ä¸€æ˜¯ä»¥hexoä¸ºä»£è¡¨çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼šå¦‚hexoã€hugoã€jekyllï¼Œè¾ƒæˆç†Ÿï¼Œæœ‰è¾ƒå¤šç¬¬ä¸‰æ–¹ä¸»é¢˜å’Œæ’ä»¶ï¼Œå¯ä¸git pagesæ­é…ä½¿ç”¨ï¼Œä¹Ÿå¯è‡ªè¡Œéƒ¨ç½²ã€‚</p><p>äºŒæ˜¯ä»¥haloä¸ºä»£è¡¨çš„äº”èŠ±å…«é—¨çš„ä¸ªäººåšå®¢ç³»ç»Ÿï¼ŒåŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œè‡ªç”±åº¦æ›´é«˜ï¼Œé€šå¸¸å¸¦åå°ç®¡ç†ï¼Œä½†ä¸æ”¯æŒgit pagesï¼Œéœ€è‡ªè¡Œéƒ¨ç½²ã€‚</p><h3 id="3-åˆ†æ"><a href="#3-åˆ†æ" class="headerlink" title="3 åˆ†æ"></a>3 åˆ†æ</h3><p>ä¸ªäººåšå®¢çš„è¯ä½¿ç”¨git pagesæ¯”è¾ƒç¨³å®šï¼Œç½‘å€å›ºå®šï¼Œå¯ä»¥æ°¸ä¹…ä½¿ç”¨ï¼Œè€Œä¸”å¯ä»¥é€šè¿‡æ­é…ä¸åŒçš„gitæœåŠ¡å•†æ¥ä¿è¯è®¿é—®é€Ÿåº¦ã€‚<br>ä½†æ˜¯git pagesçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæ˜¯é™æ€ç½‘ç«™ï¼Œè™½ç„¶å¯ä»¥æ­é…ç¬¬ä¸‰æ–¹æ’ä»¶å¢å¼ºï¼Œä½†è¯´åˆ°åº•è¿˜æ˜¯ä¸ªé™æ€ç½‘ç«™ã€‚</p><p>è€Œå¦‚æœè‡ªå·±ä¹°æœåŠ¡å™¨ï¼Œä¹°åŸŸåï¼Œç”¨ç¬¬ä¸‰æ–¹ä¸ªäººåšå®¢ç³»ç»Ÿï¼Œå°±å¯ä»¥ç©å¾—æ¯”è¾ƒèŠ±é‡Œèƒ¡å“¨äº†ï¼Œä½†è°çŸ¥é“ä¼šç”¨å¤šä¹…å‘¢ã€‚<br>æœåŠ¡å™¨ã€åŸŸåéƒ½è¦è‡ªå·±è´Ÿè´£ï¼Œä¸‰äº”å¹´ä¹‹åè¿˜èƒ½ä¸èƒ½è®¿é—®å°±æ¯”è¾ƒéš¾è¯´äº†ã€‚<br>ä½†æ˜¯å¹´è½»äººå˜›ï¼Œæ€»è¿˜æ˜¯èŠ±é‡Œèƒ¡å“¨ç‚¹æ‰é¦™ã€‚</p><p>é‚£æˆ‘å°±å…¨éƒ½è¦ã€‚</p><p>git pagesä½œä¸ºä¸“ä¸šæ€§è¾ƒå¼ºçš„ä¸ªäººç½‘ç«™å¯ä»¥æ°¸ä¹…è®¿é—®ï¼Œ<br>ç„¶åå†å¼„ä¸ªæœåŠ¡å™¨æ”¾ä¸ªåšå®¢ç³»ç»Ÿè‡ªå·±ç©ã€‚</p><h3 id="4-é€‰å‹"><a href="#4-é€‰å‹" class="headerlink" title="4 é€‰å‹"></a>4 é€‰å‹</h3><p>é™æ€ç½‘ç«™ç”Ÿæˆå™¨é€‰çš„æ˜¯hexoï¼Œä¼ ç»Ÿä¸€ç‚¹ï¼Œæ”¯æŒçš„æ’ä»¶å’Œä¸»é¢˜æ¯”è¾ƒå¤šã€‚<br>hugoè™½ç„¶ä¹Ÿä¸é”™ï¼Œä½†ä¼¼ä¹å›½å†…ç”¨çš„ä¸å¤šï¼Œæ”¯æŒå¯èƒ½è¿˜ä¸å¤Ÿå®Œå–„ã€‚</p><p>ç„¶åhexoçš„ä¸»é¢˜ç”¨çš„æœ€ç»å…¸çš„nextï¼Œæ¯”è¾ƒæˆç†Ÿï¼ŒåŠŸèƒ½ä¹Ÿå¾ˆå®Œå–„<br>è™½ç„¶æ•´ä½“æ¯”è¾ƒä¸¥è‚ƒå‹æŠ‘ï¼Œä½†å¯ä»¥è‡ªå·±åŠ ä¸ªlive2då¢æ·»ç‚¹æ´»åŠ›ï¼Œ<br>ä½œä¸ºä¸€ä¸ªå±•ç¤ºä¸“ä¸šæ€§çš„åšå®¢ç½‘ç«™è¿™æ ·ä¹Ÿå°±å¤Ÿäº†</p><p>è‡ªå®šä¹‰åšå®¢ç³»ç»Ÿçš„è¯æˆ‘é€‰çš„æ˜¯haloï¼Œæœ€ä¸»è¦åŸå› æ˜¯å®ƒæ˜¯javaå†™çš„ï¼Œåˆ©äºäºŒæ¬¡å¼€å‘ï¼ˆäº‹å®ä¸Šåé¢ç”¨ç€ä¹Ÿç¡®å®æœ‰é—®é¢˜ï¼Œè¿˜æäº¤äº†ä¸€ä¸ªissueï¼‰<br>è€Œä¸”åŠŸèƒ½æ¯”è¾ƒå¼ºå¤§ï¼Œç”Ÿæ€æ¯”è¾ƒå®Œå–„ï¼Œè™½ç„¶ç¬¬ä¸‰æ–¹ä¸»é¢˜å°‘ä¸”åŸºæœ¬éƒ½æ²¡æ›´æ–°ï¼Œä½†æ˜¯â€¦å®åœ¨æ˜¯æ‰¾ä¸å‡ºå…¶ä»–ä¸€ä¸ªèƒ½æ‰“çš„äº†<br>å¦å¤–haloæ”¯æŒå¯¼å…¥markdownï¼Œä¸”åŠŸèƒ½åŸºæœ¬éƒ½é€šè¿‡restæ¥å£æ”¾å¼€ï¼Œé€‚åˆå¼€å‘è€…ä½¿ç”¨</p><h2 id="ä¸‰-è®¾è®¡å®ç°"><a href="#ä¸‰-è®¾è®¡å®ç°" class="headerlink" title="ä¸‰ è®¾è®¡å®ç°"></a>ä¸‰ è®¾è®¡å®ç°</h2><h3 id="1-hexo"><a href="#1-hexo" class="headerlink" title="1 hexo"></a>1 hexo</h3><p>hexoæœ¬èº«åªæ˜¯é™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œä½ å¯ä»¥æŠŠhexoé¡¹ç›®æœ¬èº«å‘å¸ƒæˆä¸ºgit pagesé¡¹ç›®ï¼Œ<br>åƒgithubã€giteeè¿™äº›ä¼šè¯†åˆ«å‡ºè¿™æ˜¯ä¸€ä¸ªhexoé¡¹ç›®ï¼Œç„¶åè¿›è¡Œç¼–è¯‘ï¼Œå¾—åˆ°é™æ€èµ„æºä¾›å¤–éƒ¨è®¿é—®ã€‚<br>è¿™ä¹Ÿæ˜¯æœ€ç®€å•çš„ç”¨æ³•ã€‚</p><p>ä½†æ˜¯ä¸æ¨èã€‚</p><p>å› ä¸ºgit pagesé¡¹ç›®ä¸€èˆ¬éƒ½è¦æ±‚æ˜¯publicçš„ï¼ˆä¸”åç§°å›ºå®šï¼Œä¸€ä¸ªgitè´¦å·åªæœ‰ä¸€ä¸ªgit pagesä»“åº“ï¼‰ï¼Œ<br>hexoé¡¹ç›®åŒ…å«ä½ çš„åšå®¢markdownæºæ–‡ä»¶å’Œå…¶ä»–çš„ä¸ªäººä¿¡æ¯ã€‚<br>æˆ‘ä»¬åªæ˜¯æƒ³æŠŠå¿…è¦çš„ç”Ÿæˆåçš„é™æ€ç½‘é¡µæ”¾å‡ºå»è€Œå·²ï¼Œè‡³äºé¡¹ç›®çš„é…ç½®ä¿¡æ¯å’Œmarkdownæºæ–‡ä»¶åº”è¯¥è—èµ·æ¥ã€‚</p><p>æ‰€ä»¥éœ€è¦ä½¿ç”¨ hexo-deployer-git æ’ä»¶è¿›è¡Œgit pagesçš„éƒ¨ç½²ã€‚<br>å³æ”¾åˆ°gitå…¬å¼€çš„æ–‡ä»¶åªæœ‰ç”Ÿæˆåçš„ç½‘é¡µæ–‡ä»¶è€Œå·²ï¼Œgitåªæ˜¯æŠŠä½ ç”Ÿæˆåçš„index.htmlè¿›è¡Œç›´æ¥å±•ç¤ºï¼Œä¸ä¼šå†å»ç¼–è¯‘äº†<br>ï¼ˆéœ€è¦åœ¨sourceç›®å½•ä¸‹æ·»åŠ .nojekyllæ–‡ä»¶è¡¨æ˜ä¸ºé™æ€ç½‘é¡µï¼Œæ— é¡»ç¼–è¯‘ï¼‰</p><p>è€Œé¡¹ç›®æœ¬èº«ä¸ºäº†æ›´å¥½åœ°è¿›è¡Œç®¡ç†å’Œè®°å½•ï¼Œè¿˜æ˜¯è¦å‘å¸ƒåˆ°gitä¸Šé¢çš„ï¼Œä½œä¸ºä¸€ä¸ªæ™®é€šçš„ç§æœ‰ä»“åº“ï¼Œåç§°å¯ä»¥ä»»æ„ï¼ˆå¦‚ blogï¼‰</p><p>è¿™æ ·ï¼Œæ¯æ¬¡è¦å¢åˆ æ”¹å®Œæ–‡ç« åªéœ€è¦æ‰§è¡Œ<code>hexo clean &amp;&amp; hexo d -g</code>å³å¯å‘å¸ƒåˆ°gitä»“åº“ä¸Š<br>æ³¨æ„ï¼Œä¸åŒgitæœåŠ¡å•†git pagesè§„åˆ™ä¸ä¸€æ ·ã€‚<br>æ¯”æ–¹è¯´æˆ‘giteeå’Œgithubçš„ç”¨æˆ·åéƒ½æ˜¯linshenkx<br>ä½†æ˜¯giteeè¦æ±‚çš„ä»“åº“åæ˜¯linshenkxï¼Œè€Œgithubçš„ä»“åº“åå°±å¿…é¡»æ˜¯linshenkx.github.ioäº†<br>è€Œgithubçš„git pagesä»“åº“åœ¨æ¥æ”¶åˆ°æ¨é€åå°±è‡ªåŠ¨ï¼ˆç¼–è¯‘ï¼‰éƒ¨ç½²<br>giteeåˆ™éœ€è¦åˆ°ä»“åº“webç•Œé¢æ‰‹åŠ¨è§¦å‘æ›´æ–°</p><p>æˆªè‡³åˆ°è¿™ä¸€æ­¥æ˜¯å¤§å¤šæ•°äººçš„åšæ³•ï¼Œå³gitä¸Šä¸¤ä¸ªä»“åº“å¹¶å­˜ï¼Œä¸€ï¼ˆæˆ–å¤šï¼‰ä¸ªgit pageså…¬æœ‰ä»“åº“åšå±•ç¤ºï¼Œä¸€ä¸ªblogä»“åº“å­˜æ”¾åšå®¢æºç <br>æ³¨æ„ï¼šå¦‚æœgit pagesä»“åº“å…è®¸ç§æœ‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä¸€ä¸ªä»“åº“å¤šä¸ªåˆ†æ”¯æ¥å®ç°ç›¸åŒæ•ˆæœã€‚<br>ä½†è¿˜æ˜¯æ¨èä½¿ç”¨ä¸¤ä¸ªä»“åº“ï¼Œå› ä¸ºè¿™æ ·æ›´é€šç”¨ï¼Œè®¾è®¡ä¸Šä¹Ÿæ›´åˆç†ã€‚</p><p>å·¥ç¨‹æ€»ä½“ç»“æ„å¦‚ä¸‹ï¼Œä¸ºæ™®é€šhexoå·¥ç¨‹ï¼š<br><img src="https://lian-gallery.oss-cn-guangzhou.aliyuncs.com/img/1631718173(1).png"><br>åšå®¢æºç ç›®å½•ç»“æ„å¦‚ä¸‹ï¼Œä¸ºå¤šå±‚çº§ç»“æ„ï¼š<br><img src="https://lian-gallery.oss-cn-guangzhou.aliyuncs.com/img/1631718305(1).png"></p><h3 id="2-halo"><a href="#2-halo" class="headerlink" title="2 halo"></a>2 halo</h3><p>haloçš„ä½¿ç”¨çœ‹å®˜æ–¹æ–‡æ¡£ä¸€èˆ¬å°±å¤Ÿäº†ï¼Œè¿™é‡Œéœ€è¦è¡¥å……çš„æ˜¯å…¶ä»£ç†é…ç½®ã€‚<br>å› ä¸ºhaloçš„åœ¨çº¿ä¸‹è½½æ›´æ–°ä¸»é¢˜åŠŸèƒ½é€šå¸¸éœ€è¦è¿æ¥åˆ°githubï¼Œæˆ‘ä¹ æƒ¯é€šè¿‡ä»£ç†è®¿é—®<br>è¿™é‡Œæä¾›ä¸€ä¸‹é…ç½®æ–¹æ³•<br>å³åœ¨å®¹å™¨å¯åŠ¨æ—¶æ·»åŠ JVMå‚æ•°å³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -d --name halo --network host -e JVM_OPTS=&quot;-Dhttp.proxyHost=127.0.0.1 -Dhttp.proxyPort=7890 -Dhttps.proxyHost=127.0.0.1 -Dhttps.proxyPort=7890&quot; -v /opt/halo/workspace:/root/.halo --restart=always halohub/halo</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-markdownå›¾ç‰‡"><a href="#3-markdownå›¾ç‰‡" class="headerlink" title="3 markdownå›¾ç‰‡"></a>3 markdownå›¾ç‰‡</h3><p>markdownå›¾ç‰‡çš„å­˜æ”¾ä¸€ç›´æ˜¯ä¸ªéº»çƒ¦çš„é—®é¢˜ã€‚<br>æœ€å®³æ€•é‡åˆ°å°±æ˜¯å›¾é“¾çš„å¤±æ•ˆï¼Œè€Œä¸”å¾€å¾€è‡ªå·±è¿˜ä¸èƒ½å‘ç°ã€‚<br>ç†æƒ³çŠ¶æ€ä¸‹å°±æ˜¯markdownä¸€å¼ å›¾ç‰‡æ”¯æŒé…ç½®å¤šä¸ªå›¾åºŠé“¾æ¥ï¼Œç¬¬ä¸€ä¸ªå›¾åºŠé“¾æ¥è¶…æ—¶å°±ä½¿ç”¨ä¸‹ä¸€ä¸ªã€‚<br>è¿™ç§æœåŠ¡ç«¯çš„å¤„ç†æ€æƒ³å¾ˆæ˜æ˜¾ä¸é€‚åˆæ”¾åˆ°å®¢æˆ·ç«¯ã€‚<br>é€€è€Œæ±‚å…¶æ¬¡ï¼Œé…ç½®ä¸€ä¸ªé“¾æ¥ï¼Œè®¿é—®è¿™ä¸ªé“¾æ¥ä¼šè§¦å‘å¯¹å¤šä¸ªå›¾åºŠçš„è®¿é—®ï¼Œç„¶åé‚£ä¸ªå¿«ç”¨é‚£ä¸ªã€‚<br>è¿™ä¸ªæ•ˆæœæŠ€æœ¯ä¸Šä¸éš¾å®ç°ï¼Œä¹Ÿæœ‰ä¸ªå•†ä¸šäº§å“ï¼ˆèšåˆå›¾åºŠï¼‰æ˜¯è¿™æ ·çš„ï¼Œç¼ºç‚¹æ˜¯æ”¶è´¹ã€‚<br>ç„¶åæˆ‘åˆåœ¨githubã€giteeä¸Šæ‰¾äº†å„ä¸ªå›¾åºŠè½¯ä»¶ï¼Œéƒ½ä¸æ€ä¹ˆæ ·ï¼ˆè¿™ä¸ªæ—¶é—´æˆæœ¬éƒ½å¤Ÿç»™èšåˆå›¾åºŠå¼€å‡ å¹´ä¼šå‘˜äº†ï¼‰<br>æœ€ç»ˆè¿˜æ˜¯å¦¥åï¼Œç”¨äº‘å­˜å‚¨å§ï¼Œé€‰äº†é˜¿é‡Œ<br>ä¸ƒç‰›ã€è…¾è®¯ä¹Ÿéƒ½è¯•äº†ï¼Œå…¶å®éƒ½å·®ä¸å¤šï¼Œçœ‹ä¸ªäººçˆ±å¥½ï¼Œæ²¡æœ‰å¤ªç‰¹åˆ«çš„ç†ç”±</p><p>å¦‚æœä½ ç”¨typoraå†™markdownçš„è¯å¾ˆæ–¹ä¾¿ï¼Œå®ƒæ”¯æŒpicgoæ’ä»¶</p><p>ä½†æˆ‘ä¹ æƒ¯åœ¨ideaé‡Œé¢ç¼–å†™ï¼Œideaä¹Ÿæœ‰ä¸€äº›markdown-imageæ’ä»¶ï¼ŒåŸºæœ¬éƒ½ä¸å¥½ç”¨<br>æ‰€ä»¥æˆ‘è¿˜æ˜¯å®‰è£…äº†picgoï¼Œå¼€äº†å¿«æ·é”®ï¼Œå¤åˆ¶å›¾ç‰‡ç›´æ¥å¿«æ·é”®ç²˜è´´ä½“éªŒä¹Ÿè¿˜æ˜¯æ¯”è¾ƒèˆ’æœçš„<br>picgoçš„ç‰¹ç‚¹æ˜¯æ’ä»¶å¤šï¼Œä¸è¿‡æ’ä»¶è´¨é‡ä¸€èˆ¬ï¼Œæœ‰å¾ˆå¤šbug</p><p>èŠ±äº†ä¸¤å¤©æ—¶é—´çº ç»“ã€æµ‹è¯•ï¼Œæœ€åçš„æ–¹æ¡ˆæ˜¯ï¼šideaç¼–è¾‘+é˜¿é‡Œäº‘å­˜å‚¨+picgoä¸Šä¼ </p><h3 id="4-åŒæ­¥"><a href="#4-åŒæ­¥" class="headerlink" title="4 åŒæ­¥"></a>4 åŒæ­¥</h3><p>è¿™æ‰æ˜¯é‡ç‚¹</p><h4 id="1-åŒæ­¥çš„æ–¹å‘"><a href="#1-åŒæ­¥çš„æ–¹å‘" class="headerlink" title="1 åŒæ­¥çš„æ–¹å‘"></a>1 åŒæ­¥çš„æ–¹å‘</h4><p>å³åœ¨å“ªé‡Œå†™æ–‡ç« ï¼ŒåŒæ­¥åˆ°å“ªé‡Œ</p><p>æˆ‘è¿˜æ˜¯ä¹ æƒ¯ç”¨ideaå†™markdownæ–‡æ¡£è€Œä¸æ˜¯åœ¨ç½‘é¡µä¸Šã€‚<br>æ‰€ä»¥ç¡®å®šæ˜¯æµå‘ä¸º hexo-&gt;halo</p><h4 id="2-æŠ€æœ¯æ”¯æ’‘"><a href="#2-æŠ€æœ¯æ”¯æ’‘" class="headerlink" title="2 æŠ€æœ¯æ”¯æ’‘"></a>2 æŠ€æœ¯æ”¯æ’‘</h4><p>haloæ”¯æŒå¯¼å…¥markdownæ–‡ä»¶ï¼Œæ‰€ä»¥ä¸»è¦é—®é¢˜ä¸ºhexoçš„markdownåšå®¢æºç æ–‡ä»¶çš„è·å–<br>hexoæ–‡ç« å­˜å‚¨è·¯å¾„ä¸º source/_posts ï¼Œæœ‰å¤šå±‚çº§æ–‡ä»¶å¤¹ï¼Œå¯ä»¥ç®€å•åœ°ç†è§£æˆæ–‡ä»¶IOæ“ä½œè·å–æ–‡ç« å†…å®¹ã€‚<br>ä½†å…³é”®æ˜¯å­˜å‚¨åœ¨gitä¸Šï¼Œè¿™é‡Œå¯ä»¥ç”¨JGitè¿›è¡Œæ“ä½œã€‚<br>åŒæ—¶ï¼ŒJGitæ”¯æŒè·å–ä¸¤æ¬¡commitä¹‹é—´çš„æ–‡ä»¶å˜åŒ–æƒ…å†µã€‚<br>å³å¯ä»¥æ•è·åˆ°æ–‡ç« çš„å¢åˆ æ”¹æ“ä½œï¼Œè€Œä¸ç”¨æ¯æ¬¡éƒ½å…¨é‡åœ°åŒæ­¥ã€‚</p><h4 id="3-æˆæœ"><a href="#3-æˆæœ" class="headerlink" title="3 æˆæœ"></a>3 æˆæœ</h4><p>åˆå¤„ç†äº†ä¸€äº›ç»†èŠ‚é—®é¢˜ï¼Œæœ€ç»ˆè¿˜æ˜¯è‡ªå·±åšäº†ä¸ªhaloSyncServeråŒæ­¥ç¨‹åºï¼Œ<br>å°è£…æˆdockerï¼Œæ”¾æœåŠ¡å™¨ä¸Šè·‘ï¼Œå®ç°åŒæ­¥ã€‚<br>å¾…æ•´ç†åå¼€æºã€‚</p><p>2021å¹´11æœˆæ›´æ–°<br>å¼€æºåœ°å€ä¸ºï¼š<a href="https://github.com/linshenkx/haloSyncServer">https://github.com/linshenkx/haloSyncServer</a><br>æ•ˆæœ<br><img src="https://lian-gallery.oss-cn-guangzhou.aliyuncs.com/img/1637394238(1).jpg"></p>]]></content>
      
      
      <categories>
          
          <category> ç¨‹åºå‘˜æ‚è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç”Ÿäº§åŠ› </tag>
            
            <tag> åšå®¢ </tag>
            
            <tag> hexo </tag>
            
            <tag> halo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ranger2.1ç¼–è¯‘ç¬”è®°</title>
      <link href="//ranger-compile/"/>
      <url>//ranger-compile/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡è®°å½•äº† ranger2.1ç‰ˆæœ¬çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œä¸é‡åˆ°çš„ä¸€äº›bugçš„è§£å†³æ–¹æ³•ã€‚</p><span id="more"></span><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><h3 id="1-å¤–éƒ¨å·¥å…·ä¾èµ–"><a href="#1-å¤–éƒ¨å·¥å…·ä¾èµ–" class="headerlink" title="1 å¤–éƒ¨å·¥å…·ä¾èµ–"></a>1 å¤–éƒ¨å·¥å…·ä¾èµ–</h3><p>éœ€è¦linuxç¯å¢ƒï¼Œä¿è¯pythonå‘½ä»¤å¯ç”¨ï¼Œå¦‚æœåªè£…äº†python3ï¼Œæ¨è</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install -y python-is-python3</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦å¤–è¿˜éœ€è¦å®‰è£…gcc</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install gcc -y</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-æ’é™¤kylinæ¨¡å—"><a href="#2-æ’é™¤kylinæ¨¡å—" class="headerlink" title="2 æ’é™¤kylinæ¨¡å—"></a>2 æ’é™¤kylinæ¨¡å—</h3><p>kylin2.6.4ä¾èµ–calcite-linq4j-1.16.0-kylin-r2<br>è¿™ä¸ªjaråŒ…åœ¨å¤–éƒ¨mavenä»“åº“æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œå¯¼è‡´buildå¤±è´¥ï¼Œå‚è€ƒï¼š<br><a href="https://issues.apache.org/jira/browse/RANGER-2994">https://issues.apache.org/jira/browse/RANGER-2994</a><br><a href="https://issues.apache.org/jira/browse/RANGER-2999">https://issues.apache.org/jira/browse/RANGER-2999</a></p><p>å› ä¸ºæ˜¯kylinæœ¬èº«çš„ä¾èµ–é—®é¢˜ï¼Œä¸æ˜¯rangerçš„é”…ï¼Œè¿™é‡Œè°´è´£ä¸€ä¸‹kylinç„¶åå¯¹å…¶é€‰æ‹©æ€§æ”¾å¼ƒ<br>æ”¾å¼ƒæ–¹æ³•ï¼šåœ¨pom.xmlå°†å…¶æ‰€æœ‰çš„moduleæ³¨é‡Šæ‰ï¼Œå¦‚ä¸‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--                &lt;module&gt;plugin-kylin&lt;/module&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                &lt;module&gt;ranger-kylin-plugin-shim&lt;/module&gt;--&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-ranger-examples-distroé”™è¯¯"><a href="#3-ranger-examples-distroé”™è¯¯" class="headerlink" title="3 ranger-examples-distroé”™è¯¯"></a>3 ranger-examples-distroé”™è¯¯</h3><p>å‚è€ƒï¼š<a href="https://github.com/apache/ranger/pull/71">https://github.com/apache/ranger/pull/71</a><br>æ ¹æ®issueï¼Œä¿®æ”¹ sampleapp.xml å’Œ plugin-sampleapp.xml</p><h3 id="4-ranger-client"><a href="#4-ranger-client" class="headerlink" title="4 ranger client"></a>4 ranger client</h3><p>å®˜æ–¹çš„rangerClientæœ‰bugï¼Œæ–°ç‰ˆæœ¬å·²ä¿®å¤ï¼Œä½†è¿˜æ²¡å‘å¸ƒï¼Œéœ€è¦è‡ªè¡Œç¼–è¯‘<br>æ­¥éª¤ï¼š</p><ol><li>å‚è€ƒå®˜æ–¹ä»“åº“ ranger/intg/src/main/java å·¥ç¨‹ï¼Œå¯ç›´æ¥æ¬è¿è¿‡æ¥ï¼ŒåŸæ¥çš„ç›®å½•è¦å…ˆåˆ æ‰</li><li>å°† ranger/intg/pom.xml ä¸­ ranger-plugins-common çš„ç‰ˆæœ¬ä»${project.version} æ”¹ä¸º2.1.0ï¼ˆå³å…¬ç½‘ä»“åº“èƒ½æ‰¾åˆ°çš„æœ€æ–°ç‰ˆæœ¬ï¼‰</li></ol><h2 id="æ‰§è¡Œç¼–è¯‘"><a href="#æ‰§è¡Œç¼–è¯‘" class="headerlink" title="æ‰§è¡Œç¼–è¯‘"></a>æ‰§è¡Œç¼–è¯‘</h2><h3 id="1-ç¼–è¯‘å„ä¸ªç»„ä»¶-tar-gzåŒ…"><a href="#1-ç¼–è¯‘å„ä¸ªç»„ä»¶-tar-gzåŒ…" class="headerlink" title="1 ç¼–è¯‘å„ä¸ªç»„ä»¶ tar.gzåŒ…"></a>1 ç¼–è¯‘å„ä¸ªç»„ä»¶ tar.gzåŒ…</h3><p>åœ¨rangerå·¥ç¨‹ä¸‹æ‰§è¡Œï¼Œæ‰§è¡ŒæˆåŠŸå¯ä»¥åœ¨targetä¸‹çœ‹åˆ°åŒ…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn clean compile package assembly:assembly -DskipTests -DskipJSTests -Dpmd.skip=true</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ—¥å¿—å‚è€ƒï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Reactor Summary for ranger 2.1.1-SNAPSHOT:</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] ranger ............................................. SUCCESS [02:31 min]</span><br><span class="line">[INFO] Jdbc SQL Connector ................................. SUCCESS [ 12.635 s]</span><br><span class="line">[INFO] Credential Support ................................. SUCCESS [ 14.241 s]</span><br><span class="line">[INFO] Audit Component .................................... SUCCESS [ 40.494 s]</span><br><span class="line">[INFO] ranger-plugin-classloader .......................... SUCCESS [  8.902 s]</span><br><span class="line">[INFO] Common library for Plugins ......................... SUCCESS [02:43 min]</span><br><span class="line">[INFO] ranger-intg ........................................ SUCCESS [ 15.121 s]</span><br><span class="line">[INFO] Installer Support Component ........................ SUCCESS [  4.590 s]</span><br><span class="line">[INFO] Credential Builder ................................. SUCCESS [  7.686 s]</span><br><span class="line">[INFO] Embedded Web Server Invoker ........................ SUCCESS [ 12.830 s]</span><br><span class="line">[INFO] Key Management Service ............................. SUCCESS [ 52.264 s]</span><br><span class="line">[INFO] HBase Security Plugin Shim ......................... SUCCESS [ 15.598 s]</span><br><span class="line">[INFO] HBase Security Plugin .............................. SUCCESS [ 32.827 s]</span><br><span class="line">[INFO] Hdfs Security Plugin ............................... SUCCESS [ 34.502 s]</span><br><span class="line">[INFO] Hive Security Plugin ............................... SUCCESS [ 35.109 s]</span><br><span class="line">[INFO] Knox Security Plugin Shim .......................... SUCCESS [ 11.906 s]</span><br><span class="line">[INFO] Knox Security Plugin ............................... SUCCESS [ 49.254 s]</span><br><span class="line">[INFO] Storm Security Plugin .............................. SUCCESS [ 23.171 s]</span><br><span class="line">[INFO] YARN Security Plugin ............................... SUCCESS [ 16.011 s]</span><br><span class="line">[INFO] Ozone Security Plugin .............................. SUCCESS [ 16.418 s]</span><br><span class="line">[INFO] Ranger Util ........................................ SUCCESS [01:43 min]</span><br><span class="line">[INFO] Unix Authentication Client ......................... SUCCESS [  8.165 s]</span><br><span class="line">[INFO] Security Admin Web Application ..................... SUCCESS [21:33 min]</span><br><span class="line">[INFO] KAFKA Security Plugin .............................. SUCCESS [ 21.139 s]</span><br><span class="line">[INFO] SOLR Security Plugin ............................... SUCCESS [ 16.487 s]</span><br><span class="line">[INFO] NiFi Security Plugin ............................... SUCCESS [ 18.495 s]</span><br><span class="line">[INFO] NiFi Registry Security Plugin ...................... SUCCESS [ 15.196 s]</span><br><span class="line">[INFO] Kudu Security Plugin ............................... SUCCESS [  9.105 s]</span><br><span class="line">[INFO] Unix User Group Synchronizer ....................... SUCCESS [ 47.248 s]</span><br><span class="line">[INFO] Ldap Config Check Tool ............................. SUCCESS [  8.631 s]</span><br><span class="line">[INFO] Unix Authentication Service ........................ SUCCESS [  9.789 s]</span><br><span class="line">[INFO] Unix Native Authenticator .......................... SUCCESS [  4.242 s]</span><br><span class="line">[INFO] KMS Security Plugin ................................ SUCCESS [ 34.582 s]</span><br><span class="line">[INFO] Tag Synchronizer ................................... SUCCESS [ 28.172 s]</span><br><span class="line">[INFO] Hdfs Security Plugin Shim .......................... SUCCESS [  7.847 s]</span><br><span class="line">[INFO] Hive Security Plugin Shim .......................... SUCCESS [ 13.040 s]</span><br><span class="line">[INFO] YARN Security Plugin Shim .......................... SUCCESS [ 10.582 s]</span><br><span class="line">[INFO] OZONE Security Plugin Shim ......................... SUCCESS [ 16.250 s]</span><br><span class="line">[INFO] Storm Security Plugin shim ......................... SUCCESS [ 10.807 s]</span><br><span class="line">[INFO] KAFKA Security Plugin Shim ......................... SUCCESS [  8.435 s]</span><br><span class="line">[INFO] SOLR Security Plugin Shim .......................... SUCCESS [ 10.037 s]</span><br><span class="line">[INFO] Atlas Security Plugin Shim ......................... SUCCESS [  9.938 s]</span><br><span class="line">[INFO] KMS Security Plugin Shim ........................... SUCCESS [ 13.735 s]</span><br><span class="line">[INFO] ranger-examples .................................... SUCCESS [  2.577 s]</span><br><span class="line">[INFO] Ranger Examples - Conditions and ContextEnrichers .. SUCCESS [ 13.963 s]</span><br><span class="line">[INFO] Ranger Examples - SampleApp ........................ SUCCESS [ 14.751 s]</span><br><span class="line">[INFO] Ranger Examples - Ranger Plugin for SampleApp ...... SUCCESS [  9.067 s]</span><br><span class="line">[INFO] sample-client ...................................... SUCCESS [ 21.965 s]</span><br><span class="line">[INFO] Apache Ranger Examples Distribution ................ SUCCESS [ 17.195 s]</span><br><span class="line">[INFO] Ranger Tools ....................................... SUCCESS [ 32.274 s]</span><br><span class="line">[INFO] Atlas Security Plugin .............................. SUCCESS [ 15.610 s]</span><br><span class="line">[INFO] SchemaRegistry Security Plugin ..................... SUCCESS [ 33.643 s]</span><br><span class="line">[INFO] Sqoop Security Plugin .............................. SUCCESS [ 32.979 s]</span><br><span class="line">[INFO] Sqoop Security Plugin Shim ......................... SUCCESS [  8.851 s]</span><br><span class="line">[INFO] Presto Security Plugin ............................. SUCCESS [ 36.558 s]</span><br><span class="line">[INFO] Presto Security Plugin Shim ........................ SUCCESS [01:06 min]</span><br><span class="line">[INFO] Elasticsearch Security Plugin Shim ................. SUCCESS [ 14.989 s]</span><br><span class="line">[INFO] Elasticsearch Security Plugin ...................... SUCCESS [ 13.180 s]</span><br><span class="line">[INFO] Apache Ranger Distribution ......................... SUCCESS [38:46 min]</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  01:24 h</span><br><span class="line">[INFO] Finished at: 2021-05-27T15:47:58+08:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><h3 id="2-ç¼–è¯‘-ranger-client-jaråŒ…"><a href="#2-ç¼–è¯‘-ranger-client-jaråŒ…" class="headerlink" title="2 ç¼–è¯‘ ranger_client jaråŒ…"></a>2 ç¼–è¯‘ ranger_client jaråŒ…</h3><p>åœ¨ranger/intgä¸‹æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean compile package install -DskipTests</span><br></pre></td></tr></table></figure><p>å¯ä»¥åœ¨ ranger/intg/target çœ‹åˆ°ç”Ÿæˆåçš„jaråŒ…</p>]]></content>
      
      
      <categories>
          
          <category> ranger </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WSL2é…ç½®ä¸ç»“åˆIDEA2021ä½¿ç”¨ä½“éªŒï¼ˆåŠwsl-guiè¸©å‘ï¼‰</title>
      <link href="//wsl2_idea2021/"/>
      <url>//wsl2_idea2021/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘æŠŠIDEAæ›´æ–°åˆ°äº†2021ï¼Œå‘ç°æ–°ç‰ˆæœ¬å¢å¼ºäº†å¯¹WSL2çš„æ”¯æŒã€‚ä¹‹å‰çš„WSL2å¾ˆé¸¡è‚‹ï¼Œå¹å¾ˆå‰å®³ï¼Œä½†çœŸè¦å¼€å‘åˆå¾ˆä¸æ–¹ä¾¿ã€‚ æœ¬æ¥è¿˜æƒ³ç­‰ç€windowså¢å¼ºWSL2å¯¹guiçš„æ”¯æŒï¼Œç„¶ååœ¨WSL2é‡Œè£…ä¸ªIDEAã€‚<br>å€’æ˜¯IDEAåŠ¨ä½œå¿«ä¸€ç‚¹ï¼Œå…ˆåšäº†æ”¯æŒã€‚ä¸é”™ï¼Œå€¼å¾—æ£é¼“ä¸€ç•ªã€‚ä¹‹å‰ä¸ºäº†guiæŠŠwslç¯å¢ƒå¼„å¾—å¾ˆæ··ä¹±ï¼Œç›´æ¥é‡è£…ï¼Œéšä¾¿è®°å½•ä¸€ä¸‹æ“ä½œã€‚<br>2021.11æ›´æ–°ï¼šwsl-guiç¯å¢ƒé…ç½®åŠideaä½¿ç”¨</p><span id="more"></span><h3 id="ä¸€-é…ç½®WSL"><a href="#ä¸€-é…ç½®WSL" class="headerlink" title="ä¸€ é…ç½®WSL"></a>ä¸€ é…ç½®WSL</h3><p>æŒ‰æƒ¯ä¾‹ï¼Œå…ˆç»™å‡ºå®˜æ–¹æ–‡æ¡£åœ°å€ï¼ŒåŸºç¡€æ€§æ“ä½œå‚è€ƒè¿™ä¸ªï¼š <a href="https://docs.microsoft.com/zh-cn/windows/wsl/">https://docs.microsoft.com/zh-cn/windows/wsl/</a></p><h4 id="1-å¼€å¯wsl"><a href="#1-å¼€å¯wsl" class="headerlink" title="1 å¼€å¯wsl"></a>1 å¼€å¯wsl</h4><p>å‚è€ƒï¼š<a href="https://docs.microsoft.com/zh-cn/windows/wsl/install-win10">https://docs.microsoft.com/zh-cn/windows/wsl/install-win10</a></p><h5 id="1-å®‰è£…ã€Œé€‚ç”¨äº-Linux-çš„-Windows-å­ç³»ç»Ÿã€å’Œã€Œè™šæ‹Ÿæœºå¹³å°ã€è¿™ä¸¤ä¸ªå¯é€‰ç»„ä»¶"><a href="#1-å®‰è£…ã€Œé€‚ç”¨äº-Linux-çš„-Windows-å­ç³»ç»Ÿã€å’Œã€Œè™šæ‹Ÿæœºå¹³å°ã€è¿™ä¸¤ä¸ªå¯é€‰ç»„ä»¶" class="headerlink" title="1 å®‰è£…ã€Œé€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿã€å’Œã€Œè™šæ‹Ÿæœºå¹³å°ã€è¿™ä¸¤ä¸ªå¯é€‰ç»„ä»¶"></a>1 å®‰è£…ã€Œé€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿã€å’Œã€Œè™šæ‹Ÿæœºå¹³å°ã€è¿™ä¸¤ä¸ªå¯é€‰ç»„ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart</span><br><span class="line">dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart</span><br></pre></td></tr></table></figure><h5 id="2-é‡å¯"><a href="#2-é‡å¯" class="headerlink" title="2 é‡å¯"></a>2 é‡å¯</h5><h5 id="3-é…ç½®é»˜è®¤ä½¿ç”¨wsl2"><a href="#3-é…ç½®é»˜è®¤ä½¿ç”¨wsl2" class="headerlink" title="3 é…ç½®é»˜è®¤ä½¿ç”¨wsl2"></a>3 é…ç½®é»˜è®¤ä½¿ç”¨wsl2</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --set-default-version 2</span><br></pre></td></tr></table></figure><h4 id="2-å®‰è£…windows-terminal"><a href="#2-å®‰è£…windows-terminal" class="headerlink" title="2 å®‰è£…windows terminal"></a>2 å®‰è£…windows terminal</h4><p>åœ¨åº”ç”¨å•†åº—ä¸‹è½½å®‰è£…ï¼Œè‡ªè¡Œç¾åŒ–å³å¯ï¼Œæ–°ç‰ˆæœ¬å·²å¯ç›´æ¥é€šè¿‡é€‰é¡¹é…ç½®ï¼Œä¸éœ€è¦ç›´æ¥æ“ä½œé…ç½®æ–‡ä»¶</p><h3 id="äºŒ-é…ç½®ubuntu"><a href="#äºŒ-é…ç½®ubuntu" class="headerlink" title="äºŒ é…ç½®ubuntu"></a>äºŒ é…ç½®ubuntu</h3><h4 id="1-å®‰è£…ubuntu"><a href="#1-å®‰è£…ubuntu" class="headerlink" title="1 å®‰è£…ubuntu"></a>1 å®‰è£…ubuntu</h4><p>åœ¨åº”ç”¨å•†åº—æœç´¢ä¸‹è½½ubuntuï¼Œå½“å‰ç‰ˆæœ¬ä¸ºï¼š20.04.2ï¼Œä¸‹è½½å®Œæ‰“å¼€å›¾æ ‡è¿›è¡Œå®‰è£…<br>å®‰è£…è¿‡ç¨‹ä¼šæç¤ºè¾“å…¥ä¸€ä¸ªé»˜è®¤ç”¨æˆ·å’Œå¯¹åº”å¯†ç ï¼Œæ³¨æ„ä¸èƒ½ç”¨rootï¼ˆå·²å­˜åœ¨ï¼‰</p><h4 id="2-ä¿®æ”¹é»˜è®¤ç”¨æˆ·ä¸ºroot"><a href="#2-ä¿®æ”¹é»˜è®¤ç”¨æˆ·ä¸ºroot" class="headerlink" title="2 ä¿®æ”¹é»˜è®¤ç”¨æˆ·ä¸ºroot"></a>2 ä¿®æ”¹é»˜è®¤ç”¨æˆ·ä¸ºroot</h4><h5 id="1-æŸ¥çœ‹å½“å‰wslåˆ—è¡¨ï¼š"><a href="#1-æŸ¥çœ‹å½“å‰wslåˆ—è¡¨ï¼š" class="headerlink" title="1 æŸ¥çœ‹å½“å‰wslåˆ—è¡¨ï¼š"></a>1 æŸ¥çœ‹å½“å‰wslåˆ—è¡¨ï¼š</h5><p>   ä¹‹æ‰€ä»¥è¦è¿™ä¸€æ­¥æ˜¯å› ä¸ºå¦‚æœè£…äº†å¤šä¸ªç‰ˆæœ¬çš„ubuntuï¼Œå…¶æ ‡è¯†å¯èƒ½ä¸ä¸€æ ·<br>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl -l </span><br></pre></td></tr></table></figure></p><h5 id="2-ä¿®æ”¹å¯¹åº”wslé»˜è®¤ç”¨æˆ·"><a href="#2-ä¿®æ”¹å¯¹åº”wslé»˜è®¤ç”¨æˆ·" class="headerlink" title="2 ä¿®æ”¹å¯¹åº”wslé»˜è®¤ç”¨æˆ·"></a>2 ä¿®æ”¹å¯¹åº”wslé»˜è®¤ç”¨æˆ·</h5>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ubuntu config --default-user root</span><br></pre></td></tr></table></figure><h4 id="3-å°†linuxæ ¹ç›®å½•æ˜ å°„åˆ°win10ç£ç›˜"><a href="#3-å°†linuxæ ¹ç›®å½•æ˜ å°„åˆ°win10ç£ç›˜" class="headerlink" title="3 å°†linuxæ ¹ç›®å½•æ˜ å°„åˆ°win10ç£ç›˜"></a>3 å°†linuxæ ¹ç›®å½•æ˜ å°„åˆ°win10ç£ç›˜</h4><p>åœ¨win10æ–‡ä»¶åœ°å€æ è¾“å…¥ \wsl$ ï¼Œå¯ä»¥çœ‹åˆ°å·²å®‰è£…çš„wslæ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ Ubuntu<br>å³é”®-æ˜ å°„ç½‘ç»œé©±åŠ¨å™¨ï¼Œé€‰æ‹©è¦æ˜ å°„çš„ç›˜ç¬¦å³å¯ã€‚<br>å¦å¤–æ³¨æ„ï¼Œå¯ä»¥ç”¨<code>explorer.exe . </code>å‘½ä»¤ä½¿ç”¨windowsæ–‡ä»¶èµ„æºç®¡ç†å™¨æ‰“å¼€å½“å‰è·¯å¾„</p><h4 id="4-é…ç½®-terminal-æ‰“å¼€é»˜è®¤è·¯å¾„"><a href="#4-é…ç½®-terminal-æ‰“å¼€é»˜è®¤è·¯å¾„" class="headerlink" title="4 é…ç½® terminal æ‰“å¼€é»˜è®¤è·¯å¾„"></a>4 é…ç½® terminal æ‰“å¼€é»˜è®¤è·¯å¾„</h4><p>åœ¨ terminal é…ç½®æ–‡ä»¶ä¸­ï¼Œæ‰¾åˆ°Ubuntué…ç½®é¡¹ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®å³å¯<br>startingDirectoryâ€ : â€œ//wsl$/Ubuntu-20.04/homeâ€</p><h4 id="5-æ›´æ–°é•œåƒæº"><a href="#5-æ›´æ–°é•œåƒæº" class="headerlink" title="5 æ›´æ–°é•œåƒæº"></a>5 æ›´æ–°é•œåƒæº</h4><h5 id="1-æŸ¥çœ‹å…·ä½“ç‰ˆæœ¬"><a href="#1-æŸ¥çœ‹å…·ä½“ç‰ˆæœ¬" class="headerlink" title="1 æŸ¥çœ‹å…·ä½“ç‰ˆæœ¬"></a>1 æŸ¥çœ‹å…·ä½“ç‰ˆæœ¬</h5>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/lsb-release</span><br></pre></td></tr></table></figure><h5 id="2-åˆ°-https-mirrors-tuna-tsinghua-edu-cn-help-ubuntu-å¤åˆ¶æœ€æ–°çš„é•œåƒ"><a href="#2-åˆ°-https-mirrors-tuna-tsinghua-edu-cn-help-ubuntu-å¤åˆ¶æœ€æ–°çš„é•œåƒ" class="headerlink" title="2 åˆ° https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/ å¤åˆ¶æœ€æ–°çš„é•œåƒ"></a>2 åˆ° <a href="https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/">https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/</a> å¤åˆ¶æœ€æ–°çš„é•œåƒ</h5><p>   é˜¿é‡Œçš„æ”¯æŒå‚»ç“œå¼æ“ä½œï¼Œä½†ç»å¸¸æ‰“ä¸å¼€ï¼Œå°±ç®—äº†<br>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">å¤‡ä»½ï¼š</span></span><br><span class="line">mv /etc/apt/sources.list /etc/apt/sources.list.backup</span><br><span class="line"><span class="meta">#</span><span class="bash">ç¼–è¾‘ï¼š</span></span><br><span class="line">vi /etc/apt/sources.list</span><br></pre></td></tr></table></figure></p><h5 id="3-æ›´æ–°"><a href="#3-æ›´æ–°" class="headerlink" title="3 æ›´æ–°"></a>3 æ›´æ–°</h5>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update -y &amp;&amp; apt-get upgrade -y</span><br></pre></td></tr></table></figure><h4 id="6-é…ç½®ä»£ç†"><a href="#6-é…ç½®ä»£ç†" class="headerlink" title="6 é…ç½®ä»£ç†"></a>6 é…ç½®ä»£ç†</h4><p>å¦‚æœä»£ç†è½¯ä»¶æ˜¯è£…åœ¨windowsç³»ç»Ÿçš„ï¼Œå‚è€ƒç¬¬å››éƒ¨åˆ†çš„ è·å–å®¿ä¸»æœºip éƒ¨åˆ†é…ç½®my.winå°±è¡Œäº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;export ALL_PROXY=&quot;http://$host_ip:7890&quot;&#x27;&gt;&gt;/etc/profile</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="7-é…ç½®ssh"><a href="#7-é…ç½®ssh" class="headerlink" title="7 é…ç½®ssh"></a>7 é…ç½®ssh</h4><p>é™¤ééœ€è¦ä¸ç„¶ä¸å»ºè®®å¯ç”¨sshï¼Œåº”ç”¨åœºæ™¯ï¼šideaæ”¯æŒsshè¿è¡Œç¯å¢ƒä½†ä¸æ”¯æŒwslçš„æ—¶å€™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æ›´æ–°è½¯ä»¶</span></span></span><br><span class="line">apt -y update &amp;&amp; apt -y upgrade</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># å®‰è£…sshï¼ˆä¸€èˆ¬å·²å®‰è£…ï¼‰</span></span></span><br><span class="line">apt install -y openssh-server</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># é…ç½®å…è®¸å¯†ç ç™»å½•</span></span></span><br><span class="line">sed -i &#x27;s/PasswordAuthentication no/PasswordAuthentication yes/&#x27; /etc/ssh/sshd_config</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># é…ç½®å…è®¸rootç™»å½•</span></span></span><br><span class="line">sed -i &#x27;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/&#x27; /etc/ssh/sshd_config</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># å¯åŠ¨/é‡å¯</span></span></span><br><span class="line">service ssh restart</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ä¿®æ”¹rootå¯†ç </span></span></span><br><span class="line">passwd</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># é“¾æ¥rootç›®å½•(ä¸€èˆ¬ä¸éœ€è¦æ‰§è¡Œï¼)</span></span></span><br><span class="line">ln -s /root /home/root</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æµ‹è¯•ssh(ä½¿ç”¨åˆšè®¾ç½®çš„rootå¯†ç ç™»å½•)</span></span></span><br><span class="line">ssh root@localhost</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="99-ç¦æ­¢æ·»åŠ Windows-PATH"><a href="#99-ç¦æ­¢æ·»åŠ Windows-PATH" class="headerlink" title="99 ç¦æ­¢æ·»åŠ Windows-PATH"></a>99 ç¦æ­¢æ·»åŠ Windows-PATH</h4><blockquote><p>æ­¤éƒ¨åˆ†å†…å®¹è¿‡æœŸï¼Œå¯ä¸é…ç½®ï¼Œè§†æƒ…å†µè€Œå®šï¼Œæ²¡é—®é¢˜å¯ä»¥ä¸ç®¡ã€‚åƒåœ¨windowå’ŒwslåŒæ—¶å®‰è£…npmä¼šæœ‰é—®é¢˜ï¼Œå°±éœ€è¦é…ç½®ã€‚</p></blockquote><p>ä¸ºäº†é¿å…å¼€å‘ç¯å¢ƒå†²çªï¼Œéœ€å…³é—­Windows-PATH<br>wsl.confé…ç½®å‚è€ƒï¼š<a href="https://docs.microsoft.com/zh-cn/windows/wsl/wsl-config">https://docs.microsoft.com/zh-cn/windows/wsl/wsl-config</a><br>æ–°å»º /etc/wsl.confï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š<br>    <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¸åŠ è½½Windowsä¸­çš„PATHå†…å®¹</span></span><br><span class="line">[interop]</span><br><span class="line">appendWindowsPath = false</span><br></pre></td></tr></table></figure></p><h3 id="ä¸‰-IDEAå¼€å‘å’Œæ€»ç»“"><a href="#ä¸‰-IDEAå¼€å‘å’Œæ€»ç»“" class="headerlink" title="ä¸‰ IDEAå¼€å‘å’Œæ€»ç»“"></a>ä¸‰ IDEAå¼€å‘å’Œæ€»ç»“</h3><p>ç»è¿‡æµ‹è¯•ï¼Œå¸¸è§„SpringBootå·¥ç¨‹ï¼Œåœ¨Windowsç›®å½•ä¸‹çš„ï¼Œå¯ä»¥ä½¿ç”¨WSLç¯å¢ƒè¿›è¡Œdebugã€éƒ¨ç½²<br>å¯¹äºçº¯mavenå·¥ç¨‹ï¼Œæ”¯æŒä¹Ÿè¿˜å¥½</p><blockquote><p>æ­¤éƒ¨åˆ†è¿‡æœŸï¼š<br>ä½†å¯¹äºçº¯gradleå·¥ç¨‹ï¼ˆéspringï¼‰ï¼Œåˆ™æ— æ³•å®Œæˆgradleåˆå§‹åŒ–ï¼Œæ— è®ºå·¥ç¨‹æ˜¯å¦æ˜¯åœ¨WSLä¸­éƒ½ä¸è¡Œ<br>è®¾ç½®JDKæ˜¯WSLï¼Œä½†å°†Gradleè·¯å¾„æŒ‡å®šä¸ºWSLå´ä¸€ç›´ä¸è¡Œï¼Œè¯´è·¯å¾„æœ‰é—®é¢˜ï¼Œåªèƒ½ä½¿ç”¨é»˜è®¤çš„Gradleã€‚<br>æ ¹æ®issueçš„è¯´æ³•ï¼Œå»ºè®®å°†Windowsçš„gradle pathè®¾ç½®ä¸ºWSLçš„è·¯å¾„ï¼Œä¸è¿‡æˆ‘æ²¡æœ‰è¯•ï¼Œæˆ‘è§‰å¾—è¿™å•çº¯å°±æ˜¯å®˜æ–¹çš„bugã€‚<br>å®˜æ–¹issueï¼š<a href="https://youtrack.jetbrains.com/issues/IDEA?q=wsl">https://youtrack.jetbrains.com/issues/IDEA?q=wsl</a><br>å¦å¤–ï¼Œå¯¹äºWSLä¸‹å·¥ç¨‹çš„gitï¼Œideaä¼¼ä¹ä¹Ÿæ— æ³•è¯†åˆ«</p></blockquote><p>æ€»ä¹‹ï¼ŒIDEAï¼ˆ2021.1ï¼‰çš„WSL2æ”¯æŒå°šä¸æˆç†Ÿï¼Œä½†æ˜¯ä¹Ÿå·²ç»åˆæ­¥æ”¯æŒï¼Œè¿˜å¯ä»¥è‡ªåŠ¨ä¸‹è½½ã€é€‰æ‹©WSLç¯å¢ƒçš„JDK<br>å¯ä»¥ä½œä¸ºæ—¥å¸¸å¼€å‘çš„è¾…åŠ©æ”¯æŒï¼Œä½†ç›®å‰ä»ä¸å»ºè®®å…¨é¢è¿ç§»è¿‡å»</p><p>å¯¹æˆ‘æ¥è¯´ï¼ŒWSLçš„å¼€å‘åº”ç”¨åœºæ™¯ä¸»è¦åœ¨äºï¼š<br>å¤§æ•°æ®åŠŸèƒ½å¼€å‘ï¼šä¹‹å‰ç®€å•çš„hdfsæ“ä½œéƒ½éœ€è¦åœ¨windowsä¸­é…ç½®hadoopç›¸å…³çš„ç¯å¢ƒå˜é‡ï¼Œè€Œä¸”å„ç§ç‰ˆæœ¬æˆ–å…¼å®¹æ€§é—®é¢˜ï¼Œå¾ˆéº»çƒ¦ï¼Œä»¥åè¿™äº›ç›´æ¥ä¸¢wslé‡Œé¢<br>å¤§æ•°æ®ç»„ä»¶ç¼–è¯‘ï¼šå¾ˆå¤šç»„ä»¶å¹¶ä¸æ˜¯çº¯Javaä»£ç ï¼Œå¯èƒ½è¿˜éœ€è¦ä¸€äº›è„šæœ¬ï¼Œè¿™äº›æœ‰å¹³å°ä¾èµ–æ€§çš„ï¼Œå¾ˆå¯èƒ½å› ä¸ºwindowsè€Œå¯¼è‡´ç¼–è¯‘å¤±è´¥<br>è„šæœ¬å¼€å‘ï¼šåœ¨windowsæ–°å»ºçš„shè„šæœ¬åœ¨æ‹¿å»linuxç³»ç»Ÿä¹‹å‰éƒ½è¦å…ˆè½¬æ¢ä¸€ä¸‹æ ¼å¼ï¼Œä»¥åç›´æ¥ä½œä¸ºwslç³»ç»Ÿä¸‹æ–‡ä»¶æ–°å»ºï¼Œå°±ä¸ç”¨è€ƒè™‘è¿™äº›ä¹±ä¸ƒå…«ç³Ÿçš„é—®é¢˜</p><p>æœ€ç»ˆç›®æ ‡æ˜¯ä»¥åæŠŠæ‰€æœ‰çš„å·¥ç¨‹éƒ½è¿ç§»åˆ°wslä¸‹ï¼Œå¼€å‘ç›¸å…³å…¨éƒ¨ä½¿ç”¨wslç¯å¢ƒ</p><p>2021å¹´11æœˆæ›´æ–°ï¼š<br>IDEA2021.2.3çš„wslå·¥ç¨‹çš„bugå·²ç»è¾ƒå°‘ï¼Œgitã€gradleæ”¯æŒç›¸å¯¹æ­£å¸¸ï¼Œå¯ä»¥æ»¡è¶³ä¸€èˆ¬åœºæ™¯ä¸‹çš„å¼€å‘éœ€æ±‚ã€‚<br>ä½†ä»ä¸èƒ½åœ¨å·¥ç¨‹é‡Œè¯»å–åˆ°wslçš„ç¯å¢ƒå˜é‡ï¼ˆèƒ½è¯»å–åˆ°windowsçš„ï¼‰ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©æ”¾å¼ƒã€‚<br>ç›´æ¥åœ¨WSLgé‡Œè£…jetbrains toolboxï¼Œç„¶åå¯åŠ¨ideaã€‚<br>é™¤å»ä¸€äº›å°bugï¼Œå·²ç»å’ŒåŸç”Ÿlinuxä½“éªŒå·®ä¸å¤šäº†ï¼Œç”¨æ¥åšå¤§æ•°æ®å¼€å‘å¾ˆèˆ’æœã€‚<br>é…ç½®å¥½ç¯å¢ƒå°±å¯ä»¥ç›´æ¥æœ¬åœ°è¿›è¡Œå¤§æ•°æ®æ“ä½œï¼Œä¸å†éœ€è¦è¿œç¨‹å¼€å‘äº†ï¼Œä¹‹å‰è¢«è¿™ä¸œè¥¿æŠ˜ç£¨å¾—ä¸è¡Œã€‚<br>æ€§èƒ½çš„è¯æ¯”windows ideaçš„wslå¼€å‘è¦å¿«å¾ˆå¤šï¼Œå‰ææ˜¯ä½ å†…å­˜å¤Ÿã€‚<br>wslæ¯”è¾ƒåƒå†…å­˜ï¼Œå½“ç„¶å¼€å‘çš„æ ‡é…æ˜¯32gï¼Œä¸€èˆ¬è¿˜æ˜¯å¤Ÿç”¨çš„ã€‚</p><p>ç›®å‰é‡åˆ°çš„é—®é¢˜æœ‰ï¼š</p><ol><li>å…¨å±åç§»<br>åœ¨å…¨å±çŠ¶æ€ä¸‹ï¼Œæ— æ³•è¿›è¡Œéƒ¨åˆ†æ‹–æ‹½æ“ä½œï¼Œå¯èƒ½ä¸è¿™ä¸ªissueæœ‰å…³<br><a href="https://github.com/microsoft/wslg/issues/502">https://github.com/microsoft/wslg/issues/502</a></li><li>å¡æ­»<br>é€šå¸¸æ˜¯åœ¨è°ƒå‡ºæ–°çš„çª—å£çš„æ—¶å€™<br>éœ€è¦æ‰‹åŠ¨wsl â€“shutdownï¼Œå†å¯åŠ¨ï¼Œä½†å¯èƒ½é€ æˆideaæ–‡ä»¶æœªä¿å­˜ï¼Œä¿®æ”¹ä¸¢å¤±çš„æƒ…å†µ<br>åœ¨windowsä¸Šä¸ç®¡æ€ä¹ˆé€ åŸºæœ¬éƒ½ä¸ä¼šå‡ºç°ideaæ–‡ä»¶ä¿®æ”¹ä¸¢å¤±çš„æƒ…å†µ</li></ol><h3 id="å››-å…¶ä»–"><a href="#å››-å…¶ä»–" class="headerlink" title="å›› å…¶ä»–"></a>å›› å…¶ä»–</h3><h4 id="1-wsl2è·å–å®¿ä¸»æœºip"><a href="#1-wsl2è·å–å®¿ä¸»æœºip" class="headerlink" title="1 wsl2è·å–å®¿ä¸»æœºip"></a>1 wsl2è·å–å®¿ä¸»æœºip</h4><p>windowså¯ä»¥ç›´æ¥è®¿é—®wslçš„åº”ç”¨ï¼Œä½¿ç”¨localhostå³å¯ï¼Œä½†æ˜¯ä¸èƒ½ä½¿ç”¨127.0.0.1<br>wslå¯ä»¥é€šè¿‡ä»¥ä¸‹æ“ä½œè·å–windowsçš„ipå¹¶è®¾ç½®hostï¼Œä»¥åç›´æ¥æä¾›my.winè®¿é—®ï¼Œä¸€èˆ¬ç”¨äºè®¿é—®windowsçš„ä»£ç†æœåŠ¡<br>æ³¨æ„éœ€è¦ä½¿ç”¨/tmp/hostsä½œä¸ºä¸­è½¬ï¼Œå¦åˆ™/etc/hostsä¼šè¢«æ¸…ç©º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;host_ip=$(cat /etc/resolv.conf |grep &quot;nameserver&quot; |cut -f 2 -d &quot; &quot;)&#x27;&gt;&gt;/etc/profile</span><br><span class="line">echo &#x27;sed -e &quot;/my.win/d&quot;  /etc/hosts  &gt; /tmp/hosts&#x27;&gt;&gt;/etc/profile</span><br><span class="line">echo &#x27;cat /tmp/hosts &gt; /etc/hosts&gt;&gt;/etc/profile</span><br><span class="line">echo &#x27;echo &quot;$host_ip my.win&quot; &gt;&gt;/etc/hosts&#x27;&gt;&gt;/etc/profile</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-å±€åŸŸç½‘è®¿é—®wsl2"><a href="#2-å±€åŸŸç½‘è®¿é—®wsl2" class="headerlink" title="2 å±€åŸŸç½‘è®¿é—®wsl2"></a>2 å±€åŸŸç½‘è®¿é—®wsl2</h4><p>éœ€è¦ä½¿ç”¨netsh interface portproxyåŠŸèƒ½ï¼ŒæŒ‰ç…§helpæç¤ºæ“ä½œå°±è¡Œ<br>åœ¨powershell ç®¡ç†å‘˜æ¨¡å¼ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå±€åŸŸç½‘å…¶ä»–æœºå™¨åªéœ€è¦è¿æ¥å®¿ä¸»æœºçš„19909ç«¯å£å³å¯è®¿é—®wsl2å†…19909ç«¯å£çš„å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> é‡ç½®ç½‘ç»œä»£ç†</span></span><br><span class="line">netsh interface portproxy reset</span><br><span class="line"><span class="meta">#</span><span class="bash"> v4tov6 springbootç½‘ç»œé»˜è®¤æ˜¯v6çš„</span></span><br><span class="line">netsh interface portproxy add v4tov6 listenport=19909 listenaddress=0.0.0.0 connectport=19909 connectaddress=localhost</span><br><span class="line">netsh interface portproxy add v4tov4 listenport=19909 listenaddress=0.0.0.0 connectport=19909 connectaddress=localhost</span><br><span class="line">netsh interface portproxy show all</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="3-æ‰‹åŠ¨æ·»åŠ jetbrains-toolboxè½¯ä»¶çš„å¿«æ·æ–¹å¼åˆ°å¼€å§‹èœå•"><a href="#3-æ‰‹åŠ¨æ·»åŠ jetbrains-toolboxè½¯ä»¶çš„å¿«æ·æ–¹å¼åˆ°å¼€å§‹èœå•" class="headerlink" title="3 æ‰‹åŠ¨æ·»åŠ jetbrains toolboxè½¯ä»¶çš„å¿«æ·æ–¹å¼åˆ°å¼€å§‹èœå•"></a>3 æ‰‹åŠ¨æ·»åŠ jetbrains toolboxè½¯ä»¶çš„å¿«æ·æ–¹å¼åˆ°å¼€å§‹èœå•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ~/.local/share/applications</span><br><span class="line">sudo cp *.desktop /usr/share/applications</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://juejin.cn/post/6966630345915498526">https://juejin.cn/post/6966630345915498526</a></p><h4 id="3-ä¸­æ–‡ç¯å¢ƒåŠè¾“å…¥æ³•"><a href="#3-ä¸­æ–‡ç¯å¢ƒåŠè¾“å…¥æ³•" class="headerlink" title="3 ä¸­æ–‡ç¯å¢ƒåŠè¾“å…¥æ³•"></a>3 ä¸­æ–‡ç¯å¢ƒåŠè¾“å…¥æ³•</h4><p>è¿™ä¸ªæ•™ç¨‹æ¯”è¾ƒå¤šï¼Œè€Œä¸”å†™å¾—éƒ½ä¸ä¸€æ ·ï¼Œä½†å¤§åŒå°å¼‚ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯<br>è¾“å…¥æ³•æ²¡æœ‰åˆ‡æ¢å¤„ç†å¾ˆå¯èƒ½æ˜¯å¿«æ·é”®è¢«windowsç³»ç»Ÿçš„è¦†ç›–äº†ï¼Œ<br>éœ€è¦æ‰‹åŠ¨è°ƒå‡ºæ¥è¾“å…¥æ³•çš„é…ç½®ç•Œé¢ï¼Œä¿®æ”¹å¿«æ·é”®<br>æ¯”æ–¹è¯´fcixçš„æ˜¯fcitx-config-gtk3å‘½ä»¤<br>ç„¶åæˆ‘çš„é…ç½®æ˜¯è¿™æ ·çš„ï¼Œå°±æ˜¯shifté”®ï¼Œä¿æŒå’Œwindowsä½¿ç”¨ä¹ æƒ¯ç»Ÿä¸€<br><img src="https://lian-gallery.oss-cn-guangzhou.aliyuncs.com/img/1636899123(1).png"></p><p>è¿™é‡Œçš„æ•™ç¨‹å¯ä»¥å‚è€ƒï¼š<a href="https://monkeywie.cn/2021/09/26/wsl2-gui-idea-config/">https://monkeywie.cn/2021/09/26/wsl2-gui-idea-config/</a><br>æœç‹—è¾“å…¥æ³•å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/142206571">https://zhuanlan.zhihu.com/p/142206571</a><br>æœç‹—è¾“å…¥æ³•é…ç½®å‘½ä»¤ï¼šsogouIme-configtool<br>æˆ‘çš„é…ç½®å’Œé‡Œé¢çš„ä¸ä¸€æ ·ï¼Œ ä¹Ÿæ²¡æœ‰é‡åˆ°ideaåˆ‡ä¸å‡ºè¾“å…¥æ³•çš„é—®é¢˜<br>å¦‚æœæœ‰çš„è¯å‚è€ƒæ–‡ç« é‡Œçš„æ–¹æ³•æˆ–è€…çœ‹ï¼š<a href="https://github.com/microsoft/wslg/issues/278">https://github.com/microsoft/wslg/issues/278</a></p><h4 id="4-wsl-dockerï¼ˆext4-vhdxï¼‰ç£ç›˜ç©ºé—´æ— æ³•å›æ”¶"><a href="#4-wsl-dockerï¼ˆext4-vhdxï¼‰ç£ç›˜ç©ºé—´æ— æ³•å›æ”¶" class="headerlink" title="4 wsl-dockerï¼ˆext4.vhdxï¼‰ç£ç›˜ç©ºé—´æ— æ³•å›æ”¶"></a>4 wsl-dockerï¼ˆext4.vhdxï¼‰ç£ç›˜ç©ºé—´æ— æ³•å›æ”¶</h4><p>é—®é¢˜æè¿°ï¼š<br>Docker Desktop for Windows v2 ä½¿ç”¨ WSL2ï¼Œ<br>å°†æ‰€æœ‰æ˜ åƒå’Œå®¹å™¨æ–‡ä»¶å­˜å‚¨åœ¨å•ç‹¬çš„è™šæ‹Ÿå· (vhdx) ä¸­ã€‚<br>å½“éœ€è¦æ›´å¤šç©ºé—´ï¼ˆè¾¾åˆ°ä¸€å®šé™åº¦ï¼‰æ—¶ï¼Œè¿™ä¸ªè™šæ‹Ÿç¡¬ç›˜æ–‡ä»¶ä¼šè‡ªåŠ¨å¢é•¿ã€‚<br>ä¸å¹¸çš„æ˜¯ï¼Œå¦‚æœæ‚¨å›æ”¶ä¸€äº›ç©ºé—´ï¼Œå³é€šè¿‡åˆ é™¤æœªä½¿ç”¨çš„å›¾åƒï¼Œvhdx ä¸ä¼šè‡ªåŠ¨ç¼©å°ã€‚</p><p>å¤„ç†æ–¹æ³•ï¼š<br>æš‚æ—¶æ²¡æœ‰å¥½çš„å¤„ç†æ–¹æ³•ï¼Œå¾—æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤ï¼Œæˆ–è€…åˆ©ç”¨Docker Desktopçš„Troubleshootå®Œå…¨æ¸…é™¤ã€‚<br>å‚è€ƒï¼š <a href="https://github.com/microsoft/WSL/issues/4699">https://github.com/microsoft/WSL/issues/4699</a></p><p>æ‰§è¡Œå‘½ä»¤å‰æ³¨æ„å…ˆåœæ­¢Docker Desktopå’ŒWSL2<br>windowsä¸“ä¸šç‰ˆæ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wsl --shutdown</span><br><span class="line">optimize-vhd -Path C:\â€¦\â€¦\ext4.vhdx -Mode full</span><br></pre></td></tr></table></figure><p>windowså®¶åº­ç‰ˆæ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wsl --shutdown</span><br><span class="line">diskpart</span><br><span class="line"><span class="meta">#</span><span class="bash"> open window Diskpart</span></span><br><span class="line">select vdisk file=&quot;C:\â€¦\â€¦\ext4.vhdx&quot;</span><br><span class="line">attach vdisk readonly</span><br><span class="line">compact vdisk</span><br><span class="line">detach vdisk</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¨‹åºå‘˜æ‚è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç”Ÿäº§åŠ› </tag>
            
            <tag> WSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤§æ•°æ®é€šç”¨è®¡ç®—å¹³å°(æ”¯æŒflinkã€sparkã€storm)-ç³»ç»Ÿè°ƒç ”åŠè®¾è®¡</title>
      <link href="//bigdata_compute_platform/"/>
      <url>//bigdata_compute_platform/</url>
      
        <content type="html"><![CDATA[<p>é¡¹ç›®æºäºå¯¹flink_sqlæµè®¡ç®—ä»»åŠ¡çš„å®é™…ä½¿ç”¨éœ€æ±‚ï¼Œæœ€åˆç›®æ ‡æ˜¯è®¾è®¡ä¸€ä¸ªç³»ç»Ÿå¯ä»¥åœ¨çº¿æäº¤sqlç”Ÿæˆflinkæµå¼è®¡ç®—ä»»åŠ¡ï¼Œå¹¶è¿›è¡Œç›‘æ§ç›‘æµ‹ã€‚ åå»¶ç”³è‡³æ”¯æŒåœ¨çº¿jaråŒ…æäº¤çš„æ–¹å¼ï¼ŒåŒæ—¶æ”¯æŒæ‰¹å¼è®¡ç®—ä»»åŠ¡ã€‚å¹¶ä»¥æ¨¡å—åŒ–å¼€å‘çš„æ€è·¯ï¼Œå¼•å…¥å¯¹sparkçš„æ”¯æŒã€‚</p><span id="more"></span><h3 id="ä¸€-ç®€ä»‹"><a href="#ä¸€-ç®€ä»‹" class="headerlink" title="ä¸€ ç®€ä»‹"></a>ä¸€ ç®€ä»‹</h3><h4 id="1-ç³»ç»Ÿä»‹ç»"><a href="#1-ç³»ç»Ÿä»‹ç»" class="headerlink" title="1 ç³»ç»Ÿä»‹ç»"></a>1 ç³»ç»Ÿä»‹ç»</h4><p>æœ¬ç³»ç»ŸåŸºäºå¤šç§ä¸åŒçš„åº•å±‚è®¡ç®—æ¡†æ¶ï¼Œå¦‚flinkã€sparkã€stormï¼Œæä¾›å¯è§†åŒ–webç•Œé¢ï¼Œå®ç°å¤§æ•°æ®ä»»åŠ¡çš„åœ¨çº¿å‘å¸ƒã€ç®¡ç†ã€ç›‘æ§ç­‰åŠŸèƒ½ã€‚<br>æ”¯æŒå¤šç§ä»»åŠ¡ç±»å‹ï¼Œå¦‚sqlæäº¤ã€jaråŒ…æäº¤ç­‰ï¼Œå±è”½åº•å±‚éƒ¨ç½²ç»†èŠ‚ä¸å‚æ•°é…ç½®ï¼Œä½¿å¼€å‘äººå‘˜å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡æœ¬èº«ï¼Œæé«˜å·¥ä½œæ•ˆç‡<br>å¹³å°æœ¬èº«ä¾æ‰˜äºç°æœ‰å¤§æ•°æ®è®¡ç®—æ¡†æ¶ï¼Œä¸ä¼šå¼•å…¥å…¶ä»–ä¾èµ–ï¼Œä¸ä¼šå¯¹ç°æœ‰å¼€å‘é€ æˆå…¥ä¾µï¼Œå¯æ”¾å¿ƒä½¿ç”¨ã€‚</p><h4 id="2-è®¾è®¡ç›®æ ‡"><a href="#2-è®¾è®¡ç›®æ ‡" class="headerlink" title="2 è®¾è®¡ç›®æ ‡"></a>2 è®¾è®¡ç›®æ ‡</h4><ol><li>æ”¯æŒå¤šç§è®¡ç®—æ¡†æ¶ï¼šflinkã€sparkã€stormç­‰</li><li>æ”¯æŒå¤šç§è®¡ç®—ä»»åŠ¡ï¼šæ‰¹ã€æµ</li><li>æ”¯æŒå¤šç§ä»»åŠ¡ç±»å‹ï¼šsqlã€jaråŒ…ã€dagå›¾ç­‰</li><li>æ”¯æŒåŠŸèƒ½ï¼šå‘å¸ƒã€åœæ­¢ã€åˆ é™¤ã€ç›‘æ§ç­‰</li><li>é›¶å…¥ä¾µï¼šçº¯å®¢æˆ·ç«¯å·¥å…·ï¼Œä¸éœ€è¦è°ƒæ•´ä¸šåŠ¡ä»£ç ï¼Œä¸éœ€è¦ä¿®æ”¹å¹³å°é…ç½®</li></ol><h4 id="3-RoadMap"><a href="#3-RoadMap" class="headerlink" title="3 RoadMap"></a>3 RoadMap</h4><ol><li>æ”¯æŒæ›´å¤šçš„æäº¤æ–¹å¼ï¼Œå¦‚è„šæœ¬æäº¤</li><li>æ”¯æŒæ›´å¤šçš„åº•å±‚è¿è¡Œå¹³å°ï¼Œå¦‚kubernetesã€standaloneç­‰</li></ol><h3 id="äºŒ-è®¾è®¡è°ƒç ”"><a href="#äºŒ-è®¾è®¡è°ƒç ”" class="headerlink" title="äºŒ è®¾è®¡è°ƒç ”"></a>äºŒ è®¾è®¡è°ƒç ”</h3><h4 id="0-åŸºç¡€æ–¹å‘"><a href="#0-åŸºç¡€æ–¹å‘" class="headerlink" title="0 åŸºç¡€æ–¹å‘"></a>0 åŸºç¡€æ–¹å‘</h4><h5 id="1-åº•å±‚è¿è¡Œå¹³å°çš„é€‰æ‹©"><a href="#1-åº•å±‚è¿è¡Œå¹³å°çš„é€‰æ‹©" class="headerlink" title="1. åº•å±‚è¿è¡Œå¹³å°çš„é€‰æ‹©"></a>1. åº•å±‚è¿è¡Œå¹³å°çš„é€‰æ‹©</h5><p>ä¸ç®¡æ˜¯flinkè¿˜æ˜¯sparkï¼Œéƒ½åªæ˜¯è®¡ç®—æ¡†æ¶ï¼Œéœ€è¦çœŸæ­£çš„è¿è¡Œå¹³å°ä½œä¸ºæ”¯æŒï¼Œä¸»æµçš„æœ‰yarnã€kubernetesã€standaloneç­‰</p><ol><li>localæ¨¡å¼åŸºæœ¬åªé€‚ç”¨äºæµ‹è¯•ï¼Œè¿™é‡Œä¸ä½œè€ƒè™‘   </li><li>å…¶ä¸­standaloneå³ç‹¬ç«‹é›†ç¾¤æ¨¡å¼å»ºè®¾ç»´æŠ¤æˆæœ¬é«˜ï¼Œä¸”é‡å¤å»ºè®¾æ˜“é€ æˆèµ„æºæµªè´¹ï¼ˆå¦‚flinkä¸€å¥—ã€sparkä¸€å¥—ï¼‰ã€‚<br>ä¸è¿‡standaloneå¾€å¾€å¯ä»¥å®ç°æ›´å¤šçš„ç‰¹æ€§ï¼Œå¦‚sparkçš„spark.master.rest.enabledé…ç½®é¡¹å°±åªæ”¯æŒstandaloneæ¨¡å¼ï¼Œ<br>è€Œä¸”å¤§éƒ¨åˆ†æ—¶å€™å¼€å‘è€…åªä¼šç”¨å…¶ä¸­ä¸€ä¸ªå¹³å°ï¼Œå¹¶ä¸å­˜åœ¨é‡å¤å»ºè®¾çš„æƒ…å†µã€‚<br>è¿™é‡Œå‡ºäºå¼€å‘æˆæœ¬è€ƒè™‘ï¼Œå…ˆä¸ä½œå®ç°ï¼Œåç»­è€ƒè™‘æ”¯æŒã€‚</li><li>å„ä¸ªè®¡ç®—æ¡†æ¶åŸºæœ¬éƒ½å‡ºäº†å¯¹k8sçš„æ”¯æŒï¼Œä½†æ–‡æ¡£æ¥çœ‹è¿˜å¹¶ä¸æˆç†Ÿï¼Œå®é™…ç”Ÿäº§ç¯å¢ƒä½¿ç”¨è¿˜è¾ƒå°‘ï¼Œå…ˆè§‚æœ›ï¼Œåç»­è€ƒè™‘æ”¯æŒã€‚</li><li>Mesosæˆ‘ä¸ç†Ÿ<br>æ ¹æ®æ’é™¤æ³•ï¼Œå°±åªå‰©ä¸‹yarnä½œä¸ºåº•å±‚è®¡ç®—æ¡†æ¶äº†ã€‚<br>ä¼˜ç‚¹æ˜¯æˆç†Ÿã€ç¨³å®šï¼Œç»è¿‡å¤§è§„æ¨¡æ£€éªŒï¼ŒåŸºæœ¬ç”Ÿäº§ç¯å¢ƒéƒ½æ˜¯ç”¨yarnï¼Œè€Œä¸”ä¸åŒçš„è®¡ç®—æ¡†æ¶éƒ½å¯ä»¥å…±ç”¨ä¸€å¥—yarnè®¡ç®—å¹³å°ã€‚</li></ol><h5 id="2-æäº¤éƒ¨ç½²æ–¹å¼çš„é€‰æ‹©"><a href="#2-æäº¤éƒ¨ç½²æ–¹å¼çš„é€‰æ‹©" class="headerlink" title="2. æäº¤éƒ¨ç½²æ–¹å¼çš„é€‰æ‹©"></a>2. æäº¤éƒ¨ç½²æ–¹å¼çš„é€‰æ‹©</h5><ol><li>åœ¨ç¡®å®šåº•å±‚è¿è¡Œå¹³å°ä½¿ç”¨yarnä¹‹åï¼Œæäº¤éƒ¨ç½²æ–¹å¼ä¸»è¦å°±å‰©ä¸‹clusterã€clientä¸¤ç§äº†ï¼ˆæ­¤å¤„ä½¿ç”¨sparkçš„è¯´æ³•ï¼‰<br>ä¸¤è€…çš„åŒºåˆ«ä¸»è¦åœ¨äºå¯åŠ¨ç¨‹åºçš„è§£æè¿è¡Œåœ¨å®¢æˆ·ç«¯è¿˜æ˜¯åœ¨é›†ç¾¤ä¸Šè¿›è¡Œã€‚<br>ä½œä¸ºå¹³å°å‹å·¥å…·ï¼Œè‡ªç„¶æ˜¯é€‰æ‹©clusterï¼Œå‡å°å®¢æˆ·ç«¯å‹åŠ›ã€‚clientæ›´é€‚åˆä¸ªäººè°ƒè¯•ç”¨ï¼Œå¯ä»¥ç›´æ¥çœ‹åˆ°è¾“å‡ºã€‚</li><li>å¯¹åº”flinkçš„è¯´æ³•å³ä¸º per-jobæ–¹å¼ï¼ˆå®¢æˆ·ç«¯ï¼‰å’Œapplicationæ–¹å¼ï¼ˆé›†ç¾¤ï¼‰ï¼Œå³ä½¿ç”¨applicationæ–¹å¼ã€‚<br>å¦å¤–éœ€æ³¨æ„ï¼Œapplicationæ–¹å¼å¾—åœ¨flinké«˜ç‰ˆæœ¬ï¼ˆ1.11+ï¼‰æ‰æœ‰ã€‚</li><li>å¦å¤–ï¼Œflinkè¿˜æœ‰ä¸ªsessionæ¨¡å¼ï¼Œç®€å•ç†è§£ä¸ºä¸Šé¢çš„æ˜¯ä¸€ä»»åŠ¡ä¸€é›†ç¾¤ï¼Œè¿™ä¸ªæ˜¯å¤šä»»åŠ¡ä¸€é›†ç¾¤ï¼Œé€‚åˆè½»é‡çº§ä½¿ç”¨ï¼Œè‡ªå¸¦webç«¯jaråŒ…æäº¤ï¼Œæ–¹ä¾¿å¿«æ·ã€‚<br>ä½†ä¸å»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œå¾ˆå®¹æ˜“ä¸€ä¸ªä»»åŠ¡å´©å°±å¯¼è‡´é›†ç¾¤å´©æºƒã€‚</li></ol><h5 id="3-sqlä»»åŠ¡çš„å®ç°"><a href="#3-sqlä»»åŠ¡çš„å®ç°" class="headerlink" title="3. sqlä»»åŠ¡çš„å®ç°"></a>3. sqlä»»åŠ¡çš„å®ç°</h5><p>å°†sqlä¿å­˜ä¸ºæ–‡ä»¶ï¼Œä½¿ç”¨çº¦å®šå¥½çš„jarç¨‹åºè¿›è¡Œè§£æï¼Œå³å°†sqlä»»åŠ¡è½¬åŒ–ä¸ºjarä»»åŠ¡ã€‚å…¶ä»–ç±»å‹çš„ä»»åŠ¡åŒç†ã€‚</p><h4 id="1-flink"><a href="#1-flink" class="headerlink" title="1 flink"></a>1 flink</h4><p>flinkè®¡ç®—å¹³å°ç½‘ä¸Šæœ‰å¾ˆå¤šï¼Œå…¶ä¸­è´¨é‡æ¯”è¾ƒå¥½ä¸”æ›´æ–°æ—¶é—´æ¯”è¾ƒè¿‘çš„ä¸»è¦æœ‰ï¼šFlink-SQLæµè®¡ç®—å¹³å°ç®¡ç†ç³»ç»Ÿï¼ˆ <a href="https://github.com/zhp8341/flink-streaming-platform-web">https://github.com/zhp8341/flink-streaming-platform-web</a> ï¼‰<br>æœ¬äººæœ€å¼€å§‹å°±æ˜¯å—äº†è¿™ä¸ªç³»ç»Ÿå¯å‘ï¼Œæœ€åˆçš„ä»£ç å’Œæ€è·¯ä¹Ÿæœ‰éƒ¨åˆ†å‚è€ƒï¼Œæ¯”è¾ƒæ¨èã€‚<br>ä¼˜ç‚¹æ˜¯åŠŸèƒ½å®Œæ•´ï¼Œä¸”æ›´æ–°å¿«ã€‚ä¸è¿‡sqlæ–¹é¢å®šåˆ¶åŒ–ç¨‹åº¦æœ‰ç‚¹é«˜ï¼Œä¸å¤Ÿé€šç”¨ï¼Œå­˜åœ¨ä¸€å®šç¨‹åº¦çš„å…¥ä¾µï¼Œä¸”åŠŸèƒ½å¯¹äºæˆ‘æ¥è¯´æœ‰ç‚¹èŠ±å“¨ï¼Œæ”¯æŒflinkæœ¬åœ°æ¨¡å¼ã€yarn-peræ¨¡å¼ã€STANDALONEæ¨¡å¼ï¼Œæœ€æ–°çš„applicationæ¨¡å¼å€’æ²¡æœ‰ã€‚</p><h5 id="ä»£ç æäº¤oræ¥å£æäº¤orå‘½ä»¤è¡Œæäº¤ï¼Ÿ"><a href="#ä»£ç æäº¤oræ¥å£æäº¤orå‘½ä»¤è¡Œæäº¤ï¼Ÿ" class="headerlink" title="ä»£ç æäº¤oræ¥å£æäº¤orå‘½ä»¤è¡Œæäº¤ï¼Ÿ"></a>ä»£ç æäº¤oræ¥å£æäº¤orå‘½ä»¤è¡Œæäº¤ï¼Ÿ</h5><ol><li>ä»£ç æäº¤ï¼Ÿ<br>yarn-applicationæ–¹å¼å®˜æ–¹ä¸æ”¯æŒï¼Œç½‘ä¸Šæœ‰çš„ä¸€èˆ¬æ˜¯sessionæ¨¡å¼çš„ï¼Œè¿˜æœ‰ä¸€äº›è‡ªå·±çœ‹æºç æŒ–å‡ºæ¥æäº¤ä»£ç çš„ã€‚<br>è¿™é‡Œä¸æ¨èçš„å»æŒ–ä»£ç ï¼Œå®˜æ–¹æ²¡æœ‰æ”¾å‡ºæ¥çš„ä¸œè¥¿å¯èƒ½æ¢ä¸ªç‰ˆæœ¬å°±ä¸ä¸€æ ·äº†ï¼Œå¦‚éå¿…è¦ï¼Œè¿™ç§å¼€å‘æ€è·¯å¹¶ä¸å¯å–ã€‚</li><li>æ¥å£æäº¤ï¼Ÿ<br>flinkçš„webç•Œé¢ç¡®å®æœ‰jaråŒ…æäº¤åŠŸèƒ½ï¼Œä½†é¦–å…ˆè¦æŠŠflinkè·‘èµ·æ¥ï¼Œå³sessionæ¨¡å¼ï¼Œè¿™é‡Œä¸ä½¿ç”¨ã€‚</li><li>å‘½ä»¤è¡Œæäº¤<br>é»˜è®¤çš„æäº¤æ–¹æ³•ï¼Œä¸‡èƒ½çš„ã€‚</li></ol><h5 id="ç›‘æ§å®ç°ï¼Ÿ"><a href="#ç›‘æ§å®ç°ï¼Ÿ" class="headerlink" title="ç›‘æ§å®ç°ï¼Ÿ"></a>ç›‘æ§å®ç°ï¼Ÿ</h5><p>api+metrics</p><ul><li>apiè°ƒç”¨æµç¨‹ï¼š<ol><li>æäº¤yarnçš„æ—¶å€™æŒ‡å®štagï¼Œæ ¹æ®tagè¿›è¡Œæœç´¢ï¼Œè·å–ä»»åŠ¡çš„appIdï¼Œè¿›è¡Œä»»åŠ¡è¿½è¸ª</li><li>yarnå±‚æ ¹æ®appIdå’Œyarnçš„restæ¥å£è·Ÿè¸ªä»»åŠ¡åœ¨yarnä¸Šçš„çŠ¶æ€</li><li>flinkå±‚æ ¹æ®appIdå¯ä»¥ç»„æˆå‡ºflinkçš„webç›‘æ§é¡µé¢ï¼ŒåŒæ—¶flinkæä¾›äº†webç•Œé¢æ‰€éœ€çš„å„é¡¹æ•°æ®çš„restæ¥å£ï¼Œå¯ä»¥äºŒæ¬¡å¼€å‘</li></ol></li><li>metricsè·å–ï¼š<br>flink æ”¯æŒä¸»åŠ¨å°†æŒ‡æ ‡æ•°æ®æ¨é€åˆ° Prometheus çš„pushgatewayã€‚<h5 id="ä»»åŠ¡ç®¡ç†ï¼Ÿ"><a href="#ä»»åŠ¡ç®¡ç†ï¼Ÿ" class="headerlink" title="ä»»åŠ¡ç®¡ç†ï¼Ÿ"></a>ä»»åŠ¡ç®¡ç†ï¼Ÿ</h5>flinkä»»åŠ¡çš„åœæ­¢å¯ä»¥ç›´æ¥è°ƒç”¨å…¶restæ¥å£<br>savepointä¿¡æ¯ä¹Ÿå¯ä»¥æä¾›restæ¥å£è·å–ï¼Œsavepointçš„æ‰§è¡Œé€šè¿‡restæ‰§è¡Œå¥½åƒæœ‰é—®é¢˜ï¼Œè¿™é‡Œè¿˜æ˜¯å…ˆç”¨å‘½ä»¤è¡Œæ“ä½œ<h4 id="2-spark"><a href="#2-spark" class="headerlink" title="2 spark"></a>2 spark</h4>sparkä½œä¸ºä¸€ä¸ª<del>è¿‡æ—¶</del>æˆç†Ÿç¨³é‡çš„è®¡ç®—æ¡†æ¶ï¼Œè™½ç„¶ä¸æ”¯æŒæµæ‰¹ä¸€ä½“ï¼Œä½†æ˜¯ç›¸å…³çš„ç¬¬ä¸‰æ–¹æ¡†æ¶æ›´åŠ æˆç†Ÿã€‚<h5 id="ä»£ç æäº¤oræ¥å£æäº¤orå‘½ä»¤è¡Œæäº¤ï¼Ÿ-1"><a href="#ä»£ç æäº¤oræ¥å£æäº¤orå‘½ä»¤è¡Œæäº¤ï¼Ÿ-1" class="headerlink" title="ä»£ç æäº¤oræ¥å£æäº¤orå‘½ä»¤è¡Œæäº¤ï¼Ÿ"></a>ä»£ç æäº¤oræ¥å£æäº¤orå‘½ä»¤è¡Œæäº¤ï¼Ÿ</h5>æˆ‘ä»¬è¿˜æ˜¯å…ˆä»å®˜ç½‘çœ‹èµ·ã€‚å¤§ä½“æƒ…å†µå’Œflinkç±»ä¼¼ã€‚<br>æ²¡æœ‰å®˜æ–¹çš„ä»£ç æäº¤æ¥å£ï¼Œéƒ½æ˜¯å„è‡ªæŒ–æ˜å‡ºæ¥çš„ï¼Œè€Œä¸”å†™æ³•è¿˜éƒ½ä¸ä¸€æ ·ï¼Œè¿™é‡Œä¸æ¨èã€‚<br>æ¥å£æäº¤æœ‰ä¸ªspark.master.rest.enabledé…ç½®é¡¹ï¼Œä½†åªæ”¯æŒstandaloneæ¨¡å¼<br>æ‰€ä»¥è¿˜æ˜¯èµ°å‘½ä»¤è¡Œæäº¤<h5 id="ç›‘æ§å®ç°ï¼Ÿ-1"><a href="#ç›‘æ§å®ç°ï¼Ÿ-1" class="headerlink" title="ç›‘æ§å®ç°ï¼Ÿ"></a>ç›‘æ§å®ç°ï¼Ÿ</h5>api+metrics</li><li>apiè°ƒç”¨æµç¨‹ï¼š<br>ç±»ä¼¼flink</li><li>metricsè·å–ï¼š<br>sparkæœ€æ–°3.2.0ç‰ˆæœ¬æ”¯æŒæ˜¾ç¤ºPrometheusæ ¼å¼çš„æŒ‡æ ‡æ•°æ®ï¼Œä½†ä¸ä¼šä¸»åŠ¨æ¨é€<br>ä¸è¿‡ç¤¾åŒºæœ‰æ”¯æŒpushgatewayçš„æ’ä»¶ï¼š<a href="https://github.com/banzaicloud/spark-metrics">https://github.com/banzaicloud/spark-metrics</a><h5 id="ä»»åŠ¡ç®¡ç†ï¼Ÿ-1"><a href="#ä»»åŠ¡ç®¡ç†ï¼Ÿ-1" class="headerlink" title="ä»»åŠ¡ç®¡ç†ï¼Ÿ"></a>ä»»åŠ¡ç®¡ç†ï¼Ÿ</h5>ä¸»è¦å°±æ˜¯æƒ³æ‰¾ä¸ªsparkåŸç”Ÿçš„rest apiæ¥killå®ƒã€‚<br>ç½‘ä¸Šæœ‰ä¸€äº›sparkéšè—rest apiåˆé›†ä¹‹ç±»çš„ä¸œè¥¿ï¼Œæˆ‘æœ¬èº«æ˜¯ä¸æƒ³ç”¨çš„ï¼Œæ¯•ç«Ÿä½ éƒ½çŸ¥é“æ˜¯éšè—äº†ï¼Œè¯´æ˜å®˜æ–¹è¿˜ä¸æƒ³ç»™ä½ ç”¨ï¼Œä½ åˆä¸çŸ¥é“ä»€ä¹ˆæ—¶é—´å“ªä¸ªç‰ˆæœ¬å°±ä¼šå˜äº†<br>ä¸è¿‡æˆ‘ä¹Ÿå¾ˆå¥½å¥‡ä¸ºä»€ä¹ˆå®˜æ–¹ä¸æä¾›ï¼Œå¾ˆå¤šäººè·Ÿæˆ‘æœ‰åŒæ ·çš„æƒ³æ³•ï¼Œè¿˜è·‘å»é—®äº†ã€‚<a href="https://issues.apache.org/jira/browse/SPARK-12528">https://issues.apache.org/jira/browse/SPARK-12528</a><br>standaloneå·²ç»å¯ä»¥é€šè¿‡spark.master.rest.enabledæ¥ç”¨äº†ï¼Œä½†yarnè¿˜ä¸è¡Œã€‚è®¨è®ºçš„äººæœ‰æåˆ°å¯ä»¥ç”¨Livyæˆ–spark-jobserverã€‚</li></ul><ol><li>spark-jobserverçš„ç¤¾åŒºæ¯”è¾ƒæ´»è·ƒï¼Œæ›´æ–°æ¯”è¾ƒå¿«ï¼ŒåŠŸèƒ½ä¹Ÿå¾ˆå¼ºå¤§ï¼Œä½†æ˜¯éœ€è¦ç»§æ‰¿æŒ‡å®šç±»ï¼Œé€ æˆæå¼ºçš„å…¥ä¾µæ€§ï¼Œè¿™æ˜¯æ— æ³•å®¹å¿çš„ï¼Œè¿™é‡Œä¸åšè€ƒè™‘ã€‚<br>æŒ‰æˆ‘çš„ç†è§£ï¼Œä½ éƒ½èƒ½ç»§æ‰¿è‡ªå·±çš„ç±»äº†ï¼Œé‚£ä½ åšå‡ºä»€ä¹ˆå¢å¼ºçš„åŠŸèƒ½éƒ½ä¸ç¨€å¥‡ï¼Œå› ä¸ºä½ æœ¬è´¨ä¸Šå·²ç»ä¸æ˜¯å·¥å…·å‹äº§å“ï¼Œè€Œæ˜¯ä¸€ä¸ªåŸºäºsparkäºŒæ¬¡å¼€å‘çš„å¹³å°ï¼Œè¿˜ä¸æ”¯æŒsparkåŸç”ŸjaråŒ…ã€‚</li><li>Livyæ¯•ç«Ÿæ˜¯Apacheå­µåŒ–é¡¹ç›®ï¼Œè™½ç„¶è¿˜æ²¡æ¯•ä¸šï¼Œä½†ä½¿ç”¨è¿˜æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ã€‚<br>æ¥å£å¾ˆç®€å•ï¼Œä½¿ç”¨ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚ä¸»è¦å°±æ˜¯å¯ä»¥é€šè¿‡livyçš„restæ¥å£å®ç°ä»»åŠ¡çš„å‘å¸ƒã€åœæ­¢ã€çŠ¶æ€è·å–ã€æ—¥å¿—è·å–ã€‚<br>å…¶å®livyçš„å­˜åœ¨å·²ç»å’Œæœ¬é¡¹ç›®å¯¹sparkçš„æ”¯æŒé‡å¤äº†â€¦ä½†æ˜¯æœ¬ç€è½®å­è¦è‡ªå·±é€ çš„æ€æƒ³ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥<del>æŒ‘æŒ‘åˆº</del>ç ”ç©¶ä¸€ä¸‹livyçš„ä¼˜ç¼ºç‚¹<br>å—¯â€¦æ–‡æ¡£ä¸æ¸…æ™°ï¼šè™½ç„¶å‚æ•°éƒ½æ˜¯å¯¹å®˜æ–¹çš„å°è£…ï¼Œä½†æ˜¯ç¼ºå°‘å¿…è¦çš„æè¿°è¯´æ˜ï¼Œæ¯”æ–¹è¯´æ²¡æœ‰è¯´jaråŒ…çš„è·¯å¾„é»˜è®¤æ˜¯hdfsçš„ï¼ˆå½“ç„¶è¿™ä¸æ˜¯ä¸»è¦é—®é¢˜â€¦ï¼‰<br>å…¶å®æ²¡ä»€ä¹ˆå¤§é—®é¢˜ï¼Œè¿˜æ˜¯æ¨èä½¿ç”¨çš„ï¼Œä»»åŠ¡æäº¤æˆ‘ä»¬å·²ç»é€šè¿‡è„šæœ¬æ–¹å¼å®ç°äº†ï¼Œè¿™é‡Œå°±æ²¡å¿…è¦å†å¼•å…¥livyäº†ï¼Œæ¯•ç«Ÿæ˜¯ä¸ªå•ç‹¬çš„webæœåŠ¡å™¨ï¼Œä¹ŸæŒºé‡çš„ã€‚</li></ol><p>æ—¢ç„¶å¦‚æ­¤å°±è¿˜æ˜¯èµ°yarnçš„apiå»killå§ã€‚</p><h3 id="ä¸‰-è®¾è®¡æ€è·¯"><a href="#ä¸‰-è®¾è®¡æ€è·¯" class="headerlink" title="ä¸‰ è®¾è®¡æ€è·¯"></a>ä¸‰ è®¾è®¡æ€è·¯</h3><p>é¡¹ç›®ä»¥åˆ†ä¸ºä¸‰ä¸ªç±»å‹å·¥ç¨‹</p><ol><li>core ï¼šæ ¸å¿ƒå¤„ç†å·¥ç¨‹ã€‚å®ç°æ ¸å¿ƒé€»è¾‘ï¼Œå¯¹å¤–æä¾›ç»Ÿä¸€çš„è®¡ç®—ä»»åŠ¡ç®¡ç†æ¥å£ï¼Œä¸åŒè®¡ç®—å¹³å°ä»»åŠ¡ä¾èµ–ä¸åŒæ¨¡å—å·¥ç¨‹è¿›è¡Œå®ç°</li><li>module : è®¡ç®—å¹³å°å¤„ç†å·¥ç¨‹ã€‚å¯¹æ¥ä¸åŒçš„åº•å±‚è®¡ç®—å¹³å°ï¼Œå¦‚flinkå’Œspark</li><li>plugin : ç‹¬ç«‹æ’ä»¶å·¥ç¨‹ã€‚æœ¬è´¨ä¸ºè‡ªå®šä¹‰åŠŸèƒ½jaråŒ…ï¼Œå°è£…ç‰¹å®šä»»åŠ¡ï¼ŒæŒ‰çº¦å®šè¿›è¡Œè§£æå¤„ç†ã€‚å¦‚flink-sqlçš„jaråŒ…å°è£…ã€‚</li></ol><h4 id="coreå·¥ç¨‹"><a href="#coreå·¥ç¨‹" class="headerlink" title="coreå·¥ç¨‹"></a>coreå·¥ç¨‹</h4><p>coreæ˜¯è®¡ç®—å¹³å°çš„æ ¸å¿ƒã€‚å¯¹ä¸åŒç±»å‹çš„ä»»åŠ¡è¿›è¡Œå°è£…ï¼Œå¯¹å¤–æä¾›ç»Ÿä¸€çš„apiã€‚å¹¶åœ¨æ•°æ®åº“ä¸­è®°å½•ã€è·Ÿè¸ªä»»åŠ¡ä¿¡æ¯ã€‚<br>ä»åŠŸèƒ½è®¾è®¡æ¥çœ‹ä¸»è¦ç±»æœ‰ï¼š</p><ul><li>controllerï¼šå¯¹å¤–æ¥å£ç±»<br>å¯¹å¤–æä¾›startã€stopã€deleteã€getLogã€getStatusç­‰api<br>startéœ€ä¼ å…¥ä»»åŠ¡é…ç½®jsonï¼Œæ ¹æ®ä»»åŠ¡ç±»å‹çš„ä¸åŒäº¤ç”±ä¸åŒçš„moduleå·¥ç¨‹çš„JobServerå»è§£æå¤„ç†ã€‚<br>startã€stopã€delete ä¹Ÿéœ€è°ƒç”¨ä¸åŒçš„JobServerè¿›è¡Œå®ç°ã€‚<br>getLogã€getStatusæœ¬è´¨ä¸Šåªæ˜¯è¯»å–æ•°æ®åº“ï¼Œè€Œæ•°æ®åº“çš„ä¿¡æ¯ç»´æŠ¤å’ŒåŒæ­¥ä¹Ÿä¾èµ–å„ä¸ªmoduleå·¥ç¨‹ã€‚</li><li>jobInfo: ä»»åŠ¡ä¿¡æ¯ç±»<br>å¯¹ä¸åŒä»»åŠ¡çš„ç»Ÿä¸€å°è£…ï¼Œæ‹¥æœ‰ä»¥ä¸‹å±æ€§<br>deployMode ä»»åŠ¡ç±»å‹ï¼šFLINK_SQLã€FLINK_JARã€SPARK_SQLã€SPARK_JARç­‰<br>runConfig è¿è¡Œæ—¶é…ç½®ï¼Œjsonï¼Œä¸åŒç±»å‹ä»»åŠ¡ä¸åŒ<br>runInfo è¿è¡Œæ—¶ä¿¡æ¯ï¼Œjsonï¼Œä¸åŒç±»å‹ä»»åŠ¡ä¸åŒï¼Œå¦‚flinkä»»åŠ¡åŒ…å«yarnè¿è¡Œä¿¡æ¯å’Œflinkçš„jobIdã€savepointä¿¡æ¯ç­‰<br>runLog ä»»åŠ¡è¿è¡Œæ—¥å¿—,textï¼Œç”¨ä»¥è®°å½•ä»»åŠ¡çš„åŸºæœ¬æ“ä½œè®°å½•ä»¥åŠçŠ¶æ€æ›´æ”¹è®°å½•ç­‰ï¼ˆä¸åŒ…å«ä¸šåŠ¡æ—¥å¿—ï¼Œä¸å±äºç›‘æ§èŒƒå›´ï¼‰<br>status ä»»åŠ¡è¿è¡ŒçŠ¶æ€ï¼ŒåŸºäºyarnçš„job statusè¿›è¡ŒæŠ½è±¡ã€‚å„ä¸ªç±»å‹ä»»åŠ¡å¯ä»¥æœ‰è‡ªèº«çš„çŠ¶æ€æ ‡è¯†ï¼Œä½†å¿…é¡»å®ç°ç‰¹å®šæ¥å£ä»¥è½¬åŒ–ä¸ºé¡¶å±‚æ ‡å‡†statusã€‚</li><li>JobServer: ä»»åŠ¡å¤„ç†æ ¸å¿ƒæŠ½è±¡æ¥å£<br>å®šä¹‰äº† startã€stopã€deleteã€checkAllJobStatusã€checkJobStatus(String jobInfoId)ç­‰æ¥å£å¹¶ç”±å„ä¸ªæ¨¡å—è‡ªè¡Œå®ç°</li><li>SchedulerTaskï¼šå®šæ—¶ä»»åŠ¡ç±»<br>å®šæ—¶è°ƒç”¨å„ä¸ªæ¨¡å—çš„checkStatusæ¥å£ï¼Œç”¨ä»¥æ£€æµ‹ä»»åŠ¡çœŸå®è¿è¡ŒçŠ¶æ€ï¼Œç»´æŠ¤æ•°æ®åº“ä»»åŠ¡ä¿¡æ¯çœŸå®æ€§æœ‰æ•ˆæ€§ï¼Œé˜²æ­¢å·²åœä»»åŠ¡ä»åœ¨è¿è¡Œ</li></ul><p>å¦å¤–æˆ‘è¿˜æŠŠå‘½ä»¤è¡Œæ‰§è¡Œæ¨¡å—ã€yarnåŠŸèƒ½ç®¡ç†æ¨¡å—æ”¾åˆ°äº†è¿™é‡Œã€‚<br>å‘½ä»¤è¡Œæ‰§è¡Œè¦åŒ…å«æ—¥å¿—è®°å½•ã€å¼‚æ­¥å¤„ç†ã€å¼‚å¸¸å¤„ç†ã€å¤šå‘½ä»¤åŒä¼šè¯æ‰§è¡Œï¼Œè¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œè¸©äº†ä¸€äº›å‘ï¼Œä»¥åå†å¼€ä¸€ç¯‡åˆ†äº«ä¸€ä¸‹ã€‚<br>æœ¬æ¥çš„è®¾æƒ³å°±æ˜¯æŠŠyarnä½œä¸ºåŸºç¡€è¿è¡Œå¹³å°ï¼Œæ‰€ä»¥å¯¹yarnçš„æ“ä½œä¹Ÿç»Ÿä¸€åˆ°äº†è¿™é‡Œã€‚</p><h4 id="moduleå·¥ç¨‹"><a href="#moduleå·¥ç¨‹" class="headerlink" title="moduleå·¥ç¨‹"></a>moduleå·¥ç¨‹</h4><p>ä¸€ä¸ªdeployModeå¯¹åº”ä¸€ä¸ªJobServerå®ç°ç±»ï¼Œç›¸åŒç±»å‹çš„JobServerå¯å…±ç”¨ä¸€ä¸ªmoduleå·¥ç¨‹ï¼Œå¦‚FLINK_SQLå’ŒFLINK_JAR<br>å„ä¸ªmoduleå·¥ç¨‹ä»¥å…¶JobServerå®ç°ç±»ä¸ºæ ¸å¿ƒï¼Œæ‹¥æœ‰è‡ªå·±çš„runConfigã€runInfoã€statuså®ä½“ç±»<br>é™¤æ­¤ä¹‹å¤–ï¼Œæ ¹æ®éœ€æ±‚ï¼Œè¿˜å¯ä»¥æœ‰è‡ªèº«çš„å®šæ—¶ä»»åŠ¡ç±»ï¼Œå¦‚Flinkå¯å®šæ—¶æ‰§è¡Œsavepointæ“ä½œ</p><h4 id="pluginå·¥ç¨‹"><a href="#pluginå·¥ç¨‹" class="headerlink" title="pluginå·¥ç¨‹"></a>pluginå·¥ç¨‹</h4><p>pluginå·¥ç¨‹æœ¬è´¨ä¸Šä¸ºç‰¹æ®Šä»»åŠ¡ç±»å‹çš„æ”¯æŒå®ç°ã€‚<br>è¿™é‡Œä»¥FLINK_SQLå·¥ç¨‹ä¸ºä¾‹ã€‚</p><p>FlinkåŸç”Ÿçš„sqlåªæ”¯æŒshellæ‰§è¡Œï¼Œä¸”éœ€åœ¨sessionæ¨¡å¼ä¸­è¿è¡Œï¼Œ<br>ä½¿ç”¨ä¸Šä¹Ÿä¸ç®—ååˆ†æ–¹ä¾¿ï¼Œéœ€è¦å…ˆåœ¨é…ç½®æ–‡ä»¶ä¸­å†™å¥½å„ç§è¿æ¥é…ç½®ï¼Œä¸‹è½½å¥½å„ç§connectorçš„jaråŒ…ã€‚<br>ä½œä¸ºæµ‹è¯•ç”¨å€’è¿˜å¯ä»¥ï¼Œè¯­å¥å¯ä»¥ç›´æ¥ä¿®æ”¹ï¼Œä¸ç”¨é‡æ–°æ‰“åŒ…ï¼Œä½†æ€§èƒ½ã€å¯é æ€§éƒ½å­˜ç–‘ï¼Œæœ¬è´¨ä¸Šéš¾ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åº”ç”¨ã€‚<br>è€ŒJaråŒ…æ‰§è¡Œæ˜¯ç»å¯¹é€šç”¨çš„ï¼Œsqlçš„åŠŸèƒ½åŸºæœ¬éƒ½å¯ä»¥é€šè¿‡flinkçš„executeSqlæ¥æ‰§è¡Œï¼Œç†è®ºä¸Šå¯¹sqlè„šæœ¬è¿›è¡Œè§£æï¼Œä¸€å¥å¥è½¬æˆç”¨executeSqlæ¥è°ƒç”¨å³å¯ã€‚<br>ä¸è¿‡ä¹Ÿæœ‰ä¸€äº›å‘ï¼Œæ¯”åˆ†è¯´hive-catalogçš„ç›¸å…³é…ç½®ï¼Œæˆ‘è§‰å¾—flinkå…³äºhiveçš„è®¾è®¡æ˜¯æ¯”è¾ƒåˆ«æ‰­çš„ï¼Œhiveä¸€æ–¹é¢æ˜¯ä½œä¸ºå…ƒæ•°æ®ä»“åº“ä½¿ç”¨ï¼Œä¸€æ–¹é¢åˆå¯ä»¥ä½œä¸ºæ•°æ®æºè¿æ¥ï¼Œå¦å¤–flinkè¿˜æ”¯æŒhiveä½œä¸ºsqlæ–¹è¨€ä½¿ç”¨ã€‚<br>è€Œhiveçš„è¿æ¥ä¹Ÿç›¸å¯¹å¤æ‚ä¸€äº›ï¼Œéœ€è¦å…ˆå‡†å¤‡hive-confé…ç½®æ–‡ä»¶ï¼Œå…¶jaråŒ…çš„ä½ç½®ä¹Ÿåº”è¯¥æ˜¯æ”¾åˆ°flinkçš„classpathä¸‹ï¼Œè€Œä¸æ˜¯ç”¨æˆ·çš„fat-jarã€‚æ³¨æ„ï¼Œè¿™ä¸€ç‚¹å’Œconnectoræ˜¯ä¸ä¸€æ ·çš„ã€‚<br>å¯¹äºå…ƒæ•°æ®ä»“åº“catalogã€æ–¹è¨€dialectè¿™äº›ç‰¹æ®Šsqlè¯­å¥ï¼Œéƒ½éœ€è¦è¯†åˆ«å‡ºæ¥è°ƒç”¨ä¸“é—¨ä»£ç å®ç°ï¼Œè€Œä¸èƒ½ç›´æ¥ä½¿ç”¨executeSql</p><p>sqlè„šæœ¬åº”è¯¥é€šè¿‡æ–‡ä»¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™JaråŒ…è¿›è¡Œè¯»å–ï¼Œå…¶ä»–ç±»å‹çš„ä»»åŠ¡åŒç†ï¼Œæ— éæ˜¯æŠŠsqlè„šæœ¬æ¢æˆscalaè„šæœ¬ã€shellè„šæœ¬ä¹‹ç±»çš„<br>å…·ä½“åšæ³•æ˜¯å°†sqlå†™ä¸ºæœ¬åœ°ä¸´æ—¶æ–‡ä»¶ï¼Œé€šè¿‡flinkçš„yarn.ship-fileså‚æ•°åˆ†å‘åˆ°JaråŒ…è¿è¡Œå®¹å™¨é‡Œé¢ï¼Œsqlæ–‡ä»¶è·¯å¾„ä½œä¸ºJaråŒ…å¯åŠ¨å‚æ•°å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¤§æ•°æ® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flink </tag>
            
            <tag> spark </tag>
            
            <tag> storm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hiveä½¿ç”¨bulkLoadæ‰¹é‡å¯¼å…¥æ•°æ®åˆ°hbase</title>
      <link href="//hive_bulkLoad_hbase/"/>
      <url>//hive_bulkLoad_hbase/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦å‚è€ƒäº†hbaseå’Œhiveå®˜æ–¹æ–‡æ¡£çš„è¯´æ˜ï¼Œå¹¶ç»“åˆcdhå’Œhdpçš„ä¸€äº›æ•™ç¨‹ä»¥åŠä¸ªäººåœ¨ç”Ÿäº§ä¸­çš„å®è·µè¿›è¡Œè®°å½•ã€‚ä¸»è¦å†…å®¹æœ‰hbase bulkloadçš„åŸç†ä»¥åŠå¯¹åº”hiveçš„æ“ä½œæ­¥éª¤ï¼Œæœ€ååŸºäºcdhè¿›è¡Œå®Œæ•´å®éªŒæä¾›å‚è€ƒå®ä¾‹ã€‚<br>ä¸è¿‡æ•´ä¸ªæ“ä½œç¡®å®å¾ˆå¤æ‚ç¹çï¼Œä¸æ˜¯å¾ˆå»ºè®®ä½¿ç”¨ã€‚ç°åœ¨æœ‰æŒºå¤šä½¿ç”¨Spark Bulkloadï¼Œä¸‹æ¬¡æœ‰æœºä¼šå°è¯•ä¸€ä¸‹ã€‚<br>ä¹‹å‰æ˜¯é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œæºè¡¨åœ¨hbaseä¸Šï¼Œéœ€è¦é‡æ–°ç”Ÿæˆrowkeyå¹¶æå–éƒ¨åˆ†å­—æ®µå½¢æˆæ–°è¡¨ã€‚åŠŸèƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯è¡Œå¯¹è¡Œæ˜ å°„è¿‡å»ï¼Œä½†æ˜¯æ•ˆç‡å¤ªä½è€—æ—¶å¤ªé•¿ï¼Œç”¨bulkloadç¡®å®è§£å†³äº†å½“æ—¶çš„éº»çƒ¦ã€‚<br>å†™è¿™ç¯‡æ–‡ç« æ˜¯å¯¹è‡ªå·±æ“ä½œçš„å¤ç›˜ï¼ŒåŒæ—¶ä¹Ÿæ¢³ç†ä¸€ä¸‹çŸ¥è¯†ã€‚<br>å®éªŒç¯å¢ƒä¸ºï¼šCDH6.3.2ï¼Œå¯¹åº”çš„å„ä¸ªç»„ä»¶ç‰ˆæœ¬ä¸ºï¼šhadoop3.0.0ï¼Œhbase2.1.0ï¼Œhive2.1.1</p><span id="more"></span><h2 id="ä¸€-hbase-bulk-loadingæ‰¹é‡åŠ è½½-åŸç†"><a href="#ä¸€-hbase-bulk-loadingæ‰¹é‡åŠ è½½-åŸç†" class="headerlink" title="ä¸€ hbase bulk loadingæ‰¹é‡åŠ è½½ åŸç†"></a>ä¸€ hbase bulk loadingæ‰¹é‡åŠ è½½ åŸç†</h2><p>è¿™é‡Œæ¨èé˜…è¯»hbase æœ€æ–°å®˜æ–¹æ–‡æ¡£ï¼š<a href="http://hbase.apache.org/2.3/book.html#arch.bulk.load">http://hbase.apache.org/2.3/book.html#arch.bulk.load</a><br>æ³¨æ„å®˜æ–¹æ–‡æ¡£æä¾›äº†2.2ç‰ˆæœ¬å’Œ2.3ç‰ˆæœ¬ï¼Œè¿™é‡ŒåŸç†è®²è§£ä½¿ç”¨çš„æ˜¯æœ€æ–°çš„ï¼Œå…·ä½“æ“ä½œéœ€ç»“åˆæ ¹æ®å®é™…ä½¿ç”¨ç‰ˆæœ¬æ¥ï¼Œæœ‰ä¸€äº›ç»†èŠ‚å¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œä¾‹å¦‚2.2å’Œ2.3ç‰ˆæœ¬æœ€ç»ˆbulkloadä½¿ç”¨çš„jaråŒ…åç§°ä¸ä¸€æ ·ã€‚<br>è¿™é‡Œç®€å•åœ°æœºç¿»ä¸€ä¸‹ï¼š</p><h3 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1 æ¦‚è¿°"></a>1 æ¦‚è¿°</h3><p>HBaseåŒ…æ‹¬å‡ ç§å°†æ•°æ®åŠ è½½åˆ°è¡¨ä¸­çš„æ–¹æ³•ã€‚ æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯ä½¿ç”¨MapReduceä»»åŠ¡ä¸­çš„TableOutputFormatç±»ï¼Œæˆ–ä½¿ç”¨å¸¸è§„å®¢æˆ·ç«¯APIã€‚ ä½†æ˜¯ï¼Œè¿™äº›æ–¹æ³•å¹¶ä¸æ€»æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ã€‚<br>æ‰¹é‡åŠ è½½åŠŸèƒ½ä½¿ç”¨MapReduceä»»åŠ¡ä»¥HBaseçš„å†…éƒ¨æ•°æ®æ ¼å¼è¾“å‡ºè¡¨æ•°æ®ï¼Œç„¶åå°†ç”Ÿæˆçš„StoreFilesç›´æ¥åŠ è½½åˆ°æ­£åœ¨è¿è¡Œçš„é›†ç¾¤ä¸­ã€‚ ä¸é€šè¿‡HBase APIè¿›è¡ŒåŠ è½½ç›¸æ¯”ï¼Œä½¿ç”¨æ‰¹é‡åŠ è½½å°†å ç”¨æ›´å°‘çš„CPUå’Œç½‘ç»œèµ„æºã€‚</p><h3 id="2-æ‰¹é‡åŠ è½½æ¶æ„"><a href="#2-æ‰¹é‡åŠ è½½æ¶æ„" class="headerlink" title="2 æ‰¹é‡åŠ è½½æ¶æ„"></a>2 æ‰¹é‡åŠ è½½æ¶æ„</h3><p>HBaseæ‰¹é‡åŠ è½½è¿‡ç¨‹åŒ…æ‹¬ä¸¤ä¸ªä¸»è¦æ­¥éª¤ã€‚</p><h4 id="1-é€šè¿‡MapReduceä½œä¸šå‡†å¤‡æ•°æ®"><a href="#1-é€šè¿‡MapReduceä½œä¸šå‡†å¤‡æ•°æ®" class="headerlink" title="1. é€šè¿‡MapReduceä½œä¸šå‡†å¤‡æ•°æ®"></a>1. é€šè¿‡MapReduceä½œä¸šå‡†å¤‡æ•°æ®</h4><p>æ‰¹é‡åŠ è½½çš„ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨HFileOutputFormat2ä»MapReduceä»»åŠ¡ç”ŸæˆHBaseæ•°æ®æ–‡ä»¶(å­˜å‚¨æ–‡ä»¶)ã€‚è¿™ç§è¾“å‡ºæ ¼å¼ä»¥HBaseçš„å†…éƒ¨å­˜å‚¨æ ¼å¼å†™å‡ºæ•°æ®ï¼Œä»¥ä¾¿ç¨åå¯ä»¥æœ‰æ•ˆåœ°å°†å®ƒä»¬åŠ è½½åˆ°é›†ç¾¤ä¸­ã€‚<br>ä¸ºäº†æœ‰æ•ˆåœ°è¿è¡Œï¼Œå¿…é¡»é…ç½®HFileOutputFormat2ï¼Œä½¿æ¯ä¸ªè¾“å‡ºçš„HFileéƒ½é€‚ç”¨äºå•ä¸ªregionã€‚ä¸ºæ­¤ï¼Œé‚£äº› è¾“å‡ºç»“æœå°†è¢«æ‰¹é‡åŠ è½½åˆ°HBaseä¸­ çš„MapReduceä»»åŠ¡ï¼Œä½¿ç”¨ Hadoop çš„ TotalOrderPartitioner ç±»å°†mapè¾“å‡ºåˆ’åˆ†ä¸º key ç©ºé—´çš„ä¸ç›¸äº¤èŒƒå›´ï¼Œè¯¥èŒƒå›´ä¸è¡¨ä¸­ region çš„ key èŒƒå›´ç›¸å¯¹åº”ã€‚</p><p>HFileOutputFormat2åŒ…æ‹¬ä¸€ä¸ªä¾¿æ·å‡½æ•°configureIncrementalLoad()ï¼Œè¯¥å‡½æ•°æ ¹æ®è¡¨çš„å½“å‰åŒºåŸŸè¾¹ç•Œè‡ªåŠ¨è®¾ç½®TotalOrderPartitionerã€‚</p><h4 id="2-å®Œæˆæ•°æ®åŠ è½½"><a href="#2-å®Œæˆæ•°æ®åŠ è½½" class="headerlink" title="2. å®Œæˆæ•°æ®åŠ è½½"></a>2. å®Œæˆæ•°æ®åŠ è½½</h4><p>åœ¨å‡†å¤‡å¥½è¦å¯¼å…¥çš„æ•°æ®ä¹‹åï¼Œé€šè¿‡ä½¿ç”¨å…·æœ‰ â€œimporttsv.bulk.outputâ€ é€‰é¡¹çš„ importtsv å·¥å…·ï¼Œæˆ–é€šè¿‡ä½¿ç”¨ HFileOutputFormat çš„ MapReduce ä½œä¸šï¼Œå¯ä»¥ä½¿ç”¨ completebulkload å·¥å…·å°†æ•°æ®å¯¼å…¥åˆ°æ­£åœ¨è¿è¡Œçš„é›†ç¾¤ä¸­ã€‚ æ­¤å‘½ä»¤è¡Œå·¥å…·éå†å‡†å¤‡å¥½çš„æ•°æ®æ–‡ä»¶ï¼Œå¹¶ä¸ºæ¯ä¸ªæ–‡ä»¶ç¡®å®šæ–‡ä»¶æ‰€å±çš„regionã€‚ ç„¶åï¼Œå®ƒå°†è¿æ¥ä¸Š HFile å¯¹åº”çš„åˆé€‚çš„ RegionServer ï¼Œå°†å…¶ç§»å…¥å…¶å­˜å‚¨ç›®å½•å¹¶å°†æ•°æ®æä¾›ç»™å®¢æˆ·ç«¯ã€‚</p><p>å¦‚æœregionè¾¹ç•Œåœ¨æ‰¹é‡åŠ è½½å‡†å¤‡è¿‡ç¨‹ä¸­æˆ–åœ¨å‡†å¤‡å’Œå®Œæˆæ­¥éª¤ä¹‹é—´å‘ç”Ÿäº†æ›´æ”¹ï¼Œåˆ™completebulkloadç¨‹åºå°†è‡ªåŠ¨å°†æ•°æ®æ–‡ä»¶åˆ†å‰²ä¸ºä¸æ–°è¾¹ç•Œå¯¹åº”çš„éƒ¨åˆ†ã€‚è¿™ä¸ªè¿‡ç¨‹æ•ˆç‡ä¸é«˜ï¼Œæ‰€ä»¥ç”¨æˆ·åº”è¯¥å°½é‡å‡å°‘å‡†å¤‡æ‰¹é‡åŠ è½½å’Œå°†å…¶å¯¼å…¥é›†ç¾¤ä¹‹é—´çš„å»¶è¿Ÿï¼Œç‰¹åˆ«æ˜¯å½“å…¶ä»–å®¢æˆ·æœºé€šè¿‡å…¶ä»–æ–¹å¼åŒæ—¶åŠ è½½æ•°æ®æ—¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">hadoop jar hbase-mapreduce-VERSION.jar completebulkload [-c /path/to/hbase/config/hbase-site.xml] /user/todd/myoutput mytable</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚æœç±»è·¯å¾„ä¸­æ²¡æœ‰æä¾›ç›¸åº”çš„hbaseå‚æ•°ï¼Œé‚£ä¹ˆ-c config-fileé€‰é¡¹å¯ä»¥ç”¨æ¥æŒ‡å®šåŒ…å«ç›¸åº”hbaseå‚æ•°çš„æ–‡ä»¶(ä¾‹å¦‚hbase-site.xml)(å¦å¤–ï¼Œå¦‚æœzookeeperä¸æ˜¯ç”±hbaseç®¡ç†çš„ï¼Œé‚£ä¹ˆç±»è·¯å¾„å¿…é¡»åŒ…å«åŒ…å«zookeeperé…ç½®æ–‡ä»¶çš„ç›®å½•)ã€‚</p><h2 id="äºŒ-hive-æ“ä½œæ­¥éª¤"><a href="#äºŒ-hive-æ“ä½œæ­¥éª¤" class="headerlink" title="äºŒ hive æ“ä½œæ­¥éª¤"></a>äºŒ hive æ“ä½œæ­¥éª¤</h2><p>è¿™é‡Œä¸»è¦å‚è€ƒhiveçš„æ–‡æ¡£ï¼š<a href="https://cwiki.apache.org/confluence/display/Hive/HBaseBulkLoad">https://cwiki.apache.org/confluence/display/Hive/HBaseBulkLoad</a></p><h3 id="1-ç¡®å®šç›®æ ‡hbaseè¡¨çš„ç»“æ„"><a href="#1-ç¡®å®šç›®æ ‡hbaseè¡¨çš„ç»“æ„" class="headerlink" title="1. ç¡®å®šç›®æ ‡hbaseè¡¨çš„ç»“æ„"></a>1. ç¡®å®šç›®æ ‡hbaseè¡¨çš„ç»“æ„</h3><p>è¿™é‡Œéœ€è¦æ˜ç¡®æœ€ç»ˆå¯¼å…¥çš„hbaseè¡¨çš„å‡ ä¸ªé™åˆ¶æ¡ä»¶ï¼š</p><ol><li>ç›®æ ‡è¡¨å¿…é¡»æ˜¯æ–°å»ºçš„ï¼ˆå³ä¸èƒ½å¯¼å…¥åˆ°å·²ç»å­˜åœ¨çš„è¡¨ï¼‰</li><li>ç›®æ ‡è¡¨åªèƒ½æœ‰ä¸€ä¸ªåˆ—æ—</li><li>ç›®æ ‡è¡¨ä¸èƒ½æ˜¯ç¨€ç–çš„ï¼ˆå³æ¯ä¸€è¡Œæ•°æ®çš„ç»“æ„å¿…é¡»ä¸€è‡´ï¼‰</li></ol><h3 id="2-æ·»åŠ å¿…è¦çš„jaråŒ…"><a href="#2-æ·»åŠ å¿…è¦çš„jaråŒ…" class="headerlink" title="2. æ·»åŠ å¿…è¦çš„jaråŒ…"></a>2. æ·»åŠ å¿…è¦çš„jaråŒ…</h3><blockquote><p>å®æµ‹è¿™ä¸€æ­¥å¯è·³è¿‡ï¼Œä¸å¦‚è‡ªå·±åœ¨hive shellä¸Š add jar ã€‚ä¸ªäººæ„Ÿè§‰hive.aux.jars.path è¿™ä¸ªé…ç½®æ¯”è¾ƒé¸¡è‚‹ã€‚åˆä¸æ”¯æŒç›´æ¥æŒ‡å®šæ–‡ä»¶å¤¹ï¼Œå‘ç°å°‘äº†jaråŒ…åè¿˜å¾—å†å»ç¼–è¾‘æ–‡ä»¶ï¼Œéœ€è¦çš„jaråŒ…ä¸€å¤šxmlçœ‹èµ·æ¥å°±å¾ˆæ¶å¿ƒã€‚</p></blockquote><ol><li>å°†hiveæ“ä½œæ‰€éœ€çš„jaråŒ…ä¸Šä¼ åˆ°hdfs<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hadoop dfs -put /usr/lib/hive/lib/hbase-VERSION.jar /user/hive/hbase-VERSION.jar</span><br><span class="line">hadoop dfs -put /usr/lib/hive/lib/hive-hbase-handler-VERSION.jar /user/hive/hive-hbase-handler-VERSION.jar</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>å°†å…¶è·¯å¾„æ·»åŠ è¿› hive-site.xml<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;hive.aux.jars.path&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;/user/hive/hbase-VERSION.jar,/user/hive/hive-hbase-handler-VERSION.jar&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h3 id="3-ç¡®å®šåˆ†åŒºèŒƒå›´"><a href="#3-ç¡®å®šåˆ†åŒºèŒƒå›´" class="headerlink" title="3. ç¡®å®šåˆ†åŒºèŒƒå›´"></a>3. ç¡®å®šåˆ†åŒºèŒƒå›´</h3><p>ä¸ºäº†æœ€åbulk loadçš„æ—¶å€™å¯ä»¥ä½¿ç”¨å¤šä¸ªreduceråŠ è½½åˆ°å¤šä¸ªregionï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®rowkeyé¢„å…ˆåˆ’åˆ†å¥½æ•°æ®çš„åˆ†åŒºèŒƒå›´ã€‚è¿™ä¸ªèŒƒå›´å°†ä»¥æ–‡ä»¶çš„å½¢å¼æä¾›ç»™ä¸‹ä¸€æ­¥çš„ä¸­é—´hiveè¡¨ã€‚è¿™ä¸€æ­¥çš„ç›®çš„å°±æ˜¯è¦å¾—åˆ°è¿™ä¸ªåˆ†åŒºæ–‡ä»¶ã€‚</p><h4 id="1-åˆ›å»ºåˆ†åŒºä¿¡æ¯è¡¨"><a href="#1-åˆ›å»ºåˆ†åŒºä¿¡æ¯è¡¨" class="headerlink" title="1. åˆ›å»ºåˆ†åŒºä¿¡æ¯è¡¨"></a>1. åˆ›å»ºåˆ†åŒºä¿¡æ¯è¡¨</h4><p>åˆ†åŒºæ–‡ä»¶ä»¥ org.apache.hadoop.hive.ql.io.HiveNullValueSequenceFileOutputFormat outputformatæ ¼å¼å­˜åœ¨äºhdfsä¸Šã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåˆ†åŒºä¿¡æ¯è¡¨ï¼ŒæŒ‡å®šå¥½è¯¥è¡¨çš„å­˜å‚¨ä½ç½®ï¼Œè¿™æ ·è¯¥ä½ç½®ä¸Šçš„æ–‡ä»¶å³ä¸ºæˆ‘ä»¬è¦çš„åˆ†åŒºä¿¡æ¯æ–‡ä»¶ã€‚<br>åˆ†åŒºä¿¡æ¯è¡¨çš„åˆ›å»ºå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create external table hb_range_keys(transaction_id_range_start string)</span><br><span class="line">row format serde</span><br><span class="line">&#x27;org.apache.hadoop.hive.serde2.binarysortable.BinarySortableSerDe&#x27;</span><br><span class="line">stored as</span><br><span class="line">inputformat</span><br><span class="line">&#x27;org.apache.hadoop.mapred.TextInputFormat&#x27;</span><br><span class="line">outputformat</span><br><span class="line">&#x27;org.apache.hadoop.hive.ql.io.HiveNullValueSequenceFileOutputFormat&#x27;</span><br><span class="line">location &#x27;/tmp/hb_range_keys&#x27;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-æ’å…¥åˆ†åŒºè¾¹ç•Œ"><a href="#2-æ’å…¥åˆ†åŒºè¾¹ç•Œ" class="headerlink" title="2. æ’å…¥åˆ†åŒºè¾¹ç•Œ"></a>2. æ’å…¥åˆ†åŒºè¾¹ç•Œ</h4><p>è¿™ä¸€æ­¥éœ€è¦æ’å…¥rowkeyçš„è¾¹ç•Œã€‚ä¾‹å¦‚ï¼Œæ’å…¥æ•°æ®ä¸º 005ï¼Œåˆ™æœ€ç»ˆç”Ÿæˆçš„hbaseçš„regionæœ‰ä¸¤ä¸ªï¼šä¸‹è¾¹ç•Œ<del>005ã€005</del>ä¸Šè¾¹ç•Œã€‚<br>è¾¹ç•Œçš„é€‰æ‹©å¾ˆé‡è¦ï¼Œè‰¯å¥½çš„é¢„åˆ†åŒºè®¾è®¡å¯ä»¥å‡å°‘hbaseå†å¹³è¡¡çš„å‹åŠ›ï¼Œåœ¨å¤§æ•°æ®é‡ä¸‹å¾ˆæœ‰ç”¨ã€‚<br>å› ä¸ºæˆ‘ä»¬çš„æºè¡¨å·²ç»å­˜åœ¨äºhiveä¸­äº†ï¼Œè€Œç›®æ ‡hbaseè¡¨çš„rowkeyåˆæ˜¯ç¬¦åˆå­—å…¸æ’åºçš„ã€‚æ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨hiveçš„æŠ½æ ·åŠŸèƒ½å…ˆç”Ÿæˆhbaseçš„rowkeyåºåˆ—å¹¶æ’å¥½åºï¼Œå†ä»¥ä¸€å®šçš„é—´éš”è¿›è¡Œå–æ ·ï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°åˆ†å¸ƒæ¯”è¾ƒåˆç†çš„è¾¹ç•Œå€¼äº†ã€‚<br>æŠ½æ ·çš„å®ç°å‚è€ƒå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-- æ·»åŠ å¿…è¦çš„ jar åŒ… </span><br><span class="line"></span><br><span class="line">add jar lib/hive-contrib-0.7.0.jar;</span><br><span class="line"></span><br><span class="line">--è®¾ç½®reduceä»»åŠ¡æ•°ä¸º1</span><br><span class="line"></span><br><span class="line">set mapred.reduce.tasks=1;</span><br><span class="line"></span><br><span class="line">--åˆ›å»ºä¸´æ—¶å‡½æ•° row_sequenceï¼Œç”¨äºè®©ç»“æœå¸¦ä¸Šæ’åºç¼–å·</span><br><span class="line"></span><br><span class="line">create temporary function row_sequence as</span><br><span class="line">&#x27;org.apache.hadoop.hive.contrib.udf.UDFRowSequence&#x27;;</span><br><span class="line"></span><br><span class="line">--æ’å…¥æŠ½æ ·ç»“æœåˆ° åˆ†åŒºä¿¡æ¯è¡¨</span><br><span class="line"></span><br><span class="line">insert overwrite table hb_range_keys -- æ­¥éª¤ï¼ˆ3ï¼‰</span><br><span class="line">    select transaction_id from   -- æ­¥éª¤ï¼ˆ2ï¼‰</span><br><span class="line">        (select transaction_id     -- æ­¥éª¤ï¼ˆ1ï¼‰</span><br><span class="line">            from transactions</span><br><span class="line">        tablesample(bucket 1 out of 10000 on transaction_id) s</span><br><span class="line">        order by transaction_id</span><br><span class="line">        limit 10000000</span><br><span class="line">        ) x</span><br><span class="line">    where (row_sequence() % 910000)=0</span><br><span class="line">    order by transaction_id</span><br><span class="line">    limit 11;</span><br><span class="line">    </span><br><span class="line">-- regionæ•°é‡=count(1)+1</span><br><span class="line"> </span><br><span class="line">select count(1) from hb_range_keys ;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œ transactions æ˜¯æºè¡¨ï¼Œtransaction_id æ˜¯å¯¼å…¥åˆ° hbase ä¸­çš„ rowkey ï¼ˆå®é™…ä½¿ç”¨å¯èƒ½éœ€è¦ç”Ÿæˆï¼Œè¿™é‡Œæš‚ç”¨ transaction_id å­—æ®µä»£æ›¿ï¼‰<br>æ­¥éª¤ï¼ˆ1ï¼‰ï¼šæ ¹æ®transaction_idå­—æ®µå°†æ•°æ®åˆ†åˆ° 1ä¸‡ ä¸ªæ¡¶é‡Œï¼Œå–é‡Œé¢çš„ç¬¬ä¸€ä¸ªæ¡¶ã€‚ç†è®ºä¸Šçº¦ç­‰äºæŒ‰ ä¸‡åˆ†ä¹‹ä¸€ è¿›è¡ŒæŠ½æ ·ï¼ŒæŠ½æ ·åçš„ç»“æœé™åˆ¶æœ€å¤šä¸º 1åƒä¸‡ æ¡ã€‚<br>æ­¥éª¤ï¼ˆ2ï¼‰ï¼šå¯¹æ­¥éª¤ï¼ˆ1ï¼‰çš„ç»“æœæŒ‰ç…§ rowkey æ’åºï¼Œæ¯ 91ä¸‡ æ¡ å– ä¸€æ¡ ä½œä¸ºæœ€ç»ˆç»“æœï¼Œæœ€å¤šæœ‰ 11 æ¡ï¼ˆ1000/91&lt;=11ï¼‰ã€‚<br>æ­¥éª¤ï¼ˆ3ï¼‰ï¼šå°†æ­¥éª¤ï¼ˆ2ï¼‰çš„ç»“æœæ’å…¥åˆ°åˆ†åŒºä¿¡æ¯è¡¨</p><p>ç»¼ä¸Šï¼Œå‡è®¾æºè¡¨çš„æ•°æ®é‡åœ¨1åƒäº¿ä»¥ä¸Šï¼Œç»è¿‡ä¸¤æ¬¡æŠ½æ ·åæœ€ç»ˆæœ€å¤šè¢«åˆ’åˆ†æˆäº†12ä¸ªregionã€‚</p><blockquote><p>æ³¨æ„ï¼šæ¡¶æŠ½æ ·å¾—åˆ°çš„æ•°é‡ä¸å¯é ï¼Œåœ¨æç«¯æƒ…å†µä¸‹æ­¥éª¤ï¼ˆ1ï¼‰æŠ½æ ·çš„ç»“æœå¯èƒ½è¾ƒå°‘ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±ç¡®å®šåˆ†åŒºä¿¡æ¯è¡¨çš„è®°å½•è¡Œæ•°ï¼Œåé¢ä¼šç”¨åˆ°ã€‚</p></blockquote><h4 id="3-å¾—åˆ°åˆ†åŒºæ–‡ä»¶"><a href="#3-å¾—åˆ°åˆ†åŒºæ–‡ä»¶" class="headerlink" title="3. å¾—åˆ°åˆ†åŒºæ–‡ä»¶"></a>3. å¾—åˆ°åˆ†åŒºæ–‡ä»¶</h4><p>åœ¨hive shellä¸‹æ‰§è¡Œæ”¹å‘½ä»¤ï¼Œå³å¯å¾—åˆ°åˆ†åŒºæ–‡ä»¶ /tmp/hb_range_key_list</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dfs -cp /tmp/hb_range_keys/* /tmp/hb_range_key_list;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-ç”Ÿæˆä¸­é—´hiveè¡¨"><a href="#4-ç”Ÿæˆä¸­é—´hiveè¡¨" class="headerlink" title="4. ç”Ÿæˆä¸­é—´hiveè¡¨"></a>4. ç”Ÿæˆä¸­é—´hiveè¡¨</h3><p>è¯¥è¡¨ç”¨äºç”Ÿæˆç¬¦åˆ bulk load æ ¼å¼è¦æ±‚çš„hfileæ–‡ä»¶ã€‚æœ€ç»ˆè¯¥è¡¨çš„æ•°æ®éƒ½å°†ç§»åŠ¨åˆ°hbaseä¸­ã€‚</p><h4 id="1-å‡†å¤‡ä¸­é—´è¡¨å­˜å‚¨ä½ç½®"><a href="#1-å‡†å¤‡ä¸­é—´è¡¨å­˜å‚¨ä½ç½®" class="headerlink" title="1. å‡†å¤‡ä¸­é—´è¡¨å­˜å‚¨ä½ç½®"></a>1. å‡†å¤‡ä¸­é—´è¡¨å­˜å‚¨ä½ç½®</h4><p>å› ä¸ºä¸­é—´è¡¨çš„å ç”¨çš„ç©ºé—´ä¸€èˆ¬è¦æ¯”hbaseçš„è¿˜å¤§ï¼ˆæ•°æ®æ˜¯ç›¸åŒçš„ï¼Œä½†hbaseä¸€èˆ¬ä¼šå‹ç¼©å¾—æ¯”è¾ƒå¥½ï¼‰<br>æ‰€ä»¥ä¸­é—´è¡¨çš„å­˜å‚¨ä½ç½®è¦ç‰¹åˆ«æ³¨æ„ã€‚<br>å¦‚æœå­˜å‚¨ä½ç½®ä¸å­˜åœ¨ï¼Œhiveä¼šè‡ªåŠ¨åˆ›å»ºã€‚å¦‚æœå­˜å‚¨ä½ç½®å·²å­˜åœ¨ï¼Œéœ€ç¡®ä¿å…¶å†…å®¹ä¸ºç©ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dfs -rmr /tmp/hbsort;</span><br><span class="line">dfs -mkdir /tmp/hbsort;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-åˆ›å»ºä¸­é—´è¡¨"><a href="#2-åˆ›å»ºä¸­é—´è¡¨" class="headerlink" title="2. åˆ›å»ºä¸­é—´è¡¨"></a>2. åˆ›å»ºä¸­é—´è¡¨</h4><p>mapred.reduce.tasks=regionæ•°é‡=åˆ†åŒºä¿¡æ¯è¡¨è®°å½•æ•°+1<br>total.order.partitioner.pathå³ä¸ºåˆ†åŒºæ–‡ä»¶è·¯å¾„<br>æ³¨æ„ï¼šhfile.family.path=ä¸­é—´è¡¨å­˜å‚¨è·¯å¾„/åˆ—æ—å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">set hive.execution.engine=mr;</span><br><span class="line">set mapred.reduce.tasks=12;</span><br><span class="line">set hive.mapred.partitioner=org.apache.hadoop.mapred.lib.TotalOrderPartitioner;</span><br><span class="line">set total.order.partitioner.path=/tmp/hb_range_key_list;</span><br><span class="line">set hfile.compression=gz;</span><br><span class="line"> </span><br><span class="line">create table hbsort(transaction_id string, user_name string, amount double, ...)</span><br><span class="line">stored as</span><br><span class="line">INPUTFORMAT &#x27;org.apache.hadoop.mapred.TextInputFormat&#x27;</span><br><span class="line">OUTPUTFORMAT &#x27;org.apache.hadoop.hive.hbase.HiveHFileOutputFormat&#x27;</span><br><span class="line">TBLPROPERTIES (&#x27;hfile.family.path&#x27; = &#x27;/tmp/hbsort/cf&#x27;);</span><br><span class="line"> </span><br></pre></td></tr></table></figure><h4 id="3-å¯¼å…¥æ•°æ®"><a href="#3-å¯¼å…¥æ•°æ®" class="headerlink" title="3. å¯¼å…¥æ•°æ®"></a>3. å¯¼å…¥æ•°æ®</h4><p>æ³¨æ„è¿™é‡Œä½¿ç”¨ cluster by ååŠ  æ’åºå­—æ®µï¼ˆrowkeyï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> hbsort</span><br><span class="line"><span class="keyword">select</span> transaction_id, user_name, amount, ...</span><br><span class="line"><span class="keyword">from</span> transactions</span><br><span class="line">cluster <span class="keyword">by</span> transaction_id;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-å®Œæˆbulk-load"><a href="#5-å®Œæˆbulk-load" class="headerlink" title="5. å®Œæˆbulk load"></a>5. å®Œæˆbulk load</h3><p>è¿™ä¸€æ­¥å·²ç»å’Œhiveæ²¡ä»€ä¹ˆå…³ç³»äº†ï¼Œä»¥ä¸Šé¢ bulk load ä¸ºå‡†ã€‚hiveçš„æ–‡æ¡£æœ‰äº›è¿‡æ—¶äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop jar hbase-VERSION.jar completebulkload [-c /path/to/hbase/config/hbase-site.xml] /tmp/hbsort transactions</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ä¸‰-å®éªŒ"><a href="#ä¸‰-å®éªŒ" class="headerlink" title="ä¸‰ å®éªŒ"></a>ä¸‰ å®éªŒ</h2><h3 id="0-æµ‹è¯•ç¯å¢ƒåŠæ•°æ®æºå‡†å¤‡"><a href="#0-æµ‹è¯•ç¯å¢ƒåŠæ•°æ®æºå‡†å¤‡" class="headerlink" title="0 æµ‹è¯•ç¯å¢ƒåŠæ•°æ®æºå‡†å¤‡"></a>0 æµ‹è¯•ç¯å¢ƒåŠæ•°æ®æºå‡†å¤‡</h3><h4 id="1-ç¯å¢ƒ"><a href="#1-ç¯å¢ƒ" class="headerlink" title="1. ç¯å¢ƒ"></a>1. ç¯å¢ƒ</h4><p>å®éªŒç¯å¢ƒä¸ºï¼šCDH6.3.2 parcelå®‰è£…ç‰ˆæœ¬ï¼Œå¯¹åº”çš„å„ä¸ªç»„ä»¶ç‰ˆæœ¬ä¸ºï¼šhadoop3.0.0ï¼Œhbase2.1.0ï¼Œhive2.1.1</p><p>æ³¨æ„ï¼Œä¸åŒæ–¹å¼å®‰è£…çš„ç»„ä»¶ä½ç½®ä¸åŒï¼ŒjaråŒ…ä½ç½®ä¹Ÿä¸ä¸€æ ·<br>parcels å®‰è£…çš„ é»˜è®¤åœ¨ /opt/cloudera/parcels/CDH/lib/ç»„ä»¶å<br>package å®‰è£…çš„ é»˜è®¤åœ¨ /usr/lib/ç»„ä»¶å<br>å¼€æºhadoopçš„å°±éšæ„äº†<br>ä¸‹é¢çš„ä»¥ parcels ä¸ºå‡†</p><h4 id="2-æƒé™ç›¸å…³"><a href="#2-æƒé™ç›¸å…³" class="headerlink" title="2. æƒé™ç›¸å…³"></a>2. æƒé™ç›¸å…³</h4><p>è¯·è‡ªè¡Œè§£å†³ã€‚<br>æˆ‘è¿™é‡Œç›´æ¥æŠŠdfsçš„æƒé™è®¤è¯ç»™å…³é—­äº†ã€‚ç”Ÿäº§ç¯å¢ƒæˆ‘ç”¨çš„æ˜¯kerberosï¼Œä¸»è¦éœ€è¦ç¡®ä¿ä½¿ç”¨çš„ç”¨æˆ·å¯¹hiveã€hbaseç›®å½•æœ‰ç›¸åº”çš„è¯»å†™æƒé™ã€‚</p><h4 id="3-å®éªŒç”¨ä¾‹"><a href="#3-å®éªŒç”¨ä¾‹" class="headerlink" title="3. å®éªŒç”¨ä¾‹"></a>3. å®éªŒç”¨ä¾‹</h4><p>å‚è€ƒ hdpçš„æ–‡æ¡£ï¼š <a href="https://docs.cloudera.com/HDPDocuments/HDP1/HDP-1.3.10/bk_user-guide/content/user-guide-hbase-import-1.html">https://docs.cloudera.com/HDPDocuments/HDP1/HDP-1.3.10/bk_user-guide/content/user-guide-hbase-import-1.html</a><br>æˆ‘ä¸‹è½½çš„æ•°æ®æ˜¯ï¼š<br><a href="https://dumps.wikimedia.org/other/pagecounts-raw/2008/2008-08/pagecounts-20080801-010000.gz">https://dumps.wikimedia.org/other/pagecounts-raw/2008/2008-08/pagecounts-20080801-010000.gz</a></p><h3 id="1-åˆ›å»ºæºè¡¨"><a href="#1-åˆ›å»ºæºè¡¨" class="headerlink" title="1 åˆ›å»ºæºè¡¨"></a>1 åˆ›å»ºæºè¡¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¸‹è½½æµ‹è¯•æ•°æ®</span></span><br><span class="line">wget https://dumps.wikimedia.org/other/pagecounts-raw/2008/2008-08/pagecounts-20080801-010000.gz</span><br><span class="line"><span class="meta">#</span><span class="bash"> è§£å‹</span></span><br><span class="line">gzip pagecounts-20080801-010000.gz -d </span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºæºè¡¨å­˜å‚¨è·¯å¾„</span></span><br><span class="line">hadoop fs -mkdir /tmp/wikistats</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸Šä¼ æµ‹è¯•æ•°æ®</span></span><br><span class="line">hadoop fs -put pagecounts-20080801-010000 /tmp/wikistats/</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿›å…¥ hive shell åˆ›å»ºè¡¨<br>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº† pagecounts è¡¨ä½œä¸ºæºè¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> pagecounts (projectcode STRING, pagename STRING, pageviews STRING, bytes STRING)</span><br><span class="line"><span class="type">ROW</span> FORMAT</span><br><span class="line">  DELIMITED FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27; &#x27;</span></span><br><span class="line">  LINES TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">STORED <span class="keyword">AS</span> TEXTFILE</span><br><span class="line">LOCATION <span class="string">&#x27;/tmp/wikistats&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥selectä¸€ä¸‹çœ‹ä¸€ä¸‹æ•°æ®çš„æ ·å­<br><img src="https://img-blog.csdnimg.cn/20201120005936525.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æœ€å¥½å†countä¸€ä¸‹çœ‹ä¸€ä¸‹æ•°æ®é‡å¤§å°ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯ 3039029<br><img src="https://img-blog.csdnimg.cn/20201120010036509.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="2-åˆ›å»ºrowkeyè§†å›¾"><a href="#2-åˆ›å»ºrowkeyè§†å›¾" class="headerlink" title="2 åˆ›å»ºrowkeyè§†å›¾"></a>2 åˆ›å»ºrowkeyè§†å›¾</h3><p>åˆ›å»ºè§†å›¾ï¼Œç”¨äºè·å–è‡ªå®šä¹‰çš„rowkeyï¼Œä»¥åå¯¹æºè¡¨çš„æ“ä½œçš„è½¬ä¸ºå¯¹æ­¤è§†å›¾çš„æ“ä½œ<br>æ³¨æ„å¿…é¡»ä¿è¯ç”Ÿæˆrowkeyæ²¡æœ‰é‡å¤ï¼Œä¸ç„¶åœ¨æœ€åä¸€æ­¥å†™hfileçš„æ—¶å€™ä¼šæŠ¥é”™ï¼šAdded a key not lexically larger than previousã€‚hbaseçš„apiå†™rowkeyé‡å¤å€’æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œç›¸å½“äºè¦†ç›–ï¼Œä½†è¿™é‡Œæ˜¯ç›´æ¥å†™hfileï¼Œå¿…é¡»ä¿è¯rowkeyä¸é‡å¤ã€‚<br>å®æµ‹è¿™é‡Œç»™çš„rowkeyç”Ÿæˆæ–¹æ³•æ˜¯ä¼šå¯¼è‡´é‡å¤çš„ã€‚</p><p>hqlå¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> pgc (rowkey, pageviews, bytes) <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> concat_ws(<span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">         projectcode,</span><br><span class="line">         concat_ws(<span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">           pagename,</span><br><span class="line">           regexp_extract(INPUT__FILE__NAME, <span class="string">&#x27;pagecounts-(\\d&#123;8&#125;-\\d&#123;6&#125;)\\..*$&#x27;</span>, <span class="number">1</span>))),</span><br><span class="line">       pageviews, bytes</span><br><span class="line"><span class="keyword">FROM</span> pagecounts;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020112001012265.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ£€æµ‹é‡å¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> rowkey,<span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">from</span> pgc <span class="keyword">group</span> <span class="keyword">by</span> rowkey <span class="keyword">having</span> <span class="built_in">count</span>(<span class="number">1</span>)<span class="operator">&gt;</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201123011902531.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç›´æ¥åˆ›å»ºä¸€ä¸ªrowkeyè§†å›¾è¡¨å‡ºæ¥ï¼Œç„¶åæŠŠé‡å¤çš„å’Œæºè¡¨éƒ½åˆ æ‰å§ã€‚</p><blockquote><p>æ³¨æ„hiveçš„distinctæ˜¯æ— æ³•è¯†åˆ«å­—æ®µçº§çš„é‡å¤çš„ï¼Œè€Œgroup byä¹Ÿæ²¡åŠæ³•ç”¨åœ¨è¿™é‡Œï¼Œæ‰€ä»¥æˆ‘ç”¨çš„æ˜¯ not inã€‚</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»º pgctè¡¨ å–ä»£ æºè¡¨pagecountså’Œè§†å›¾pgc</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> pgct   </span><br><span class="line"><span class="type">ROW</span> FORMAT</span><br><span class="line">  DELIMITED FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27; &#x27;</span></span><br><span class="line">  LINES TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">STORED <span class="keyword">AS</span> TEXTFILE</span><br><span class="line">LOCATION <span class="string">&#x27;/tmp/wikistats_pgct&#x27;</span></span><br><span class="line"> <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> pgc <span class="keyword">where</span> rowkey <span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line">( <span class="keyword">select</span> rowkey <span class="keyword">from</span> pgc <span class="keyword">group</span> <span class="keyword">by</span> rowkey <span class="keyword">having</span> <span class="built_in">count</span>(<span class="number">1</span>)<span class="operator">&gt;</span><span class="number">1</span>)</span><br><span class="line">;</span><br><span class="line"><span class="comment">-- æŸ¥çœ‹å†…å®¹æ ¼å¼æ˜¯å¦æ­£ç¡®</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> pgct limit <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- å†æ¬¡ç¡®è®¤æ˜¯å¦æœ‰é‡å¤çš„rowkey</span></span><br><span class="line"><span class="keyword">select</span> rowkey,<span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">from</span> pgct <span class="keyword">group</span> <span class="keyword">by</span> rowkey <span class="keyword">having</span> <span class="built_in">count</span>(<span class="number">1</span>)<span class="operator">&gt;</span><span class="number">1</span>;</span><br><span class="line"><span class="comment">-- åˆ é™¤æºè¡¨</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> pagecounts;</span><br><span class="line"><span class="comment">-- åˆ é™¤è§†å›¾</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> pgc;</span><br></pre></td></tr></table></figure><p>å¦‚æœè§†å›¾pgcæ²¡æœ‰é‡å¤çš„rowkeyå°±ä¸ç”¨é‚£ä¹ˆéº»çƒ¦å†ç”Ÿæˆpgctè¡¨äº†</p><h3 id="3-åˆ›å»ºåˆ†åŒºä¿¡æ¯è¡¨"><a href="#3-åˆ›å»ºåˆ†åŒºä¿¡æ¯è¡¨" class="headerlink" title="3 åˆ›å»ºåˆ†åŒºä¿¡æ¯è¡¨"></a>3 åˆ›å»ºåˆ†åŒºä¿¡æ¯è¡¨</h3><p>åˆ›å»ºçš„åˆ†åŒºä¿¡æ¯è¡¨åä¸ºï¼šhbase_splits</p><blockquote><p>åŸæ•™ç¨‹çš„åˆ—åä¸º partition ï¼Œä¼šå¯¼è‡´å¼‚å¸¸ï¼Œæˆ‘è¿™é‡Œæ”¹ä¸ºäº† keyã€‚å¼‚å¸¸ä¿¡æ¯ä¸ºï¼šFAILED: ParseException line 1:49 cannot recognize input near â€˜partitionâ€™ â€˜STRINGâ€™ â€˜)â€™ in column name or primary key or foreign key</p></blockquote><blockquote><p>hbase_splits_tmpçš„ä½œç”¨ï¼š<br>ç”¨äºè·å–åˆ†åŒºä¿¡æ¯çš„è¡Œæ•°<br>å…¶ä»–çš„æ•™ç¨‹éƒ½æ²¡æœ‰å†™åˆ°éœ€è¦countè·å–åˆ†åŒºä¿¡æ¯è¡¨çš„è¡Œæ•°ï¼Œä½†å¦‚æœæ²¡è·å–å°±æ²¡åŠæ³•æ­£ç¡®è®¾ç½®ä¸‹ä¸€æ­¥çš„mapred.reduce.tasksã€‚<br>hbase_splitsè¡¨ç”±äºå­˜å‚¨æ ¼å¼å’Œinputformatçš„å…³ç³»ï¼Œå­˜åœ¨ä¸€äº›bugï¼Œæ²¡åŠæ³•selectå‡ºå†…å®¹ï¼Œç”šè‡³è¿countéƒ½ä¸è¡Œã€‚æ‰€ä»¥æˆ‘è¿™é‡Œç”¨äº†hbase_splits_tmpè¿›è¡Œè®°å½•ï¼Œå†…å®¹å…ˆå†™åˆ°hbase_splits_tmpï¼Œcountå®Œå†æŠŠhbase_splits_tmpçš„å†…å®¹å†™åˆ°hbase_splitsä¸Šã€‚</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> hbase_splits(key STRING) </span><br><span class="line"><span class="type">ROW</span> FORMAT</span><br><span class="line">  SERDE <span class="string">&#x27;org.apache.hadoop.hive.serde2.binarysortable.BinarySortableSerDe&#x27;</span></span><br><span class="line">STORED <span class="keyword">AS</span></span><br><span class="line"> INPUTFORMAT <span class="string">&#x27;org.apache.hadoop.mapred.TextInputFormat&#x27;</span></span><br><span class="line"> OUTPUTFORMAT <span class="string">&#x27;org.apache.hadoop.hive.ql.io.HiveNullValueSequenceFileOutputFormat&#x27;</span></span><br><span class="line">LOCATION <span class="string">&#x27;/tmp/hbase_splits_out&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> hbase_splits_tmp(key STRING) </span><br><span class="line"><span class="type">ROW</span> FORMAT</span><br><span class="line">  DELIMITED FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27; &#x27;</span></span><br><span class="line">  LINES TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">STORED <span class="keyword">AS</span> TEXTFILE</span><br><span class="line">LOCATION <span class="string">&#x27;/tmp/hbase_splits_tmp&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-è·å–åˆ†åŒºä¿¡æ¯"><a href="#4-è·å–åˆ†åŒºä¿¡æ¯" class="headerlink" title="4 è·å–åˆ†åŒºä¿¡æ¯"></a>4 è·å–åˆ†åŒºä¿¡æ¯</h3><p>æˆ‘ä»¬æºè¡¨çš„æ•°æ®åœ¨300ä¸‡æ¡ä»¥ä¸Šï¼ˆæ•™ç¨‹é‡Œçš„æ•°æ®æ˜¯åœ¨400wæ¡å·¦å³ï¼Œè¿™é‡Œä¸ºäº†å·æ‡’ï¼Œå°±ä¸æ”¹äº†ï¼‰<br>è¿™é‡Œè®¾è®¡ä¸ºæ¯1wæ¡æŠ½å‡ºä¸€æ¡ï¼Œå¾—åˆ°400æ¡ä»¥å†…çš„ç»“æœï¼Œå†æ¯100æ¡å–1ï¼Œæœ€ç»ˆä¸è¶…è¿‡4æ¡rowkeyä½œä¸ºè¾¹ç•Œã€‚</p><p>è¿™é‡Œä¸ºäº†ä½¿ç”¨ row_seq éœ€è¦æ·»åŠ  hive-contrib åŒ…</p><p>è¿™é‡Œæ˜¯å¯¹è§†å›¾è¿›è¡Œæ“ä½œï¼Œè§†å›¾é‡Œå·²ç»è§„å®šäº†rowkeyçš„è®¾è®¡æ–¹æ³•äº†<br>æœ€åï¼Œè¦æ ¹æ®å­˜å‚¨ä½ç½®æŠŠæ–‡ä»¶cpæˆä¸€ä¸ªæ–‡ä»¶</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span> JAR <span class="operator">/</span>opt<span class="operator">/</span>cloudera<span class="operator">/</span>parcels<span class="operator">/</span>CDH<span class="operator">/</span>lib<span class="operator">/</span>hive<span class="operator">/</span>contrib<span class="operator">/</span>hive<span class="operator">-</span>contrib<span class="number">-2.1</span><span class="number">.1</span><span class="operator">-</span>cdh6<span class="number">.3</span><span class="number">.2</span>.jar;</span><br><span class="line"><span class="keyword">SET</span> mapred.reduce.tasks<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> TEMPORARY <span class="keyword">FUNCTION</span> row_seq <span class="keyword">AS</span> <span class="string">&#x27;org.apache.hadoop.hive.contrib.udf.UDFRowSequence&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è·å–åˆ†åŒºä¿¡æ¯</span></span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> hbase_splits_tmp</span><br><span class="line"><span class="keyword">SELECT</span> rowkey <span class="keyword">FROM</span></span><br><span class="line">  (<span class="keyword">SELECT</span> rowkey, row_seq() <span class="keyword">AS</span> seq <span class="keyword">FROM</span> pgct</span><br><span class="line">   <span class="keyword">TABLESAMPLE</span>(BUCKET <span class="number">1</span> <span class="keyword">OUT</span> <span class="keyword">OF</span> <span class="number">10000</span> <span class="keyword">ON</span> rowkey) s</span><br><span class="line">   <span class="keyword">ORDER</span> <span class="keyword">BY</span> rowkey</span><br><span class="line">   LIMIT <span class="number">400</span>) x</span><br><span class="line"><span class="keyword">WHERE</span> (seq <span class="operator">%</span> <span class="number">100</span>) <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> rowkey</span><br><span class="line">LIMIT <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹å†…å®¹ åŠ è·å–countæ•°</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> hbase_splits_tmp;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">from</span> hbase_splits_tmp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å†…å®¹å†™åˆ°hbase_splits_tmp</span></span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> hbase_splits_tmp</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> hbase_splits_tmp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ é™¤ä¸´æ—¶å·¥å…·è¡¨</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> hbase_splits_tmp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¾—åˆ°åˆ†åŒºä¿¡æ¯æ–‡ä»¶</span></span><br><span class="line">dfs <span class="operator">-</span>cp <span class="operator">/</span>tmp<span class="operator">/</span>hbase_splits_out<span class="comment">/* /tmp/hbase_splits;</span></span><br><span class="line"><span class="comment"></span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201123142921465.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="5-åˆ›å»ºhfileè¡¨å¹¶æ’å…¥æ•°æ®"><a href="#5-åˆ›å»ºhfileè¡¨å¹¶æ’å…¥æ•°æ®" class="headerlink" title="5 åˆ›å»ºhfileè¡¨å¹¶æ’å…¥æ•°æ®"></a>5 åˆ›å»ºhfileè¡¨å¹¶æ’å…¥æ•°æ®</h3><h4 id="1-åˆ›å»ºhfileè¡¨"><a href="#1-åˆ›å»ºhfileè¡¨" class="headerlink" title="1 åˆ›å»ºhfileè¡¨"></a>1 åˆ›å»ºhfileè¡¨</h4><p>è¿™ä¸ªè¡¨ç”¨æ¥ç”Ÿæˆhfileï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„åˆ—æ—ä¸º w</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE hbase_hfiles(rowkey STRING, pageviews STRING, bytes STRING)</span><br><span class="line">STORED AS</span><br><span class="line">  INPUTFORMAT &#x27;org.apache.hadoop.mapred.TextInputFormat&#x27;</span><br><span class="line">  OUTPUTFORMAT &#x27;org.apache.hadoop.hive.hbase.HiveHFileOutputFormat&#x27;</span><br><span class="line">TBLPROPERTIES(&#x27;hfile.family.path&#x27; = &#x27;/tmp/hbase_hfiles/w&#x27;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-æ’å…¥æ•°æ®"><a href="#2-æ’å…¥æ•°æ®" class="headerlink" title="2 æ’å…¥æ•°æ®"></a>2 æ’å…¥æ•°æ®</h4><p>total.order.partitioner.path ç”¨äºæŒ‡å®šä½¿ç”¨çš„åˆ†åŒºæ’åºæ–‡ä»¶çš„ä½ç½®ï¼Œå·²ç»è¿‡æ—¶ï¼Œä½¿ç”¨ mapreduce.totalorderpartitioner.path ä»£æ›¿ã€‚<br>æ³¨æ„ï¼Œæˆ‘è¿™é‡ŒæŠŠhive çš„libä¸‹æ‰€æœ‰å¸¦æœ‰hbaseçš„åŒ…éƒ½æ·»åŠ è¿›å»äº†ã€‚ç†è®ºä¸Šåº”è¯¥æ˜¯å®Œæ•´çš„äº†ï¼Œä¸è¿‡å®æµ‹è¿˜æ˜¯ä¼šæç¤ºç¼ºå°‘ç±»ï¼š.ClassNotFoundException: org.apache.hadoop.hbase.shaded.protobuf.generated.HFileProtos$FileInfoProtoã€‚<br>è¿™ä¸ªç±»æ˜¯åœ¨hbase-protocol-shaded.jaråŒ…é‡Œçš„ï¼Œéœ€è¦åˆ°hbaseç›®å½•é‡Œæ‰èƒ½æ‰¾åˆ°ï¼Œä¹Ÿç»™æ·»åŠ è¿›å»ï¼Œå°±å¯ä»¥äº†ã€‚<br>mapred.reduce.tasksæ•°ç›®æ˜¯å‰æ–¹é¢„ä¼°çš„regionsæ•°ã€‚</p><p>æœ€åä¸€æ­¥selectå‡ºæ¥çš„æ•°æ®å¿…é¡»ä¿è¯æ— é‡å¤çš„rowkeyï¼Œå®æµ‹åŠ distinct ä¹Ÿæ²¡ç”¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hbase-client.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hbase-common.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hbase-hadoop2-compat.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hbase-hadoop-compat.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hbase-http.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hbase-mapreduce.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hbase-metrics-api.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hbase-metrics.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hbase-procedure.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hbase-protocol.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hbase-replication.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hbase-server.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hbase-shaded-miscellaneous.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hbase-shaded-netty.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hbase-shaded-protobuf.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hbase-zookeeper.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/tephra-hbase-compat-1.0-0.6.0.jar;</span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hive/lib/hive-hbase-handler.jar;</span><br><span class="line"></span><br><span class="line">ADD JAR /opt/cloudera/parcels/CDH/lib/hbase/hbase-protocol-shaded.jar;</span><br><span class="line"></span><br><span class="line">SET mapred.reduce.tasks=3;</span><br><span class="line">SET hive.mapred.partitioner=org.apache.hadoop.mapred.lib.TotalOrderPartitioner;</span><br><span class="line">SET mapreduce.totalorderpartitioner.path=/tmp/hbase_splits;</span><br><span class="line"></span><br><span class="line">-- generate hfiles using the splits ranges</span><br><span class="line">INSERT OVERWRITE TABLE hbase_hfiles</span><br><span class="line">SELECT distinct rowkey, pageviews, bytes FROM pgct</span><br><span class="line">CLUSTER BY rowkey;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="6-å®Œæˆbulk-load"><a href="#6-å®Œæˆbulk-load" class="headerlink" title="6 å®Œæˆbulk load"></a>6 å®Œæˆbulk load</h3><h4 id="1-åˆ›å»ºç›®æ ‡hbaseè¡¨"><a href="#1-åˆ›å»ºç›®æ ‡hbaseè¡¨" class="headerlink" title="1. åˆ›å»ºç›®æ ‡hbaseè¡¨"></a>1. åˆ›å»ºç›®æ ‡hbaseè¡¨</h4><p>åœ¨hbase shellä¸‹æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create &#x27;page_count&#x27;, &#123;  NAME =&gt;&#x27;w&#x27;,COMPRESSION =&gt; &#x27;SNAPPY&#x27; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201123142510273.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="2-bulkload"><a href="#2-bulkload" class="headerlink" title="2. bulkload"></a>2. bulkload</h4><p>bulkloadæœ‰ä¸¤ç§å†™æ³•ï¼Œè¿™é‡Œæ¨èä½¿ç”¨ä¸‹é¢çš„ç¬¬äºŒç§ï¼Œä¸éœ€è¦è®¾ç½®classpathï¼Œå¦‚æœæ˜¯ä½¿ç”¨ hadoop jaréœ€è¦å°† hbase classpath æ·»åŠ åˆ° hadoop classpath</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> hadoop jar hbase-mapreduce.jar completebulkload /tmp/hbase_hfiles page_count</span></span><br><span class="line">hbase org.apache.hadoop.hbase.mapreduce.LoadIncrementalHFiles /tmp/hbase_hfiles page_count</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20201123142428299.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7 æ€»ç»“"></a>7 æ€»ç»“</h3><p>ä¸åŒçš„ç‰ˆæœ¬ä¼šæœ‰ä¸åŒçš„é—®é¢˜ã€‚æˆ‘è‡ªå·±ä½¿ç”¨çš„å®˜æ–¹å¼€æºç‰ˆæœ¬çš„hiveè·å–åˆ†åŒºä¿¡æ¯çš„æ—¶å€™å¯ä»¥ç›´æ¥countï¼Œè¿™é‡Œç”¨çš„æ¯”è¾ƒè€ï¼Œä¼¼ä¹å°±æœ‰é—®é¢˜ã€‚<br>å¦å¤–éœ€è¦æ³¨æ„å¯èƒ½ä¼šå„ç§ç¼ºå°‘classï¼Œæ‰€ä»¥å»ºè®®ç›´æ¥addæ‰€æœ‰hbaseç›¸å…³çš„åŒ…ã€‚</p><h2 id="å››-å‚è€ƒæ–‡ç« "><a href="#å››-å‚è€ƒæ–‡ç« " class="headerlink" title="å›› å‚è€ƒæ–‡ç« "></a>å›› å‚è€ƒæ–‡ç« </h2><ul><li>hbaseå®˜æ–¹æ•™ç¨‹ï¼š<br><a href="http://hbase.apache.org/2.2/book.html#arch.bulk.load">http://hbase.apache.org/2.2/book.html#arch.bulk.load</a></li><li>hive å®˜æ–¹æ•™ç¨‹ï¼š<br><a href="https://cwiki.apache.org/confluence/display/Hive/HBaseBulkLoad">https://cwiki.apache.org/confluence/display/Hive/HBaseBulkLoad</a></li><li>hortonworksæ•™ç¨‹ï¼š<br><a href="https://docs.cloudera.com/HDPDocuments/HDP1/HDP-1.3.10/bk_user-guide/content/user-guide-hbase-import-1.html">https://docs.cloudera.com/HDPDocuments/HDP1/HDP-1.3.10/bk_user-guide/content/user-guide-hbase-import-1.html</a></li><li>æœ‰èµHBase Bulkload å®è·µæ¢è®¨ï¼š<a href="https://tech.youzan.com/hbase-bulkloadshi-practice/">https://tech.youzan.com/hbase-bulkloadshi-practice/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å¤§æ•°æ® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hbase </tag>
            
            <tag> hive </tag>
            
            <tag> bulkload </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hiveç¼–å†™udfå®è·µè®°å½•</title>
      <link href="//hive_udf/"/>
      <url>//hive_udf/</url>
      
        <content type="html"><![CDATA[<p>å®˜æ–¹æ•™ç¨‹ï¼š<a href="https://cwiki.apache.org/confluence/display/Hive/HivePlugins">https://cwiki.apache.org/confluence/display/Hive/HivePlugins</a><br>ç®€å•ä½¿ç”¨æŸ¥çœ‹ä¸Šé¢å®˜æ–¹çš„æ–‡æ¡£å³å¯ã€‚è¿™é‡Œè®°å½•ä¸€ä¸‹æˆ‘ä½¿ç”¨çš„å®è·µå’Œä¸€ç‚¹æ³¨æ„äº‹é¡¹ã€‚</p><span id="more"></span><h2 id="ä¸€-ç¼–å†™udf"><a href="#ä¸€-ç¼–å†™udf" class="headerlink" title="ä¸€ ç¼–å†™udf"></a>ä¸€ ç¼–å†™udf</h2><p>è¿™é‡Œçš„éœ€æ±‚æ˜¯å†™ä¸€ä¸ªudfï¼Œç”¨äºå°†ç»çº¬åº¦è½¬æ¢æˆgeohashã€‚å‚æ•°æœ‰ ç»çº¬åº¦å’Œgeohashçš„ç²¾åº¦ã€‚</p><h3 id="gradleé…ç½®"><a href="#gradleé…ç½®" class="headerlink" title="gradleé…ç½®"></a>gradleé…ç½®</h3><p>gradle éƒ¨åˆ†é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="keyword">compile</span> <span class="keyword">group</span>: <span class="string">&#x27;ch.hsr&#x27;</span>, name: <span class="string">&#x27;geohash&#x27;</span>, version: <span class="string">&#x27;1.3.0&#x27;</span></span><br><span class="line">    compileOnly <span class="keyword">group</span>: <span class="string">&#x27;org.apache.hive&#x27;</span>, name: <span class="string">&#x27;hive-exec&#x27;</span>, version: <span class="string">&#x27;2.3.6&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">task</span> fatJar(type: Jar) &#123;</span><br><span class="line">    <span class="comment">//baseName = project.name</span></span><br><span class="line">    baseName = <span class="string">&#x27;hiveFunction&#x27;</span></span><br><span class="line">    <span class="keyword">project</span>.<span class="keyword">fileTree</span>(<span class="string">&quot;$buildDir/fatjar/libs&quot;</span>).forEach &#123; jarFile -&gt;</span><br><span class="line">        <span class="keyword">from</span> zipTree(jarFile )</span><br><span class="line">    &#125;</span><br><span class="line">    with jar</span><br><span class="line">    <span class="keyword">destinationDir</span> = <span class="keyword">file</span>(<span class="string">&quot;$buildDir/fatjar&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">task</span> copyToLib(type: <span class="keyword">Copy</span>) &#123;</span><br><span class="line">    <span class="keyword">into</span> <span class="string">&quot;$buildDir/fatjar/libs&quot;</span></span><br><span class="line">    <span class="keyword">from</span> <span class="keyword">configurations</span>.<span class="keyword">runtime</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="UDFç±»"><a href="#UDFç±»" class="headerlink" title="UDFç±»"></a>UDFç±»</h3><p>GeoHashUDF.java ä»£ç å¦‚ä¸‹ï¼š<br>è¿™é‡Œéœ€è¦æ³¨æ„çš„å°±æ˜¯æ³¨é‡Šçš„å†™æ³•ï¼Œä»¥åŠå¼‚å¸¸çš„å¤„ç†ã€‚<br>å› ä¸ºåœ¨hiveæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœudfæŠ›ä¸€ä¸ªå¼‚å¸¸å‡ºæ¥ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªhive sqlæ‰§è¡Œçš„å¤±è´¥ã€‚æ‰€ä»¥ï¼Œå¯¹äºä¸šåŠ¡å¼‚å¸¸ï¼Œåº”è¯¥é¿å…å‘å¤–æŠ›å‡ºã€‚<br>ä»¥æœ¬geohashçš„udfä¸ºä¾‹ï¼Œå¦‚æœç»™å®šçš„ç»çº¬åº¦ä¸åˆæ³•ï¼Œåˆ™å¯è¿”å›ç”¨0å¡«å……çš„é»˜è®¤å­—ç¬¦ä¸²ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ch.hsr.geohash.GeoHash;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.ql.exec.Description;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.ql.exec.UDF;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Description(</span></span><br><span class="line"><span class="meta">        name = &quot;geohash&quot;,</span></span><br><span class="line"><span class="meta">        value = &quot;_FUNC_(double lat,double lon,int precison) - Returns geohash&quot;,</span></span><br><span class="line"><span class="meta">        extended = &quot;Example:\n  &gt; SELECT _FUNC_(\&#x27;20.1,111.2,6\&#x27;) FROM src LIMIT 1;\n  \&#x27;hello:Facebook\&#x27;&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeoHashUDF</span> <span class="keyword">extends</span> <span class="title">UDF</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Integer,String&gt; defaultValueMap = <span class="keyword">new</span> HashMap&lt;&gt; ();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++)&#123;</span><br><span class="line">            defaultValueMap.put(i,sb.toString());</span><br><span class="line">            sb.append(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">evaluate</span> <span class="params">(Double lat,Double lon,Integer precision)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> GeoHash.geoHashStringWithCharacterPrecision(lat, lon, precision);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> defaultValueMap.get(precision);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> GeoHashUDF().evaluate(<span class="number">20.1</span>,<span class="number">111.2</span>,<span class="number">6</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ‰“jaråŒ…"><a href="#æ‰“jaråŒ…" class="headerlink" title="æ‰“jaråŒ…"></a>æ‰“jaråŒ…</h3><p>å…ˆæ‰§è¡Œgradle copyToLibï¼Œå†æ‰§è¡Œ gradle  fatJar<br>å¾—åˆ° hiveFunction.jar</p><h2 id="äºŒ-åˆ›å»ºfunction"><a href="#äºŒ-åˆ›å»ºfunction" class="headerlink" title="äºŒ åˆ›å»ºfunction"></a>äºŒ åˆ›å»ºfunction</h2><h3 id="1-åˆ›å»ºä¸´æ—¶function"><a href="#1-åˆ›å»ºä¸´æ—¶function" class="headerlink" title="1 åˆ›å»ºä¸´æ—¶function"></a>1 åˆ›å»ºä¸´æ—¶function</h3><ol><li>å…ˆå°†ç”Ÿæˆçš„jaråŒ…æ·»åŠ åˆ°hiveçš„libç›®å½•ä¸‹<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\cp -f hiveFunction.jar $HIVE_HOME/lib/</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>å†åœ¨hive shellé‡Œé¢æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼Œæ³¨æ„è¦ä½¿ç”¨å…¨ç§°ç±»å<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create temporary function geohash as &#x27;GeoHashUDF&#x27;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>åˆ é™¤<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">drop temporary function if exists geohash;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-åˆ›å»ºæ°¸ä¹…function"><a href="#2-åˆ›å»ºæ°¸ä¹…function" class="headerlink" title="2 åˆ›å»ºæ°¸ä¹…function"></a>2 åˆ›å»ºæ°¸ä¹…function</h3></li><li>ä¸Šä¼ jaråŒ…åˆ°hdfsä¸Š<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -rm /my/hive/libs/hiveFunction.jar</span><br><span class="line">hadoop fs -put hiveFunction.jar /my/hive/libs/hiveFunction.jar</span><br></pre></td></tr></table></figure></li><li>åˆ›å»ºæ°¸ä¹…å‡½æ•°<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create function geohash as &#x27;com.yaoyun.anyonedev.hive.function.GeoHashUDF&#x27; using jar &#x27;hdfs:///my/hive/libs/hiveFunction.jar&#x27;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>åˆ é™¤<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">drop function if exists geohash;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> å¤§æ•°æ® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hive </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CDHå®¢æˆ·ç«¯ç¯å¢ƒæ­å»º</title>
      <link href="//cdh_client_env_deploy/"/>
      <url>//cdh_client_env_deploy/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼šè¦ä½¿ç”¨azkabanå¯¹æ¥å®¢æˆ·çš„CDHé›†ç¾¤ï¼ŒCDHç”¨çš„æ˜¯oozieï¼Œazkabanåªèƒ½éƒ¨ç½²åœ¨æˆ‘ä»¬å®¢æˆ·ç«¯çš„æœºå™¨ä¸Šï¼Œæ‰€ä»¥éœ€è¦åœ¨å®¢æˆ·æœºä¸Šæ‰‹åŠ¨æ­å»ºCDHçš„hadoopç¯å¢ƒã€‚æ“ä½œå¾ˆç®€å•ï¼Œè¿‡ç¨‹æ¯”è¾ƒéº»çƒ¦ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ã€‚</p><span id="more"></span><h2 id="ä¸€-è·å–æ‰€éœ€CDH-rpmåŒ…"><a href="#ä¸€-è·å–æ‰€éœ€CDH-rpmåŒ…" class="headerlink" title="ä¸€ è·å–æ‰€éœ€CDH rpmåŒ…"></a>ä¸€ è·å–æ‰€éœ€CDH rpmåŒ…</h2><h3 id="1-æ­å»ºæœ¬åœ°CDH-packageä»“åº“"><a href="#1-æ­å»ºæœ¬åœ°CDH-packageä»“åº“" class="headerlink" title="1. æ­å»ºæœ¬åœ°CDH packageä»“åº“"></a>1. æ­å»ºæœ¬åœ°CDH packageä»“åº“</h3><p>è¯´æ˜ï¼šCDHæœ‰ä¸¤ç§æœ¬åœ°ä»“åº“é…ç½®æ–¹å¼ï¼Œpackageå’Œparcelã€‚å®˜æ–¹æ˜¯æ¨èä½¿ç”¨packageï¼Œæˆ‘æ¨èä¸¤ç§éƒ½é…ç½®å¥½ï¼ŒCDHè¿˜æ˜¯ç”¨parcelã€‚packageæ–¹å¼å¯ç”¨äºè·å–rpmåŒ…ã€‚<br><a href="https://docs.cloudera.com/documentation/enterprise/6/latest/topics/cm_ig_create_local_package_repo.html">https://docs.cloudera.com/documentation/enterprise/6/latest/topics/cm_ig_create_local_package_repo.html</a><br>yumåŒ…çš„ä¸‹è½½å»ºè®®ä½¿ç”¨idmçš„ç«™ç‚¹æŠ“å–åŠŸèƒ½ï¼Œä¸è¦ç”¨wgetä¸‹è½½</p><h3 id="2-ä½¿ç”¨-yumdownloader-è·å–rpmåŒ…"><a href="#2-ä½¿ç”¨-yumdownloader-è·å–rpmåŒ…" class="headerlink" title="2. ä½¿ç”¨ yumdownloader è·å–rpmåŒ…"></a>2. ä½¿ç”¨ yumdownloader è·å–rpmåŒ…</h3><p>è¿™ä¸€æ­¥éœ€è¦åœ¨dockerå®¹å™¨ç¯å¢ƒä¸‹è¿›è¡Œï¼Œè¿™æ ·ç¯å¢ƒå¾ˆçº¯ç²¹ï¼Œè·å–åˆ°åˆ°rpmåŒ…æ›´å®Œæ•´ï¼Œå‚è€ƒï¼š<a href="https://blog.csdn.net/alinyua/article/details/108071365">https://blog.csdn.net/alinyua/article/details/108071365</a></p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yum install yum-utils -y</span></span><br><span class="line">mkdir cdh-packages &amp;&amp; cd cdh-packages </span><br><span class="line">yumdownloader --resolve  hadoop-client hbase hive-hbase spark-core</span><br><span class="line">cd .. &amp;&amp; tar -zcf cdh-packages.tar.gz cdh-packages</span><br></pre></td></tr></table></figure><h2 id="äºŒ-å®‰è£…CDH-rpmåŒ…"><a href="#äºŒ-å®‰è£…CDH-rpmåŒ…" class="headerlink" title="äºŒ å®‰è£…CDH rpmåŒ…"></a>äºŒ å®‰è£…CDH rpmåŒ…</h2><p>å®‰è£…æ—¶è™½ç„¶ä¸ä¼šæœ‰ä¾èµ–ç¼ºå°‘ï¼Œä½†å¯èƒ½ç”±äºç³»ç»Ÿç‰ˆæœ¬å…³ç³»éƒ¨åˆ†ç³»ç»Ÿè‡ªå¸¦è½¯ä»¶ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œæˆ‘æ˜¯å‚è€ƒé”™è¯¯æç¤ºç›´æ¥å¿½ç•¥æ‰ï¼Œåé¢ä¹Ÿæ²¡æœ‰é‡åˆ°é—®é¢˜ã€‚</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf cdh-packages.tar.gz</span><br><span class="line">yum -y localinstall cdh-packages/*.rpm</span><br></pre></td></tr></table></figure><h2 id="ä¸‰-é…ç½®CDH-ç¯å¢ƒ"><a href="#ä¸‰-é…ç½®CDH-ç¯å¢ƒ" class="headerlink" title="ä¸‰ é…ç½®CDH ç¯å¢ƒ"></a>ä¸‰ é…ç½®CDH ç¯å¢ƒ</h2><h3 id="1-é…ç½®ç¯å¢ƒå˜é‡"><a href="#1-é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="1. é…ç½®ç¯å¢ƒå˜é‡"></a>1. é…ç½®ç¯å¢ƒå˜é‡</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;export HADOOP_HOME=/usr/lib/hadoop&quot;&gt;&gt; /etc/profile</span><br><span class="line">echo &quot;export HBASE_HOME=/usr/lib/hbase&quot;&gt;&gt; /etc/profile</span><br><span class="line">echo &quot;export HIVE_HOME=/usr/lib/hive&quot;&gt;&gt; /etc/profile</span><br><span class="line">echo &quot;export SPARK_HOME=/usr/lib/spark&quot;&gt;&gt; /etc/profile</span><br><span class="line">echo &quot;export HADOOP_CONF_DIR=/etc/hadoop/conf/&quot;&gt;&gt; /etc/profile</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><h3 id="2-æ·»åŠ é…ç½®æ–‡ä»¶"><a href="#2-æ·»åŠ é…ç½®æ–‡ä»¶" class="headerlink" title="2. æ·»åŠ é…ç½®æ–‡ä»¶"></a>2. æ·»åŠ é…ç½®æ–‡ä»¶</h3><p>åœ¨CDHç®¡ç†ç•Œé¢ä¸‹è½½å„ç»„ä»¶çš„å®¢æˆ·ç«¯é…ç½®ï¼Œæ·»åŠ åˆ°å¯¹åº”æ–‡ä»¶å¤¹ä¸‹<br>å„ç»„ä»¶é…ç½®æ–‡ä»¶ä½ç½®å¦‚ä¸‹ï¼š<br>hadoop/yarn: /etc/hadoop/conf/<br>hbase: /etc/hbase/conf<br>hive: /etc/hive/conf</p><h2 id="å››-éªŒè¯"><a href="#å››-éªŒè¯" class="headerlink" title="å›› éªŒè¯"></a>å›› éªŒè¯</h2><p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤å¯¹å„ä¸ªç»„ä»¶è¿›è¡ŒéªŒè¯</p><h3 id="1-hdfs"><a href="#1-hdfs" class="headerlink" title="1. hdfs"></a>1. hdfs</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -ls /</span><br></pre></td></tr></table></figure><h3 id="2-yarn"><a href="#2-yarn" class="headerlink" title="2. yarn"></a>2. yarn</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn node -list</span><br></pre></td></tr></table></figure><h3 id="3-hbase"><a href="#3-hbase" class="headerlink" title="3. hbase"></a>3. hbase</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hbase shell</span><br><span class="line"></span><br><span class="line">status</span><br></pre></td></tr></table></figure><h3 id="4-hive"><a href="#4-hive" class="headerlink" title="4. hive"></a>4. hive</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive shell</span><br><span class="line"></span><br><span class="line">show tables;</span><br></pre></td></tr></table></figure><h3 id="5-spark"><a href="#5-spark" class="headerlink" title="5. spark"></a>5. spark</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> èƒ½æ­£ç¡®è¿›å…¥å³å¯</span></span><br><span class="line">spark-shell</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœæŠ¥é”™ï¼šjava.lang.NoSuchMethodError: jline.console.completer.CandidateListCompletionHandler.setPrintSpaceAfterFullCompletion(Z)V<br>æ ¹æ®ï¼š<a href="https://issues.apache.org/jira/browse/SPARK-25783">https://issues.apache.org/jira/browse/SPARK-25783</a><br>å¯ä¸‹è½½ jline-2.14.3.jar æ”¾åˆ° $SPARK_HOME/jars ä¸‹<br>ä¸‹è½½åœ°å€ï¼š<a href="https://repo1.maven.org/maven2/jline/jline/2.14.3/jline-2.14.3.jar">https://repo1.maven.org/maven2/jline/jline/2.14.3/jline-2.14.3.jar</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å¤§æ•°æ® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CDH </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CDHéƒ¨ç½²ç¬”è®°</title>
      <link href="//cdh_server_env_deploy/"/>
      <url>//cdh_server_env_deploy/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸ºä¸ªäººå®‰è£…CDHæ—¶è®°å½•ï¼Œä¸å…·æ™®é€‚æ€§ï¼Œä»…ä¾›å‚è€ƒã€‚å»ºè®®å¯¹æ¯”å®˜æ–¹æ–‡æ¡£é˜…è¯»ã€‚</p><span id="more"></span><h2 id="ä¸€-ä¾èµ–æ£€æŸ¥"><a href="#ä¸€-ä¾èµ–æ£€æŸ¥" class="headerlink" title="ä¸€ ä¾èµ–æ£€æŸ¥"></a>ä¸€ ä¾èµ–æ£€æŸ¥</h2><p>ä»¥centos7ä¸ºä¾‹</p><h3 id="1-è½¯ä»¶"><a href="#1-è½¯ä»¶" class="headerlink" title="1. è½¯ä»¶"></a>1. è½¯ä»¶</h3><p><a href="https://docs.cloudera.com/documentation/enterprise/6/release-notes/topics/rg_os_requirements.html">https://docs.cloudera.com/documentation/enterprise/6/release-notes/topics/rg_os_requirements.html</a></p><h4 id="0-å¸¸ç”¨è½¯ä»¶å®‰è£…"><a href="#0-å¸¸ç”¨è½¯ä»¶å®‰è£…" class="headerlink" title="0. å¸¸ç”¨è½¯ä»¶å®‰è£…"></a>0. å¸¸ç”¨è½¯ä»¶å®‰è£…</h4><p>æ­¤æ­¥éª¤éå¿…é¡»</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y bind-utils</span><br></pre></td></tr></table></figure><h4 id="1-python"><a href="#1-python" class="headerlink" title="1. python"></a>1. python</h4><p>ä½¿ç”¨2.7ç‰ˆæœ¬æˆ–ä»¥ä¸Šç‰ˆæœ¬ï¼Œä½†ä¸æ”¯æŒ3<br>centos7 ä¸­é»˜è®¤å·²åŒ…å«ï¼Œå¦‚æœæœ‰å¤šç‰ˆæœ¬éœ€è®¾ç½®PYSPARK_PYTHONå’Œ<br>PYSPARK_DRIVER_PYTHONç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line">python --version</span><br></pre></td></tr></table></figure><h4 id="2-Perl"><a href="#2-Perl" class="headerlink" title="2. Perl"></a>2. Perl</h4><p>ä¸€èˆ¬å·²å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line">perlÂ -v</span><br></pre></td></tr></table></figure><h4 id="3-python-psycopg2"><a href="#3-python-psycopg2" class="headerlink" title="3. python-psycopg2"></a>3. python-psycopg2</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¦å…ˆå®‰è£…epel-releaseï¼Œï¼Œè¿™ä¸ªåŒ…åŒ…å«äº† EPEL æºçš„ gpg å¯†é’¥å’Œè½¯ä»¶æºä¿¡æ¯ï¼Œè¯¥è½¯ä»¶åŒ…ä¼šè‡ªåŠ¨é…ç½®yumçš„è½¯ä»¶ä»“åº“</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦åˆ™ä¸‹ä¸€æ­¥ä¼šæç¤ºï¼šæ²¡æœ‰å¯ç”¨è½¯ä»¶åŒ… pip-python</span></span><br><span class="line">yum -y install epel-release</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…pip</span></span><br><span class="line">yum -y install python-pip</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨pip å®‰è£… psycopg2</span></span><br><span class="line">pip install psycopg2==2.7.5 --ignore-installed</span><br></pre></td></tr></table></figure><h3 id="2-ç½‘ç»œ"><a href="#2-ç½‘ç»œ" class="headerlink" title="2. ç½‘ç»œ"></a>2. ç½‘ç»œ</h3><h4 id="ç¦ç”¨ipv6"><a href="#ç¦ç”¨ipv6" class="headerlink" title="ç¦ç”¨ipv6"></a>ç¦ç”¨ipv6</h4><p><a href="https://www.jianshu.com/p/225d040d0b66">https://www.jianshu.com/p/225d040d0b66</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w net.ipv6.conf.all.disable_ipv6=1</span><br><span class="line">sysctl -w net.ipv6.conf.default.disable_ipv6=1</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br><span class="line">netstat -lnpt</span><br></pre></td></tr></table></figure><h4 id="é…ç½®hostname"><a href="#é…ç½®hostname" class="headerlink" title="é…ç½®hostname"></a>é…ç½®hostname</h4><p><a href="https://docs.cloudera.com/documentation/enterprise/6/latest/topics/configure_network_names.html">https://docs.cloudera.com/documentation/enterprise/6/latest/topics/configure_network_names.html</a><br>ç”¨å…¨ç§°åŸŸåï¼Œå¦‚ï¼špaas-201.adp.com è€Œä¸æ˜¯ paas-201</p><ol><li><p>é…ç½®hostname</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo hostnamectl set-hostname foo-1.example.com</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¾‘/ets/hosts(é›†ç¾¤ç»Ÿä¸€)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.1.1.1  foo-1.example.com  foo-1</span><br><span class="line">2.2.2.2  foo-2.example.com  foo-2</span><br><span class="line">3.3.3.3  foo-3.example.com  foo-3</span><br><span class="line">4.4.4.4  foo-4.example.com  foo-4</span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¾‘/etc/sysconfig/network</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;HOSTNAME=$HOSTNAME&quot; &gt;&gt;/etc/sysconfig/network</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å…³é—­é˜²ç«å¢™"><a href="#å…³é—­é˜²ç«å¢™" class="headerlink" title="å…³é—­é˜²ç«å¢™"></a>å…³é—­é˜²ç«å¢™</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¿å­˜è§„åˆ™</span></span><br><span class="line">sudo iptables-save &gt; ~/firewall.rules</span><br><span class="line"><span class="meta">#</span><span class="bash"> å…³é—­</span></span><br><span class="line">sudo systemctl disable firewalld</span><br><span class="line">sudo systemctl stop firewalld</span><br></pre></td></tr></table></figure><h3 id="3-å…³é—­SELinux"><a href="#3-å…³é—­SELinux" class="headerlink" title="3. å…³é—­SELinux"></a>3. å…³é—­SELinux</h3><p>æŸ¥çœ‹æ˜¯å¦å·²ç»å…³é—­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getenforce</span><br></pre></td></tr></table></figure><p>å…³é—­æ–¹æ³•ï¼š<br>ä¿®æ”¹/etc/selinux/config<br>SELINUX=permissive<br>å¹¶æ‰§è¡Œ setenforce 0  ç«‹å³ç”Ÿæ•ˆ</p><h3 id="4-å¯ç”¨ntp"><a href="#4-å¯ç”¨ntp" class="headerlink" title="4. å¯ç”¨ntp"></a>4. å¯ç”¨ntp</h3><p>å®‰è£…åç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡ŒéªŒè¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl status chronyd.service </span><br><span class="line">chronyc sources -v </span><br><span class="line">chronyc sourcestats -v</span><br></pre></td></tr></table></figure><h2 id="äºŒ-å®‰è£…"><a href="#äºŒ-å®‰è£…" class="headerlink" title="äºŒ å®‰è£…"></a>äºŒ å®‰è£…</h2><h3 id="ä¸€-é…ç½®æœ¬åœ°ä»“åº“"><a href="#ä¸€-é…ç½®æœ¬åœ°ä»“åº“" class="headerlink" title="ä¸€. é…ç½®æœ¬åœ°ä»“åº“"></a>ä¸€. é…ç½®æœ¬åœ°ä»“åº“</h3><p><a href="https://docs.cloudera.com/documentation/enterprise/6/latest/topics/cm_ig_create_local_package_repo.html">https://docs.cloudera.com/documentation/enterprise/6/latest/topics/cm_ig_create_local_package_repo.html</a></p><h4 id="1-é…ç½®webæœåŠ¡å™¨"><a href="#1-é…ç½®webæœåŠ¡å™¨" class="headerlink" title="1. é…ç½®webæœåŠ¡å™¨"></a>1. é…ç½®webæœåŠ¡å™¨</h4></li><li><p>å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install httpd</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>éœ€ä¿è¯/var/wwwç£ç›˜ç©ºé—´è¶³å¤Ÿï¼Œå»ºè®®æŒ‚è½½ï¼Œè¿™é‡Œå‡è®¾ /home/www æœ‰è¶³å¤Ÿçš„ç©ºé—´</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mv /var/www /var/www2</span><br><span class="line">mkdir /home/www</span><br><span class="line">ln -s /home/www /var/www</span><br><span class="line">mv /var/www2/* /var/www/</span><br><span class="line">rm -rf /var/www2</span><br><span class="line">ls /home/www</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start httpd</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-ä¸‹è½½æ–‡ä»¶-clouderaManagerå’Œcdhï¼‰"><a href="#2-ä¸‹è½½æ–‡ä»¶-clouderaManagerå’Œcdhï¼‰" class="headerlink" title="2. ä¸‹è½½æ–‡ä»¶(clouderaManagerå’Œcdhï¼‰"></a>2. ä¸‹è½½æ–‡ä»¶(clouderaManagerå’Œcdhï¼‰</h4></li><li><p>clouderaManager<br>ä¸‹è½½ï¼š<a href="https://archive.cloudera.com/cm6/6.3.1/repo-as-tarball/cm6.3.1-redhat7.tar.gz">https://archive.cloudera.com/cm6/6.3.1/repo-as-tarball/cm6.3.1-redhat7.tar.gz</a></p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /var/www/html/cloudera-repos/cm6</span><br><span class="line">tar xvfz cm6.3.1-redhat7.tar.gz -C /var/www/html/cloudera-repos/cm6 --strip-components=1</span><br><span class="line">sudo chmod -R ugo+rX /var/www/html/cloudera-repos/cm6</span><br></pre></td></tr></table></figure><ol start="2"><li>cdh</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /var/www/html/cloudera-repos</span><br><span class="line">sudo wget --recursive --no-parent --no-host-directories https://archive.cloudera.com/cdh6/6.3.2/redhat7/ -P /var/www/html/cloudera-repos</span><br><span class="line"></span><br><span class="line">sudo wget --recursive --no-parent --no-host-directories https://archive.cloudera.com/gplextras6/6.3.2/redhat7/ -P /var/www/html/cloudera-repos</span><br><span class="line"></span><br><span class="line">sudo chmod -R ugo+rX /var/www/html/cloudera-repos/cdh6</span><br><span class="line">sudo chmod -R ugo+rX /var/www/html/cloudera-repos/gplextras6</span><br></pre></td></tr></table></figure><p>è®¿é—® http://<host>/cloudera-repos/ ï¼Œåº”è¯¥å¯ä»¥çœ‹åˆ°ä¸‹è½½çš„æ–‡ä»¶</p><h4 id="3-é…ç½®ä½¿ç”¨æœ¬åœ°å­˜å‚¨åº“"><a href="#3-é…ç½®ä½¿ç”¨æœ¬åœ°å­˜å‚¨åº“" class="headerlink" title="3. é…ç½®ä½¿ç”¨æœ¬åœ°å­˜å‚¨åº“"></a>3. é…ç½®ä½¿ç”¨æœ¬åœ°å­˜å‚¨åº“</h4><p>åˆ›å»º/etc/yum.repos.d/cloudera-repo.repo<br>å†…å®¹å¦‚ä¸‹ï¼š</p><p>[cloudera-repo]<br>name=cloudera-repo<br>baseurl=<a href="http://paas-241/cloudera-repos/cm6">http://paas-241/cloudera-repos/cm6</a><br>enabled=1<br>gpgcheck=0</p><h3 id="ä¸‰-å®‰è£…CDH"><a href="#ä¸‰-å®‰è£…CDH" class="headerlink" title="ä¸‰. å®‰è£…CDH"></a>ä¸‰. å®‰è£…CDH</h3><h4 id="1-å®‰è£…java"><a href="#1-å®‰è£…java" class="headerlink" title="1. å®‰è£…java"></a>1. å®‰è£…java</h4> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y oracle-j2sdk1.8</span><br></pre></td></tr></table></figure><h4 id="2-å®‰è£…CM"><a href="#2-å®‰è£…CM" class="headerlink" title="2. å®‰è£…CM"></a>2. å®‰è£…CM</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y cloudera-manager-daemons cloudera-manager-agent cloudera-manager-server</span><br></pre></td></tr></table></figure><h4 id="3-å®‰è£…æ•°æ®åº“"><a href="#3-å®‰è£…æ•°æ®åº“" class="headerlink" title="3. å®‰è£…æ•°æ®åº“"></a>3. å®‰è£…æ•°æ®åº“</h4><p>å‡è®¾ä½¿ç”¨mysqlä¸”å·²å®‰è£…</p><p>åœ¨cmæœåŠ¡å™¨ä¸Šï¼š</p><h5 id="1-å®‰è£…jdbcé©±åŠ¨"><a href="#1-å®‰è£…jdbcé©±åŠ¨" class="headerlink" title="1. å®‰è£…jdbcé©±åŠ¨"></a>1. å®‰è£…jdbcé©±åŠ¨</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wget https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.46.tar.gz</span><br><span class="line"></span><br><span class="line">tar zxvf mysql-connector-java-5.1.46.tar.gz</span><br><span class="line"></span><br><span class="line">sudo mkdir -p /usr/share/java/</span><br><span class="line"></span><br><span class="line">cd mysql-connector-java-5.1.46</span><br><span class="line"></span><br><span class="line">sudo cp mysql-connector-java-5.1.46-bin.jar  /usr/share/java/mysql-connector-java.jar</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="2-åˆ›å»ºæ•°æ®åº“å¹¶æˆæƒ"><a href="#2-åˆ›å»ºæ•°æ®åº“å¹¶æˆæƒ" class="headerlink" title="2. åˆ›å»ºæ•°æ®åº“å¹¶æˆæƒ"></a>2. åˆ›å»ºæ•°æ®åº“å¹¶æˆæƒ</h5><p>ç™»å½•mysqlè¿›è¡Œé…ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -h 192.168.100.200 -p</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼šå‡è®¾æ•°æ®åº“ä¸ºcdh æˆæƒç”¨æˆ·ä¸ºrootï¼Œå¯†ç ä¸ºanyonedev<br> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE cdh <span class="keyword">DEFAULT</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> cdh.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;anyonedev&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h5 id="3-æ‰§è¡Œåˆ›å»ºè„šæœ¬"><a href="#3-æ‰§è¡Œåˆ›å»ºè„šæœ¬" class="headerlink" title="3. æ‰§è¡Œåˆ›å»ºè„šæœ¬"></a>3. æ‰§è¡Œåˆ›å»ºè„šæœ¬</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/opt/cloudera/cm/schema/scm_prepare_database.sh -h 192.168.100.200 mysql cdh root anyonedev</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å››-å¯åŠ¨"><a href="#å››-å¯åŠ¨" class="headerlink" title="å›› å¯åŠ¨"></a>å›› å¯åŠ¨</h4> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable cloudera-scm-server</span><br><span class="line">sudo systemctl start cloudera-scm-server</span><br><span class="line">sudo tail -f /var/log/cloudera-scm-server/cloudera-scm-server.log</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›´åˆ°çœ‹åˆ°ï¼š<br>INFO WebServerImpl:com.cloudera.server.cmf.WebServerImpl: Started Jetty server.<br>åˆ™è¯´æ˜å¯åŠ¨å®Œæˆï¼Œæ‰“å¼€<br><a href="http://paas-241:7180/">http://paas-241:7180</a> å³å¯ admin/admin</p><p>æ³¨æ„é…ç½®è‡ªå®šä¹‰ä»“åº“ï¼š<br><a href="http://192.168.100.241/cloudera-repos/cdh6/6.3.2/redhat7/yum/">http://192.168.100.241/cloudera-repos/cdh6/6.3.2/redhat7/yum/</a><br>æ–¹æ³•æ˜¯æ•°æ®è¡¨</p>]]></content>
      
      
      <categories>
          
          <category> å¤§æ•°æ® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CDH </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>oracle_logminerå­¦ä¹ å’Œå®è·µç¬”è®°</title>
      <link href="//oracle_logminer/"/>
      <url>//oracle_logminer/</url>
      
        <content type="html"><![CDATA[<p>Oracle LogMineræ˜¯Oracleå…¬å¸ä»äº§å“8iä»¥åæä¾›çš„ä¸€ä¸ªå®é™…éå¸¸æœ‰ç”¨çš„åˆ†æå·¥å…·ï¼Œä½¿ç”¨è¯¥å·¥å…·å¯ä»¥è½»æ¾è·å¾—Oracle åœ¨çº¿/å½’æ¡£æ—¥å¿—æ–‡ä»¶ä¸­çš„å…·ä½“å†…å®¹ï¼Œç‰¹åˆ«æ˜¯è¯¥å·¥å…·å¯ä»¥åˆ†æå‡ºæ‰€æœ‰å¯¹äºæ•°æ®åº“æ“ä½œçš„DMLå’ŒDDLè¯­å¥ã€‚è¯¥å·¥å…·ç‰¹åˆ«é€‚ç”¨äºè°ƒè¯•ã€å®¡è®¡æˆ–è€…å›é€€æŸä¸ªç‰¹å®šçš„äº‹åŠ¡ã€‚</p><span id="more"></span><h2 id="ä¼˜å…ˆå‚è€ƒèµ„æ–™"><a href="#ä¼˜å…ˆå‚è€ƒèµ„æ–™" class="headerlink" title="ä¼˜å…ˆå‚è€ƒèµ„æ–™"></a>ä¼˜å…ˆå‚è€ƒèµ„æ–™</h2><p>åä¸ºç›¸å…³é…ç½®ï¼š <a href="https://support.huaweicloud.com/usermanual-roma/fdi-ug-190624017.html">https://support.huaweicloud.com/usermanual-roma/fdi-ug-190624017.html</a><br>flink-cdcç›¸å…³é…ç½®ï¼š <a href="https://ververica.github.io/flink-cdc-connectors/master/content/connectors/oracle-cdc.html#setup-oracle">https://ververica.github.io/flink-cdc-connectors/master/content/connectors/oracle-cdc.html#setup-oracle</a></p><h2 id="ä¸€-æ­å»ºç¯å¢ƒ"><a href="#ä¸€-æ­å»ºç¯å¢ƒ" class="headerlink" title="ä¸€ æ­å»ºç¯å¢ƒ"></a>ä¸€ æ­å»ºç¯å¢ƒ</h2><h3 id="1-ä½¿ç”¨dockeræä¾›oracleè¿è¡Œç¯å¢ƒ"><a href="#1-ä½¿ç”¨dockeræä¾›oracleè¿è¡Œç¯å¢ƒ" class="headerlink" title="1 ä½¿ç”¨dockeræä¾›oracleè¿è¡Œç¯å¢ƒ"></a>1 ä½¿ç”¨dockeræä¾›oracleè¿è¡Œç¯å¢ƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name my-oracle --restart=always -p 49161:1521 -e ORACLE_ALLOW_REMOTE=true wnameless/oracle-xe-11g-r2</span><br></pre></td></tr></table></figure><p>è¿æ¥é…ç½®å¦‚ä¸‹ï¼š</p><blockquote><p>hostname: localhost<br>port: 49161<br>sid: xe<br>username: system  ç®¡ç†å‘˜ï¼šsys as sysdba<br>password: oracle</p></blockquote><p>ä»¥ä¸‹æ“ä½œéœ€åœ¨sql plusç¯å¢ƒä¸‹æ‰§è¡Œ</p><blockquote><p>navicat é…ç½®sql plusæ–¹æ³•å¦‚ä¸‹ï¼š<br>åˆ° <a href="https://www.oracle.com/database/technologies/instant-client/winx64-64-downloads.html">https://www.oracle.com/database/technologies/instant-client/winx64-64-downloads.html</a> ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ Instant Client Package - Basic åŸºç¡€å®‰è£…åŒ… å’Œ Instant Client Package - SQL*Plusï¼Œè§£å‹åˆ°åŒä¸€ç›®å½•ï¼Œåœ¨navicat - é€‰é¡¹ - ç¯å¢ƒ é‡Œé…ç½®è¯¥ç›®å½•å³å¯</p></blockquote><p>ä¸è¿‡è¿˜æ˜¯å»ºè®®ç›´æ¥åˆ°å®¹å™¨é‡Œé¢æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥å®¹å™¨</span></span><br><span class="line">docker exec -it my-oracle bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä»¥ç³»ç»Ÿç®¡ç†å‘˜ç™»å½•sqlplus</span></span><br><span class="line">sqlplus sys/oracle as sysdba</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªç³»ç»Ÿç®¡ç†å‘˜ï¼Œå¦‚ä¸‹ï¼Œå…¶ä¸­â€CONNECTâ€, â€œDBAâ€, â€œRESOURCEâ€æ˜¯è§’è‰²ï¼ŒSYSDBA æ˜¯æœåŠ¡å™¨æƒé™ï¼Œä¸èƒ½åŒæ—¶grant</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> &quot;LOGMINER01&quot; IDENTIFIED <span class="keyword">BY</span> &quot;123456&quot;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> &quot;CONNECT&quot;, &quot;DBA&quot;, &quot;RESOURCE&quot; <span class="keyword">TO</span> &quot;LOGMINER01&quot;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> SYSDBA  <span class="keyword">TO</span> &quot;LOGMINER01&quot;;</span><br></pre></td></tr></table></figure><h3 id="2-åŠ å…¥åŠŸèƒ½åŒ…"><a href="#2-åŠ å…¥åŠŸèƒ½åŒ…" class="headerlink" title="2 åŠ å…¥åŠŸèƒ½åŒ…"></a>2 åŠ å…¥åŠŸèƒ½åŒ…</h3><p>é€šå¸¸åœ¨å®‰è£…æ•°æ®åº“åå°±å·²ç»å®‰è£…äº†Logminerï¼Œè¦æŸ¥çœ‹æ•°æ®åº“æ˜¯å¦å®‰è£…äº†LogMinerï¼Œåªéœ€æŸ¥çœ‹æ•°æ®åº“ä¸­æ˜¯å¦å·²ç»æœ‰äº†dbms_logmnrå’Œdbms_logmnr_dè¿™2ä¸ªpackageï¼Œå¦‚æœæœ‰äº†ï¼Œåˆ™å·²ç»å®‰è£…ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ‰§è¡Œä¸‹é¢ä¸¤ä¸ªè„šæœ¬å³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@/u01/app/oracle/product/11.2.0/xe/rdbms/admin/dbmslm.sql</span><br><span class="line">@/u01/app/oracle/product/11.2.0/xe/rdbms/admin/dbmslmd.sql</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚æœç¯å¢ƒä¸ä¸€æ ·ï¼Œä¸çŸ¥é“å¯¹åº”çš„æ–‡ä»¶ä½ç½®ï¼Œå»ºè®®ç›´æ¥ find / -name â€˜dbmslm.sqlâ€™<br><img src="https://img-blog.csdnimg.cn/20200917224107575.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="åŠ å…¥åŠŸèƒ½åŒ…"></p><h3 id="3-å¯ç”¨è¡¥å……æ—¥å¿—"><a href="#3-å¯ç”¨è¡¥å……æ—¥å¿—" class="headerlink" title="3 å¯ç”¨è¡¥å……æ—¥å¿—"></a>3 å¯ç”¨è¡¥å……æ—¥å¿—</h3><p>è¡¥å……æ—¥å¿—æœ‰å‡ ç§ç±»å‹ï¼ŒSUPPLEMENTAL LOG DATAæ˜¯æœ€å°è¡¥å……æ—¥å¿—ï¼Œè¿™é‡Œæ¨èä½¿ç”¨SUPPLEMENTAL LOG DATA (ALL) COLUMNSï¼Œå½“æ•°æ®è¡Œæ›´æ–°æ—¶ä¼šè®°å½•å®Œæ•´çš„å­—æ®µæ•°æ®ï¼ˆè€Œéåªæœ‰æ›´æ–°çš„å­—æ®µæ•°æ®ï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æœ€å°è¡¥å……æ—¥å¿—</span></span><br><span class="line"><span class="comment">-- ALTER DATABASE ADD SUPPLEMENTAL LOG DATA;</span></span><br><span class="line"><span class="keyword">ALTER</span> DATABASE <span class="keyword">ADD</span> SUPPLEMENTAL LOG DATA (<span class="keyword">ALL</span>) COLUMNS;</span><br><span class="line"><span class="keyword">SELECT</span> SUPPLEMENTAL_LOG_DATA_MIN <span class="keyword">FROM</span> V$DATABASE;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200917225120914.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="å¯ç”¨è¡¥å……æ—¥å¿—"></p><h3 id="4-å¼€å¯archivelog-mode"><a href="#4-å¼€å¯archivelog-mode" class="headerlink" title="4 å¼€å¯archivelog mode"></a>4 å¼€å¯archivelog mode</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SHUTDOWN IMMEDIATE</span><br><span class="line">STARTUP MOUNT</span><br><span class="line">ALTER DATABASE ARCHIVELOG;</span><br><span class="line">ALTER DATABASE OPEN;</span><br><span class="line">archive log list;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200917225424282.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="å¼€å¯archivelog mode"></p><h3 id="5-åˆ›å»ºæ—¥å¸¸ç»´æŠ¤è´¦å·"><a href="#5-åˆ›å»ºæ—¥å¸¸ç»´æŠ¤è´¦å·" class="headerlink" title="5 åˆ›å»ºæ—¥å¸¸ç»´æŠ¤è´¦å·"></a>5 åˆ›å»ºæ—¥å¸¸ç»´æŠ¤è´¦å·</h3><p>éœ€è¦æ³¨æ„ï¼Œæœ€åçš„ ALTER system æƒé™è¿‡å¤§ï¼Œå¦‚æœä¸éœ€è¦ä½¿ç”¨alter system switch logfileè¯­å¥çš„ï¼Œå¯ä»¥ä¸æˆæƒã€‚<br>alter system switch  logfile çš„å…·ä½“è¯´æ˜å‚è€ƒï¼š<a href="https://blog.csdn.net/fred_yang2013/article/details/45171283">https://blog.csdn.net/fred_yang2013/article/details/45171283</a></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºuser1ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> &quot;USER1&quot; IDENTIFIED <span class="keyword">BY</span> &quot;123456&quot;;</span><br><span class="line"><span class="comment">-- æˆäºˆ è¿æ¥ æƒé™</span></span><br><span class="line"><span class="keyword">GRANT</span> &quot;CONNECT&quot;,&quot;RESOURCE&quot; <span class="keyword">TO</span> &quot;USER1&quot;;</span><br><span class="line"><span class="comment">-- æˆäºˆ ä½¿ç”¨LogMiner PL / SQLç¨‹åºåŒ… æƒé™</span></span><br><span class="line"><span class="keyword">GRANT</span> EXECUTE_CATALOG_ROLE <span class="keyword">TO</span> &quot;USER1&quot;;</span><br><span class="line"><span class="comment">-- æˆäºˆ æŸ¥è¯¢V$ARCHIVED_LOGè§†å›¾ æƒé™</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span>V_$ARCHIVED_LOG <span class="keyword">TO</span> &quot;USER1&quot;;</span><br><span class="line"><span class="comment">-- æˆäºˆ ä½¿ç”¨DBMS_LOGMNR_Dç¨‹åº æƒé™ï¼ˆç”¨äºç”Ÿæˆå­—å…¸æ–‡ä»¶ï¼‰</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">execute</span> <span class="keyword">ON</span> DBMS_LOGMNR_D <span class="keyword">TO</span> &quot;USER1&quot;;</span><br><span class="line"><span class="comment">-- æˆäºˆ ä½¿ç”¨DBMS_LOGMNRç¨‹åº æƒé™ ï¼ˆç”¨äºç”Ÿæˆåˆ†æä¼šè¯ï¼‰</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">execute</span> <span class="keyword">ON</span> DBMS_LOGMNR <span class="keyword">TO</span> &quot;USER1&quot;;</span><br><span class="line"><span class="comment">-- æˆäºˆ æŸ¥è¯¢V$LOGMNR_CONTENTS TOè§†å›¾ æƒé™ï¼ˆå¿…é¡»æ‹¥æœ‰SELECT ANY TRANSACTIONæƒé™æ‰èƒ½æŸ¥è¯¢æ­¤è§†å›¾ï¼‰</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ANY</span> TRANSACTION <span class="keyword">TO</span> USER1;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span>V_$LOGMNR_CONTENTS <span class="keyword">TO</span> &quot;USER1&quot;;</span><br><span class="line"><span class="comment">-- æˆäºˆ æ‰§è¡Œalter system switch logfileç”Ÿæˆæ—¥å¿—æ–‡ä»¶ æƒé™</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALTER</span> <span class="keyword">system</span> <span class="keyword">TO</span> &quot;USER1&quot;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="äºŒ-å¸¸ç”¨å‘½ä»¤"><a href="#äºŒ-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="äºŒ å¸¸ç”¨å‘½ä»¤"></a>äºŒ å¸¸ç”¨å‘½ä»¤</h2><h3 id="1-æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶"><a href="#1-æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶" class="headerlink" title="1 æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶"></a>1 æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> V$ARCHIVED_LOG ;</span><br></pre></td></tr></table></figure><h3 id="2-åˆ›å»ºå­—å…¸æ–‡ä»¶"><a href="#2-åˆ›å»ºå­—å…¸æ–‡ä»¶" class="headerlink" title="2 åˆ›å»ºå­—å…¸æ–‡ä»¶"></a>2 åˆ›å»ºå­—å…¸æ–‡ä»¶</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    DBMS_LOGMNR_D.BUILD(OPTIONS<span class="operator">=</span><span class="operator">&gt;</span> DBMS_LOGMNR_D.STORE_IN_REDO_LOGS);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-åˆ›å»ºå½’æ¡£æ—¥å¿—"><a href="#3-åˆ›å»ºå½’æ¡£æ—¥å¿—" class="headerlink" title="3 åˆ›å»ºå½’æ¡£æ—¥å¿—"></a>3 åˆ›å»ºå½’æ¡£æ—¥å¿—</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> switch logfile</span><br></pre></td></tr></table></figure><h2 id="ä¸‰-ä½¿ç”¨ç¤ºä¾‹"><a href="#ä¸‰-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä¸‰ ä½¿ç”¨ç¤ºä¾‹"></a>ä¸‰ ä½¿ç”¨ç¤ºä¾‹</h2><pre><code>  0. å…ˆæ‰§è¡Œå½’æ¡£æ“ä½œ  1. æ ¹æ®ç»™å®šèŒƒå›´ï¼Œè·å–è¦åˆ†æçš„æ–‡ä»¶åˆ—è¡¨  2. å…ˆç”Ÿæˆå­—å…¸ï¼Œå†æ ¹æ®1ï¼Œé€‰å®šæœ€è¿‘çš„å­—å…¸.å­—å…¸å¯èƒ½æœ‰å¤šæ–‡ä»¶ï¼Œéœ€æ‰¾å‡ºæœ€åä¸€ä¸ª   2.0 ç”Ÿæˆå­—å…¸æ–‡ä»¶   2.1 æ ¹æ®1çš„æ–‡ä»¶æ‰¾å‡º1ä¹‹å‰æœ€è¿‘çš„ä¸€ä¸ªå­—å…¸ç»“æŸæ–‡ä»¶   2.2 æ ¹æ®2.1æ–‡ä»¶æ‰¾å‡º2.1ä¹‹å‰æœ€è¿‘çš„ä¸€ä¸ªå­—å…¸å¼€å§‹æ–‡ä»¶  3. å…¨éƒ¨åŠ å…¥è¦åˆ†æçš„æ–‡ä»¶åˆ—è¡¨ä¸­  4. æ‰§è¡Œåˆ†æ</code></pre><h3 id="0-å½’æ¡£"><a href="#0-å½’æ¡£" class="headerlink" title="0 å½’æ¡£"></a>0 å½’æ¡£</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> switch logfile</span><br></pre></td></tr></table></figure><h3 id="1-è·å–è¦åˆ†æçš„æ–‡ä»¶åˆ—è¡¨"><a href="#1-è·å–è¦åˆ†æçš„æ–‡ä»¶åˆ—è¡¨" class="headerlink" title="1 è·å–è¦åˆ†æçš„æ–‡ä»¶åˆ—è¡¨"></a>1 è·å–è¦åˆ†æçš„æ–‡ä»¶åˆ—è¡¨</h3><p>å¦‚ä¸‹ï¼Œå¯ä»¥æ ¹æ®scnåºå·èŒƒå›´æˆ–è€…æ—¶é—´èŒƒå›´è·å–å½’æ¡£æ–‡ä»¶åˆ—è¡¨ã€‚<br>è¿™é‡Œå¯ä»¥é™åˆ¶å¾…ä¼šè¦åˆ†æçš„æ–‡ä»¶æ•°é‡ï¼Œå‡å°‘æœåŠ¡å™¨å·¥ä½œé‡ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> recid , stamp , name , sequence# <span class="keyword">as</span> sequence, next_change# <span class="keyword">as</span> nextChange,next_time <span class="keyword">as</span> nextTime,completion_time <span class="keyword">as</span> completionTime ,dictionary_begin <span class="keyword">as</span> dictionaryBegin,dictionary_end <span class="keyword">as</span> dictionaryEnd</span><br><span class="line"><span class="keyword">FROM</span> V$ARCHIVED_LOG </span><br><span class="line"><span class="keyword">WHERE</span> NEXT_CHANGE# <span class="operator">&gt;=</span> $&#123;beginScn?c&#125; <span class="keyword">AND</span></span><br><span class="line">FIRST_CHANGE# <span class="operator">&lt;=</span> $&#123;endScn?c&#125; <span class="keyword">AND</span></span><br><span class="line">NEXT_TIME <span class="operator">&gt;=</span> to_date(<span class="string">&#x27;$&#123;beginTime&#125;&#x27;</span>,<span class="string">&#x27;YYYYMMDDHH24MISS&#x27;</span>) <span class="keyword">AND</span></span><br><span class="line">FIRST_TIME <span class="operator">&lt;=</span> to_date(<span class="string">&#x27;$&#123;endTime&#125;&#x27;</span>,<span class="string">&#x27;YYYYMMDDHH24MISS&#x27;</span>) <span class="keyword">AND</span></span><br><span class="line"><span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="2-é€‰æ‹©å­—å…¸æ–‡ä»¶"><a href="#2-é€‰æ‹©å­—å…¸æ–‡ä»¶" class="headerlink" title="2 é€‰æ‹©å­—å…¸æ–‡ä»¶"></a>2 é€‰æ‹©å­—å…¸æ–‡ä»¶</h3><p>è¿™ä¸€æ­¥å‚è€ƒï¼š<a href="https://docs.oracle.com/en/database/oracle/oracle-database/12.2/sutil/oracle-logminer-utility.html#GUID-90944343-46BB-4BD5-A0C6-7A4B79D9BEF0">https://docs.oracle.com/en/database/oracle/oracle-database/12.2/sutil/oracle-logminer-utility.html#GUID-90944343-46BB-4BD5-A0C6-7A4B79D9BEF0</a></p><h4 id="2-0-ç”Ÿæˆå­—å…¸æ–‡ä»¶"><a href="#2-0-ç”Ÿæˆå­—å…¸æ–‡ä»¶" class="headerlink" title="2.0. ç”Ÿæˆå­—å…¸æ–‡ä»¶"></a>2.0. ç”Ÿæˆå­—å…¸æ–‡ä»¶</h4><p>è¿™ä¸€æ­¥éå¿…è¦ï¼Œä¸ªäººä¹ æƒ¯ï¼Œæ¯æ¬¡å¤šç”Ÿæˆä¸€ä»½å­—å…¸æ–‡ä»¶</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    DBMS_LOGMNR_D.BUILD(OPTIONS<span class="operator">=</span><span class="operator">&gt;</span> DBMS_LOGMNR_D.STORE_IN_REDO_LOGS);</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><h4 id="2-1-æ ¹æ®1çš„æ–‡ä»¶æ‰¾å‡º1ä¹‹å‰æœ€è¿‘çš„ä¸€ä¸ªå­—å…¸ç»“æŸæ–‡ä»¶"><a href="#2-1-æ ¹æ®1çš„æ–‡ä»¶æ‰¾å‡º1ä¹‹å‰æœ€è¿‘çš„ä¸€ä¸ªå­—å…¸ç»“æŸæ–‡ä»¶" class="headerlink" title="2.1 æ ¹æ®1çš„æ–‡ä»¶æ‰¾å‡º1ä¹‹å‰æœ€è¿‘çš„ä¸€ä¸ªå­—å…¸ç»“æŸæ–‡ä»¶"></a>2.1 æ ¹æ®1çš„æ–‡ä»¶æ‰¾å‡º1ä¹‹å‰æœ€è¿‘çš„ä¸€ä¸ªå­—å…¸ç»“æŸæ–‡ä»¶</h4><p>å°†${minSequence?c}æ›¿æ¢æˆç¬¬1æ­¥è·å–åˆ°çš„åˆ†ææ–‡ä»¶åˆ—è¡¨ä¸­æœ€å°çš„çš„sequence</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> recid , stamp , name , sequence# sequence, next_change# <span class="keyword">as</span> nextChange,next_time <span class="keyword">as</span> nextTime,completion_time <span class="keyword">as</span> completionTime ,dictionary_begin <span class="keyword">as</span> dictionaryBegin,dictionary_end <span class="keyword">as</span> dictionaryEnd</span><br><span class="line"><span class="keyword">FROM</span> V$ARCHIVED_LOG</span><br><span class="line"><span class="keyword">WHERE</span> SEQUENCE# <span class="operator">=</span> (</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span> (SEQUENCE#) <span class="keyword">FROM</span> V$ARCHIVED_LOG</span><br><span class="line"><span class="keyword">WHERE</span> DICTIONARY_END <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span></span><br><span class="line"><span class="keyword">and</span> SEQUENCE# <span class="operator">&lt;=</span> $&#123;minSequence?c&#125; )</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå¦‚æœè¿™ä¸€æ­¥æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼Œè¯´æ˜åˆ†æçš„èŒƒå›´ä¹‹å‰æ²¡æœ‰å­—å…¸æ–‡ä»¶ç”Ÿæˆï¼Œè¿™é‡Œæˆ‘çš„å¤„ç†æ–¹æ³•æ˜¯ç›´æ¥æŠŠå­æŸ¥è¯¢æ”¹æˆæŸ¥æœ€è¿œçš„ä¸€ä¸ªå­—å…¸æ–‡ä»¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span> (SEQUENCE#) <span class="keyword">FROM</span> V$ARCHIVED_LOG </span><br><span class="line"><span class="keyword">WHERE</span> DICTIONARY_END <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="2-2-æ ¹æ®2-1æ–‡ä»¶æ‰¾å‡º2-1ä¹‹å‰æœ€è¿‘çš„ä¸€ä¸ªå­—å…¸å¼€å§‹æ–‡ä»¶"><a href="#2-2-æ ¹æ®2-1æ–‡ä»¶æ‰¾å‡º2-1ä¹‹å‰æœ€è¿‘çš„ä¸€ä¸ªå­—å…¸å¼€å§‹æ–‡ä»¶" class="headerlink" title="2.2 æ ¹æ®2.1æ–‡ä»¶æ‰¾å‡º2.1ä¹‹å‰æœ€è¿‘çš„ä¸€ä¸ªå­—å…¸å¼€å§‹æ–‡ä»¶"></a>2.2 æ ¹æ®2.1æ–‡ä»¶æ‰¾å‡º2.1ä¹‹å‰æœ€è¿‘çš„ä¸€ä¸ªå­—å…¸å¼€å§‹æ–‡ä»¶</h4><p>å°†${minSequence?c}æ›¿æ¢æˆ2.1æ‰¾å‡ºçš„é‚£ä¸ªå­—å…¸ç»“æŸæ–‡ä»¶çš„åºå·</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> recid , stamp , name , sequence# sequence, next_change# <span class="keyword">as</span> nextChange,next_time <span class="keyword">as</span> nextTime,completion_time <span class="keyword">as</span> completionTime ,dictionary_begin <span class="keyword">as</span> dictionaryBegin,dictionary_end <span class="keyword">as</span> dictionaryEnd</span><br><span class="line"><span class="keyword">FROM</span> V$ARCHIVED_LOG</span><br><span class="line"><span class="keyword">WHERE</span> SEQUENCE# <span class="operator">=</span> (</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span> (SEQUENCE#) <span class="keyword">FROM</span> V$ARCHIVED_LOG</span><br><span class="line"><span class="keyword">WHERE</span> DICTIONARY_BEGIN <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span></span><br><span class="line"><span class="keyword">and</span> SEQUENCE# <span class="operator">&lt;=</span> $&#123;minSequence?c&#125; )</span><br></pre></td></tr></table></figure><h3 id="3-å…¨éƒ¨åŠ å…¥è¦åˆ†æçš„æ–‡ä»¶åˆ—è¡¨ä¸­"><a href="#3-å…¨éƒ¨åŠ å…¥è¦åˆ†æçš„æ–‡ä»¶åˆ—è¡¨ä¸­" class="headerlink" title="3. å…¨éƒ¨åŠ å…¥è¦åˆ†æçš„æ–‡ä»¶åˆ—è¡¨ä¸­"></a>3. å…¨éƒ¨åŠ å…¥è¦åˆ†æçš„æ–‡ä»¶åˆ—è¡¨ä¸­</h3><p>æŠŠ1ã€2æ‰¾åˆ°çš„æ–‡ä»¶éƒ½ä¸¢è¿›å»åˆ†æåˆ—è¡¨ä¸­<br>è¿™é‡Œç”¨freemarkerè¯­æ³•è¡¨è¾¾å¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="operator">&lt;</span>#list logFileNameSet <span class="keyword">as</span> logFile<span class="operator">&gt;</span></span><br><span class="line">   DBMS_LOGMNR.ADD_LOGFILE(LOGFILENAME <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;$&#123;logFile&#125;&#x27;</span><span class="operator">&lt;</span>#if logFile_index<span class="operator">=</span><span class="operator">=</span><span class="number">0</span><span class="operator">&gt;</span>,OPTIONS <span class="operator">=</span><span class="operator">&gt;</span> DBMS_LOGMNR.NEW<span class="operator">&lt;</span><span class="operator">/</span>#if<span class="operator">&gt;</span>);</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span>#list<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><h3 id="4-å¯åŠ¨logminer"><a href="#4-å¯åŠ¨logminer" class="headerlink" title="4. å¯åŠ¨logminer"></a>4. å¯åŠ¨logminer</h3><p>ç›´æ¥å¼€å§‹å³å¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">DBMS_LOGMNR.START_LOGMNR ( OPTIONS <span class="operator">=</span><span class="operator">&gt;</span> DBMS_LOGMNR.DICT_FROM_REDO_LOGS );</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-ä»è§†å›¾ä¸­æŸ¥è¯¢"><a href="#5-ä»è§†å›¾ä¸­æŸ¥è¯¢" class="headerlink" title="5. ä»è§†å›¾ä¸­æŸ¥è¯¢"></a>5. ä»è§†å›¾ä¸­æŸ¥è¯¢</h3><p>å¦‚ä¸‹ï¼Œä»v$logmnr_contents ä¸­æŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> v$logmnr_contents <span class="keyword">where</span> TABLE_NAME<span class="operator">=</span>? <span class="keyword">order</span> <span class="keyword">by</span> SCN <span class="keyword">asc</span></span><br></pre></td></tr></table></figure><h3 id="6-é€€å‡ºlogminer"><a href="#6-é€€å‡ºlogminer" class="headerlink" title="6. é€€å‡ºlogminer"></a>6. é€€å‡ºlogminer</h3><p>æ¯æ¬¡åˆ†æåªå¯¹å½“å‰ä¼šè¯æœ‰æ•ˆï¼Œä¼šè¯å…³é—­åè‡ªåŠ¨é€€å‡ºlogminerã€‚å»ºè®®æ‰‹åŠ¨å…³é—­</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">DBMS_LOGMNR.END_LOGMNR();</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
            <tag> logminer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetesåº”ç”¨ä¸­ä½¿ç”¨TLS(SSL)è¯ä¹¦çš„ä¸¤ç§æ–¹æ³•åŠå®è·µ</title>
      <link href="//kubernetes-tls-ssl-certificates/"/>
      <url>//kubernetes-tls-ssl-certificates/</url>
      
        <content type="html"><![CDATA[<p>åœ¨k8såº”ç”¨æ³¨å…¥è‡ªç­¾å‘çš„TLS/SSLè¯ä¹¦æœ‰ä¸¤ç§æ€è·¯ï¼š1.ä½¿ç”¨certificates.k8s.io API è¿›è¡Œç­¾å‘ã€‚2. ç›´æ¥åˆ©ç”¨è‡ªå·±çš„CAè¯ä¹¦è¿›è¡Œç­¾å‘ã€‚ä¸€èˆ¬æ¨èç¬¬äºŒç§æ–¹æ³•ï¼Œæœ¬æ–‡è®°å½•äº†ä¸¤ç§æ–¹æ³•çš„å®Œæ•´å®è·µå¹¶æœ€åå°†å…¶è½¬æ¢ä¸ºJAVAçš„ä½¿ç”¨æ ¼å¼ã€‚</p><span id="more"></span><h2 id="é›¶-å‰è¨€"><a href="#é›¶-å‰è¨€" class="headerlink" title="é›¶ å‰è¨€"></a>é›¶ å‰è¨€</h2><h3 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h3><p>é˜…è¯»é¡ºåºå‚ç…§ä¸‹å›¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A[ peer-config.json] --&gt; C[ ca.pem]</span><br><span class="line">C</span><br><span class="line">C --&gt; D( k8s API)</span><br><span class="line">C --&gt; E( ç›´æ¥ç­¾å‘)</span><br></pre></td></tr></table></figure><h3 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h3><p>ç›´æ¥ç­¾å‘æ–¹å¼æ˜¯ä¼ ç»Ÿæ–¹å¼ï¼Œåªä¸è¿‡æ˜¯ä½¿ç”¨äº†secretæŠ€æœ¯è¿›è¡Œä¼ é€’è€Œå·²ï¼ˆæ¢æˆnfsä¹Ÿå¯ä»¥ï¼‰ï¼Œæœ¬èº«ä¸k8sæ²¡æœ‰å…³ç³»<br>certificates.k8s.io API æ–¹å¼ä¸€èˆ¬ç”¨äºkuberneteså†…éƒ¨ç»„ä»¶ï¼Œä¸€èˆ¬ä¸å»ºè®®ä¸ä¸šåŠ¡ç³»ç»Ÿè€¦åˆã€‚</p><h2 id="ä¸€-åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚é…ç½®ï¼ˆpeer-config-jsonï¼‰"><a href="#ä¸€-åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚é…ç½®ï¼ˆpeer-config-jsonï¼‰" class="headerlink" title="ä¸€ åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚é…ç½®ï¼ˆpeer-config.jsonï¼‰"></a>ä¸€ åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚é…ç½®ï¼ˆpeer-config.jsonï¼‰</h2><p>è¿™ä¸ªä¸œè¥¿ç”¨äºç¡®å®šæœ€ç»ˆç­¾å‘çš„ç›®æ ‡è¯ä¹¦çš„å†…å®¹ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š<br>è¿™ä¸ªé…ç½®ç”Ÿæˆçš„è¯ä¹¦å¯ç”¨äºlinshenkx.comåšhttpsç”¨ï¼ˆå»ºè®®hostsæŠŠå¯èƒ½ç”¨åˆ°çš„éƒ½å†™ä¸Šï¼Œç‰¹åˆ«æ˜¯ä¸€ä¸ªè¯ä¹¦ç»™å¤šä¸ªèŠ‚ç‚¹ç”¨çš„æƒ…å†µï¼Œå¦åˆ™ä»¥åç”¨çš„æ—¶å€™ä¼šæœ‰è¯ä¹¦hostnameä¸åŒ¹é…çš„è­¦å‘Šï¼‰</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;hosts&quot;:</span> [</span><br><span class="line">    <span class="string">&quot;linshenkx.com&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;CN&quot;:</span> <span class="string">&quot;linshenkx&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;key&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;algo&quot;:</span> <span class="string">&quot;ecdsa&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;size&quot;:</span> <span class="number">256</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="äºŒ-è·å–CAè¯ä¹¦ï¼ˆca-pemï¼‰"><a href="#äºŒ-è·å–CAè¯ä¹¦ï¼ˆca-pemï¼‰" class="headerlink" title="äºŒ è·å–CAè¯ä¹¦ï¼ˆca.pemï¼‰"></a>äºŒ è·å–CAè¯ä¹¦ï¼ˆca.pemï¼‰</h2><h3 id="1-å‡†å¤‡å¥½opensslå·¥å…·"><a href="#1-å‡†å¤‡å¥½opensslå·¥å…·" class="headerlink" title="1. å‡†å¤‡å¥½opensslå·¥å…·"></a>1. å‡†å¤‡å¥½opensslå·¥å…·</h3><p>ä¸‹è½½åŠä½¿ç”¨å‚è€ƒï¼š<a href="https://kubernetes.io/zh/docs/concepts/cluster-administration/certificates/#cfssl">https://kubernetes.io/zh/docs/concepts/cluster-administration/certificates/#cfssl</a><br>å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 -o cfssl</span><br><span class="line">curl -L https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64 -o cfssljson</span><br><span class="line">curl -L https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64 -o cfssl-certinfo</span><br><span class="line">mv cfssl* /usr/local/bin/</span><br><span class="line">chmod +x /usr/local/bin/cfssl*</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-åˆ›å»º-CAè¯ä¹¦ç­¾åç”³è¯·-é…ç½®æ–‡ä»¶ï¼ˆca-csr-config-jsonï¼‰"><a href="#2-åˆ›å»º-CAè¯ä¹¦ç­¾åç”³è¯·-é…ç½®æ–‡ä»¶ï¼ˆca-csr-config-jsonï¼‰" class="headerlink" title="2. åˆ›å»º CAè¯ä¹¦ç­¾åç”³è¯· é…ç½®æ–‡ä»¶ï¼ˆca-csr-config.jsonï¼‰"></a>2. åˆ›å»º CAè¯ä¹¦ç­¾åç”³è¯· é…ç½®æ–‡ä»¶ï¼ˆca-csr-config.jsonï¼‰</h3><p>è¿™ä¸ªä¸œè¥¿å³ä»£è¡¨CAæœ¬èº«çš„æ¦‚å¿µï¼Œå¯ç”¨äºç”ŸæˆCAçš„å…¬é’¥å¯†é’¥ã€‚<br>ä½¿ç”¨ <code>cfssl print-defaults csr &gt; ca-csr-config.json</code> å¯è·å–é»˜è®¤é…ç½®å¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;CN&quot;:</span> <span class="string">&quot;example.net&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;hosts&quot;:</span> [</span><br><span class="line">        <span class="string">&quot;example.net&quot;</span>,</span><br><span class="line">        <span class="string">&quot;www.example.net&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;key&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;algo&quot;:</span> <span class="string">&quot;ecdsa&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;size&quot;:</span> <span class="number">256</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;names&quot;:</span> [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;C&quot;:</span> <span class="string">&quot;US&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;L&quot;:</span> <span class="string">&quot;CA&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;ST&quot;:</span> <span class="string">&quot;San Francisco&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®éœ€æ±‚å»é…ç½®ï¼Œå‚è€ƒå¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;CN&quot;:</span> <span class="string">&quot;LinShen Self Signed Ca&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;key&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;algo&quot;:</span> <span class="string">&quot;rsa&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;size&quot;:</span> <span class="number">2048</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;names&quot;:</span> [&#123;</span><br><span class="line">    <span class="attr">&quot;C&quot;:</span> <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;ST&quot;:</span> <span class="string">&quot;GD&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;L&quot;:</span> <span class="string">&quot;GZ&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;O&quot;:</span> <span class="string">&quot;LinShen&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;OU&quot;:</span> <span class="string">&quot;LS&quot;</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-ç”Ÿæˆ-CAå¯†é’¥åŠè¯ä¹¦"><a href="#3-ç”Ÿæˆ-CAå¯†é’¥åŠè¯ä¹¦" class="headerlink" title="3. ç”Ÿæˆ CAå¯†é’¥åŠè¯ä¹¦"></a>3. ç”Ÿæˆ CAå¯†é’¥åŠè¯ä¹¦</h3><p>æœ‰äº†CAçš„CSRé…ç½®å°±å¯ä»¥ç”ŸæˆCAå¯†é’¥åŠè¯ä¹¦äº†<br>ç”Ÿæˆca.pem(CAè¯ä¹¦ï¼Œå«å…¬é’¥)ã€ca.csrï¼ˆæ­¥éª¤2å¯¹åº”çš„csrï¼Œæ²¡ä»€ä¹ˆç”¨äº†ï¼‰ã€ca-key.pem(CAç§é’¥,éœ€å¦¥å–„ä¿ç®¡)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert -initca ca-csr-config.json | cfssljson -bare ca -</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200826234715284.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="ç”Ÿæˆ CAå¯†é’¥åŠè¯ä¹¦"></p><p>ä½¿ç”¨æ€è·¯1è½¬ä¸€ï¼Œæ€è·¯2è½¬äºŒ</p><h2 id="ä¸‰-certificates-k8s-io-API"><a href="#ä¸‰-certificates-k8s-io-API" class="headerlink" title="ä¸‰ certificates.k8s.io API"></a>ä¸‰ certificates.k8s.io API</h2><h3 id="ç­¾å‘"><a href="#ç­¾å‘" class="headerlink" title="ç­¾å‘"></a>ç­¾å‘</h3><p>ä¸»è¦å‚è€ƒï¼š<a href="https://kubernetes.io/docs/tasks/tls/managing-tls-in-a-cluster">https://kubernetes.io/docs/tasks/tls/managing-tls-in-a-cluster</a></p><h4 id="1-é…ç½®kubernetesä½¿ç”¨è‡ªå®šä¹‰çš„CAæ ¹è¯ä¹¦"><a href="#1-é…ç½®kubernetesä½¿ç”¨è‡ªå®šä¹‰çš„CAæ ¹è¯ä¹¦" class="headerlink" title="1 é…ç½®kubernetesä½¿ç”¨è‡ªå®šä¹‰çš„CAæ ¹è¯ä¹¦"></a>1 é…ç½®kubernetesä½¿ç”¨è‡ªå®šä¹‰çš„CAæ ¹è¯ä¹¦</h4><p>kube-controller-managerå·²ç»æœ‰äº†ä¸€ä¸ªé»˜è®¤çš„å®ç°äº†ï¼Œå¦‚æœæƒ³ä½¿ç”¨ä¸Šæ–‡ä¸­æˆ‘ä»¬åˆ›å»ºçš„CAè¯ä¹¦ä½œä¸ºé›†ç¾¤çš„æ ¹è¯ä¹¦ï¼Œåˆ™å¯å¦‚ä¸‹ï¼š<br>Kubernetes æä¾›äº†ä¸€ä¸ª certificates.k8s.io APIï¼Œå¯ä»¥ä½¿ç”¨é…ç½®çš„ CA æ ¹è¯ä¹¦æ¥ç­¾å‘ç”¨æˆ·è¯ä¹¦ã€‚è¯¥ API ç”± kube-controller-manager å®ç°ï¼Œå…¶ç­¾å‘è¯ä¹¦ä½¿ç”¨çš„æ ¹è¯ä¹¦åœ¨ä¸‹é¢çš„å‘½ä»¤è¡Œä¸­è¿›è¡Œé…ç½®ã€‚æˆ‘ä»¬å¸Œæœ› Kubernetes é‡‡ç”¨é›†ç¾¤æ ¹ CA æ¥ç­¾å‘ç”¨æˆ·è¯ä¹¦ï¼Œå› æ­¤åœ¨ kube-controller-manager çš„å‘½ä»¤è¡Œå‚æ•°ä¸­å°†ç›¸å…³å‚æ•°é…ç½®ä¸ºäº†é›†ç¾¤æ ¹ CAã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/bin/kube-controller-manager \\</span><br><span class="line">--cluster-signing-cert-file=ca.pem             # ç”¨äºç­¾å‘è¯ä¹¦çš„ CA æ ¹è¯ä¹¦</span><br><span class="line">--cluster-signing-key-file=ca-key.pem          # ç”¨äºç­¾å‘è¯ä¹¦çš„ CA æ ¹è¯ä¹¦çš„ç§é’¥  </span><br><span class="line">--experimental-cluster-signing-duration=438000h # æ‰€ç­¾ç½²çš„è¯ä¹¦çš„æœ‰æ•ˆæœŸæ—¶é•¿ã€‚(é»˜è®¤å€¼ï¼šé»˜è®¤å€¼ï¼š8760h0m0s å³ä¸€å¹´)</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æ›´å¤šå‚æ•°å‚è€ƒï¼šhttps://kubernetes.io/zh/docs/reference/command-line-tools-reference/kube-controller-manager/</span></span></span><br></pre></td></tr></table></figure><h4 id="2-åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚"><a href="#2-åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚" class="headerlink" title="2 åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚"></a>2 åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚</h4><p>æ ¹æ®æµç¨‹ä¸€çš„é…ç½®ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆç§é’¥å’Œè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆæˆ–CSRï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cfssl genkey ./peer-config.json | cfssljson -bare peer</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆæ–‡ä»¶æœ‰ peer-key.pemï¼ˆç§é’¥ï¼Œè‡ªå·±å…ˆç•™ç€ï¼‰åŠpeer.csrï¼ˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼Œç”¨äºä¸‹ä¸€æ­¥ç”³è¯·è¯ä¹¦ï¼‰<br><img src="https://img-blog.csdnimg.cn/20200827210639951.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚"></p><h4 id="3-åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚å¯¹è±¡å¹¶å‘é€åˆ°-Kubernetes-API"><a href="#3-åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚å¯¹è±¡å¹¶å‘é€åˆ°-Kubernetes-API" class="headerlink" title="3 åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚å¯¹è±¡å¹¶å‘é€åˆ° Kubernetes API"></a>3 åˆ›å»ºè¯ä¹¦ç­¾åè¯·æ±‚å¯¹è±¡å¹¶å‘é€åˆ° Kubernetes API</h4><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»º CSR yaml æ–‡ä»¶ï¼Œå¹¶å‘é€åˆ° API serverï¼š<br>ä¸‹é¢å‘½ä»¤çš„ä½œç”¨ä¸º å°†ä¸Šä¸€æ­¥peer.csrçš„å†…å®¹ç”¨base64å°è£…åœ¨ä¸€ä¸ªCertificateSigningRequestå¯¹è±¡é‡Œé¢ã€‚<br>å…¶ä¸­usagesè¯¦ç»†é€‰é¡¹å‚ç…§ï¼š<a href="https://godoc.org/k8s.io/api/certificates/v1beta1#KeyUsage">https://godoc.org/k8s.io/api/certificates/v1beta1#KeyUsage</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;<span class="string">EOF | kubectl create -f -</span></span><br><span class="line"><span class="string">apiVersion: certificates.k8s.io/v1beta1</span></span><br><span class="line"><span class="string">kind: CertificateSigningRequest</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: peer</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  groups:</span></span><br><span class="line"><span class="string">  - system:authenticated</span></span><br><span class="line"><span class="string">  request: $(cat peer.csr | base64 | tr -d &#x27;\n&#x27;)</span></span><br><span class="line"><span class="string">  usages:</span></span><br><span class="line"><span class="string">  - digital signature</span></span><br><span class="line"><span class="string">  - key encipherment</span></span><br><span class="line"><span class="string">  - server auth</span></span><br><span class="line"><span class="string">  - client auth</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæ¯•ä¼šæé†’ï¼š<code> certificatesigningrequest.certificates.k8s.io/peer created </code></p><h4 id="4-åŒæ„è¯ä¹¦ç­¾åè¯·æ±‚"><a href="#4-åŒæ„è¯ä¹¦ç­¾åè¯·æ±‚" class="headerlink" title="4. åŒæ„è¯ä¹¦ç­¾åè¯·æ±‚"></a>4. åŒæ„è¯ä¹¦ç­¾åè¯·æ±‚</h4><p>è¿™ä¸€æ­¥åº”è¯¥ç­‰å¾…é›†ç¾¤ç®¡ç†å‘˜æ¥åšçš„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl certificate approve peer</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæ¯•ä¼šæé†’ï¼š <code>certificatesigningrequest.certificates.k8s.io/peer approved</code></p><h4 id="5-å¯¼å‡ºè¯ä¹¦"><a href="#5-å¯¼å‡ºè¯ä¹¦" class="headerlink" title="5. å¯¼å‡ºè¯ä¹¦"></a>5. å¯¼å‡ºè¯ä¹¦</h4><p>é€šè¿‡åå°±å¯ä»¥å¯¼å‡ºæˆpemè¯ä¹¦äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get csr peer -o jsonpath=<span class="string">&#x27;&#123;.status.certificate&#125;&#x27;</span> \</span><br><span class="line">| base64 -d &gt; peer-cert.pem</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¶å®æ¥åˆ°è¿™ä¸€æ­¥å°±è¡Œäº†ï¼Œè¯ä¹¦å·²ç»ç­¾å‘å®Œæ¯•å¹¶ä¸”æ‹¿åˆ°æ‰‹äº†ï¼Œå¯ä»¥çœ‹åˆ°peerç›¸å…³çš„æœ‰4ä¸ªæ–‡ä»¶ï¼š<br>peer-config.json ã€peer.csr ç”¨äºè¯·æ±‚è¯ä¹¦ç­¾åï¼Œå¯åˆ é™¤<br>peer-key.pemä¸ºç§é’¥ï¼Œpeer-cert.pemä¸ºè¢«ç­¾å‘çš„è¯ä¹¦ï¼ˆå«å…¬é’¥ï¼‰<br><img src="https://img-blog.csdnimg.cn/20200827212050426.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="å¯¼å‡ºè¯ä¹¦"></p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>åœ¨kuberneteså†…ä½¿ç”¨éœ€å°†è¯ä¹¦æ–‡ä»¶peer-cert.pemå’Œç§é’¥peer-key.pemå°è£…æˆsecretä¼ é€’è¿›å»</p><h4 id="1-åˆ›å»ºsecret"><a href="#1-åˆ›å»ºsecret" class="headerlink" title="1 åˆ›å»ºsecret"></a>1 åˆ›å»ºsecret</h4><p>å‘½ä»¤å‚è€ƒè‡ªï¼š<a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands">https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands</a><br><code>$ kubectl create tls NAME --cert=path/to/cert/file --key=path/to/key/file [--dry-run=server|client|none]</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret tls peer --cert peer-cert.pem --key peer-key.pem</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œsecreté‡Œé¢çš„ç§é’¥åŠè¯ä¹¦ä¸ºtls.keyï¼Œtls.crt<br><img src="https://img-blog.csdnimg.cn/20200827220952946.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="åˆ›å»ºsecret"></p><h4 id="2-æŒ‚è½½secret"><a href="#2-æŒ‚è½½secret" class="headerlink" title="2 æŒ‚è½½secret"></a>2 æŒ‚è½½secret</h4><p>ä»¥ä¸‹å‘½ä»¤å°†secret peeræŒ‚è½½åˆ°/tmp/tls_secretä¸‹ï¼Œè€ŒCAè¯ä¹¦ä¼šè‡ªåŠ¨åŠ è½½åˆ°podçš„/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tls-secret</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/tmp/tls_secret</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tls-secret</span></span><br><span class="line">    <span class="attr">secret:</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">peer</span></span><br></pre></td></tr></table></figure><p>ç»¼ä¸Šï¼Œpodé‡Œæœ‰ç­¾å‘è¯ä¹¦ï¼ˆtls.crtï¼‰åŠå…¶ç§é’¥(tls.key)ï¼Œå’ŒCAæ ¹è¯ä¹¦(ca.crt)ï¼Œå·²å¯ç”¨äºä¸šåŠ¡ç³»ç»Ÿçš„tlsè®¤è¯ã€‚</p><h2 id="å››-ç›´æ¥ç­¾å‘"><a href="#å››-ç›´æ¥ç­¾å‘" class="headerlink" title="å›› ç›´æ¥ç­¾å‘"></a>å›› ç›´æ¥ç­¾å‘</h2><p>æµ‹è¯•çš„æ—¶å€™è®°å¾—æŠŠæ–¹æ³•ä¸€äº§ç”Ÿçš„peerç›¸å…³æ–‡ä»¶ç§»é™¤æ‰ï¼Œç•™ä¸‹peer-config.jsonå°±å¥½</p><h3 id="ç­¾å‘-1"><a href="#ç­¾å‘-1" class="headerlink" title="ç­¾å‘"></a>ç­¾å‘</h3><h4 id="1-åˆ›å»º-CAè¯ä¹¦-é…ç½®æ–‡ä»¶ï¼ˆca-config-jsonï¼‰"><a href="#1-åˆ›å»º-CAè¯ä¹¦-é…ç½®æ–‡ä»¶ï¼ˆca-config-jsonï¼‰" class="headerlink" title="1 åˆ›å»º CAè¯ä¹¦ é…ç½®æ–‡ä»¶ï¼ˆca-config.jsonï¼‰"></a>1 åˆ›å»º CAè¯ä¹¦ é…ç½®æ–‡ä»¶ï¼ˆca-config.jsonï¼‰</h4><p>è¿™ä¸ªä¸œè¥¿ç”¨äºä»¥åç­¾å‘CAè¯ä¹¦æ—¶çš„é…ç½®ï¼ˆæ¯”åˆ†è¯´è¯ä¹¦æœ‰æ•ˆæœŸ/ç”¨é€” ä¹‹ç±»ï¼‰<br>åŒæ ·ï¼Œä½¿ç”¨<code>cfssl print-defaults config &gt; ca-config.json</code>å¯è·å–é»˜è®¤é…ç½®ï¼Œå¦‚ä¸‹<br>å¦‚æœç­¾å‘è¯ä¹¦çš„æ—¶å€™ä¸æŒ‡å®šprofileï¼Œåˆ™è¯ä¹¦æœ‰æ•ˆæœŸåªæœ‰ä¸€å‘¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;signing&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;default&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;expiry&quot;:</span> <span class="string">&quot;168h&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;profiles&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;www&quot;:</span> &#123;</span><br><span class="line">                <span class="attr">&quot;expiry&quot;:</span> <span class="string">&quot;8760h&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;usages&quot;:</span> [</span><br><span class="line">                    <span class="string">&quot;signing&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;key encipherment&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;server auth&quot;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;client&quot;:</span> &#123;</span><br><span class="line">                <span class="attr">&quot;expiry&quot;:</span> <span class="string">&quot;8760h&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;usages&quot;:</span> [</span><br><span class="line">                    <span class="string">&quot;signing&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;key encipherment&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;client auth&quot;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘çš„é…ç½®å‚è€ƒå¦‚ä¸‹ï¼š<br>æŒ‰æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯åŠåŒå‘è®¤è¯è¿›è¡Œåˆ†ç±»ï¼Œä¸”æœ‰æ•ˆæœŸä¸º50å¹´ï¼ˆæŒ‰365å¤©ç®—ï¼‰</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;signing&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;default&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;expiry&quot;:</span> <span class="string">&quot;438000h&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;profiles&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;server&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;expiry&quot;:</span> <span class="string">&quot;438000h&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;usages&quot;:</span> [</span><br><span class="line">          <span class="string">&quot;signing&quot;</span>,</span><br><span class="line">          <span class="string">&quot;key encipherment&quot;</span>,</span><br><span class="line">          <span class="string">&quot;server auth&quot;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;client&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;expiry&quot;:</span> <span class="string">&quot;438000h&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;usages&quot;:</span> [</span><br><span class="line">          <span class="string">&quot;signing&quot;</span>,</span><br><span class="line">          <span class="string">&quot;key encipherment&quot;</span>,</span><br><span class="line">          <span class="string">&quot;client auth&quot;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;peer&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;expiry&quot;:</span> <span class="string">&quot;438000h&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;usages&quot;:</span> [</span><br><span class="line">          <span class="string">&quot;signing&quot;</span>,</span><br><span class="line">          <span class="string">&quot;key encipherment&quot;</span>,</span><br><span class="line">          <span class="string">&quot;server auth&quot;</span>,</span><br><span class="line">          <span class="string">&quot;client auth&quot;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-ç”Ÿæˆè¯ä¹¦å’Œç§é’¥"><a href="#2-ç”Ÿæˆè¯ä¹¦å’Œç§é’¥" class="headerlink" title="2 ç”Ÿæˆè¯ä¹¦å’Œç§é’¥"></a>2 ç”Ÿæˆè¯ä¹¦å’Œç§é’¥</h4><p>è¿™é‡Œæ€»å…±ç”¨åˆ°4ä¸ªæ–‡ä»¶ï¼Œæ„æ€ä¸º<br>ä½¿ç”¨caå…¬å¯†é’¥ï¼ˆå³ä»£è¡¨caæœ¬èº«ï¼‰æ ¹æ®ca-config.json(å³è¯ä¹¦ç­¾åçš„é…ç½®)ä»¥å…¶ä¸­peerçš„profileé…ç½®ä¸ºpeer-config.jsonä»£è¡¨çš„å¯¹è±¡ç­¾å‘åä¸ºpeerçš„è¯ä¹¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=peer peer-config.json | cfssljson -bare peer</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¤šå‡ºäº†3ä¸ªæ–‡ä»¶ï¼š<br>peer.csr : è¯ä¹¦ç­¾åè¯·æ±‚ï¼Œæ²¡ç”¨äº†<br>peer.pem : è¯ä¹¦ï¼ˆå…¬é’¥ï¼‰<br>peer-key.pem : ç§é’¥<br>è‡³æ­¤è¯ä¹¦å³ç­¾å‘å®Œæ¯•äº†<br><img src="https://img-blog.csdnimg.cn/20200827223420525.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="ç”Ÿæˆè¯ä¹¦åŠç§é’¥"></p><h3 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><h4 id="1-åˆ›å»ºsecret-1"><a href="#1-åˆ›å»ºsecret-1" class="headerlink" title="1 åˆ›å»ºsecret"></a>1 åˆ›å»ºsecret</h4><p>ç”±äºæ˜¯ç›´æ¥ä½¿ç”¨æˆ‘ä»¬çš„ca.pemã€ca-key.pemè¿›è¡Œç­¾å‘çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ˜¯å·²ç»æ‹¥æœ‰ca.pemã€peer-key.pemã€peer.pemä¸‰ä»¶å¥—äº†ï¼Œè¿™é‡Œè®²ä¸€ä¸‹å°†è¿™ä¸‰ä¸ªæ–‡ä»¶ä¼ é€’åˆ°podé‡Œé¢ã€‚<br>è¿™é‡Œå¯ä»¥è§†ä¸ºæ™®é€šçš„å°†æ–‡ä»¶ä¼ é€’åˆ°podé‡Œé¢ï¼Œå‚è€ƒ <a href="https://kubernetes.io/zh/docs/concepts/configuration/secret/">https://kubernetes.io/zh/docs/concepts/configuration/secret/</a> ä»æ–‡ä»¶ç”Ÿæˆsecret<br>kubectl apply -k ä½¿ç”¨æ–¹æ³•å‚è€ƒï¼š <a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands">https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands</a></p><p>è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mkdir kustomization &amp;&amp; cp peer.pem peer-key.pem ca.pem kustomization </span><br><span class="line">cd kustomization</span><br><span class="line">cat &lt;&lt;EOF &gt;./kustomization.yaml</span><br><span class="line">secretGenerator:</span><br><span class="line">- name: peer-ca</span><br><span class="line">  files:</span><br><span class="line">  - peer.pem</span><br><span class="line">  - peer-key.pem</span><br><span class="line">  - ca.pem</span><br><span class="line">EOF</span><br><span class="line">cd ..</span><br><span class="line">kubectl apply -k kustomization </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„secretåå­—æ˜¯éšæœºçš„ï¼Œéœ€è¦è‡ªå·±è®°ä¸‹æ¥<br><img src="https://img-blog.csdnimg.cn/20200827224758858.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="åˆ›å»ºsecret"></p><h4 id="2-æŒ‚è½½secret-1"><a href="#2-æŒ‚è½½secret-1" class="headerlink" title="2 æŒ‚è½½secret"></a>2 æŒ‚è½½secret</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tls-secret</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/tmp/tls_secret</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tls-secret</span></span><br><span class="line">    <span class="attr">secret:</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">peer-ca-dg97cgfkgg</span></span><br></pre></td></tr></table></figure><p>ç»¼ä¸Šï¼Œpodé‡Œæœ‰ç­¾å‘è¯ä¹¦ï¼ˆpeer.pemï¼‰åŠå…¶ç§é’¥(peer-key.pem)ï¼Œå’ŒCAæ ¹è¯ä¹¦(ca.pem)ï¼Œå·²å¯ç”¨äºä¸šåŠ¡ç³»ç»Ÿçš„tlsè®¤è¯ã€‚</p><h2 id="äº”-ä¸šåŠ¡ç³»ç»Ÿä½¿ç”¨ï¼ˆHADOOP-JAVAä¸ºä¾‹ï¼‰"><a href="#äº”-ä¸šåŠ¡ç³»ç»Ÿä½¿ç”¨ï¼ˆHADOOP-JAVAä¸ºä¾‹ï¼‰" class="headerlink" title="äº” ä¸šåŠ¡ç³»ç»Ÿä½¿ç”¨ï¼ˆHADOOP-JAVAä¸ºä¾‹ï¼‰"></a>äº” ä¸šåŠ¡ç³»ç»Ÿä½¿ç”¨ï¼ˆHADOOP-JAVAä¸ºä¾‹ï¼‰</h2><p>è¯¥è„šæœ¬å°†æ ¹æ®TLS_KEYã€TLS_CRTã€CA_CRTç”ŸæˆJavaç”¨çš„keystoreè¯ä¹¦åˆ°TARGET_DIRç›®å½•ä¸‹ï¼Œå¦å¤–è¿˜å°†<br>è„šæœ¬è§£é‡Šï¼š</p><ol><li>ä½¿ç”¨openssl å°†pemæ ¼å¼çš„è¯ä¹¦å…ˆè½¬æˆPKCS12å†è½¬æˆJKS æ ¼å¼<br>TLS_KEYã€TLS_CRT =&gt; DEST_KEYSTORE<br>å‚è€ƒè‡ªï¼š<a href="https://docs.cloudera.com/documentation/enterprise/5-10-x/topics/cm_sg_openssl_jks.html">https://docs.cloudera.com/documentation/enterprise/5-10-x/topics/cm_sg_openssl_jks.html</a></li><li>CA_CRT =&gt; TRUST_KEYSTORE<br>ä½¿ç”¨ keytool -import å°†CAè¯ä¹¦å¯¼å…¥è‡ªå®šä¹‰JKS æ–‡ä»¶å’ŒJDKçš„JKSæ–‡ä»¶ã€‚</li></ol><p>å¦å¤–éœ€è¦æ³¨æ„ï¼Œå¦‚æœä¸åŒJDKç‰ˆæœ¬çš„ cacerts ä½ç½®æ˜¯ä¸ä¸€æ ·çš„ï¼š<br>1.8åŠä»¥ä¸‹ï¼š<code>$JAVA_HOME/jre/lib/security/cacerts</code><br>9åŠä»¥ä¸Šï¼š<code>$JAVA_HOME/lib/security/cacerts </code><br>æœ‰ç©ºå†æ”¹ä¸€ä¸‹è„šæœ¬å†™æˆé€šç”¨çš„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">   #</span><span class="bash">!/bin/bash</span></span><br><span class="line">   set -e</span><br><span class="line">   </span><br><span class="line"><span class="meta">   #</span><span class="bash"> ä½¿ç”¨certificates.k8s.io APIæ–¹å¼</span></span><br><span class="line">   TLS_KEY=/tmp/tls_secret/tls.key</span><br><span class="line">   TLS_CRT=/tmp/tls_secret/tls.crt</span><br><span class="line">   CA_CRT=/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span><br><span class="line"></span><br><span class="line"><span class="meta">   #</span><span class="bash"> ä½¿ç”¨ç›´æ¥ç­¾å‘æ–¹å¼</span></span><br><span class="line"><span class="meta">   #</span><span class="bash"> TLS_KEY=/tmp/tls_secret/peer.pem</span></span><br><span class="line"><span class="meta">   #</span><span class="bash"> TLS_CRT=/tmp/tls_secret/peer-key.pem</span></span><br><span class="line"><span class="meta">   #</span><span class="bash"> CA_CRT=/tmp/tls_secret/ca.pem</span></span><br><span class="line"></span><br><span class="line">   PASSWORD=1qaz@WSX</span><br><span class="line">   TARGET_DIR=/keystore</span><br><span class="line">   PKCS12_OUTPUT=$TARGET_DIR/keystore.pkcs12</span><br><span class="line">   DEST_KEYSTORE=$TARGET_DIR/my.jks</span><br><span class="line">   TRUST_KEYSTORE=$TARGET_DIR/my-truststore.jks</span><br><span class="line">   </span><br><span class="line">   ALIAS_NAME=&quot;service&quot;</span><br><span class="line"></span><br><span class="line">mkdir -p $TARGET_DIR</span><br><span class="line">   openssl &quot;pkcs12&quot; -export -inkey &quot;$&#123;TLS_KEY&#125;&quot; -in &quot;$&#123;TLS_CRT&#125;&quot; -out &quot;$&#123;PKCS12_OUTPUT&#125;&quot; -password &quot;pass:$&#123;PASSWORD&#125;&quot;</span><br><span class="line">   keytool -importkeystore -noprompt -srckeystore &quot;$&#123;PKCS12_OUTPUT&#125;&quot; -srcstoretype &quot;pkcs12&quot; -destkeystore &quot;$&#123;DEST_KEYSTORE&#125;&quot; -storepass &quot;$&#123;PASSWORD&#125;&quot; -srcstorepass &quot;$&#123;PASSWORD&#125;&quot;</span><br><span class="line"></span><br><span class="line">   csplit -z -f crt- $&#123;CA_CRT&#125; &#x27;/-----BEGIN CERTIFICATE-----/&#x27; &#x27;&#123;*&#125;&#x27;</span><br><span class="line"></span><br><span class="line">   for file in crt-*; do</span><br><span class="line">     keytool -import -noprompt -keystore &quot;$&#123;TRUST_KEYSTORE&#125;&quot; -file &quot;$&#123;file&#125;&quot; -storepass &quot;$&#123;PASSWORD&#125;&quot; -alias $&#123;ALIAS_NAME&#125;-$file;</span><br><span class="line">   done</span><br><span class="line">   for file in crt-*; do</span><br><span class="line">     keytool -import -noprompt -keystore $JAVA_HOME/jre/lib/security/cacerts -file &quot;$&#123;file&#125;&quot; -storepass &quot;changeit&quot; -alias $&#123;ALIAS_NAME&#125;-$file;</span><br><span class="line">     </span><br><span class="line">   done</span><br><span class="line">   rm -f crt-*</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Xloggcå®è·µï¼ˆJVM1.8åŠä¹‹å‰ï¼‰</title>
      <link href="//Xloggc/"/>
      <url>//Xloggc/</url>
      
        <content type="html"><![CDATA[<p>JavaæœåŠ¡å™¨è°ƒä¼˜å…ä¸äº†è¦å¯¹gcæ—¥å¿—è¿›è¡Œåˆ†æï¼Œæˆ‘ä¸€èˆ¬æ˜¯ä¸Šä¼ gcæ—¥å¿—æ–‡ä»¶åˆ°GCEasyè¿›è¡Œå¤„ç†çš„ï¼Œä¸Šä¼ çš„æ–‡ä»¶æœ‰å¤§å°é™åˆ¶ã€‚å¦å¤–é»˜è®¤çš„gcæ—¥å¿—æ‰“å°è¿˜ä¼šå­˜åœ¨é‡å¯åä¸¢å¤±çš„é—®é¢˜ã€‚ç»¼ä¸Šï¼Œæˆ‘ä»¬å¸Œæœ›gcæ—¥å¿—æ–‡ä»¶åœ¨ä¸èƒ½ä¸¢å¤±ï¼ˆä½†å…è®¸è¶…è¿‡ä¸€å®šæ—¶é—´æˆ–å¤§å°è¢«æ¸…ç†æ‰ï¼‰çš„æƒ…å†µä¸‹æ§åˆ¶gcæ—¥å¿—çš„å¤§å°æˆ–è€…æŒ‰æ—¶é—´åˆ‡å‰²ï¼Œå³åƒJavaæ—¥å¿—æ¡†æ¶é‚£æ ·çš„æ•ˆæœã€‚Java9å¯¹jvmçš„æ—¥å¿—ç³»ç»Ÿè¿›è¡Œäº†æ¯”è¾ƒå¤§çš„å‡çº§ï¼Œå¯ä»¥æ¯”è¾ƒå¥½çš„å®ç°è¿™äº›éœ€æ±‚ï¼Œä½†å¤§éƒ¨åˆ†æœåŠ¡ç«¯çš„Javaè½¯ä»¶è¿˜åªæ”¯æŒJdk8ï¼Œæœ¬æ–‡è®°å½•ä½œè€…è‡ªå·±çš„ç›¸å…³é…ç½®ã€‚</p><span id="more"></span><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>é¦–å…ˆæ¨èçœ‹ä¸¤ç¯‡gceasyçš„åšå®¢æ–‡ç« ï¼Œç½‘ä¸Šå¯¹UseGCLogFileRotationçš„ç›¸å…³è®¨è®ºå¾ˆå¤šéƒ½æ¥è‡ªäºè¿™é‡Œï¼š<br><a href="https://blog.gceasy.io/2016/11/15/rotating-gc-log-files/">https://blog.gceasy.io/2016/11/15/rotating-gc-log-files/</a><br><a href="https://blog.gceasy.io/2019/01/29/try-to-avoid-xxusegclogfilerotation/">https://blog.gceasy.io/2019/01/29/try-to-avoid-xxusegclogfilerotation/</a></p><p>ç®€å•æ¥è¯´ï¼ŒUseGCLogFileRotation å¯ä»¥æ§åˆ¶gcæ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œä¸”æŒ‰æ—¥æœŸåˆ†ç‰‡åˆ‡å‰²<br>ç¼ºç‚¹æ˜¯ï¼š</p><ol><li>è®°å½•ä¸¢å¤±<br>ä¸ªäººè®¤ä¸ºä¸æ˜¯é—®é¢˜ï¼Œè¶…è¿‡æŒ‡å®šæ–‡ä»¶æ•°é‡åŠå¤§å°çš„æ—¥å¿—è¢«ä¸¢å¼ƒæ˜¯é¢„æœŸæ“ä½œã€‚</li><li>å¾ªç¯æ‰“å°<br> è‹¥é™åˆ¶æ—¥å¿—æ–‡ä»¶æ•°å…±5ä¸ªï¼Œåˆ†åˆ«ä¸º0ã€1ã€2ã€3ã€4ï¼Œåœ¨æ–‡ä»¶4è¾¾åˆ°æ–‡ä»¶æœ€å¤§å€¼åç³»ç»Ÿå°†ä»1å¼€å§‹è¦†å†™ï¼Œæœ€ç»ˆçš„ç»“æœå°±æ˜¯é¡ºåºé”™ä¹±ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼ˆéœ€è¦äººä¸ºåœ°ä¿®æ”¹æ–‡ä»¶åä»¥ä¿®æ­£é¡ºåºï¼‰</li><li>é‡å¯åä»ç¼–å·0å¼€å§‹å†™å…¥ï¼Œè€Œéä¸Šæ¬¡çš„å†™å…¥ä½ç½®ã€‚ç»“åˆç¬¬2ç‚¹ä½ å°±ä¼šå‘ç°ä½ çš„æ—¥å¿—é¡ºåºå·²ç»å®Œå…¨ä¸å¯ä¿¡äº†ã€‚</li></ol><h3 id="åº”å¯¹æ–¹æ³•"><a href="#åº”å¯¹æ–¹æ³•" class="headerlink" title="åº”å¯¹æ–¹æ³•"></a>åº”å¯¹æ–¹æ³•</h3><ol start="0"><li>ç›´æ¥ä½¿ç”¨-Xloggc:gc-%t.logï¼ˆ<code>æ¨è</code>ï¼‰<br>ç®€å•ç²—æš´ï¼Œç¼ºç‚¹æ˜¯æ–‡ä»¶ä¾ç„¶å¤ªå¤§ï¼Œéœ€è¦ç”¨è‡ªå·±åˆ‡å‰²</li><li>ç»“åˆ-Xloggc:gc-%t.logä½¿ç”¨<br>ä½¿ç”¨ -Xloggc:gc-%t.logå¯ä»¥è§£å†³é—®é¢˜3ï¼Œä½†ä»å­˜åœ¨å¾ªç¯æ‰“å°ã€‚<ol><li>è®¾ç½®è¾ƒå¤§çš„æ–‡ä»¶æ•°é‡å’Œå¤§å°é™åˆ¶ï¼Œå°½é‡ä½¿å…¶ä¸äº§ç”Ÿå¾ªç¯æ‰“å°<br>ä¸Šé¢æ–‡ç« è®¨è®ºåŒºçš„ä¸€ä¸ªå°ä¼™ä¼´æå‡ºçš„ï¼Œå…¶å®ä¹Ÿæ˜¯ä¸ªåŠæ³•<br>ä»¥ä¸‹æ˜¯æˆ‘çš„æ—¥å¿—æ–‡ä»¶è¾“å‡ºæµ‹è¯•ï¼Œä¸åŒä¸€ä¸ªæ‰¹æ¬¡çš„æ–‡ä»¶æ•°é‡é™åˆ¶å¯èƒ½ä¸åŒï¼Œç”¨è“æ¡†éš”ç¦»ã€‚</li><li>æ‰‹åŠ¨è°ƒæ•´é¡ºåºï¼ˆå…¶å®ä¹Ÿä¸éº»çƒ¦ï¼‰ã€‚</li></ol></li><li>å¦‚æœæ˜¯ä¸šåŠ¡ç³»ç»Ÿçš„è¯ç›´æ¥ç”¨é«˜ç‰ˆæœ¬çš„jdkå§ï¼Œä¸ç”¨çœ‹è¿™ç¯‡æ–‡ç« äº†</li></ol><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>ï¼ˆä½¿ç”¨ä¸¤ä¸ªgcæ—¥å¿—æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶æœ€å¤§ä¸º1kï¼‰ï¼š<br>æ¯ä¸€ä¸ªæ‰¹æ¬¡éƒ½æœ‰ä¸€ä¸ªcurrentåç¼€çš„æ—¥å¿—æ–‡ä»¶æ ‡è¯†å½“å‰å†™å…¥ï¼ŒåŒä¸€æ‰¹æ¬¡çš„æ—¥å¿—æ–‡ä»¶ç”¨ä»0å¼€å§‹çš„åºå·åç¼€éš”å¼€ï¼Œé€šå¸¸currentåº”è¯¥åœ¨åºå·æœ€å¤§çš„ä½ç½®ï¼Œå¦‚æœä¸æ˜¯åˆ™è¯´æ˜å­˜åœ¨å¾ªç¯æ‰“å°çš„æƒ…å†µã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xmx60M -Xms60M -XX:+PrintGCDetails  -XX:+PrintGCDateStamps  -Xloggc:gc-%t.log  -XX:+UseGCLogFileRotation  -XX:NumberOfGCLogFiles=2  -XX:GCLogFileSize=1K</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200820003502171.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="æ—¥å¿—ç¤ºä¾‹"></p>]]></content>
      
      
      <categories>
          
          <category> åç«¯å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kafkaåŠ¨æ€è°ƒæ•´å‰¯æœ¬å› å­replication.factoråŠjsonç”Ÿæˆè„šæœ¬</title>
      <link href="//kafka_replication_factor/"/>
      <url>//kafka_replication_factor/</url>
      
        <content type="html"><![CDATA[<p>kafkaé»˜è®¤çš„å‰¯æœ¬å› å­default.replication.factoræ˜¯1ï¼Œå³æ— é¢å¤–å‰¯æœ¬ï¼Œå¦‚æœåœ¨åˆ›å»ºtopicæ—¶æ²¡æœ‰æŒ‡å®šå‰¯æœ¬æ•°ï¼Œåˆ™æ— é«˜å¯ç”¨æ€§ã€‚</p><span id="more"></span><h3 id="1-è¯´æ˜"><a href="#1-è¯´æ˜" class="headerlink" title="1. è¯´æ˜"></a>1. è¯´æ˜</h3><p>kafkaé»˜è®¤çš„å‰¯æœ¬å› å­default.replication.factoræ˜¯1ï¼Œå³æ— é¢å¤–å‰¯æœ¬ï¼Œå¦‚æœåœ¨åˆ›å»ºtopicæ—¶æ²¡æœ‰æŒ‡å®šå‰¯æœ¬æ•°ï¼Œåˆ™æ— é«˜å¯ç”¨æ€§ã€‚è¯¥å‚æ•°åœ¨topicåˆ›å»ºæ—¶ç”Ÿæ•ˆï¼Œtopicåˆ›å»ºåæ— æ³•ç›´æ¥å¯¹topicçº§åˆ«çš„å‰¯æœ¬æ•°è¿›è¡Œä¿®æ”¹ï¼Œä½†å®˜æ–¹æä¾›äº†åœ¨partitionçº§åˆ«å¢åŠ å‰¯æœ¬æ•°çš„åŠŸèƒ½ï¼Œç”¨äºé›†ç¾¤æ·»åŠ èŠ‚ç‚¹çš„æƒ…å†µã€‚<br>è¯¦æƒ…å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://kafka.apache.org/documentation/#basic_ops_increase_replication_factor">https://kafka.apache.org/documentation/#basic_ops_increase_replication_factor</a></p><p>ç®€å•æ¥è¯´å°±æ˜¯ä½¿ç”¨jsonæ–‡ä»¶æè¿°è¯¥topicæ¯ä¸€ä¸ªpartitionçš„æƒ…å†µï¼Œæ¯ä¸€ä¸ªpartitionåŒ…å«å‰¯æœ¬åˆ†å¸ƒçš„æè¿°ã€‚ç„¶åä½¿ç”¨ kafka-reassign-partitions.sh æ‰§è¡Œå®‰è£…jsonæ–‡ä»¶å®Œæˆå†åˆ†é…ä»»åŠ¡å³å¯ã€‚</p><h3 id="2-jsonç”Ÿæˆè„šæœ¬"><a href="#2-jsonç”Ÿæˆè„šæœ¬" class="headerlink" title="2. jsonç”Ÿæˆè„šæœ¬"></a>2. jsonç”Ÿæˆè„šæœ¬</h3><p>è¿™é‡Œæä¾›jsonçš„ç”Ÿæˆè„šæœ¬ï¼Œå‚è€ƒè‡ªï¼š<a href="https://github.com/dkurzaj/generate-kafka-replication-factor-json/blob/master/generate-kafka-replication-factor-json.sh">https://github.com/dkurzaj/generate-kafka-replication-factor-json/blob/master/generate-kafka-replication-factor-json.sh</a></p><p>å…¶ä¸­BROKER_IDSä¸ºè¦åˆ†é…çš„brokerId,<br>NUMBER_OF_PARTITIONSä¸ºtopicåˆ†åŒºæ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">BROKER_IDS=(1 2 3)</span><br><span class="line">NUMBER_OF_PARTITIONS=5</span><br><span class="line">TOPIC_NAME=__consumer_offsets</span><br><span class="line"></span><br><span class="line">output_file=&quot;increase-rf-json/increase-replication-factor-&quot;$&#123;TOPIC_NAME&#125;&quot;.json&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Beginning of the file</span></span><br><span class="line">echo &#x27;&#123;&quot;version&quot;:1,&#x27; &gt; $output_file</span><br><span class="line">echo &#x27;  &quot;partitions&quot;:[&#x27; &gt;&gt; $output_file</span><br><span class="line"></span><br><span class="line">current_broker_id_index=0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Responsible <span class="keyword">for</span> the circular array over the brokers IDs</span></span><br><span class="line">set_next_broker()&#123;</span><br><span class="line">    current_broker_id_index=$1</span><br><span class="line">    current_broker_id_index=$(($current_broker_id_index + 1))</span><br><span class="line">    current_broker_id_index=$(($current_broker_id_index % $&#123;#BROKER_IDS[@]&#125;))</span><br><span class="line">    return $current_broker_id_index</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Forges the string containing the replicas brokers of a partition</span></span><br><span class="line">get_brokers_string()&#123;</span><br><span class="line">    current_broker_id_index=$1</span><br><span class="line">    brokers_string=&quot;$&#123;BROKER_IDS[$current_broker_id_index]&#125;&quot;</span><br><span class="line">    set_next_broker $current_broker_id_index</span><br><span class="line">    current_broker_id_index=$?</span><br><span class="line">    brokers_string=&quot;$brokers_string,$&#123;BROKER_IDS[$current_broker_id_index]&#125;&quot;</span><br><span class="line">    set_next_broker $current_broker_id_index</span><br><span class="line">    current_broker_id_index=$?</span><br><span class="line">    brokers_string=&quot;$brokers_string,$&#123;BROKER_IDS[$current_broker_id_index]&#125;&quot;</span><br><span class="line">    set_next_broker $current_broker_id_index</span><br><span class="line">    current_broker_id_index=$?</span><br><span class="line">    echo $brokers_string</span><br><span class="line">    return $current_broker_id_index</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Create all the lines</span></span><br><span class="line">partition_number=0</span><br><span class="line">while ((&quot;$partition_number&quot; &lt; &quot;$NUMBER_OF_PARTITIONS-1&quot;)); do</span><br><span class="line">    brokers_string=$(get_brokers_string $current_broker_id_index)</span><br><span class="line">    current_broker_id_index=$?</span><br><span class="line">    echo &quot;    &#123;\&quot;topic\&quot;:\&quot;$TOPIC_NAME\&quot;,\&quot;partition\&quot;:$partition_number,\&quot;replicas\&quot;:[$brokers_string]&#125;,&quot; &gt;&gt; $output_file</span><br><span class="line">    partition_number=$(($partition_number + 1))</span><br><span class="line">done</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Last line without trailing coma</span></span><br><span class="line">brokers_string=$(get_brokers_string $current_broker_id_index)</span><br><span class="line">echo &quot;    &#123;\&quot;topic\&quot;:\&quot;$TOPIC_NAME\&quot;,\&quot;partition\&quot;:$partition_number,\&quot;replicas\&quot;:[$brokers_string]&#125;&quot; &gt;&gt; $output_file</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> End of the file</span></span><br><span class="line">echo &#x27;]&#125;&#x27; &gt;&gt; $output_file</span><br><span class="line"></span><br><span class="line">exit 0</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆjsonå†…å®¹å¦‚ä¸‹ï¼š<br>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯å¯¹partitionè€Œétopicçš„æè¿°</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;version&quot;</span>:<span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;partitions&quot;</span>:[</span><br><span class="line">    &#123;<span class="attr">&quot;topic&quot;</span>:<span class="string">&quot;__consumer_offsets&quot;</span>,<span class="attr">&quot;partition&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;replicas&quot;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]&#125;,</span><br><span class="line">    &#123;<span class="attr">&quot;topic&quot;</span>:<span class="string">&quot;__consumer_offsets&quot;</span>,<span class="attr">&quot;partition&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;replicas&quot;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]&#125;,</span><br><span class="line">    &#123;<span class="attr">&quot;topic&quot;</span>:<span class="string">&quot;__consumer_offsets&quot;</span>,<span class="attr">&quot;partition&quot;</span>:<span class="number">2</span>,<span class="attr">&quot;replicas&quot;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]&#125;,</span><br><span class="line">    &#123;<span class="attr">&quot;topic&quot;</span>:<span class="string">&quot;__consumer_offsets&quot;</span>,<span class="attr">&quot;partition&quot;</span>:<span class="number">3</span>,<span class="attr">&quot;replicas&quot;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]&#125;,</span><br><span class="line">    &#123;<span class="attr">&quot;topic&quot;</span>:<span class="string">&quot;__consumer_offsets&quot;</span>,<span class="attr">&quot;partition&quot;</span>:<span class="number">4</span>,<span class="attr">&quot;replicas&quot;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]&#125;</span><br><span class="line">]&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-ä¾‹å­"><a href="#3-ä¾‹å­" class="headerlink" title="3. ä¾‹å­"></a>3. ä¾‹å­</h3><p>ç”Ÿæˆåæ‰§è¡Œå‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼ˆä¹Ÿå¯ä½¿ç”¨zookeeperä»£æ›¿bootstrap-serverï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-reassign-partitions.sh --bootstrap-server localhost:9092 --reassignment-json-file increase-replication-factor.json --execute</span><br></pre></td></tr></table></figure><p>å®ä¾‹ï¼ˆæœ‰50ä¸ªpartitionï¼‰ï¼š<br><img src="https://img-blog.csdnimg.cn/20200819094107721.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="execute"></p><p>ä½¿ç”¨verifyä»£æ›¿executeå³å¯æŸ¥çœ‹æ‰§è¡Œè¿›åº¦<br><img src="https://img-blog.csdnimg.cn/20200819094400579.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70#pic_center" alt="verify"></p><h3 id="4-æ”¹è¿›æ–¹å‘"><a href="#4-æ”¹è¿›æ–¹å‘" class="headerlink" title="4. æ”¹è¿›æ–¹å‘"></a>4. æ”¹è¿›æ–¹å‘</h3><p>ç›®å‰çš„shellè„šæœ¬ç”Ÿæˆçš„partitionå‰¯æœ¬åˆ†å¸ƒå›ºå®šä¸º BROKER_IDS ï¼Œé€‚ç”¨äºèŠ‚ç‚¹æ•°å’Œå‰¯æœ¬æ•°ç›¸åŒçš„æƒ…å†µï¼Œå¦‚æœæœ‰10èŠ‚ç‚¹è€Œåªè¦3å‰¯æœ¬å°±ä¸è¡Œï¼Œç”Ÿæˆçš„jsonä¼šä½¿å‰¯æœ¬é›†ä¸­çš„3ä¸ªèŠ‚ç‚¹ã€‚<br>ä¸è¿‡ä¸€èˆ¬è¿˜æ˜¯å»ºè®®ä¿®æ”¹é»˜è®¤å‰¯æœ¬æ•°æˆ–è€…åˆ›å»ºtopicæ—¶æ‰§è¡Œå‰¯æœ¬æ•°è€Œéä½¿ç”¨è¿™ä¸ªè„šæœ¬ï¼Œå¦‚æœæ˜¯é›†ç¾¤æ·»åŠ èŠ‚ç‚¹çš„æƒ…å†µï¼Œå»ºè®®è¿˜æ˜¯ä½¿ç”¨ä¸“ä¸šçš„å¸¦è´Ÿè½½å¹³è¡¡åŠŸèƒ½çš„kafkaç®¡ç†ç³»ç»Ÿã€‚</p><h3 id="5-å»ºè®®è®¾ç½®å‚æ•°"><a href="#5-å»ºè®®è®¾ç½®å‚æ•°" class="headerlink" title="5. å»ºè®®è®¾ç½®å‚æ•°"></a>5. å»ºè®®è®¾ç½®å‚æ•°</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">offsets.topic.replication.factor=3</span><br><span class="line">transaction.state.log.replication.factor=3</span><br><span class="line">transaction.state.log.min.isr=3</span><br><span class="line">default.replication.factor=3</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¤§æ•°æ® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>centosåˆ©ç”¨yumdownloaderè·å–å«ä¾èµ–çš„rpmå®‰è£…åŒ…</title>
      <link href="//centos-yumdownloader-rpm-package/"/>
      <url>//centos-yumdownloader-rpm-package/</url>
      
        <content type="html"><![CDATA[<p>å·¥ä½œç»å¸¸ä¼šé‡åˆ°éœ€è¦ç¦»çº¿å®‰è£…è½¯ä»¶çš„æƒ…å†µï¼Œç‰¹æ­¤è®°å½•ä¸‹æ¥ï¼Œé¿å…æ¯æ¬¡éƒ½å¾—å»ç¿»ç¬”è®°ã€‚</p><span id="more"></span><h2 id="é›¶-æ€è·¯"><a href="#é›¶-æ€è·¯" class="headerlink" title="é›¶ æ€è·¯"></a>é›¶ æ€è·¯</h2><ol><li>ä½¿ç”¨dockeræä¾›ç›®æ ‡åŒ…æ´å‡€éš”ç¦»ç¯å¢ƒï¼ˆå¦‚centos7ã€centos8ï¼‰ã€‚</li><li>ä½¿ç”¨<code>yumdownloader -resolve</code>ä¸‹è½½å®Œæ•´ä¾èµ–ã€‚</li><li>åœ¨ç›®æ ‡ç¯å¢ƒä½¿ç”¨<code>yum -y localinstall</code> ä¸€é”®å®‰è£…</li></ol><h2 id="ä¸€-æ„é€ è¿è¡Œç¯å¢ƒ"><a href="#ä¸€-æ„é€ è¿è¡Œç¯å¢ƒ" class="headerlink" title="ä¸€ æ„é€ è¿è¡Œç¯å¢ƒ"></a>ä¸€ æ„é€ è¿è¡Œç¯å¢ƒ</h2><h3 id="1-ä½¿ç”¨dockeræä¾›ç›®æ ‡æ“ä½œç³»ç»Ÿ"><a href="#1-ä½¿ç”¨dockeræä¾›ç›®æ ‡æ“ä½œç³»ç»Ÿ" class="headerlink" title="1 ä½¿ç”¨dockeræä¾›ç›®æ ‡æ“ä½œç³»ç»Ÿ"></a>1 ä½¿ç”¨dockeræä¾›ç›®æ ‡æ“ä½œç³»ç»Ÿ</h3><p>åœ¨æœ¬åœ°åˆ›å»ºdataç›®å½•å¹¶æŒ‚è½½åˆ°å®¹å™¨é‡Œï¼Œæ–¹ä¾¿å°†ç”Ÿæˆçš„ä¾èµ–å–å‡ºã€‚<br>å¦‚æœæƒ³å°†å®¹å™¨å½“linuxè¿œç¨‹ä¸»æœºä½¿ç”¨ï¼Œå°†22ç«¯å£æ˜ å°„å‡ºæ¥å³å¯ï¼š -p 5022:22 </p><ol><li>centos7<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /home/lin/centos7/data</span><br><span class="line">docker run -d  --name centos7 -v /home/lin/centos7/data:/data centos:7 /usr/sbin/init</span><br><span class="line">docker exec -it centos7 /bin/bash</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>centos8<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /home/lin/centos8/data</span><br><span class="line">docker run -d  --name centos8 -v /home/lin/centos8/data:/data centos:8 /usr/sbin/init</span><br><span class="line">docker exec -it centos8 /bin/bash</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-æ›´æ–°yumé•œåƒä»“åº“"><a href="#2-æ›´æ–°yumé•œåƒä»“åº“" class="headerlink" title="2 æ›´æ–°yumé•œåƒä»“åº“"></a>2 æ›´æ–°yumé•œåƒä»“åº“</h3>å‚è€ƒé˜¿é‡Œçš„å¼€æºé•œåƒç«™ï¼š<a href="https://developer.aliyun.com/mirror/">https://developer.aliyun.com/mirror/</a><br>ä»¥centos7ä¸ºä¾‹ï¼š<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">sed -i -e &#x27;/mirrors.cloud.aliyuncs.com/d&#x27; -e &#x27;/mirrors.aliyuncs.com/d&#x27; /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line">yum makecache</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="äºŒ-ä½¿ç”¨yumdownloader"><a href="#äºŒ-ä½¿ç”¨yumdownloader" class="headerlink" title="äºŒ ä½¿ç”¨yumdownloader"></a>äºŒ ä½¿ç”¨yumdownloader</h2><h3 id="1-å®‰è£…yumdownloader"><a href="#1-å®‰è£…yumdownloader" class="headerlink" title="1. å®‰è£…yumdownloader"></a>1. å®‰è£…yumdownloader</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install yum-utils -y</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-ä¸‹è½½ä¾èµ–åŒ…"><a href="#2-ä¸‹è½½ä¾èµ–åŒ…" class="headerlink" title="2. ä¸‹è½½ä¾èµ–åŒ…"></a>2. ä¸‹è½½ä¾èµ–åŒ…</h3>å‘½ä»¤ä¸ºæ ¼å¼ä¸º yumdownloader â€“resolve éœ€è¦çš„åŒ…<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥æŒ‚è½½æ–‡ä»¶å¤¹</span></span><br><span class="line">cd /data</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ ¹æ®éœ€è¦å…ˆæ·»åŠ å¯¹åº”çš„è½¯ä»¶å­˜å‚¨åº“æºï¼Œå¦‚</span></span><br><span class="line">rpm -ivh http://mirrors.wlnmp.com/centos/wlnmp-release-centos.noarch.rpm</span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºå­ç›®å½•</span></span><br><span class="line">mkdir packages &amp;&amp; cd packages </span><br><span class="line"><span class="meta">#</span><span class="bash"> å†ä½¿ç”¨yumdownloader --resolveå–ä»£yum installï¼Œè¿™é‡Œä»¥tarå’Œnetstatä¸ºä¾‹</span></span><br><span class="line">yumdownloader --resolve  tar netstat </span><br><span class="line"></span><br></pre></td></tr></table></figure>ä¸€èˆ¬ä¸‹è½½çš„å®‰è£…rpmåŒ…éƒ½æ˜¯å¸¦æœ‰x86_64çš„ï¼ŒæŸäº›æ—§ä¸€ç‚¹çš„è½¯ä»¶ä¼šæ”¯æŒ32ä½ï¼Œä¸ºäº†åé¢å¯ä»¥ç›´æ¥ä¸€é”®å®‰è£…ï¼Œè¿™é‡Œæ¨èæŠŠä¸éœ€è¦çš„32ä½ç‰ˆæœ¬çš„ä¾èµ–åˆ æ‰<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rm -f *.i386*</span><br><span class="line">rm -f *.i586*</span><br><span class="line">rm -f *.i686*</span><br><span class="line">rm -f *.noarch*</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h3 id="3-localinstall-å®‰è£…"><a href="#3-localinstall-å®‰è£…" class="headerlink" title="3. localinstall å®‰è£…"></a>3. localinstall å®‰è£…</h3><p>å°†ç”Ÿæˆçš„æ–‡ä»¶å¤¹æ‹·è´åˆ°ç›®æ ‡é›†ç¾¤ä¸Šï¼Œä½¿ç”¨localinstall è¿›è¡Œå®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y localinstall *.rpm</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¨‹åºå‘˜æ‚è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> yumdownloader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç©ºé—´ç´¢å¼• S2 å­¦ä¹ æŒ‡å—åŠJavaå·¥å…·ç±»å®è·µ</title>
      <link href="//google_spatial_search_s2/"/>
      <url>//google_spatial_search_s2/</url>
      
        <content type="html"><![CDATA[<p>geohashå¯¹äºå¤§åŒºåŸŸæŸ¥è¯¢è¡¨ç°æä¸è‰¯å¥½ï¼Œç»è°ƒç ”æµ‹è¯•ï¼Œæ”¹ç”¨googleçš„s2ã€‚å› ä¸ºæ¶‰åŠçš„èµ„æ–™ã€å·¥å…·è¾ƒå¤šï¼Œç‰¹æ­¤è®°å½•ï¼Œä»¥å¤‡åç”¨ã€‚</p><span id="more"></span><h2 id="ä¸€-å­¦ä¹ æŒ‡å—"><a href="#ä¸€-å­¦ä¹ æŒ‡å—" class="headerlink" title="ä¸€ å­¦ä¹ æŒ‡å—"></a>ä¸€ å­¦ä¹ æŒ‡å—</h2><h3 id="0-ä»‹ç»è¯´æ˜"><a href="#0-ä»‹ç»è¯´æ˜" class="headerlink" title="0 ä»‹ç»è¯´æ˜"></a>0 ä»‹ç»è¯´æ˜</h3><p>ç­é—¨ä¸å¼„æ–§ï¼Œè¿™é‡Œæ¨è halfrost å¤§ç¥çš„ç©ºé—´æœç´¢ç³»åˆ—æ–‡ç« ï¼Œæ¨èå…ˆæµè§ˆä¸€éã€‚<br>è¿™ä¸€ç¯‡æ˜¯å¯¹S2çš„æ¦‚å¿µä»‹ç»ï¼š<a href="https://github.com/halfrost/Halfrost-Field/blob/master/contents/Go/go_spatial_search.md">é«˜æ•ˆçš„å¤šç»´ç©ºé—´ç‚¹ç´¢å¼•ç®—æ³• â€” Geohash å’Œ Google S2</a><br>è¿™ä¸€ç¯‡æ˜¯å¯¹S2é‡Œé¢çš„å„ä¸ªç»„ä»¶çš„ä»‹ç»ï¼š<a href="https://github.com/halfrost/Halfrost-Field/blob/master/contents/Go/go_s2_regionCoverer.md">Google S2 æ˜¯å¦‚ä½•è§£å†³ç©ºé—´è¦†ç›–æœ€ä¼˜è§£é—®é¢˜çš„?</a></p><h3 id="1-s2-å¯¹æ¯”-geohash-çš„ä¼˜ç‚¹"><a href="#1-s2-å¯¹æ¯”-geohash-çš„ä¼˜ç‚¹" class="headerlink" title="1 s2 å¯¹æ¯” geohash çš„ä¼˜ç‚¹"></a>1 s2 å¯¹æ¯” geohash çš„ä¼˜ç‚¹</h3><ol><li>s2æœ‰30çº§ï¼Œgeohashåªæœ‰12çº§ã€‚s2çš„å±‚çº§å˜åŒ–è¾ƒå¹³ç¼“ï¼Œæ–¹ä¾¿é€‰æ‹©ã€‚</li><li>s2åŠŸèƒ½å¼ºå¤§ï¼Œè§£å†³äº†å‘é‡è®¡ç®—ï¼Œé¢ç§¯è®¡ç®—ï¼Œå¤šè¾¹å½¢è¦†ç›–ï¼Œè·ç¦»è®¡ç®—ç­‰é—®é¢˜ï¼Œå‡å°‘äº†å¼€å‘å·¥ä½œé‡ã€‚</li><li><em><strong>s2è§£å†³äº†å¤šè¾¹å½¢è¦†ç›–é—®é¢˜</strong></em>ã€‚ä¸ªäººè®¤ä¸ºè¿™æ˜¯å…¶ä¸geohashåŠŸèƒ½ä¸Šæœ€æœ¬è´¨çš„ä¸åŒã€‚ç»™å®šä¸è§„åˆ™èŒƒå›´ï¼Œs2å¯ä»¥è®¡ç®—å‡ºä¸€ä¸ªå¤šè¾¹å½¢è¿‘ä¼¼è¦†ç›–è¿™ä¸ªèŒƒå›´ã€‚å…¶è¦†ç›–ç”¨çš„æ ¼å­æ•°é‡æ ¹æ®ç²¾ç¡®åº¦å¯æ§ã€‚geohashåœ¨è¿™æ–¹é¢ååˆ†ä¸å‹å¥½ï¼Œåˆ’å®šä¸€ä¸ªå¤§ä¸€ç‚¹çš„åŒºåŸŸï¼Œå…¶æ ¼å­æ•°å¯èƒ½è¾¾åˆ°æ•°åƒï¼Œè‹¥å‡å°‘æ ¼å­æ•°åˆ™ä¸¢å¤±ç²¾åº¦ï¼ŒæŸ¥è¯¢åŒºåŸŸè¿‡å¤§ã€‚<br>å¦‚ä¸‹ï¼Œåœ¨min levelå’Œmax levelä¸å˜çš„æƒ…å†µä¸‹ï¼Œåªéœ€è®¾ç½®å¯æ¥å—çš„max cellsæ•°å€¼ï¼Œå³å¯æ§åˆ¶è¦†ç›–ç²¾åº¦ã€‚è€Œä¸”å…¶cellçš„regionå¤§å°è‡ªåŠ¨é€‚é…ã€‚geohashè¦åœ¨å¦‚æ­¤å¤§èŒƒå›´å®ç°é«˜ç²¾åº¦è¦†ç›–åˆ™ä¼šäº§ç”Ÿæä¸ºåºå¤§çš„ç½‘æ ¼æ•°ã€‚<br>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯,åœ¨minLevel,maxLevel,maxCellsè¿™3ä¸ªå‚æ•°ä¸­,ä¸ä¸€å®šèƒ½å®Œå…¨æ»¡è¶³.ä¸€èˆ¬è€Œè¨€æ˜¯ä¼˜å…ˆæ»¡è¶³maxLevelå³æœ€ç²¾ç»†çš„ç½‘æ ¼å¤§å°,å†å°½å¯èƒ½æ§åˆ¶cellæ•°é‡åœ¨maxCellsé‡Œé¢.è€ŒminLevelç”±äºä¼šåˆå¹¶ç½‘æ ¼,æ‰€ä»¥å¾ˆéš¾æ»¡è¶³(åœ¨æŸ¥è¯¢å¤§åŒºåŸŸçš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªå¤§ç½‘æ ¼å’Œå¾ˆå¤šä¸ªå°ç½‘æ ¼,å¯¼è‡´æœ¨æ¡¶æ•ˆåº”.è¿™ä¸ªæ—¶å€™å¯èƒ½å°†å¤§ç½‘æ ¼åˆ’åˆ†ä¸ºæŒ‡å®šç­‰çº§çš„å°ç½‘æ ¼,å³æœ€ç»ˆæ•ˆæœä¸º,ä¸¥æ ¼éµå¾ªminLevelå’ŒmaxLevel,ä¸ºæ­¤ç‰ºç‰²maxCells,åé¢æœ‰ä»£ç )<br><img src="https://img-blog.csdnimg.cn/20200429231333130.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="max cells ä¸º10"><br><img src="https://img-blog.csdnimg.cn/20200429231612572.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="max cells ä¸º45"><h3 id="2-ç²¾åº¦è¡¨"><a href="#2-ç²¾åº¦è¡¨" class="headerlink" title="2 ç²¾åº¦è¡¨"></a>2 ç²¾åº¦è¡¨</h3></li></ol><table><thead><tr><th align="center">level</th><th align="center">min area</th><th align="center">max area</th><th align="center">average area</th><th align="center">units</th><th align="center">Random cell 1 (UK) min edge length</th><th align="center">Random cell 1 (UK) max edge length</th><th align="center">Random cell 2 (US) min edge length</th><th align="center">Random cell 2 (US) max edge length</th><th align="center">Number of cells</th></tr></thead><tbody><tr><td align="center">00</td><td align="center">85011012.19</td><td align="center">85011012.19</td><td align="center">85011012.19</td><td align="center">km2</td><td align="center">7842 km</td><td align="center">7842 km</td><td align="center">7842 km</td><td align="center">7842 km</td><td align="center">6</td></tr><tr><td align="center">01</td><td align="center">21252753.05</td><td align="center">21252753.05</td><td align="center">21252753.05</td><td align="center">km2</td><td align="center">3921 km</td><td align="center">5004 km</td><td align="center">3921 km</td><td align="center">5004 km</td><td align="center">24</td></tr><tr><td align="center">02</td><td align="center">4919708.23</td><td align="center">6026521.16</td><td align="center">5313188.26</td><td align="center">km2</td><td align="center">1825 km</td><td align="center">2489 km</td><td align="center">1825 km</td><td align="center">2489 km</td><td align="center">96</td></tr><tr><td align="center">03</td><td align="center">1055377.48</td><td align="center">1646455.50</td><td align="center">1328297.07</td><td align="center">km2</td><td align="center">840 km</td><td align="center">1167 km</td><td align="center">1130 km</td><td align="center">1310 km</td><td align="center">384</td></tr><tr><td align="center">04</td><td align="center">231564.06</td><td align="center">413918.15</td><td align="center">332074.27</td><td align="center">km2</td><td align="center">432 km</td><td align="center">609 km</td><td align="center">579 km</td><td align="center">636 km</td><td align="center">1536</td></tr><tr><td align="center">05</td><td align="center">53798.67</td><td align="center">104297.91</td><td align="center">83018.57</td><td align="center">km2</td><td align="center">210 km</td><td align="center">298 km</td><td align="center">287 km</td><td align="center">315 km</td><td align="center">6K</td></tr><tr><td align="center">06</td><td align="center">12948.81</td><td align="center">26113.30</td><td align="center">20754.64</td><td align="center">km2</td><td align="center">108 km</td><td align="center">151 km</td><td align="center">143 km</td><td align="center">156 km</td><td align="center">24K</td></tr><tr><td align="center">07</td><td align="center">3175.44</td><td align="center">6529.09</td><td align="center">5188.66</td><td align="center">km2</td><td align="center">54 km</td><td align="center">76 km</td><td align="center">72 km</td><td align="center">78 km</td><td align="center">98K</td></tr><tr><td align="center">08</td><td align="center">786.20</td><td align="center">1632.45</td><td align="center">1297.17</td><td align="center">km2</td><td align="center">27 km</td><td align="center">38 km</td><td align="center">36 km</td><td align="center">39 km</td><td align="center">393K</td></tr><tr><td align="center">09</td><td align="center">195.59</td><td align="center">408.12</td><td align="center">324.29</td><td align="center">km2</td><td align="center">14 km</td><td align="center">19 km</td><td align="center">18 km</td><td align="center">20 km</td><td align="center">1573K</td></tr><tr><td align="center">10</td><td align="center">48.78</td><td align="center">102.03</td><td align="center">81.07</td><td align="center">km2</td><td align="center">7 km</td><td align="center">9 km</td><td align="center">9 km</td><td align="center">10 km</td><td align="center">6M</td></tr><tr><td align="center">11</td><td align="center">12.18</td><td align="center">25.51</td><td align="center">20.27</td><td align="center">km2</td><td align="center">3 km</td><td align="center">5 km</td><td align="center">4 km</td><td align="center">5 km</td><td align="center">25M</td></tr><tr><td align="center">12</td><td align="center">3.04</td><td align="center">6.38</td><td align="center">5.07</td><td align="center">km2</td><td align="center">1699 m</td><td align="center">2 km</td><td align="center">2 km</td><td align="center">2 km</td><td align="center">100M</td></tr><tr><td align="center">13</td><td align="center">0.76</td><td align="center">1.59</td><td align="center">1.27</td><td align="center">km2</td><td align="center">850 m</td><td align="center">1185 m</td><td align="center">1123 m</td><td align="center">1225 m</td><td align="center">402M</td></tr><tr><td align="center">14</td><td align="center">0.19</td><td align="center">0.40</td><td align="center">0.32</td><td align="center">km2</td><td align="center">425 m</td><td align="center">593 m</td><td align="center">562 m</td><td align="center">613 m</td><td align="center">1610M</td></tr><tr><td align="center">15</td><td align="center">47520.30</td><td align="center">99638.93</td><td align="center">79172.67</td><td align="center">m2</td><td align="center">212 m</td><td align="center">296 m</td><td align="center">281 m</td><td align="center">306 m</td><td align="center">6B</td></tr><tr><td align="center">16</td><td align="center">11880.08</td><td align="center">24909.73</td><td align="center">19793.17</td><td align="center">m2</td><td align="center">106 m</td><td align="center">148 m</td><td align="center">140 m</td><td align="center">153 m</td><td align="center">25B</td></tr><tr><td align="center">17</td><td align="center">2970.02</td><td align="center">6227.43</td><td align="center">4948.29</td><td align="center">m2</td><td align="center">53 m</td><td align="center">74 m</td><td align="center">70 m</td><td align="center">77 m</td><td align="center">103B</td></tr><tr><td align="center">18</td><td align="center">742.50</td><td align="center">1556.86</td><td align="center">1237.07</td><td align="center">m2</td><td align="center">27 m</td><td align="center">37 m</td><td align="center">35 m</td><td align="center">38 m</td><td align="center">412B</td></tr><tr><td align="center">19</td><td align="center">185.63</td><td align="center">389.21</td><td align="center">309.27</td><td align="center">m2</td><td align="center">13 m</td><td align="center">19 m</td><td align="center">18 m</td><td align="center">19 m</td><td align="center">1649B</td></tr><tr><td align="center">20</td><td align="center">46.41</td><td align="center">97.30</td><td align="center">77.32</td><td align="center">m2</td><td align="center">7 m</td><td align="center">9 m</td><td align="center">9 m</td><td align="center">10 m</td><td align="center">7T</td></tr><tr><td align="center">21</td><td align="center">11.60</td><td align="center">24.33</td><td align="center">19.33</td><td align="center">m2</td><td align="center">3 m</td><td align="center">5 m</td><td align="center">4 m</td><td align="center">5 m</td><td align="center">26T</td></tr><tr><td align="center">22</td><td align="center">2.90</td><td align="center">6.08</td><td align="center">4.83</td><td align="center">m2</td><td align="center">166 cm</td><td align="center">2 m</td><td align="center">2 m</td><td align="center">2 m</td><td align="center">105T</td></tr><tr><td align="center">23</td><td align="center">0.73</td><td align="center">1.52</td><td align="center">1.21</td><td align="center">m2</td><td align="center">83 cm</td><td align="center">116 cm</td><td align="center">110 cm</td><td align="center">120 cm</td><td align="center">422T</td></tr><tr><td align="center">24</td><td align="center">0.18</td><td align="center">0.38</td><td align="center">0.30</td><td align="center">m2</td><td align="center">41 cm</td><td align="center">58 cm</td><td align="center">55 cm</td><td align="center">60 cm</td><td align="center">1689T</td></tr><tr><td align="center">25</td><td align="center">453.19</td><td align="center">950.23</td><td align="center">755.05</td><td align="center">cm2</td><td align="center">21 cm</td><td align="center">29 cm</td><td align="center">27 cm</td><td align="center">30 cm</td><td align="center">7e15</td></tr><tr><td align="center">26</td><td align="center">113.30</td><td align="center">237.56</td><td align="center">188.76</td><td align="center">cm2</td><td align="center">10 cm</td><td align="center">14 cm</td><td align="center">14 cm</td><td align="center">15 cm</td><td align="center">27e15</td></tr><tr><td align="center">27</td><td align="center">28.32</td><td align="center">59.39</td><td align="center">47.19</td><td align="center">cm2</td><td align="center">5 cm</td><td align="center">7 cm</td><td align="center">7 cm</td><td align="center">7 cm</td><td align="center">108e15</td></tr><tr><td align="center">28</td><td align="center">7.08</td><td align="center">14.85</td><td align="center">11.80</td><td align="center">cm2</td><td align="center">2 cm</td><td align="center">4 cm</td><td align="center">3 cm</td><td align="center">4 cm</td><td align="center">432e15</td></tr><tr><td align="center">29</td><td align="center">1.77</td><td align="center">3.71</td><td align="center">2.95</td><td align="center">cm2</td><td align="center">12 mm</td><td align="center">18 mm</td><td align="center">17 mm</td><td align="center">18 mm</td><td align="center">1729e15</td></tr><tr><td align="center">30</td><td align="center">0.44</td><td align="center">0.93</td><td align="center">0.74</td><td align="center">cm2</td><td align="center">6 mm</td><td align="center">9 mm</td><td align="center">8 mm</td><td align="center">9 mm</td><td align="center">7e18</td></tr></tbody></table><h3 id="3-ç›¸å…³èµ„æ–™"><a href="#3-ç›¸å…³èµ„æ–™" class="headerlink" title="3 ç›¸å…³èµ„æ–™"></a>3 ç›¸å…³èµ„æ–™</h3><ol><li>halfrost çš„ git ä»“åº“ï¼ŒåŒ…å«ç©ºé—´æœç´¢ç³»åˆ—æ–‡ç« ï¼š<a href="https://github.com/halfrost/Halfrost-Field">https://github.com/halfrost/Halfrost-Field</a></li><li>s2 å®˜ç½‘ï¼š<a href="https://s2geometry.io/">https://s2geometry.io</a></li><li>s2 åœ°å›¾/å¯è§†åŒ–å·¥å…·ï¼ˆåŠŸèƒ½å¼ºå¤§ï¼Œå¼ºçƒˆæ¨èï¼‰ï¼š <a href="http://s2.sidewalklabs.com/regioncoverer/">http://s2.sidewalklabs.com/regioncoverer/</a></li><li>ç»çº¬åº¦ç”»åœ†/ç”»çŸ©å½¢ åœ°å›¾/å¯è§†åŒ–å·¥å…· ï¼š<a href="https://www.mapdevelopers.com/draw-circle-tool.php">https://www.mapdevelopers.com/draw-circle-tool.php</a></li><li>ç»çº¬åº¦ç”»å¤šè¾¹å½¢ åœ°å›¾/å¯è§†åŒ–å·¥å…· ï¼š<a href="http://apps.headwallphotonics.com/">http://apps.headwallphotonics.com</a></li><li>csdnå‚è€ƒæ–‡ç« ï¼šGoogle S2 å¸¸ç”¨æ“ä½œ ï¼š<a href="https://blog.csdn.net/deng0515001/article/details/88031153">https://blog.csdn.net/deng0515001/article/details/88031153</a></li></ol><h2 id="äºŒ-å·¥å…·ç±»åŠæµ‹è¯•"><a href="#äºŒ-å·¥å…·ç±»åŠæµ‹è¯•" class="headerlink" title="äºŒ å·¥å…·ç±»åŠæµ‹è¯•"></a>äºŒ å·¥å…·ç±»åŠæµ‹è¯•</h2><h3 id="å·¥å…·ç±»"><a href="#å·¥å…·ç±»" class="headerlink" title="å·¥å…·ç±»"></a>å·¥å…·ç±»</h3><h4 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><p>ä»¥ä¸‹æ˜¯ä¸ªäººä½¿ç”¨çš„Javaå·¥å…·ç±»ï¼ŒæŒæœ‰å¯¹è±¡S2RegionCovererï¼ˆç”¨äºè·å–ç»™å®šåŒºåŸŸçš„cellIdï¼‰ï¼Œç”¨äºæ“ä½œ3ç§å¸¸è§åŒºåŸŸç±»å‹ï¼ˆåœ†ï¼ŒçŸ©å½¢ï¼Œå¤šè¾¹å½¢ï¼‰ã€‚æ”¯æŒå¤šç§ä¼ å‚ï¼ˆch.hsr.geohashçš„WGS84Pointä¼ é€’ç»çº¬åº¦ï¼Œæˆ–è€…Tupleå·¥å…·ç±»ä¼ é€’ç»çº¬åº¦ï¼‰<br>ä¸»è¦åŒ…å«3ç±»æ–¹æ³•ï¼š</p><ol><li>getS2RegionByXXX<br>è·å–ç»™å®šç»çº¬åº¦åæ ‡å¯¹åº”çš„S2Region,è¯¥regionå¯ç”¨äºè·å–cellId,æˆ–ç”¨äºåˆ¤æ–­åŒ…å«å…³ç³»</li><li>getCellIdList<br>è·å–ç»™å®šregionçš„cellId,å¹¶é€šè¿‡childrenCellIdæ–¹æ³•æ§åˆ¶å…¶ä¸¥æ ¼éµå®ˆminLevel</li><li>contains<br>å¯¹äºæŒ‡å®šS2Region,åˆ¤æ–­ç»çº¬åº¦æˆ–CellTokenæ˜¯å¦åœ¨å…¶èŒƒå›´å†…</li></ol><p>æ³¨æ„äº‹é¡¹ï¼š</p><ol><li>è¯¥S2RegionCovererä¸ç¡®å®šæ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Œå¾…æµ‹è¯•ï¼Œä¸å»ºè®®åŠ¨æ€ä¿®æ”¹å…¶é…ç½®å‚æ•°</li><li>åŸç”Ÿçš„çŸ©å½¢Rectåœ¨æŸäº›å‚æ•°ä¸‹è¡¨ç°ä¸æ­£å¸¸ï¼Œå¾…ç¡®è®¤ï¼Œè¿™é‡Œå°†å…¶è½¬ä¸ºå¤šè¾¹å½¢å¯¹å¾…ã€‚<h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">S2Util</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> minLevel = <span class="number">11</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> maxLevel = <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> maxCells = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> S2RegionCoverer COVERER = <span class="keyword">new</span> S2RegionCoverer();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        COVERER.setMinLevel(minLevel);</span><br><span class="line">        COVERER.setMaxLevel(maxLevel);</span><br><span class="line">        COVERER.setMaxCells(maxCells);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†å•ä¸ªcellIdè½¬æ¢ä¸ºå¤šä¸ªæŒ‡å®šlevelçš„cellId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s2CellId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> desLevel</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;S2CellId&gt; <span class="title">childrenCellId</span><span class="params">(S2CellId s2CellId, Integer desLevel)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> childrenCellId(s2CellId, s2CellId.level(), desLevel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;S2CellId&gt; <span class="title">childrenCellId</span><span class="params">(S2CellId s2CellId, Integer curLevel, Integer desLevel)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (curLevel &lt; desLevel) &#123;</span><br><span class="line">            <span class="keyword">long</span> interval = (s2CellId.childEnd().id() - s2CellId.childBegin().id()) / <span class="number">4</span>;</span><br><span class="line">            List&lt;S2CellId&gt; s2CellIds = Lists.newArrayList();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">long</span> id = s2CellId.childBegin().id() + interval * i;</span><br><span class="line">                s2CellIds.addAll(childrenCellId(<span class="keyword">new</span> S2CellId(id), curLevel + <span class="number">1</span>, desLevel));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> s2CellIds;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Lists.newArrayList(s2CellId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†cellTokenè½¬æ¢ä¸ºç»çº¬åº¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Tuple2&lt;Double, Double&gt; <span class="title">toLatLon</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        S2LatLng latLng = <span class="keyword">new</span> S2LatLng(S2CellId.fromToken(token).toPoint());</span><br><span class="line">        <span class="keyword">return</span> Tuple2.tuple(latLng.latDegrees(), latLng.lngDegrees());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†ç»çº¬åº¦è½¬æ¢ä¸ºcellId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> lat</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> lon</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> S2CellId <span class="title">toCellId</span><span class="params">(<span class="keyword">double</span> lat, <span class="keyword">double</span> lon)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> S2CellId.fromLatLng(S2LatLng.fromDegrees(lat, lon));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­regionæ˜¯å¦åŒ…å«æŒ‡å®šcellToken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> region</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cellToken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(S2Region region, String cellToken)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> region.contains(<span class="keyword">new</span> S2Cell(S2CellId.fromToken(cellToken)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­regionæ˜¯å¦åŒ…å«æŒ‡å®šç»çº¬åº¦åæ ‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> region</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> lat</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> lon</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(S2Region region, <span class="keyword">double</span> lat, <span class="keyword">double</span> lon)</span> </span>&#123;</span><br><span class="line">        S2LatLng s2LatLng = S2LatLng.fromDegrees(lat, lon);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">boolean</span> contains = region.contains(<span class="keyword">new</span> S2Cell(s2LatLng));</span><br><span class="line">            <span class="keyword">return</span> contains;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NullPointerException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®regionè·å–cellIdåˆ—è¡¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> region</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;S2CellId&gt; <span class="title">getCellIdList</span><span class="params">(S2Region region)</span> </span>&#123;</span><br><span class="line">        List&lt;S2CellId&gt; primeS2CellIdList = COVERER.getCovering(region).cellIds();</span><br><span class="line">        <span class="keyword">return</span> primeS2CellIdList.stream().flatMap(s2CellId -&gt; S2Util.childrenCellId(s2CellId, S2Util.minLevel).stream()).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®regionè·å–åˆå¹¶åçš„cellIdåˆ—è¡¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> region</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;S2CellId&gt; <span class="title">getCompactCellIdList</span><span class="params">(S2Region region)</span> </span>&#123;</span><br><span class="line">        List&lt;S2CellId&gt; primeS2CellIdList = COVERER.getCovering(region).cellIds();</span><br><span class="line">        <span class="keyword">return</span> primeS2CellIdList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////     è·å–åœ†å½¢region       ///////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> S2Region <span class="title">getS2RegionByCircle</span><span class="params">(<span class="keyword">double</span> lat, <span class="keyword">double</span> lon, <span class="keyword">double</span> radius)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> capHeight = (<span class="number">2</span> * S2.M_PI) * (radius / <span class="number">40075017</span>);</span><br><span class="line">        S2Cap cap = S2Cap.fromAxisHeight(S2LatLng.fromDegrees(lat, lon).toPoint(), capHeight * capHeight / <span class="number">2</span>);</span><br><span class="line">        S2CellUnion s2CellUnion = COVERER.getCovering(cap);</span><br><span class="line">        <span class="keyword">return</span> cap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> S2Region <span class="title">getS2RegionByCircle</span><span class="params">(WGS84Point point, <span class="keyword">double</span> radius)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getS2RegionByCircle(point.getLatitude(), point.getLongitude(), radius);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////     è·å–çŸ©å½¢region       ///////////////</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> S2Region <span class="title">geS2RegionByRect</span><span class="params">(WGS84Point point1, WGS84Point point2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getS2RegionByRect(point1.getLatitude(), point1.getLongitude(), point2.getLatitude(), point2.getLongitude());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> S2Region <span class="title">getS2RegionByRect</span><span class="params">(Tuple2&lt;Double, Double&gt; point1, Tuple2&lt;Double, Double&gt; point2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getS2RegionByRect(point1.getVal1(), point1.getVal2(), point2.getVal1(), point2.getVal2());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> S2Region <span class="title">getS2RegionByRect</span><span class="params">(<span class="keyword">double</span> lat1, <span class="keyword">double</span> lon1, <span class="keyword">double</span> lat2, <span class="keyword">double</span> lon2)</span> </span>&#123;</span><br><span class="line">        List&lt;Tuple2&lt;Double, Double&gt;&gt; latLonTuple2List = Lists.newArrayList(Tuple2.tuple(lat1, lon1), Tuple2.tuple(lat1, lon2), Tuple2.tuple(lat2, lon2), Tuple2.tuple(lat2, lon1));</span><br><span class="line">        <span class="keyword">return</span> getS2RegionByPolygon(latLonTuple2List);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////     è·å–å¤šè¾¹å½¢region       ///////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> S2Region <span class="title">getS2RegionByPolygon</span><span class="params">(WGS84Point[] pointArray)</span> </span>&#123;</span><br><span class="line">        List&lt;Tuple2&lt;Double, Double&gt;&gt; latLonTuple2List = Lists.newArrayListWithExpectedSize(pointArray.length);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pointArray.length; ++i) &#123;</span><br><span class="line">            latLonTuple2List.add(Tuple2.tuple(pointArray[i].getLatitude(), pointArray[i].getLongitude()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> getS2RegionByPolygon(latLonTuple2List);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> S2Region <span class="title">getS2RegionByPolygon</span><span class="params">(Tuple2&lt;Double, Double&gt;[] tuple2Array)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getS2RegionByPolygon(Lists.newArrayList(tuple2Array));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨æ„éœ€è¦ä»¥é€†æ—¶é’ˆæ–¹å‘æ·»åŠ åæ ‡ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> S2Region <span class="title">getS2RegionByPolygon</span><span class="params">(List&lt;Tuple2&lt;Double, Double&gt;&gt; latLonTuple2List)</span> </span>&#123;</span><br><span class="line">        List&lt;S2Point&gt; pointList = Lists.newArrayList();</span><br><span class="line">        <span class="keyword">for</span> (Tuple2&lt;Double, Double&gt; latlonTuple2 : latLonTuple2List) &#123;</span><br><span class="line">            pointList.add(S2LatLng.fromDegrees(latlonTuple2.getVal1(), latlonTuple2.getVal2()).toPoint());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        S2Loop s2Loop = <span class="keyword">new</span> S2Loop(pointList);</span><br><span class="line">        S2PolygonBuilder builder = <span class="keyword">new</span> S2PolygonBuilder(S2PolygonBuilder.Options.DIRECTED_XOR);</span><br><span class="line">        builder.addLoop(s2Loop);</span><br><span class="line">        <span class="keyword">return</span> builder.assemblePolygon();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/////////////     é…ç½®covererå‚æ•°       ///////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getMinLevel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> minLevel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setMinLevel</span><span class="params">(<span class="keyword">int</span> minLevel)</span> </span>&#123;</span><br><span class="line">        S2Util.minLevel = minLevel;</span><br><span class="line">        COVERER.setMinLevel(minLevel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getMaxLevel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> maxLevel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setMaxLevel</span><span class="params">(<span class="keyword">int</span> maxLevel)</span> </span>&#123;</span><br><span class="line">        S2Util.maxLevel = maxLevel;</span><br><span class="line">        COVERER.setMaxLevel(maxLevel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getMaxCells</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> maxCells;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setMaxCells</span><span class="params">(<span class="keyword">int</span> maxCells)</span> </span>&#123;</span><br><span class="line">        S2Util.maxCells = maxCells;</span><br><span class="line">        COVERER.setMaxCells(maxCells);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><h5 id="1-ä¸è§„åˆ™-å¤šè¾¹å½¢"><a href="#1-ä¸è§„åˆ™-å¤šè¾¹å½¢" class="headerlink" title="1. (ä¸è§„åˆ™)å¤šè¾¹å½¢"></a>1. (ä¸è§„åˆ™)å¤šè¾¹å½¢</h5><ol><li>å»<a href="http://apps.headwallphotonics.com/%E7%94%BB%E4%B8%AA%E5%A4%9A%E8%BE%B9%E5%BD%A2,%E8%BF%99%E9%87%8C%E6%88%91%E7%94%BB%E4%BA%86%E4%B8%AA%E6%9C%89%E6%A3%B1%E6%9C%89%E8%A7%92%E7%9A%84%E7%88%B1%E5%BF%83%E6%A0%87%E5%BF%97,%E5%A6%82%E4%B8%8B">http://apps.headwallphotonics.com/ç”»ä¸ªå¤šè¾¹å½¢,è¿™é‡Œæˆ‘ç”»äº†ä¸ªæœ‰æ£±æœ‰è§’çš„çˆ±å¿ƒæ ‡å¿—,å¦‚ä¸‹</a>.<br><img src="https://img-blog.csdnimg.cn/20200502173431384.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="çˆ±å¿ƒæ ‡å¿—"></li><li>å°†å·¦ä¸‹è§’çš„åæ ‡ä¿¡æ¯ä½œä¸ºå‚æ•°,è°ƒç”¨,æµ‹è¯•ä»£ç å¦‚ä¸‹<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCellIdListByPolygon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Map&lt;Integer,Integer&gt; sizeCountMap= Maps.newHashMap();</span><br><span class="line">    StringBuilder sb3=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">    S2Region s2Region = S2Util.getS2RegionByPolygon(Lists.newArrayList(Tuple2.tuple(<span class="number">23.851458634747043</span>, <span class="number">113.66432546548037</span>),  Tuple2.tuple(<span class="number">21.60205563594303</span>, <span class="number">114.82887624673037</span>),Tuple2.tuple(<span class="number">23.771049234941454</span>, <span class="number">116.18019460610537</span>),Tuple2.tuple(<span class="number">23.16640234327511</span>, <span class="number">114.94423269204286</span>)));</span><br><span class="line">    List&lt;S2CellId&gt; cellIdListByPolygon = S2Util.getCellIdList(s2Region);</span><br><span class="line">    cellIdListByPolygon.forEach(s2CellId -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Level:&quot;</span> + s2CellId.level() + <span class="string">&quot;,ID:&quot;</span> + s2CellId.toToken() + <span class="string">&quot;,Min:&quot;</span> + s2CellId.rangeMin().toToken() + <span class="string">&quot;,Max:&quot;</span> + s2CellId.rangeMax().toToken());</span><br><span class="line">        sb3.append(<span class="string">&quot;,&quot;</span>).append(s2CellId.toToken());</span><br><span class="line">        sizeCountMap.put(s2CellId.level(),sizeCountMap.getOrDefault(s2CellId.level(),<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(sb3.substring(<span class="number">1</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;totalSize:&quot;</span>+cellIdListByPolygon.size());</span><br><span class="line">    sizeCountMap.entrySet().forEach(integerIntegerEntry -&gt; &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;level:%d,size:%d\n&quot;</span>,integerIntegerEntry.getKey(),integerIntegerEntry.getValue());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>æ‰§è¡Œç»“æœå¦‚ä¸‹<br><img src="https://img-blog.csdnimg.cn/20200502173708151.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¯ä»¥çœ‹åˆ°ç½‘æ ¼æ•°è¿œè¿œè¶…å‡ºäº†è®¾å®šçš„100,ä¸è¿‡ç½‘æ ¼å¤§å°ä¸¥æ ¼æ§åˆ¶åœ¨äº†11åˆ°16ä¹‹é—´.</li><li>å°†cellTokenåˆ—è¡¨(é€—å·åˆ†éš”)å¤åˆ¶åˆ° <a href="http://s2.sidewalklabs.com/regioncoverer/">http://s2.sidewalklabs.com/regioncoverer/</a> ,ç‚¹å‡»é‚£ä¸ªç½‘æ ¼(data)æ ‡å¿—å³å¯,å¦‚ä¸‹<br><img src="https://img-blog.csdnimg.cn/20200502174203269.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li><li>å¦‚æœè°ƒç”¨çš„æ˜¯getCompactCellIdList,åˆ™ç»“æœå¦‚ä¸‹,å…¶cellæ•°ä»1000å¤šå‹ç¼©åˆ°200å¤š.<br><img src="https://img-blog.csdnimg.cn/20200502174644676.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><h5 id="2-åœ†å½¢"><a href="#2-åœ†å½¢" class="headerlink" title="2 åœ†å½¢"></a>2 åœ†å½¢</h5></li><li>è¿™æ¬¡æˆ‘ä»¬å†ç”¨ <a href="https://www.mapdevelopers.com/draw-circle-tool.php">https://www.mapdevelopers.com/draw-circle-tool.php</a> åˆ°å°æ¹¾çœä¸Šé¢ç”»ä¸ªåœˆåœˆ,å¦‚ä¸‹<br><img src="https://img-blog.csdnimg.cn/20200502175137239.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="åœˆåœˆ"></li><li>ç„¶åå°†å…¶ç»çº¬åº¦å’Œåæ ‡ä¿¡æ¯ä½œä¸ºå‚æ•°,è°ƒç”¨,æµ‹è¯•æ–¹æ³•å¦‚ä¸‹,ä½¿ç”¨çš„æ˜¯getCompactCellIdList<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCellIdListByCircle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Map&lt;Integer,Integer&gt; sizeCountMap= Maps.newHashMap();</span><br><span class="line">    StringBuilder sb3=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">    S2Region s2Region = S2Util.getS2RegionByCircle(<span class="number">23.753954</span>,<span class="number">120.749615</span>,<span class="number">193511.10</span>);</span><br><span class="line">    List&lt;S2CellId&gt; cellIdListByPolygon = S2Util.getCompactCellIdList(s2Region);</span><br><span class="line">    cellIdListByPolygon.forEach(s2CellId -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Level:&quot;</span> + s2CellId.level() + <span class="string">&quot;,ID:&quot;</span> + s2CellId.toToken() + <span class="string">&quot;,Min:&quot;</span> + s2CellId.rangeMin().toToken() + <span class="string">&quot;,Max:&quot;</span> + s2CellId.rangeMax().toToken());</span><br><span class="line">        sb3.append(<span class="string">&quot;,&quot;</span>).append(s2CellId.toToken());</span><br><span class="line">        sizeCountMap.put(s2CellId.level(),sizeCountMap.getOrDefault(s2CellId.level(),<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(sb3.substring(<span class="number">1</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;totalSize:&quot;</span>+cellIdListByPolygon.size());</span><br><span class="line">    sizeCountMap.entrySet().forEach(integerIntegerEntry -&gt; &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;level:%d,size:%d\n&quot;</span>,integerIntegerEntry.getKey(),integerIntegerEntry.getValue());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>ç»“æœå¦‚ä¸‹<br><img src="https://img-blog.csdnimg.cn/20200502175555629.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li></ol>]]></content>
      
      
      <categories>
          
          <category> åç«¯å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> s2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HBCK2ä¿®å¤RITå®è·µç¬”è®°</title>
      <link href="//hbck2_rit/"/>
      <url>//hbck2_rit/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡è®°å½•äº†ä½œè€…ä½¿ç”¨HBCK2å·¥å…·å¯¹çº¿ä¸ŠHBaseå‘ç”ŸRITçŠ¶æ€çš„å¤„ç†ï¼Œä»…ä¾›å‚è€ƒï¼Œè‹¥æœ‰ç–µæ¼ï¼Œè¿˜æœ›æŒ‡æ­£ã€‚<br>ç½‘ç»œä¸Šå…³äºHBCK2çš„æ–‡ç« å¾ˆå°‘ï¼ŒåŸºæœ¬éƒ½æ˜¯å¤åˆ¶ç²˜è´´è‡ªç”°ç«äº‘(å°ç±³)çš„è¿™ä¸€ç¯‡ï¼š<a href="https://mp.weixin.qq.com/s/GVMWwB1WsKcdvZGfvX1lcA?spm=a2c4e.11153940.blogcont683107.11.49d762a815MegW">HBaseæŒ‡å— | HBase 2.0ä¹‹ä¿®å¤å·¥å…·HBCK2è¿ç»´æŒ‡å—</a><br>äº‹å®ä¸Šè¿™ä¸€ç¯‡æ–‡ç« ä»‹ç»å¾—ä¹Ÿå·²ç»å¾ˆè¯¦ç»†äº†ã€‚è¿™é‡Œåªæ˜¯åšä¸€äº›å®è·µä¸Šçš„è¡¥å……è¯´æ˜ã€‚</p><span id="more"></span><h3 id="1-ä¸‹è½½"><a href="#1-ä¸‹è½½" class="headerlink" title="1. ä¸‹è½½"></a>1. ä¸‹è½½</h3><p>ç›´æ¥å»<a href="https://hbase.apache.org/downloads.html">hbaseçš„å®˜ç½‘ä¸‹è½½åœ°å€</a>é‡Œå°±å¯ä»¥æ‰¾åˆ°ã€‚è¿™é‡Œç›´æ¥ç»™æœ€æ–°ç‰ˆæœ¬çš„ä¸‹è½½é“¾æ¥ï¼ˆæˆªæ­¢è‡³2020å¹´4æœˆï¼‰ï¼š<a href="https://downloads.apache.org/hbase/hbase-operator-tools-1.0.0/hbase-operator-tools-1.0.0-bin.tar.gz">https://downloads.apache.org/hbase/hbase-operator-tools-1.0.0/hbase-operator-tools-1.0.0-bin.tar.gz</a><br>ä½†è¿˜æ˜¯æ¨èè‡ªå·±å»git cloneç¼–è¯‘ï¼Œå› ä¸ºå®˜ç½‘æä¾›çš„ç¼–è¯‘ç‰ˆæœ¬æœ‰æ»åæ€§ã€‚é€šå¸¸æ¥è¯´ï¼Œä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„hbaseå†æ­é…ä½¿ç”¨æœ€æ–°ç¼–è¯‘çš„HBCK2,å¯ä»¥è§£å†³ç»å¤§éƒ¨åˆ†è«åå…¶å¦™çš„é—®é¢˜ã€‚ï¼ˆfixMeta+restartæš´åŠ›æµï¼‰<br>æ–°ç‰ˆæœ¬çš„HBCK2æœ‰æ›´å¤šæ›´æ–¹ä¾¿çš„åŠŸèƒ½ï¼Œä¸è¿‡ä¸€èˆ¬åªèƒ½åœ¨æ–°ç‰ˆæœ¬çš„hbaseä¸­ä½¿ç”¨ã€‚</p><h3 id="2-ä½¿ç”¨å‘½ä»¤"><a href="#2-ä½¿ç”¨å‘½ä»¤" class="headerlink" title="2. ä½¿ç”¨å‘½ä»¤"></a>2. ä½¿ç”¨å‘½ä»¤</h3><p>å°†å…¶è§£å‹åå¾—åˆ° hbase-hbck2-1.0.0.jarï¼Œå†cpåˆ°$HBASE_HOME/libä¸‹ï¼Œæ‰§è¡Œ  <em><strong>hbase org.apache.hbase.HBCK2 &lt;å‘½ä»¤&gt;</strong></em>  å³å¯ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨æ¨è  <em><strong>hbase org.apache.hbase.HBCK2  -h</strong></em> æŸ¥çœ‹è¯¦ç»†ä»‹ç»</p><h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><h3 id="1-æŸ¥æ‰¾é—®é¢˜"><a href="#1-æŸ¥æ‰¾é—®é¢˜" class="headerlink" title="1. æŸ¥æ‰¾é—®é¢˜"></a>1. æŸ¥æ‰¾é—®é¢˜</h3><p>å‚è€ƒHBCK2è¿ç»´æŒ‡å—çš„æ€è·¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A(canary tool)--&gt; B(Procedures &amp; Locks é¡µé¢çŠ¶æ€)</span><br><span class="line">B --&gt; C(RITé˜Ÿåˆ—)</span><br><span class="line">C --&gt; D(Masteræ—¥å¿—)</span><br></pre></td></tr></table></figure><h3 id="2-å®è·µä¾‹å­"><a href="#2-å®è·µä¾‹å­" class="headerlink" title="2. å®è·µä¾‹å­"></a>2. å®è·µä¾‹å­</h3><ol><li><p>å¤„ç†Procedures &amp; Locks<br>åœ¨ Procedures &amp; Locks é¡µé¢æŸ¥æ‰¾waitingçŠ¶æ€çš„procedureï¼ŒæŒ‰é¡ºåºè¿›è¡Œbypassã€‚æŒ‰é¡ºåºæ˜¯å› ä¸ºæœ‰ä¸€äº›waitingçš„å‘ç”Ÿæ˜¯procedureå­˜åœ¨ä¾èµ–å…³ç³»ï¼Œå°†å…¶bypassååé¢çš„procedureä¼šè¿›å…¥successçŠ¶æ€ã€‚å¦‚æœbypassè¿”å›falseå°±ä½¿ç”¨bypass -rï¼Œè¿˜æ˜¯ä¸è¡Œå†ä½¿ç”¨bypass -or</p></li><li><p>å¤„ç†RITé˜Ÿåˆ—<br>å‚è€ƒHBCK2è¿ç»´æŒ‡å—å¯ä»¥ä»¥txtæ ¼å¼æ‹¿åˆ°RITé˜Ÿåˆ—çš„æ‰€æœ‰procedureçš„idï¼Œå°†å…¶å¤åˆ¶åˆ°ä»»æ„æ–‡ä»¶ï¼ˆå¦‚pid.txtï¼‰ï¼Œå†æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat pid.txt | xargs hbase org.apache.hbase.HBCK2 bypass -or </span><br></pre></td></tr></table></figure><p>ç„¶åå†ä»¥txtæ ¼å¼æ‹¿åˆ°RITé˜Ÿåˆ—çš„æ‰€æœ‰regionçš„encodedNameï¼Œå°†å…¶å¤åˆ¶åˆ°ä»»æ„æ–‡ä»¶ï¼ˆå¦‚region.txtï¼‰ï¼Œå†æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat region.txt | xargs hbase org.apache.hbase.HBCK2 assigns</span><br></pre></td></tr></table></figure></li><li><p>assignå„ä¸ªè¡¨ä¸­offlineçš„region<br>æ£€æŸ¥ä¸€ä¸‹å„ä¸ªè¡¨ä¸­æ˜¯å¦æœ‰regionçš„StorefileSizeä¸º0ï¼Œå½“ç„¶ä¹Ÿå¯èƒ½æ˜¯æœ¬èº«æ²¡æœ‰å­˜å‚¨å¤šå°‘æ•°æ®ï¼Œè¦æ³¨æ„è¾¨åˆ«ã€‚è¿™ç§ä¸€èˆ¬å¯¹å…¶assignså°±å¯ä»¥äº†ã€‚<br><img src="https://img-blog.csdnimg.cn/20200416012024639.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¯¹äºä¸€äº›å¤§è¡¨å¯èƒ½æœ‰ä¸Šåƒä¸ªregionçš„ï¼Œä¸€ä¸ªä¸ªç”„é€‰æœªå…å¤ªæµªè´¹æ—¶é—´ï¼Œå¯ä»¥ç›´æ¥åœ¨webç•Œé¢å°†å…¶regionåŒºåŸŸå…¨éƒ¨æ‹·è´ä¸‹æ¥ï¼Œå¤åˆ¶åˆ°txtï¼Œä½¿ç”¨ä¸‹è¿°å‘½ä»¤è¿›è¡Œç­›é€‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat regions.txt |grep -v &#x27;GB&#x27; |grep -v &#x27;MB&#x27; &gt; region2.txt</span><br></pre></td></tr></table></figure></li><li><p>é«˜ç‰ˆæœ¬çš„hbaseæœ‰hbckè®°å½•é¡µï¼Œå»é¡µé¢æŸ¥çœ‹ï¼Œæ ¹æ®æé†’æ“ä½œå°±è¡Œï¼Œæ›´æ–¹ä¾¿<br><img src="https://img-blog.csdnimg.cn/20201214142116129.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä½¿ç”¨ä»¥ä¸‹Javaä»£ç å³å¯æå–å‡ºencodedName</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printRegionEncodedName</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    List&lt;String&gt; lines = FileUtil.readUtf8Lines(<span class="string">&quot;C:\\tmp\\region2.txt&quot;</span>);</span><br><span class="line">    List&lt;String&gt; regionEncodedNameList= Lists.newArrayListWithExpectedSize(lines.size());</span><br><span class="line">    <span class="keyword">for</span> (String line : lines) &#123;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(line))&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> point1=line.indexOf(<span class="string">&quot;.&quot;</span>) ;</span><br><span class="line">        <span class="keyword">int</span> point2=line.indexOf(<span class="string">&quot;.&quot;</span>, line.indexOf(<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">        String s = line.substring(point1+<span class="number">1</span>, point2);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        regionEncodedNameList.add(s);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;size:&quot;</span>+regionEncodedNameList.size());</span><br><span class="line">    <span class="keyword">try</span> (PrintWriter pw = <span class="keyword">new</span> PrintWriter(<span class="keyword">new</span> FileWriter(<span class="string">&quot;C:\\tmp\\encodedName.txt&quot;</span>));)&#123;</span><br><span class="line">        regionEncodedNameList.forEach(regionEncodedName-&gt;pw.println(regionEncodedName+<span class="string">&quot; &quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååˆæ˜¯ <em><strong>cat encodedName.txt | xargs hbase org.apache.hbase.HBCK2 assigns</strong></em> å°±å¯ä»¥äº†<br>å¦‚ä¸‹ï¼Œä¸€æ¬¡æ€§å¯¹å¤§é‡regionè¿›è¡Œæ“ä½œ<br><img src="https://img-blog.csdnimg.cn/20201214141729730.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li></ol><h3 id="3-æ³¨æ„äº‹é¡¹"><a href="#3-æ³¨æ„äº‹é¡¹" class="headerlink" title="3. æ³¨æ„äº‹é¡¹"></a>3. æ³¨æ„äº‹é¡¹</h3><p>å¯¹procedureæ‰§è¡Œbypassåå…¶çŠ¶æ€ä¼šç”±waitingè½¬æ¢ä¸ºsuccess(bypassed)ï¼Œä½†ä¸ä¼šç«‹å³ç§»é™¤å‡ºrité˜Ÿåˆ—ã€‚å¯é€šè¿‡é‡å¯masterè§£å†³ã€‚        </p>]]></content>
      
      
      <categories>
          
          <category> å¤§æ•°æ® </category>
          
          <category> HBASE </category>
          
          <category> bug </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hbase </tag>
            
            <tag> debug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k8så¸¸ç”¨å‘½ä»¤ç¬”è®°</title>
      <link href="//kubernetes-commands/"/>
      <url>//kubernetes-commands/</url>
      
        <content type="html"><![CDATA[<p>ä¸€äº›è‡ªç”¨çš„kubectlå‘½ä»¤</p><span id="more"></span><h3 id="é‡å¯pod"><a href="#é‡å¯pod" class="headerlink" title="é‡å¯pod"></a>é‡å¯pod</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NAME_SPACE=anyonedev</span><br><span class="line">kubectl get pod podname -n=$&#123;NAME_SPACE&#125; -o yaml | kubectl replace --force -f  - </span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¼ºåˆ¶åˆ é™¤pod"><a href="#å¼ºåˆ¶åˆ é™¤pod" class="headerlink" title="å¼ºåˆ¶åˆ é™¤pod"></a>å¼ºåˆ¶åˆ é™¤pod</h3><p>è§£å†³ï¼šåŠ å‚æ•°<code> --force --grace-period=0</code><br><strong>grace-period</strong>è¡¨ç¤ºè¿‡æ¸¡å­˜æ´»æœŸï¼Œé»˜è®¤30sï¼Œåœ¨åˆ é™¤PODä¹‹å‰å…è®¸PODæ…¢æ…¢ç»ˆæ­¢å…¶ä¸Šçš„å®¹å™¨è¿›ç¨‹ï¼Œä»è€Œä¼˜é›…é€€å‡º<br>0è¡¨ç¤ºç«‹å³ç»ˆæ­¢POD</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod &lt;your-pod-name&gt; -n=&lt;name-space&gt; --force --grace-period=0</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ ¹æ®çŠ¶æ€è¿‡æ»¤æ‰¹é‡æ“ä½œ"><a href="#æ ¹æ®çŠ¶æ€è¿‡æ»¤æ‰¹é‡æ“ä½œ" class="headerlink" title="æ ¹æ®çŠ¶æ€è¿‡æ»¤æ‰¹é‡æ“ä½œ"></a>æ ¹æ®çŠ¶æ€è¿‡æ»¤æ‰¹é‡æ“ä½œ</h3><p>è¿‡æ»¤æ¡ä»¶ï¼š ImagePullBackOff|CrashLoopBackOff|Evicted|Terminating</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">NAME_SPACE=anyonedev</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># åˆ é™¤æ‰€æœ‰ImagePullBackOffæˆ–CrashLoopBackOffçš„pod</span></span></span><br><span class="line">kubectl get pods -n=$&#123;NAME_SPACE&#125; | grep -E &#x27;ImagePullBackOff|CrashLoopBackOff&#x27;  | awk &#x27;&#123;print $1&#125;&#x27; | xargs kubectl delete pod  -n=$&#123;NAME_SPACE&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># é‡å¯æ‰€æœ‰evictedæˆ–Terminatingçš„pod</span></span></span><br><span class="line">kubectl get pods -n=$&#123;NAME_SPACE&#125; | grep -E &#x27;Evicted|Terminating&#x27;  | awk &#x27;&#123;print $1&#125;&#x27; | xargs kubectl get pod  -n=$&#123;NAME_SPACE&#125; -o yaml | kubectl replace --force -f  - </span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kubernetes </tag>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥è§£æSpringä½¿ç”¨æšä¸¾æ¥æ”¶å‚æ•°å’Œè¿”å›å€¼æœºåˆ¶å¹¶æä¾›è‡ªå®šä¹‰æœ€ä½³å®è·µ</title>
      <link href="//spring_enum/"/>
      <url>//spring_enum/</url>
      
        <content type="html"><![CDATA[<p>Springå¯¹åº”æšä¸¾ä¼ å‚/è¿”å›å€¼é»˜è®¤æ˜¯ç”¨å­—é¢é‡å®ç°çš„ï¼ˆå®é™…æƒ…å†µæ›´å¤æ‚ï¼‰ï¼Œè€Œã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹è§„å®šæ¥å£è¿”å›å€¼ä¸å¯ä»¥ä½¿ç”¨æšä¸¾ç±»å‹ï¼ˆåŒ…æ‹¬å«æšä¸¾ç±»å‹çš„POJOå¯¹è±¡ï¼‰ï¼Œä¸ºæ­¤ï¼Œæœ¬æ–‡æ¢ç©¶äº†Springå†…éƒ¨å¯¹æšä¸¾å‚æ•°çš„ä¼ é€’å’Œå¤„ç†æœºåˆ¶ï¼Œå¹¶æä¾›äº†ä¸€å¥—è‡ªå®šä¹‰æ–¹æ¡ˆã€‚</p><span id="more"></span><h2 id="ä¸€-ç›®æ ‡ä¸æ€è·¯"><a href="#ä¸€-ç›®æ ‡ä¸æ€è·¯" class="headerlink" title="ä¸€ ç›®æ ‡ä¸æ€è·¯"></a>ä¸€ ç›®æ ‡ä¸æ€è·¯</h2><h3 id="0-èµ·å› "><a href="#0-èµ·å› " class="headerlink" title="0 èµ·å› "></a>0 èµ·å› </h3><p>ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹å°†æ¥å£ä¸­æšä¸¾çš„ä½¿ç”¨åˆ†ä¸ºä¸¤ç±»ï¼Œå³ æ¥å£å‚æ•°å’Œæ¥å£è¿”å›å€¼ï¼Œå¹¶è§„å®šï¼š<br><strong>æ¥å£å‚æ•°å¯ä»¥ä½¿ç”¨æšä¸¾ç±»å‹ï¼Œä½†æ¥å£è¿”å›å€¼ä¸å¯ä»¥ä½¿ç”¨æšä¸¾ç±»å‹ï¼ˆåŒ…æ‹¬å«æšä¸¾ç±»å‹çš„POJOå¯¹è±¡ï¼‰</strong>ã€‚</p><p>çŸ¥ä¹æœ‰ç›¸å…³è®¨è®ºå’Œä½œè€…äº²ç­”ï¼Œè¯¦æƒ…å¯è§ï¼š<a href="https://www.zhihu.com/question/52760637">Javaæšä¸¾ä»€ä¹ˆä¸å¥½ï¼Œã€Šé˜¿é‡Œå·´å·´JAVAå¼€å‘æ‰‹å†Œã€‹å¯¹äºæšä¸¾è§„å®šçš„è€ƒé‡æ˜¯ä»€ä¹ˆï¼Ÿ</a></p><p>ç°æ‘˜å½•ä¸€éƒ¨åˆ†ä½œè€…å›ç­”å¦‚ä¸‹ï¼š</p><blockquote><blockquote><p><strong>ç”±äºå‡çº§åŸå› ï¼Œå¯¼è‡´åŒæ–¹çš„æšä¸¾ç±»ä¸å°½ç›¸åŒï¼Œåœ¨æ¥å£è§£æï¼Œç±»ååºåˆ—åŒ–æ—¶å‡ºç°å¼‚å¸¸</strong>ã€‚</p></blockquote><blockquote><p>Javaä¸­å‡ºç°çš„ä»»ä½•å…ƒç´ ï¼Œåœ¨Goslingçš„è§’åº¦éƒ½ä¼šæœ‰èƒŒåçš„æ€è€ƒå’Œé€»è¾‘ï¼ˆå°½ç®¡å¹¶éç»å¯¹å®Œç¾ï¼Œä½†Javaçš„é¡¶å±‚æŠ½è±¡å·²ç»æ˜¯å¤©æ‰çº§äº†ï¼‰ï¼Œæ¯”å¦‚ï¼šæ¥å£ã€æŠ½è±¡ç±»ã€æ³¨è§£ã€å’Œæœ¬æ–‡æåˆ°çš„æšä¸¾ã€‚æšä¸¾æœ‰å¥½å¤„ï¼Œç±»å‹å®‰å…¨ï¼Œæ¸…æ™°ç›´æ¥ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç­‰å·æ¥åˆ¤æ–­ï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨switchä¸­ã€‚<code>å®ƒçš„åŠ£åŠ¿ä¹Ÿæ˜¯æ˜æ˜¾çš„ï¼Œå°±æ˜¯ä¸è¦æ‰©å±•</code>ã€‚å¯æ˜¯ä¸ºä»€ä¹ˆåœ¨è¿”å›å€¼å’Œå‚æ•°è¿›è¡Œäº†åŒºåˆ†å‘¢ï¼Œå¦‚æœä¸å…¼å®¹ï¼Œé‚£ä¹ˆä¸¤ä¸ªéƒ½æœ‰é—®é¢˜ï¼Œæ€ä¹ˆå…è®¸å‚æ•°å¯ä»¥æœ‰æšä¸¾ã€‚å½“æ—¶çš„è€ƒè™‘ï¼Œå¦‚æœå‚æ•°ä¹Ÿä¸èƒ½ç”¨ï¼Œé‚£ä¹ˆæšä¸¾å‡ ä¹æ— ç”¨æ­¦ä¹‹åœ°äº†ã€‚å‚æ•°è¾“å‡ºï¼Œæ¯•ç«Ÿæ˜¯æœ¬åœ°å†³å®šçš„ï¼Œä½ æœ¬åœ°æœ‰çš„ï¼Œä¼ é€è¿‡å»ï¼Œå‘å‰å…¼å®¹æ˜¯ä¸ä¼šæœ‰é—®é¢˜çš„ã€‚ä½†å¦‚æœæ˜¯æ¥å£è¿”å›ï¼Œå°±æ¯”è¾ƒæ¶å¿ƒäº†ï¼Œå› ä¸ºè§£æå›æ¥çš„è¿™ä¸ªæšä¸¾å€¼ï¼Œå¯èƒ½æœ¬åœ°è¿˜æ²¡æœ‰ï¼Œè¿™æ—¶å°±ä¼šæŠ›å‡ºåºåˆ—åŒ–å¼‚å¸¸ã€‚</p></blockquote><blockquote><p>æ¯”å¦‚ï¼šä½ çš„æœ¬åœ°æšä¸¾ç±»ï¼Œæœ‰ä¸€ä¸ªå¤©æ°”Enumï¼šSUNNY, RAINY, CLOUDYï¼Œå¦‚æœæ ¹æ®å¤©æ°”è®¡ç®—å¿ƒæƒ…çš„æ–¹æ³•ï¼šguess(WeatcherEnum xx)ï¼Œä¼ å…¥è¿™ä¸‰ä¸ªå€¼éƒ½æ˜¯å¯ä»¥çš„ã€‚è¿”å›å€¼ï¼šWeather guess(å‚æ•°)ï¼Œé‚£ä¹ˆå¯¹æ–¹è¿ç®—åï¼Œè¿”å›ä¸€ä¸ªSNOWYï¼Œæœ¬åœ°æšä¸¾é‡Œæ²¡æœ‰è¿™ä¸ªå€¼ï¼Œå‚»çœ¼äº†ã€‚</p></blockquote></blockquote><p>å½“ç„¶ï¼Œä½¿ç”¨ code ç…§æ ·ä¸èƒ½å¤„ç†ï¼Œå¯¹æ­¤ï¼Œå¼€å‘æ‰‹å†Œä½œè€…çš„å›ç­”å¦‚ä¸‹</p><blockquote><p>ä¸»è¦æ˜¯ä»é˜²æ­¢è¿™ç§åºåˆ—åŒ–å¼‚å¸¸è§’åº¦æ¥è€ƒè™‘ï¼Œä½¿ç”¨codeè‡³å°‘ä¸ä¼šå‡ºå¤§ä¹±å­ã€‚è€Œcatchåºåˆ—åŒ–å¼‚å¸¸ï¼Œæœ‰ç‚¹åƒcatch(NullPointerException e)ä¸€æ ·ä»£ç è¿‡åº¦ï¼Œå› ä¸ºå®ƒæ˜¯å¯é¢„æ£€å¼‚å¸¸ã€‚</p></blockquote><h3 id="1-ç»Ÿä¸€ç§°è°“"><a href="#1-ç»Ÿä¸€ç§°è°“" class="headerlink" title="1 ç»Ÿä¸€ç§°è°“"></a>1 ç»Ÿä¸€ç§°è°“</h3><p>å‡å¦‚æœ‰ä¸€æšä¸¾ç±»å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ReturnCodeEnum</span> </span>&#123;</span><br><span class="line">    OK(<span class="number">200</span>),</span><br><span class="line">    ERROR(<span class="number">500</span>)</span><br><span class="line">    ;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> code;</span><br><span class="line">    ReturnCodeEnum(<span class="keyword">int</span> code)&#123;</span><br><span class="line">        <span class="keyword">this</span>.code=code;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æšä¸¾å®ä¾‹æœ‰ä¸¤ä¸ªé»˜è®¤å±æ€§ï¼Œ<code>name</code> å’Œ <code>ordinal</code>ï¼Œå¯é€šè¿‡ name()å’Œordinal()æ–¹æ³•åˆ†åˆ«è·å¾—ã€‚å…¶ä¸­ name ä¸ºæšä¸¾å­—é¢é‡ï¼ˆå¦‚ OKï¼‰ï¼Œordinal ä¸ºæšä¸¾å®ä¾‹é»˜è®¤æ¬¡åºï¼ˆä»0å¼€å§‹ï¼‰<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸å»ºè®®ä½¿ç”¨æšä¸¾çš„ ordinalï¼Œå› ä¸ºæšä¸¾å®ä¾‹åº”è¯¥æ˜¯æ— åºçš„ï¼Œordinal æä¾›çš„é¡ºåºæ˜¯ä¸å¯é çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä½¿ç”¨è‡ªå®šä¹‰çš„æšä¸¾å­—æ®µ codeã€‚</p></blockquote><p>åæ–‡ä¸ºæ–¹ä¾¿é˜è¿°ï¼Œä»¥ å­—é¢é‡ï¼ˆnameï¼‰ã€é»˜è®¤æ¬¡åºï¼ˆordinalï¼‰å’Œ codeæ¥å±•å¼€é˜è¿°ã€‚å¦‚ OK çš„ å­—é¢é‡ä¸º OKï¼Œordinal ä¸º 0 ï¼Œcodeä¸º 200ã€‚</p><h3 id="2-ç›®æ ‡"><a href="#2-ç›®æ ‡" class="headerlink" title="2 ç›®æ ‡"></a>2 ç›®æ ‡</h3><h4 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h4><ol><li>ç›´æ¥ä½¿ç”¨ æšä¸¾ç±»å‹ <strong>æ¥æ”¶å‚æ•°</strong>å’Œ<strong>è¿”å›å€¼</strong></li><li>ç³»ç»Ÿè‡ªåŠ¨å°† å‚æ•°ä¸­çš„ code è½¬æ¢ä¸º æšä¸¾ç±»å‹ï¼Œè‡ªåŠ¨å°† è¿”å›å€¼ä¸­çš„æšä¸¾ç±»å‹è½¬æ¢ä¸º code</li></ol><h4 id="å®ç°æ•ˆæœ"><a href="#å®ç°æ•ˆæœ" class="headerlink" title="å®ç°æ•ˆæœ"></a>å®ç°æ•ˆæœ</h4><p>å¯¹äºå®ç°é€šç”¨codeæšä¸¾æ¥å£çš„æšä¸¾ç±»å‹ï¼Œæœ‰å¦‚ä¸‹æ•ˆæœï¼š</p><ol><li>ä½¿ç”¨ beanï¼ˆ<strong>application/x-www-form-urlencoded</strong>ï¼‰æ¥æ”¶æ—¶ï¼Œæ”¯æŒ code è‡ªåŠ¨è½¬æ¢ä¸º æšä¸¾ç±»å‹ï¼ŒåŒæ—¶å…¼å®¹ å­—é¢é‡è½¬æ¢ä¸ºæšä¸¾ç±»å‹ã€‚æ³¨æ„ï¼šè¡¨å•æ¥æ”¶çš„å‚æ•°éƒ½è§†ä¸º Stringï¼Œå³æ˜¯å°†Stringè½¬ä¸º æšä¸¾ç±»å‹</li><li>ä½¿ç”¨ @RequestBody ï¼ˆ<strong>application/json</strong>ï¼‰æ¥æ”¶æ—¶ï¼Œé»˜è®¤åªæ”¯æŒ code è‡ªåŠ¨è½¬æ¢ä¸ºæšä¸¾ç±»å‹ã€‚å¦‚æœéœ€è¦åŒæ—¶æ”¯æŒ code å’Œ å­—é¢é‡ï¼ˆæˆ–è€…åªæ”¯æŒå­—é¢é‡ï¼‰ï¼Œå¯ä»¥åœ¨å…·ä½“çš„æšä¸¾ç±»é‡Œæ·»åŠ @JsonCreatoræ³¨è§£çš„æ–¹æ³•ï¼Œä¸‹æ–‡ä¼šç»™å‡ºå‚è€ƒå®ç°ã€‚</li><li>å¯ä»¥ä½¿ç”¨ @RequestParam å’Œ @PathVariable æ¥æ”¶æšä¸¾ç±»å‹å‚æ•°</li><li>ä½¿ç”¨ @ResponseBody / @RestControllerï¼ˆè¿”å› Jsonï¼‰æ—¶ï¼Œé»˜è®¤å°† æšä¸¾ç±»å‹è½¬æ¢ä¸º codeã€‚</li><li>åœ¨æ¥æ”¶å‚æ•°/è¿”å›å€¼éƒ½ä¸å…è®¸ä½¿ç”¨ ordinal ï¼Œè¿™åªä¼šå¯¼è‡´æ··ä¹±ã€‚</li></ol><h3 id="3-SpringMVC-å¯¹-æšä¸¾å‚æ•°çš„å¤„ç†"><a href="#3-SpringMVC-å¯¹-æšä¸¾å‚æ•°çš„å¤„ç†" class="headerlink" title="3 SpringMVC å¯¹ æšä¸¾å‚æ•°çš„å¤„ç†"></a>3 SpringMVC å¯¹ æšä¸¾å‚æ•°çš„å¤„ç†</h3><p>æ­¤å¤„åªå¯¹ restful æ¥å£è¿›è¡Œè®¨è®ºã€‚å¯¹äº restful æ¥å£ï¼ŒSpring MVC çš„è¿”å›å€¼æ˜¯ä½¿ç”¨ @ResponseBody è¿›è¡Œå¤„ç†çš„ã€‚<br>è€Œå‚æ•°çš„æ¥æ”¶æ–¹å¼åˆ™è¾ƒå¤šï¼Œå¯¹äºéç®€å•ç±»å‹ï¼Œå¦‚ Enum ï¼Œä¸€èˆ¬çš„æ¥æ”¶æ–¹æ³•ä¸º Bean æ¥æ”¶æˆ– @ResponseBody æ¥æ”¶ã€‚</p><h4 id="Springä½¿ç”¨Beanæ¥æ”¶æšä¸¾å‚æ•°"><a href="#Springä½¿ç”¨Beanæ¥æ”¶æšä¸¾å‚æ•°" class="headerlink" title="Springä½¿ç”¨Beanæ¥æ”¶æšä¸¾å‚æ•°"></a>Springä½¿ç”¨Beanæ¥æ”¶æšä¸¾å‚æ•°</h4><p>ç®€å•æ¥è¯´ Spring é»˜è®¤ä½¿ç”¨Beanæ¥æ”¶æšä¸¾å‚æ•°æ—¶æ”¯æŒ <code>å­—é¢é‡</code>ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è§çš„åšæ³•ã€‚</p><blockquote><p>å‚è€ƒè‡ªï¼š<a href="http://note4code.com/2018/03/12/spring%E4%B8%8E%E6%9E%9A%E4%B8%BE%E5%8F%82%E6%95%B0/">Springä¸æšä¸¾å‚æ•°</a></p><blockquote><p>GET è¯·æ±‚å’Œ POST Form è¯·æ±‚ä¸­çš„å­—ç¬¦ä¸²åˆ°æšä¸¾çš„è½¬åŒ–æ˜¯é€šè¿‡ org.springframework.core.convert.support.StringToEnumConverterFactory æ¥å®ç°çš„.<br>è¯¥ç±»å®ç°äº†æ¥å£ ConverterFactory ï¼Œé€šè¿‡è°ƒç”¨ Enum.valueOf(Class, String) å®ç°äº†è¿™ä¸ªåŠŸèƒ½ã€‚<br>å‘ä¸‹è¿½æº¯æºç å¯ä»¥å‘ç°è¯¥æ–¹æ³•å®é™…ä¸Šæ˜¯ä»ä¸€ä¸ª Map&lt;String, Enum&gt; çš„å­—å…¸ä¸­è·å–äº†è½¬æ¢åçš„å®é™…å€¼ï¼Œç€è¿™ä¸ª String ç±»å‹çš„ Key çš„è·å–æ–¹å¼å°±æ˜¯ Enum.name() è¿”å›çš„ç»“æœï¼Œå³<code>æšä¸¾çš„å­—é¢å€¼</code>ã€‚</p></blockquote></blockquote><h4 id="Springä½¿ç”¨-RequestBody-æ¥æ”¶æšä¸¾å‚æ•°"><a href="#Springä½¿ç”¨-RequestBody-æ¥æ”¶æšä¸¾å‚æ•°" class="headerlink" title="Springä½¿ç”¨@RequestBody æ¥æ”¶æšä¸¾å‚æ•°"></a>Springä½¿ç”¨@RequestBody æ¥æ”¶æšä¸¾å‚æ•°</h4><p>ç®€å•æ¥è¯´ Springä½¿ç”¨@RequeseBody æ¥æ”¶æšä¸¾å‚æ•°æ—¶æ”¯æŒ <code>å­—é¢é‡å’Œ ordinal</code></p><p>å¯¹äº@RequestBodyï¼ŒSpringä¼šå°†å…¶å†…å®¹è§†ä¸ºä¸€æ®µ Jsonï¼Œæ‰€åšå·¥ä½œä¸ºä½¿ç”¨ Jackson å®Œæˆååºåˆ—åŒ–ã€‚å…¶å®ç°ä¼šç»è¿‡Jacksonçš„EnumDeserializerçš„deserializeæ–¹æ³•ã€‚æ„Ÿå…´è¶£çš„å¯ä»¥å»çœ‹çœ‹æºç ï¼Œè¿™é‡Œä¸è´´å‡ºæ¥ï¼Œè®²ä¸€ä¸‹æ€è·¯ï¼š</p><ol><li><p>ä½¿ç”¨å­—é¢é‡ï¼ˆStringï¼‰è¿›è¡Œååºåˆ—åŒ–</p></li><li><p>åˆ¤æ–­æ˜¯å¦æ˜¯ int ç±»å‹ï¼Œå¦‚æœæ˜¯ä½¿ç”¨ ordinal è¿›è¡Œååºåˆ—åŒ–ï¼Œå¦‚æœæ•°å­—ä¸åœ¨ ordinal é‡Œé¢ï¼Œåˆ™æŠ›å¼‚å¸¸</p></li><li><p>åˆ¤æ–­æ˜¯å¦æ˜¯æ•°ç»„ï¼Œæ˜¯çš„è¯äº¤ç”±æ•°ç»„å¤„ç†ï¼Œå¦åˆ™æŠ›å¼‚å¸¸</p><h4 id="Springä½¿ç”¨-ResponseBody-è¿”å›å€¼"><a href="#Springä½¿ç”¨-ResponseBody-è¿”å›å€¼" class="headerlink" title="Springä½¿ç”¨@ResponseBody è¿”å›å€¼"></a>Springä½¿ç”¨@ResponseBody è¿”å›å€¼</h4><p>å¦‚æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨æ‰€è§ï¼Œè¿”å›çš„æ˜¯å­—é¢é‡</p><h3 id="4-æ€è·¯"><a href="#4-æ€è·¯" class="headerlink" title="4 æ€è·¯"></a>4 æ€è·¯</h3><p>å‚ç…§Springå¯¹æšä¸¾å‚æ•°çš„å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›è¦†ç›–/æ›¿æ¢Springçš„å¤„ç†æ¥è¾¾åˆ°æˆ‘ä»¬çš„æ•ˆæœï¼Œ<br>ç»æœ¬äººæµ‹è¯•ï¼Œæ¯”è¾ƒå¥½çš„å®ç°æ–¹æ¡ˆæœ‰ï¼ˆä¸è€ƒè™‘åå°„ï¼‰ï¼š</p></li><li><p>è‡ªå®šä¹‰Beanæ¥æ”¶æšä¸¾å‚æ•°è§„åˆ™ï¼š</p><ol><li>å¯è¡Œæ–¹æ¡ˆ<br>é€šè¿‡Spring MVCæ³¨å…¥ç‰¹å®šç±»å‹è‡ªå®šä¹‰è½¬æ¢å™¨å®ç°ä»codeåˆ° æšä¸¾çš„è‡ªåŠ¨è½¬æ¢</li><li>åšæ³•<br>ä½¿ç”¨ WebMvcConfigurerçš„<code>addFormatters</code>æ³¨å…¥è‡ªå®šä¹‰ConverterFactoryï¼Œè¯¥å·¥å‚è´Ÿè´£ç”Ÿæˆ é€šç”¨codeæšä¸¾æ¥å£çš„å®ç°ç±»å¯¹åº”çš„è½¬æ¢å™¨<br>è¯¦è§ç¬¬äºŒéƒ¨åˆ†â€“ä»£ç å®ç°ã€‚</li><li>å‚è€ƒèµ„æ–™<br><a href="https://blog.csdn.net/u014527058/article/details/62883573">Spring Bootç»‘å®šæšä¸¾ç±»å‹å‚æ•°</a></li></ol></li><li><p>è‡ªå®šä¹‰@RequestBody å’Œ@ResponseBodyå¤„ç†æšä¸¾å‚æ•°</p><ol><li><p>å¯è¡Œæ–¹æ¡ˆ<br>ä½¿ç”¨<code>@JsonValue</code>è‡ªå®šä¹‰ç‰¹å®šæšä¸¾ç±»çš„Jacksonåºåˆ—åŒ–/ååºåˆ—åŒ–æ–¹å¼</p><ol><li>å…·ä½“åšæ³•<br>ä½¿ç”¨ <code>@JsonValue</code>æ³¨è§£æ ‡è®°  è·å–codeå€¼çš„æšä¸¾å®ä¾‹æ–¹æ³•ã€‚</li><li>æ³¨æ„äº‹é¡¹<br>è¯¥codeå€¼æ˜¯ä½¿ç”¨jackson<code>åºåˆ—åŒ–</code>/<code>ååºåˆ—åŒ–</code>æ—¶æšä¸¾å¯¹åº”çš„å€¼ï¼Œä¼šè¦†ç›–åŸæ¥ä»å­—é¢é‡ååºåˆ—åŒ–å›æšä¸¾çš„é»˜è®¤å®ç°ã€‚<br>å¦‚æœæƒ³è¦ä¿ç•™åŸæ¥ä»å­—é¢é‡ååºåˆ—åŒ–å›æšä¸¾ç±»çš„åŠŸèƒ½ï¼Œéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª<code> @JsonCreator</code> çš„æ„é€ /é™æ€å·¥å‚æ–¹æ³•ã€‚</li><li>ç›¸å…³ä»£ç <br>ä»£ç å¦‚ä¸‹ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonValue</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonCreator</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ReturnCodeEnum <span class="title">create</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ReturnCodeEnum.valueOf(name);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (IllegalArgumentException e)&#123;</span><br><span class="line">        <span class="keyword">int</span> code=Integer.parseInt(name);</span><br><span class="line">        <span class="keyword">for</span> (ReturnCodeEnum value : ReturnCodeEnum.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span>(value.code==code)&#123;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;No element matches &quot;</span>+name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li><li><p>ä¸å¯è¡Œæ–¹æ¡ˆ</p><ol><li><p>æ›¿æ¢@RequestBodyå’Œ@ResponseBodyæˆ–ç›¸å…³å¤„ç†å™¨  / è‡ªå®šä¹‰HttpMessageConverter</p><ul><li><p>ä¾‹å­<br>å¦‚ä½¿ç”¨è‡ªå®šä¹‰çš„ @ResponseBody æ³¨è§£åŠå¯¹åº” HandlerMethodReturnValueHandler<br>ä½¿ç”¨è‡ªå®šä¹‰ HttpMessageConverter å®ç°å¯¹ json è¿”å›èµ„æºçš„å®Œå…¨æ§åˆ¶</p></li><li><p>ä¸å¯è¡ŒåŸå› <br>æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨ @ResponseBody æ˜¯äº¤ç»™ <code>RequestResponseBodyMethodProcessor </code>è¿™ä¸ªç±»å¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥å¼ƒç”¨@ResponseBodyå¹¶è‡ªå·±å†™ä¸€ä¸ªæ³¨è§£å’Œå¯¹è´Ÿè´£å¤„ç†è¯¥æ³¨è§£çš„ HandlerMethodReturnValueHandlerã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®Œå…¨æ§åˆ¶è¿”å›å€¼çš„å¤„ç†äº†ã€‚è¿™æ ·ä¹Ÿå°±ç›¸å¯¹äºæ”¾å¼ƒäº† @ResponseBodyã€‚<br>è‡ªå·±å®ç° HttpMessageConverter åˆ™æ˜¯åœ¨æ›´é«˜çš„å±‚æ¬¡è¿›è¡Œå¤„ç†ï¼Œä»£ä»·å¤ªå¤§ã€‚</p></li><li><p>ç›¸å…³èµ„æ–™<br><a href="https://www.baeldung.com/spring-httpmessageconverter-rest">baeldungï¼šHttp Message Converters with the Spring Framework</a><br><a href="https://www.baeldung.com/spring-type-conversions">baeldungï¼šGuide to Spring Type Conversions</a><br>è‡ªå®šä¹‰æ³¨è§£å’ŒHandlerMethodReturnValueHandlerå¯ä»¥å‚è€ƒï¼š<br><a href="https://www.ctolib.com/topics-109580.html">Spring MVC æ›´çµæ´»çš„æ§åˆ¶ json è¿”å›ï¼ˆè‡ªå®šä¹‰è¿‡æ»¤å­—æ®µï¼‰</a><br><a href="https://www.jianshu.com/p/4fa3006c066f">æ·±å…¥Spring:è‡ªå®šä¹‰ResponseBody</a><br><a href="http://www.xiaojiezhu.com/wordpress/?p=17#i">springè‡ªå®šä¹‰è¿”å›å€¼è§£æå™¨</a><br><a href="http://www.cnblogs.com/fangjian0423/p/springMVC-request-param-analysis.html#interface_demo">è¯¦è§£SpringMVCä¸­Controllerçš„æ–¹æ³•ä¸­å‚æ•°çš„å·¥ä½œåŸç†[é™„å¸¦æºç åˆ†æ]</a><br><a href="https://blog.csdn.net/a67474506/article/details/46364159">SpringMVC å­¦ä¹ ç¬”è®°(ä¸ƒ) JSONè¿”å›:HttpMessageConverterä½œç”¨</a><br><a href="https://www.scienjus.com/custom-http-message-converter/">ä½¿ç”¨è‡ªå®šä¹‰HttpMessageConverterå¯¹è¿”å›å†…å®¹è¿›è¡ŒåŠ å¯†</a><br><a href="https://www.jianshu.com/p/e25ecc0c5762">è‡ªå®šä¹‰æšä¸¾ â€” Gsonè½¬æ¢</a></p></li></ul></li><li><p>ä½¿ç”¨@JsonCreatoråœ¨æ¥å£å±‚é¢å®šä¹‰ååºåˆ—åŒ–è§„åˆ™</p><ul><li>ä¸å¯è¡ŒåŸå› </li></ul><p>   <strong>@JsonCreatoråªé€‚ç”¨äºæšä¸¾ç±»ä¸é€‚ç”¨äºæ¥å£ã€‚</strong><br>   @JsonCreatoræœ¬è´¨ä¸Šæ˜¯è¦åœ¨æ²¡æœ‰ç±»å®ä¾‹çš„æ—¶å€™ä½¿ç”¨çš„ï¼Œæ‰€ä»¥åªèƒ½æ ‡è®°åœ¨ æ„é€ æ–¹æ³•æˆ–è€…é™æ€å·¥å‚æ–¹æ³•ä¸Šï¼Œæ¥å£çš„è¯ä¸å¯è¡Œï¼Œä¼ ç»Ÿçš„æ¥å£æ–¹æ³•å±å®ä¾‹æ–¹æ³•ï¼Œæ–°å¢çš„ default æ–¹æ³•ä¹Ÿå±å®ä¾‹æ–¹æ³•ï¼Œå¦å¤–çš„ static æ–¹æ³•åˆä¸å¯ç»§æ‰¿ã€‚æ‰€ä»¥è¿™ä¸ªæ€è·¯åªé™äºå…·ä½“ç±»å‹ï¼Œä¸é€‚ç”¨äºæ¥å£ã€‚</p><ul><li>ç›¸å…³èµ„æ–™<br>ç›¸å…³Jacksonèµ„æ–™å‚è€ƒï¼š<br><a href="https://github.com/FasterXML/jackson-annotations/wiki/Jackson-Annotations">Githubï¼šJacksonæ³¨è§£å®˜æ–¹æ–‡æ¡£</a><br><a href="https://cloud.tencent.com/developer/article/1147127">Jacksonå¸¸ç”¨æ³¨è§£è¯¦è§£1 åˆçº§2 ä¸­çº§</a></li></ul></li><li><p>é€‚ç”¨@JsonDeserializeåœ¨æ¥å£å±‚é¢å®šä¹‰ååºåˆ—åŒ–è§„åˆ™</p><ul><li>ä¸å¯è¡ŒåŸå› <br><strong>æ³¨è§£è‡ªå®šä¹‰ä» jsonå­—ç¬¦ä¸² è½¬æ¢ä¸º å®ä½“ç±»çš„æ–¹æ³•ä¹Ÿåªé€‚ç”¨äºæšä¸¾ç±»ä¸é€‚ç”¨äºæ¥å£ã€‚</strong><br>ä½¿ç”¨@JsonDeserialize(using = è‡ªå®šä¹‰ååºåˆ—åŒ–ç±».class)ï¼Œåœ¨è‡ªå®šä¹‰Jacksonååºåˆ—åŒ–ç±»å®ç°deserialize(JsonParser p, DeserializationContext ctxt)æ–¹æ³•ã€‚<br>å¯ä»¥è·å– jsonå­—ç¬¦ä¸²ï¼ˆå³ codeï¼‰ï¼Œä½†æ²¡åŠæ³•é€šè¿‡æ¥å£ä½¿ç”¨codeè·å–æšä¸¾å¯¹è±¡ï¼Œç†ç”±åŒä¸Šï¼Œæ¥å£æ²¡æœ‰å¯ç”¨çš„åŒæ—¶å¯ç»§æ‰¿çš„æ–¹æ³•ã€‚</li><li>ç›¸å…³èµ„æ–™<br>è‡ªå®šä¹‰Jacksonåºåˆ—åŒ–/ååºåˆ—åŒ–ç±»å‚è€ƒï¼š<a href="https://www.ibm.com/developerworks/cn/java/jackson-advanced-application/index.html">IBM:Jackson æ¡†æ¶çš„é«˜é˜¶åº”ç”¨</a></li></ul></li></ol></li></ol></li></ol><h2 id="äºŒ-ä»£ç å®ç°"><a href="#äºŒ-ä»£ç å®ç°" class="headerlink" title="äºŒ ä»£ç å®ç°"></a>äºŒ ä»£ç å®ç°</h2><h3 id="1-é€šç”¨codeæšä¸¾æ¥å£"><a href="#1-é€šç”¨codeæšä¸¾æ¥å£" class="headerlink" title="1 é€šç”¨codeæšä¸¾æ¥å£"></a>1 é€šç”¨codeæšä¸¾æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: linshenkx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2019/1/12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å¸¦ç¼–å·çš„æšä¸¾æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CodedEnum</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨jacksonåºåˆ—åŒ–/ååºåˆ—åŒ–æ—¶æšä¸¾å¯¹åº”çš„å€¼</span></span><br><span class="line"><span class="comment">     * å¦‚æœæƒ³è¦ä¿ç•™åŸæ¥ä»å­—é¢é‡ååºåˆ—åŒ–å›æšä¸¾ç±»çš„åŠŸèƒ½ï¼Œ</span></span><br><span class="line"><span class="comment">     * éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª <span class="doctag">@JsonCreator</span> çš„æ„é€ /é™æ€å·¥å‚æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è‡ªå®šä¹‰æšä¸¾code</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonValue</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-è½¬æ¢å™¨å·¥å‚ç±»"><a href="#2-è½¬æ¢å™¨å·¥å‚ç±»" class="headerlink" title="2 è½¬æ¢å™¨å·¥å‚ç±»"></a>2 è½¬æ¢å™¨å·¥å‚ç±»</h3><p>ä»£ç å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: linshenkx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2019/1/12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å¸¦ç¼–å·çš„æšä¸¾è½¬æ¢å™¨ å·¥å‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CodedEnumConverterFactory</span> <span class="keyword">implements</span> <span class="title">ConverterFactory</span>&lt;<span class="title">String</span>, <span class="title">CodedEnum</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›®æ ‡ç±»å‹ä¸å¯¹åº”è½¬æ¢å™¨çš„Map</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Class,Converter&gt; CONVERTER_MAP=<span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç›®æ ‡ç±»å‹è·å–ç›¸åº”çš„è½¬æ¢å™¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetType ç›®æ ‡ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt; CodedEnumçš„å®ç°ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T extends CodedEnum&gt; <span class="function">Converter&lt;String, T&gt; <span class="title">getConverter</span><span class="params">(Class&lt;T&gt; targetType)</span> </span>&#123;</span><br><span class="line">        Converter converter=CONVERTER_MAP.get(targetType);</span><br><span class="line">        <span class="keyword">if</span>(converter==<span class="keyword">null</span>)&#123;</span><br><span class="line">            converter=<span class="keyword">new</span> IntegerStrToEnumConverter&lt;&gt;(targetType);</span><br><span class="line">            CONVERTER_MAP.put(targetType,converter);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> converter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†intå¯¹åº”çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºç›®æ ‡ç±»å‹çš„è½¬æ¢å™¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt; ç›®æ ‡ç±»å‹ï¼ˆCodedEnumçš„å®ç°ç±»ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">IntegerStrToEnumConverter</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">CodedEnum</span>&gt; <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>,<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Map&lt;String,T&gt; enumMap=<span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">IntegerStrToEnumConverter</span><span class="params">(Class&lt;T&gt; enumType)</span></span>&#123;</span><br><span class="line">            T[] enums=enumType.getEnumConstants();</span><br><span class="line">            <span class="keyword">for</span> (T e:enums)&#123;</span><br><span class="line">                <span class="comment">//ä» code ååºåˆ—åŒ–å›æšä¸¾</span></span><br><span class="line">                enumMap.put(e.getCode()+<span class="string">&quot;&quot;</span>,e);</span><br><span class="line">                <span class="comment">//ä»æšä¸¾å­—é¢é‡ååºåˆ—å›æš</span></span><br><span class="line">                <span class="comment">//æ˜¯Springé»˜è®¤çš„æ–¹æ¡ˆ</span></span><br><span class="line">                <span class="comment">//æ­¤å¤„æ·»åŠ å¯é¿å…ä¸‹é¢convertæ–¹æ³•æŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸åè¢«ç³»ç»Ÿæ•è·å†æ¬¡è°ƒç”¨é»˜è®¤æ–¹æ¡ˆ</span></span><br><span class="line">                enumMap.put(((Enum)e).name()+<span class="string">&quot;&quot;</span>,e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> T <span class="title">convert</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">            T result=enumMap.get(source);</span><br><span class="line">            <span class="keyword">if</span>(result==<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">//æŠ›å‡ºè¯¥å¼‚å¸¸åï¼Œä¼šè°ƒç”¨ spring çš„é»˜è®¤è½¬æ¢æ–¹æ¡ˆï¼Œå³ä½¿ç”¨ æšä¸¾å­—é¢é‡è¿›è¡Œæ˜ å°„</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;No element matches &quot;</span>+source);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Spring-MVC-é…ç½®ç±»"><a href="#3-Spring-MVC-é…ç½®ç±»" class="headerlink" title="3 Spring MVC é…ç½®ç±»"></a>3 Spring MVC é…ç½®ç±»</h3><h4 id="1-ç›¸å…³çŸ¥è¯†"><a href="#1-ç›¸å…³çŸ¥è¯†" class="headerlink" title="1 ç›¸å…³çŸ¥è¯†"></a>1 ç›¸å…³çŸ¥è¯†</h4><ol><li>Spring Boot é»˜è®¤æä¾›Spring MVC è‡ªåŠ¨é…ç½®ï¼Œä¸éœ€è¦ä½¿ç”¨@EnableWebMvcæ³¨è§£</li><li>å¦‚æœéœ€è¦é…ç½®MVCï¼ˆæ‹¦æˆªå™¨ã€æ ¼å¼åŒ–ã€è§†å›¾ç­‰ï¼‰ è¯·ä½¿ç”¨æ·»åŠ @Configurationå¹¶å®ç°WebMvcConfigureræ¥å£.ä¸è¦æ·»åŠ @EnableWebMvcæ³¨è§£ã€‚</li><li>@EnableWebMvc åªèƒ½æ·»åŠ åˆ°ä¸€ä¸ª@Configurationé…ç½®ç±»ä¸Šï¼Œç”¨äºå¯¼å…¥Spring Web MVC configuration</li><li>å¦‚æœSpring Bootåœ¨classpathé‡Œçœ‹åˆ°æœ‰ spring webmvc ä¹Ÿä¼šè‡ªåŠ¨æ·»åŠ @EnableWebMvc</li></ol><p>ç®€å•æ¥è¯´å°±æ˜¯åœ¨SpringBootä¸­ä¸è¦ä½¿ç”¨@EnableWebMvcï¼Œä½¿ç”¨@Configurationæ ‡è®°è‡ªå®šä¹‰@WebMvcConfigurerç±»å°±è¡Œï¼Œè€Œä¸”è¯¥ç±»å…è®¸å¤šä¸ªåŒæ—¶å­˜åœ¨ã€‚</p><p>ç›¸å…³èµ„æ–™ï¼š<br><a href="https://blog.csdn.net/zxc123e/article/details/84636521">Springæ³¨è§£@EnableWebMvcä½¿ç”¨å‘ç‚¹è§£æ</a><br><a href="https://blog.csdn.net/pinebud55/article/details/53420481">è§£æ@EnableWebMvc ã€WebMvcConfigurationSupportå’ŒWebMvcConfigurationAdapter</a><br><a href="https://www.jianshu.com/p/d47a09532de7">WebMvcConfigurationSupportä¸WebMvcConfigurerçš„å…³ç³»</a><br><a href="https://blog.csdn.net/lqadam/article/details/80637335">@EnableWebMvcå¦‚ä½•ç¦æ­¢@EnableAutoConfiguration</a></p><h4 id="2-ä»£ç å®ç°"><a href="#2-ä»£ç å®ç°" class="headerlink" title="2 ä»£ç å®ç°"></a>2 ä»£ç å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: linshenkx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2019/1/12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å°†è½¬æ¢å™¨å·¥å‚æ·»åŠ åˆ°Spring</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CodedEnumWebAppConfigurer</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFormatters</span><span class="params">(FormatterRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addConverterFactory(<span class="keyword">new</span> CodedEnumConverterFactory());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ä¸‰-æµ‹è¯•åŠåˆ†æ"><a href="#ä¸‰-æµ‹è¯•åŠåˆ†æ" class="headerlink" title="ä¸‰ æµ‹è¯•åŠåˆ†æ"></a>ä¸‰ æµ‹è¯•åŠåˆ†æ</h2><h3 id="1-æšä¸¾ç±»"><a href="#1-æšä¸¾ç±»" class="headerlink" title="1 æšä¸¾ç±»"></a>1 æšä¸¾ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: linshenkx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2019/1/13</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: æšä¸¾ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ReturnCodeEnum</span> <span class="keyword">implements</span> <span class="title">CodedEnum</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ­£å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    OK(<span class="number">200</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‡ºé”™</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ERROR(<span class="number">500</span>)</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> code;</span><br><span class="line"></span><br><span class="line">    ReturnCodeEnum(<span class="keyword">int</span> code)&#123;</span><br><span class="line">        <span class="keyword">this</span>.code=code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonCreator</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ReturnCodeEnum <span class="title">create</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> ReturnCodeEnum.valueOf(name);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IllegalArgumentException e)&#123;</span><br><span class="line">            <span class="keyword">int</span> code=Integer.parseInt(name);</span><br><span class="line">            <span class="keyword">for</span> (ReturnCodeEnum value : ReturnCodeEnum.values()) &#123;</span><br><span class="line">                <span class="keyword">if</span>(value.code==code)&#123;</span><br><span class="line">                    <span class="keyword">return</span> value;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;No element matches &quot;</span>+name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-åŒ…å«æšä¸¾ç±»çš„POJO"><a href="#2-åŒ…å«æšä¸¾ç±»çš„POJO" class="headerlink" title="2 åŒ…å«æšä¸¾ç±»çš„POJO"></a>2 åŒ…å«æšä¸¾ç±»çš„POJO</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: linshenkx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2019/1/12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: æšä¸¾åŒ…è£…ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyResult</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ReturnCodeEnum returnCode;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-æµ‹è¯•ç±»"><a href="#3-æµ‹è¯•ç±»" class="headerlink" title="3 æµ‹è¯•ç±»"></a>3 æµ‹è¯•ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: linshenkx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2019/1/12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: æµ‹è¯•ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@PostMapping(value = &quot;/enumForm&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> MyResult <span class="title">testEnumForm</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">         <span class="meta">@RequestBody</span> MyResult myResult)</span> </span>&#123;</span><br><span class="line">    ReturnCodeEnum status = myResult.getReturnCode();</span><br><span class="line">    System.out.println(<span class="string">&quot;name():&quot;</span>+status.name());</span><br><span class="line">    System.out.println(<span class="string">&quot;ordinal():&quot;</span>+status.ordinal());</span><br><span class="line">    System.out.println(<span class="string">&quot;getCode():&quot;</span>+status.getCode());</span><br><span class="line">    <span class="keyword">return</span> myResult;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@PostMapping(value = &quot;/enumJson&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> MyResult <span class="title">testEnumJson</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">          <span class="meta">@RequestBody</span> MyResult myResult)</span> </span>&#123;</span><br><span class="line">    ReturnCodeEnum status = myResult.getReturnCode();</span><br><span class="line">    System.out.println(<span class="string">&quot;name():&quot;</span>+status.name());</span><br><span class="line">    System.out.println(<span class="string">&quot;ordinal():&quot;</span>+status.ordinal());</span><br><span class="line">    System.out.println(<span class="string">&quot;getCode():&quot;</span>+status.getCode());</span><br><span class="line">    <span class="keyword">return</span> myResult;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@PostMapping(value = &quot;/enumPath/&#123;status&#125;&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ReturnCodeEnum <span class="title">testEnumPath</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">          <span class="meta">@PathVariable</span> ReturnCodeEnum status)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@PostMapping(value = &quot;/enumParam&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ReturnCodeEnum <span class="title">testEnumParam</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">          <span class="meta">@RequestParam</span> ReturnCodeEnum status)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–è¿˜éœ€æ³¨å…¥ä¸Šé¢çš„è½¬æ¢å™¨å·¥å‚ï¼Œè¿™é‡Œä¸å†é‡å¤è´´å‡ºã€‚</p><h3 id="4-æµ‹è¯•ç»“æœ"><a href="#4-æµ‹è¯•ç»“æœ" class="headerlink" title="4 æµ‹è¯•ç»“æœ"></a>4 æµ‹è¯•ç»“æœ</h3><h4 id="é¢„æµ‹åˆ†æ"><a href="#é¢„æµ‹åˆ†æ" class="headerlink" title="é¢„æµ‹åˆ†æ"></a>é¢„æµ‹åˆ†æ</h4><p>å¦‚ä¸Šï¼Œå› ä¸ºReturnCodeEnum å®ç°äº† CodedEnum æ¥å£ï¼Œå¹¶æ³¨å…¥å¯¹åº”è½¬æ¢å™¨å·¥å‚ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ è¡¨å•æäº¤çš„æ—¶å€™é€‚ç”¨codeå’Œå­—é¢é‡æ¥æ”¶æšä¸¾å‚æ•°ã€‚<br>ReturnCodeEnumè¿˜å†™äº†@JsonValueæ³¨è§£çš„æ–¹æ³•ï¼Œæ‰€ä»¥ä½¿ç”¨Jsonä¼ å‚/è¿”å›å€¼æ—¶ä½¿ç”¨@JsonValueå¯¹åº”çš„è¿”å›å€¼ã€‚<br>å› ä¸ºæˆ‘ä»¬è¿˜æƒ³å®ç°Jsonä¼ å‚çš„æ—¶å€™æ”¯æŒå­—é¢é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨@JsonCreatoræ³¨è§£çš„æ–¹æ³•é‡Œå†™äº†æ”¯æŒ code å’Œå­—é¢é‡ï¼Œè¯¥æ–¹æ³•ä¼šä½¿@JsonValue å¯¹ååºåˆ—åŒ–çš„æ”¯æŒå¤±æ•ˆï¼Œæ‰€ä»¥å†™çš„æ—¶å€™ä¸ä»…è¦æ”¯æŒå­—é¢é‡è¿˜è¦æ”¯æŒåŸæœ¬çš„ç›®çš„â€”â€“codeã€‚<br>ç”±äºæˆ‘ä»¬å·²ç»è¦†ç›–äº†åŸæ¥çš„åºåˆ—åŒ–/ååºåˆ—åŒ–æ–¹å¼ï¼Œæ‰€ä»¥ ordinal çš„æ”¯æŒå·²ç»å¤±æ•ˆã€‚<br>å¦å¤–ï¼Œç”±äºæˆ‘ä»¬å¯ä»¥å°†å‚æ•°ä¸­çš„Stringè½¬åŒ–ä¸ºæšä¸¾ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ @PathVariable å’Œ @RequestParamï¼ˆContent-Type: multipart/form-dataï¼‰æ¥ä¼ é€’æšä¸¾å‚æ•°(ç›¸å…³èµ„æ–™ï¼š<a href="https://www.baeldung.com/spring-type-conversions">Baeldungï¼šGuide to Spring Type Conversions</a>)ï¼Œä½†æ˜¯æ³¨æ„è¿™ä¸ªæ—¶å€™ä¸èƒ½ä½¿ç”¨ åŒ…å«æšä¸¾ç±»å‹çš„POJOç±»ï¼Œé™¤éä½ å†å®šä¹‰ä¸€ä¸ªä»ç®€å•ç±»å‹åˆ°å¤åˆç±»å‹çš„è½¬æ¢å™¨ã€‚</p><h4 id="1-beanæ¥æ”¶ï¼ˆapplication-x-www-form-urlencodedï¼‰"><a href="#1-beanæ¥æ”¶ï¼ˆapplication-x-www-form-urlencodedï¼‰" class="headerlink" title="1 beanæ¥æ”¶ï¼ˆapplication/x-www-form-urlencodedï¼‰"></a>1 beanæ¥æ”¶ï¼ˆapplication/x-www-form-urlencodedï¼‰</h4><ol><li><p>å­—é¢é‡<br><img src="https://img-blog.csdnimg.cn/2019011409281053.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="OK"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name():<span class="function">OK</span></span><br><span class="line"><span class="function"><span class="title">ordinal</span><span class="params">()</span>:0</span></span><br><span class="line"><span class="function"><span class="title">getCode</span><span class="params">()</span>:200</span></span><br></pre></td></tr></table></figure></li><li><p>code<br><img src="https://img-blog.csdnimg.cn/20190114092919865.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="code"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name():<span class="function">OK</span></span><br><span class="line"><span class="function"><span class="title">ordinal</span><span class="params">()</span>:0</span></span><br><span class="line"><span class="function"><span class="title">getCode</span><span class="params">()</span>:200</span></span><br></pre></td></tr></table></figure></li><li><p>ordinal<br><img src="https://img-blog.csdnimg.cn/20190114093114217.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="ordinal"><br>æŠ›å‡ºå¼‚å¸¸</p><blockquote><p>Field error in object â€˜myResultâ€™ on field â€˜returnCodeâ€™: rejected value [0]; codes [typeMismatch.myResult.returnCode,typeMismatch.returnCode,typeMismatch.com.dx.hbdt.system.manager.hongbao.controller.ReturnCodeEnum,typeMismatch]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [myResult.returnCode,returnCode]; arguments []; default message [returnCode]]; default message [Failed to convert property value of type â€˜java.lang.Stringâ€™ to required type â€˜com.dx.hbdt.system.manager.hongbao.controller.ReturnCodeEnumâ€™ for property â€˜returnCodeâ€™; nested exception is org.springframework.core.convert.ConversionFailedException: Failed to convert from type [java.lang.String] to type [com.dx.hbdt.system.manager.hongbao.controller.ReturnCodeEnum] for value â€˜0â€™; nested exception is java.lang.IllegalArgumentException: No element matches 0]]</p></blockquote></li></ol><h4 id="2-RequestBody-æ¥æ”¶ï¼ˆapplication-jsonï¼‰"><a href="#2-RequestBody-æ¥æ”¶ï¼ˆapplication-jsonï¼‰" class="headerlink" title="2 @RequestBody æ¥æ”¶ï¼ˆapplication/jsonï¼‰"></a>2 @RequestBody æ¥æ”¶ï¼ˆapplication/jsonï¼‰</h4><ol><li><p>å­—é¢é‡<br><img src="https://img-blog.csdnimg.cn/20190114093238352.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="OK"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name():<span class="function">OK</span></span><br><span class="line"><span class="function"><span class="title">ordinal</span><span class="params">()</span>:0</span></span><br><span class="line"><span class="function"><span class="title">getCode</span><span class="params">()</span>:200</span></span><br></pre></td></tr></table></figure></li><li><p>code<br><img src="https://img-blog.csdnimg.cn/20190114093333135.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="200"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name():<span class="function">OK</span></span><br><span class="line"><span class="function"><span class="title">ordinal</span><span class="params">()</span>:0</span></span><br><span class="line"><span class="function"><span class="title">getCode</span><span class="params">()</span>:200</span></span><br></pre></td></tr></table></figure></li><li><p>ordinal<br><img src="https://img-blog.csdnimg.cn/2019011409350597.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="å¼‚å¸¸"><br>è°ƒç”¨@JsonCreatorçš„createæ–¹æ³•çš„æ—¶å€™æŠ›å‡º IllegalArgumentException å¼‚å¸¸</p></li><li><p>å…¶ä»–<br>å­—ç¬¦ä¸²æ˜¯è¦æºå¸¦å¼•å·çš„ï¼Œå¦‚æœä¸æºå¸¦å¼•å·ä¼šè§£æé”™è¯¯ï¼Œå¦‚{    â€œreturnCodeâ€: OK }<br>æ•°å­—å¯ä¸æºå¸¦å¼•å·ï¼Œåœ¨ååºåˆ—åŒ–æˆæšä¸¾æ—¶ä»ä¼šçœ‹æˆ String å¯¹å¾…ï¼Œå¹¶è·å¾—ä¸ä¸Šé¢ç›¸åŒçš„æ•ˆæœã€‚</p></li></ol><h4 id="3-PathVariable"><a href="#3-PathVariable" class="headerlink" title="3 @PathVariable"></a>3 @PathVariable</h4><p><img src="https://img-blog.csdnimg.cn/20190114101616935.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="è·¯å¾„"></p><h4 id="4-RequestParamï¼ˆmultipart-form-dataï¼‰"><a href="#4-RequestParamï¼ˆmultipart-form-dataï¼‰" class="headerlink" title="4 @RequestParamï¼ˆmultipart/form-dataï¼‰"></a>4 @RequestParamï¼ˆmultipart/form-dataï¼‰</h4><p><img src="https://img-blog.csdnimg.cn/20190114101654469.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsaW55dWE=,size_16,color_FFFFFF,t_70" alt="å‚æ•°"></p>]]></content>
      
      
      <categories>
          
          <category> åç«¯å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ªäººç”µè„‘ä¼˜åŒ–æ‚è®°</title>
      <link href="//pc-optimize-notes/"/>
      <url>//pc-optimize-notes/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•ä¸ªäººåœ¨æ—¥å¸¸å¼€å‘ã€ä½¿ç”¨ä¸­å¯¹ç”µè„‘çš„ä¸€äº›é›¶æ•£é…ç½®ï¼Œå¤‡å¿˜ã€‚</p><span id="more"></span><h3 id="1-ä½¿ç”¨onedriveå¤‡ä»½æŒ‡å®šæ–‡ä»¶å¤¹"><a href="#1-ä½¿ç”¨onedriveå¤‡ä»½æŒ‡å®šæ–‡ä»¶å¤¹" class="headerlink" title="1 ä½¿ç”¨onedriveå¤‡ä»½æŒ‡å®šæ–‡ä»¶å¤¹"></a>1 ä½¿ç”¨onedriveå¤‡ä»½æŒ‡å®šæ–‡ä»¶å¤¹</h3><p>é‡è£…ç³»ç»Ÿçš„æ—¶å€™æ€»æœ‰ä¸€äº›æ–‡ä»¶å¿˜è®°å¤‡ä»½ï¼Œç­‰æƒ³èµ·æ¥çš„æ—¶å€™åªèƒ½åæ‚”è«åŠã€‚<br>å¦‚åŸç¥çš„æ¸¸æˆæˆªå›¾ï¼Œè¿™äº›éƒ½æ˜¯ç•™åœ¨æœ¬åœ°çš„ï¼Œä¸€èˆ¬å¾ˆéš¾è®°å¾—å¤‡ä»½ï¼Œæƒ³èµ·æ¥å°±è®©äººå¿ƒç—›</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mklink /d &quot;X:\backup\Genshin&quot; &quot;D:\Program Files\Genshin Impact\Genshin Impact Game\ScreenShot&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„ mklinkéœ€è¦åœ¨cmdä¸‹æ‰§è¡Œ, PowerShellæ˜¯æ²¡æœ‰çš„</p><p>å¦å¤–ï¼Œå¦‚æœæ˜¯ç”¨google dirveæˆ–è€…åšæœäº‘çš„è¯åˆ™å‚»ç“œå¼æ“ä½œå³å¯ï¼Œæ¯”è¾ƒæ¨èã€‚</p><h3 id="2-ä½¿ç”¨TreeSize-Freeåˆ†æç£ç›˜ç©ºé—´å ç”¨"><a href="#2-ä½¿ç”¨TreeSize-Freeåˆ†æç£ç›˜ç©ºé—´å ç”¨" class="headerlink" title="2 ä½¿ç”¨TreeSize Freeåˆ†æç£ç›˜ç©ºé—´å ç”¨"></a>2 ä½¿ç”¨TreeSize Freeåˆ†æç£ç›˜ç©ºé—´å ç”¨</h3><p>åœ¨å¾®è½¯åº”ç”¨å•†åº—å°±å¯ä»¥ä¸‹è½½ï¼Œä»¥æ ‘çŠ¶å›¾ç»“æ„åˆ†æç£ç›˜ç©ºé—´å ç”¨ï¼Œæ¯”è¾ƒå¥½ç”¨çš„å°å·¥å…·</p>]]></content>
      
      
      <categories>
          
          <category> ç¨‹åºå‘˜æ‚è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç”Ÿäº§åŠ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerfileå®ç°MySQLå®šæ—¶å¤‡ä»½</title>
      <link href="//mysql-cron-docker/"/>
      <url>//mysql-cron-docker/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡åˆ©ç”¨è‡ªå®šåˆ¶Dockerfileå®ç°åœ¨mysqlå®¹å™¨å†…è‡ªåŠ¨å®šæ—¶å¤‡ä»½,é¿å…äº†åœ¨å®¿ä¸»æœºè®¾ç½®cronå®šæ—¶ä»»åŠ¡æ‰€å¸¦æ¥çš„é«˜è€¦åˆæ“ä½œ,æ›´æ˜“äºéƒ¨ç½²å’Œæ¬è¿.é¡¹ç›®æœ€æ–°ç‰ˆå·²ä¸Šä¼ åˆ°<a href="https://github.com/linshenkx/mysql-cron">github</a>å’Œ<a href="https://hub.docker.com/r/linshen/mysql-cron/">DockerHub</a>,å»ºè®®ç›´æ¥åˆ°<a href="https://hub.docker.com/r/linshen/mysql-cron/">DockerHub</a>æŸ¥çœ‹ä½¿ç”¨.</p><span id="more"></span><p>ç½‘ä¸Šå…¶ä»–æ•™ç¨‹å¤§å¤šéƒ½æ˜¯åˆ©ç”¨å®¿ä¸»æœºcrontabå®šæœŸæ‰§è¡Œdocker execå®ç°,å¾ˆç®€å•ä½†æ¯æ¬¡éƒ¨ç½²mysqléƒ½éœ€è¦è®¾ç½®,æœ¬æ•™ç¨‹åˆ™æ˜¯å°†å…¶å°è£…èµ·æ¥,é¿å…é‡å¤æ€§å·¥ä½œ.è¸©å‘ä¸æ˜“,è¯·å¤§å®¶å¤šå¤šæ”¯æŒ,æœªç»æœ¬äººå…è®¸ç¦æ­¢è½¬è½½.</p><h3 id="ä¸€-æ–‡ä»¶ç»“æ„"><a href="#ä¸€-æ–‡ä»¶ç»“æ„" class="headerlink" title="ä¸€. æ–‡ä»¶ç»“æ„"></a>ä¸€. æ–‡ä»¶ç»“æ„</h3><h3 id="äºŒ-æ–‡ä»¶ä»‹ç»"><a href="#äºŒ-æ–‡ä»¶ä»‹ç»" class="headerlink" title="äºŒ. æ–‡ä»¶ä»‹ç»"></a>äºŒ. æ–‡ä»¶ä»‹ç»</h3><ul><li><p>cron-shellæ–‡ä»¶å¤¹<br>æ”¾ç½®cronä»»åŠ¡è¡¨æ–‡ä»¶crontab.bakå’Œç›¸å…³ä»»åŠ¡è„šæœ¬,å¯¹åº”å®¹å™¨å†…æ–‡ä»¶å¤¹ä¸º**/cron-shell**</p><ul><li>backup.sh<br>å®ç°å¤‡ä»½åŠŸèƒ½,ç”¨æˆ·å¯æ›¿æ¢æ‰è¯¥æ–‡ä»¶ä»¥å®ç°è‡ªå·±çš„å¤‡ä»½é€»è¾‘</li><li>crontab.bak<br>crontabä»»åŠ¡è¡¨,è¦æ±‚ç»“å°¾å¿…é¡»æ¢è¡Œ,ä¸”æ–‡ä»¶ä¸ºUnixæ ¼å¼</li></ul></li><li><p>start.sh<br>åŠŸèƒ½:</p></li></ul><ol><li>å°†mysqlç”¨æˆ·çš„ç¯å¢ƒå˜é‡å†™å…¥/etc/default/localeæ–‡ä»¶,ä½¿å¾—è¿™äº›ç¯å¢ƒå˜é‡å¯¹cronè¿è¡Œçš„è„šæœ¬(å¦‚backup.sh)å¯è§</li><li>å¯åŠ¨cron</li><li>è½½å…¥/cron-shell/crontab.bakå®šæ—¶ä»»åŠ¡åˆ—è¡¨æ–‡ä»¶</li></ol><ul><li>init-sqlæ–‡ä»¶å¤¹<br>inti-sqlæ–‡ä»¶å¤¹ä¸‹çš„sqlè„šæœ¬(.sql)æˆ–è€…sqlçš„å‹ç¼©æ–‡ä»¶(.sql.gz)åœ¨å®¹å™¨å¯åŠ¨åç”±msqlè¿è¡Œ,é€šå¸¸ç”¨æ¥å®ç°æ•°æ®åº“åˆå§‹åŒ–,éœ€è¦æ³¨æ„çš„æ˜¯è¿™äº›sqlçš„æ‰§è¡Œé¡ºåºä¸å›ºå®š,æ•…å¦‚æœå¯¹sqlè„šæœ¬æ‰§è¡Œé¡ºåºæœ‰è¦æ±‚çš„è¯åº”è‡ªå·±ä½¿ç”¨shellè„šæœ¬å®ç°<ul><li>data_20180909.sql.gz<br>æ•°æ®åº“åˆå§‹åŒ–sqlçš„å‹ç¼©åŒ…</li></ul></li><li>Dockerfile<br>å°†æ–‡ä»¶å¤åˆ¶è¿›é•œåƒæ–‡ä»¶,å¹¶å®‰è£…sudo,cronå·¥å…·,åŒæ—¶æˆäºˆmysqlç»„ç”¨æˆ·å…å¯†ç ä½¿ç”¨sudoçš„æƒé™.</li></ul><h3 id="ä¸‰-å®ç°æ€è·¯"><a href="#ä¸‰-å®ç°æ€è·¯" class="headerlink" title="ä¸‰. å®ç°æ€è·¯"></a>ä¸‰. å®ç°æ€è·¯</h3><p>é€šè¿‡Dockerfileå®‰è£…æ‰€éœ€cron,åˆ©ç”¨<strong>docker-entrypoint.sh</strong>ä¸­è‡ªåŠ¨æ‰§è¡Œ**/docker-entrypoint-initdb.d**æ–‡ä»¶å¤¹ä¸‹shellå’Œsqlè„šæœ¬çš„åŠŸèƒ½å®Œæˆcronè‡ªå¯åŠ¨å’Œä»»åŠ¡åˆ¶å®š</p><h3 id="å››-æ–‡ä»¶å®ç°"><a href="#å››-æ–‡ä»¶å®ç°" class="headerlink" title="å››. æ–‡ä»¶å®ç°"></a>å››. æ–‡ä»¶å®ç°</h3><h4 id="1-baskup-sh"><a href="#1-baskup-sh" class="headerlink" title="1. baskup.sh"></a>1. baskup.sh</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ä½œä¸ºcrontabè¿è¡Œçš„è„šæœ¬,éœ€ç‰¹åˆ«æ³¨æ„ç¯å¢ƒå˜é‡é—®é¢˜,æŒ‡ä»¤å†™æˆç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">è¯»å–ç¯å¢ƒå˜é‡</span></span><br><span class="line">. /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="bash">å¦‚æœç›®å½•ä¸å­˜åœ¨åˆ™æ–°å»º</span></span><br><span class="line">DIR=/var/lib/mysql/backup</span><br><span class="line">if [ ! -e $DIR ]</span><br><span class="line">then</span><br><span class="line">/bin/mkdir -p $DIR</span><br><span class="line">fi</span><br><span class="line"><span class="meta">#</span><span class="bash">å°†æ‰€æœ‰æ•°æ®åº“å¯¼å‡ºå¹¶æŒ‰æ—¥æœŸå‘½åä¿å­˜æˆsqlæ–‡ä»¶å¹¶å‹ç¼©</span></span><br><span class="line">/usr/bin/mysqldump --all-databases -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;   | gzip &gt; &quot;$DIR/data_`date +%Y%m%d`.sql.gz&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥æ‰¾æ›´æ”¹æ—¶é—´åœ¨7æ—¥ä»¥å‰çš„sqlå¤‡ä»½æ–‡ä»¶å¹¶åˆ é™¤</span></span><br><span class="line">/usr/bin/find $DIR -mtime +7  -name &quot;data_[1-9]*.sql.gz&quot; -exec rm -rf &#123;&#125; \;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-crontab-bak"><a href="#2-crontab-bak" class="headerlink" title="2. crontab.bak"></a>2. crontab.bak</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/1 * * * * /cron-shell/backup.sh</span><br></pre></td></tr></table></figure><p>æ³¨æ„ç»“å°¾è¦æ¢è¡Œ,å¹¶ä¸”æ–‡ä»¶æ ¼å¼è¦æ˜¯Unix(å…¶ä»–æ‰€æœ‰shè„šæœ¬ä¹Ÿæ˜¯)</p><h4 id="3-start-sh"><a href="#3-start-sh" class="headerlink" title="3. start.sh"></a>3. start.sh</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">æ­¤è„šæœ¬ç”±mysqlç”¨æˆ·æ‰§è¡Œ,æ•…éœ€è¦åŠ sudoé¿å…æƒé™ä¸å¤Ÿ,åŒæ—¶,æ–°å»ºæ–‡ä»¶ä¸€èˆ¬æ”¾åœ¨/var/lib/mysqlç›®å½•ä¸‹,å¦åˆ™åŒæ ·æƒé™ä¸å¤Ÿ</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">ä¿®æ”¹æ–‡ä»¶å¤¹æƒé™,å¦åˆ™æ— æ³•åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶</span></span><br><span class="line">sudo chmod 777 /etc/default</span><br><span class="line"><span class="meta">#</span><span class="bash">å°†dockerçš„ç¯å¢ƒå˜é‡è¾“å‡ºåˆ°locale,ä½¿å¾—cronå®šæœŸè¿è¡Œçš„è„šæœ¬å¯ä»¥ä½¿ç”¨è¿™äº›ç¯å¢ƒå˜é‡,å¦åˆ™æ‰§è¡Œå¤‡ä»½è„šæœ¬æ—¶å¯èƒ½æç¤ºå¯†ç ä¸ºç©º</span></span><br><span class="line">env &gt;&gt; /etc/default/locale</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">å¯åŠ¨cronå¹¶å°†å…¶å¯åŠ¨ç»“æœå†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿™é‡Œéœ€è¦ä½¿ç”¨sudo,å¦åˆ™ä¼šæç¤ºcron: can<span class="string">&#x27;t open or create /var/run/crond.pid: Permission denied</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> è¿™ä¸ªé—®é¢˜æ— æ³•é€šè¿‡ä¿®æ”¹/var/run/crondæˆ–/runæ–‡ä»¶å¤¹æƒé™è§£å†³</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> éœ€è¦æ³¨æ„çš„æ˜¯,ä½¿ç”¨sudoåcronæ˜¯åœ¨rootç”¨æˆ·ä¸‹è¿è¡Œçš„,rootç”¨æˆ·ä¸‹ä½¿ç”¨`service cron status`ä¼šå‡ºç°` [ ok ] cron is running. `</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> è€Œmysqlæ‰§è¡Œ`service cron status`åˆ™ä¼šå‡ºç°` [FAIL] cron is not running ... failed! `</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> è™½ç„¶å¦‚æ­¤,mysqlç”¨æˆ·èº«ä»½åˆ¶å®šçš„å®šæ—¶ä»»åŠ¡è¿˜æ˜¯ä¼šæ‰§è¡Œçš„</span></span></span><br><span class="line">sudo /usr/sbin/service cron start &amp;&gt;&gt; /var/lib/mysql/cron-start.log</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string">æˆäºˆæƒé™</span></span></span><br><span class="line">sudo chmod 777 -R /cron-shell</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string">ä¿®æ­£æ–‡ä»¶æ ¼å¼,è¿™é‡Œdos2unixçš„æ‰§è¡Œä¹Ÿéœ€è¦sudo,å¦åˆ™ä¼šæŠ¥é”™`Failed to change the owner and group of temporary output file /cron-shell/d2utmpKfjPMF: Operation not permitted`</span></span></span><br><span class="line">for f in /cron-shell/*; do</span><br><span class="line">sudo dos2unix &quot;$f&quot;</span><br><span class="line">done</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> ç¡®ä¿ç»“å°¾æ¢è¡Œ,é¿å…å‡ºç°é”™è¯¯:`new crontab file is missing newline before EOF, can&#x27;</span>t install.`</span></span><br><span class="line">echo &quot;&quot; &gt;&gt; /cron-shell/crontab.bak</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">ä»¥/cron-shell/crontab.bakä½œä¸ºcrontabçš„ä»»åŠ¡åˆ—è¡¨æ–‡ä»¶å¹¶è½½å…¥</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å› ä¸ºæ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡ä¸€èˆ¬æ˜¯æ•°æ®åº“ç›¸å…³çš„,mysqlç”¨æˆ·å°±å¯ä»¥äº†,å¦‚æœä½¿ç”¨rootç”¨æˆ·å¯èƒ½ä¼šæŠ¥é”™:`Got error: 1045: Access denied <span class="keyword">for</span> user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> (using password: YES) when trying to connect`</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰€ä»¥è¿™é‡Œä½¿ç”¨mysqlç”¨æˆ·è½½å…¥å®šæ—¶ä»»åŠ¡è¡¨,ä»»åŠ¡è„šæœ¬ä¹Ÿå°†ä»¥mysqlç”¨æˆ·æ‰§è¡Œ,éœ€æ³¨æ„æƒé™é—®é¢˜</span></span><br><span class="line">crontab /cron-shell/crontab.bak</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="4-Dockerfile"><a href="#4-Dockerfile" class="headerlink" title="4. Dockerfile"></a>4. Dockerfile</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">FROM mysql:5.7</span><br><span class="line"></span><br><span class="line">MAINTAINER LinShen</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">ä¿®æ­£æ—¶åŒº</span></span><br><span class="line">RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \</span><br><span class="line">      &amp;&amp; echo &#x27;Asia/Shanghai&#x27; &gt;/etc/timezone \</span><br><span class="line"><span class="meta">#</span><span class="bash">æ›´æ–°æº</span></span><br><span class="line">      &amp;&amp; apt-get update \</span><br><span class="line"><span class="meta">#</span><span class="bash">å®‰è£…cron</span></span><br><span class="line">      &amp;&amp; apt-get install -y  --no-install-recommends cron \</span><br><span class="line"><span class="meta">#</span><span class="bash">å®‰è£…dos2unixå·¥å…·</span></span><br><span class="line">      &amp;&amp; apt-get install -y  dos2unix \</span><br><span class="line"><span class="meta">#</span><span class="bash">å®‰è£…sudo</span></span><br><span class="line">      &amp;&amp; apt-get install sudo \</span><br><span class="line"><span class="meta">#</span><span class="bash">æˆäºˆmysqlç»„ç”¨æˆ·sudoå…å¯†ç </span></span><br><span class="line">      &amp;&amp; echo &#x27;%mysql ALL=(ALL) NOPASSWD: ALL&#x27; &gt;&gt; /etc/sudoers \</span><br><span class="line"><span class="meta">#</span><span class="bash">å‡å°é•œåƒçš„ä½“ç§¯</span></span><br><span class="line">      &amp;&amp; rm -rf /var/lib/apt/lists/*  \</span><br><span class="line">      &amp;&amp; apt-get clean \</span><br><span class="line"><span class="meta">#</span><span class="bash">èµ‹äºˆè„šæœ¬å¯æ‰§è¡Œæƒé™</span></span><br><span class="line">      &amp;&amp; chmod a+x -R /docker-entrypoint-initdb.d</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">å°†ä»»åŠ¡è„šæœ¬å¤åˆ¶è¿›å®¹å™¨,éœ€è¦æ³¨æ„ä¸èƒ½æ”¾åˆ°/var/lib/mysqlç›®å½•ä¸‹,è¯¥ç›®å½•éšmysqlåˆå§‹åŒ–ä¼šè¢«æ¸…ç©ºé€ æˆåŸæ–‡ä»¶ä¸¢å¤±</span></span><br><span class="line">COPY cron-shell/ /cron-shell/</span><br><span class="line"></span><br><span class="line">COPY start.sh /tmp/start.sh</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;/tmp/start.sh&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="äº”-é—®é¢˜"><a href="#äº”-é—®é¢˜" class="headerlink" title="äº”. é—®é¢˜"></a>äº”. é—®é¢˜</h3><h4 id="1-åœ¨ä»€ä¹ˆæ—¶å€™å¯åŠ¨cron-åœ¨å“ªé‡Œæ‰§è¡Œservice-cron-start"><a href="#1-åœ¨ä»€ä¹ˆæ—¶å€™å¯åŠ¨cron-åœ¨å“ªé‡Œæ‰§è¡Œservice-cron-start" class="headerlink" title="(1) åœ¨ä»€ä¹ˆæ—¶å€™å¯åŠ¨cron(åœ¨å“ªé‡Œæ‰§è¡Œservice cron start)"></a>(1) åœ¨ä»€ä¹ˆæ—¶å€™å¯åŠ¨cron(åœ¨å“ªé‡Œæ‰§è¡Œ<code>service cron start</code>)</h4><p>æˆ‘æœ¬æ¥æ˜¯æƒ³åœ¨Dockerfileé‡Œå®Œæˆå¯åŠ¨cronå·¥ä½œçš„,Dockerfileé‡Œæ‰§è¡Œè¯­å¥æ— å¤–ä¹<code>RUN</code>,<code>CMD</code>å’Œ<code>ENTRYPOINT</code>ä¸‰ç§æŒ‡ä»¤,ä½†å¾ˆå¯æƒœè¿™ä¸‰ç§æŒ‡ä»¤éƒ½ä¸è¡Œ,æœ€ååªèƒ½åˆ©ç”¨<strong>docker-entrypoint.sh</strong>,ä¸‹é¢è¿›è¡Œåˆ†æè¯´æ˜:</p><h5 id="1-RUN"><a href="#1-RUN" class="headerlink" title="1. RUN"></a>1. RUN</h5><p>RUNçš„ç‰¹ç‚¹æ˜¯å¯ä»¥æ‰§è¡Œå¤šæ¡,æ¯æ‰§è¡Œä¸€æ¡dockeré•œåƒå°±ä¼šå¤šæ„å»ºä¸€å±‚.<br>éœ€è¦æ³¨æ„çš„æ˜¯RUNé€šå¸¸åªç”¨æ¥æ„å»ºé•œåƒ,è€Œé•œåƒæ˜¯ä¸å¸¦æœ‰è¿è¡ŒçŠ¶æ€çš„.æ•…RUNå¯å®Œæˆå®‰è£…è½¯ä»¶,ä¿®æ”¹æ–‡ä»¶ç­‰æ“ä½œ,ä½†ä½¿ç”¨<strong>service start</strong>æ˜¯æ— æ„ä¹‰çš„.<br>è€ŒCMDå’ŒENTRYPOINTåˆ™æ˜¯ç­‰åˆ°å®¹å™¨å¯åŠ¨åæ‰è¿è¡Œ.</p><h5 id="2-CMD"><a href="#2-CMD" class="headerlink" title="2. CMD"></a>2. CMD</h5><p>CMDæ¯ä¸ªDockerfileæ–‡ä»¶å¯ä»¥æœ‰å¤šæ¡,ä½†ä¸€ä¸ªé•œåƒåªæœ‰æœ€åä¸€æ¡CMDæœ‰æ•ˆ<br>MySQLå®˜æ–¹é•œåƒå·²ç»æœ‰ç”¨åˆ°CMDå’ŒENTRYPOINTæŒ‡ä»¤äº†,åˆ†åˆ«æ˜¯<code>CMD [&quot;mysqld&quot;]</code>å’Œ<code>ENTRYPOINT [&quot;docker-entrypoint.sh&quot;]</code>,å½“ENTRYPOINTå’ŒCMDåŒæ—¶å­˜åœ¨æ—¶,CMDé€šå¸¸æ˜¯ä½œä¸ºENTRYPOINTçš„å‚æ•°,å…¶å†…å®¹è§†ENTRYPOINTçš„å¤„ç†è€Œæ‰§è¡Œ.<br>è€Œdocker-entrypoint.shä¸­å¯¹cmdå†…å®¹çš„åˆ†ç±»æœ‰å¦‚ä¸‹:</p><ol><li>å¼€å¤´æ˜¯ <code>-</code> , è®¤ä¸ºæ˜¯å‚æ•°çš„æƒ…å†µ<br> å¯æºå¸¦å‚æ•°,å¦‚**â€“character-set-server=utf8mb4<strong>å’Œ</strong>â€“collation-server=utf8mb4_unicode_ci**</li><li>å¼€å¤´æ˜¯ mysqld, ä¸”ç”¨æˆ· id ä¸º0 (root ç”¨æˆ·) çš„æƒ…å†µ</li><li>å¼€å¤´æ˜¯ mysqld çš„æƒ…å†µ</li><li>å…¶ä»–æƒ…å†µ<br>ç”±docker-entrypoint.shæœ€åä¸€å¥çš„<code>exec &quot;$@&quot;</code>è´Ÿè´£æ‰§è¡Œç”¨æˆ·çš„è‡ªå®šä¹‰è¯­å¥</li></ol><blockquote><p>ç‰¹åˆ«æ³¨æ„:å‰3ç§æƒ…å†µåœ¨docker-entrypoint.shéƒ½æœ‰å¯¹åº”çš„å¤„ç†,æœ€ç»ˆéƒ½ä¼šå¯åŠ¨mysql,è€Œæœ€åä¸€ç§æƒ…å†µä¸ä¼š !</p></blockquote><p>åœ¨å‰3ç§æƒ…å†µä¸­CMDæ— æ³•æºå¸¦<code>service cron start</code>,ä¼šè¢«è§†ä¸ºå‚æ•°å¿½ç•¥æˆ–æŠ¥é”™,è€Œæœ€åä¸€ç§å¯åŠ¨cronçš„è¯­å¥å¦‚ä¸‹<code>CMD service cron start &amp;&amp; tail -n 1 -f somefile</code>,å…¶ä¸­tailè¯­å¥æ˜¯ä¸ºäº†è®©å®¹å™¨åœ¨å‰å°è¿è¡Œè€Œä¸ä¼šè‡ªåŠ¨é€€å‡º.ä½†æ˜¯ä½¿ç”¨docker exec è¿›å…¥å®¹å™¨å°±å¯ä»¥å‘ç°,mysqlæ ¹æœ¬æ²¡æœ‰è¿è¡Œ.è€Œå¦‚æœæƒ³åœ¨CMDé‡Œé¢åŒæ—¶å¯åŠ¨cronå’Œmysqlå°±æ›´éº»çƒ¦äº†,å‡ ä¹ä¸å¯èƒ½(å› ä¸ºæœ‰å¾ˆå¤šmysqlçš„åˆå§‹åŒ–å·¥ä½œè¦åš,è¿™äº›æœ¬æ¥æ˜¯docker-entrypointå¸®ä½ åšå¥½çš„),è€Œä¸”è¿™æ ·å°±å¤±å»äº†ä½¿ç”¨docker-entrypoint.shçš„æ„ä¹‰,å¾—ä¸å¿å¤±.</p><h5 id="3-ENTRYPOINT"><a href="#3-ENTRYPOINT" class="headerlink" title="3. ENTRYPOINT"></a>3. ENTRYPOINT</h5><p>ENTRYPOINTæ¯ä¸ªDockerfileæ–‡ä»¶å¯ä»¥æœ‰å¤šæ¡,ä½†ä¸€ä¸ªé•œåƒåªæœ‰æœ€åä¸€æ¡ENTRYPOINTæœ‰æ•ˆ<br>MySQLå®˜æ–¹é•œåƒçš„ENTRYPOINTæ˜¯æ‰§è¡Œ<strong>docker-entrypoint.sh</strong>,æ‰€ä»¥è¿™ä¸€å¥æ˜¯æ”¹ä¸äº†çš„,è¦æ”¹ä¸å¦‚ç›´æ¥æ”¹<strong>docker-entrypoint.sh</strong>.</p><p>ä»¥ä¸Š,å¯ä»¥çœ‹å‡ºæ¥,æƒ³è¦åœ¨Dockerfileé‡Œæ‰§è¡Œ<strong>service cron start</strong>æ˜¯ä¸å¯èƒ½çš„,å”¯ä¸€çš„åŠæ³•åœ¨<strong>docker-entrypoint.sh</strong>æ–‡ä»¶.</p><h5 id="4-docker-entrypoint-sh"><a href="#4-docker-entrypoint-sh" class="headerlink" title="4. docker-entrypoint.sh"></a>4. docker-entrypoint.sh</h5><p>è¯¥æ–‡ä»¶çš„è¯¦ç»†è§£è¯»ç½‘ä¸Šæœ‰æ¯”è¾ƒå¤š,å¯ä»¥ç›´æ¥æŠŠæ‰§è¡Œè¯­å¥åŠ åœ¨è¿™é‡Œ,æ¯•ç«Ÿè¿™ä¸ªæ–‡ä»¶å°±æ˜¯æ¥åšè¿™ç§äº‹çš„,è¿™ä¹Ÿç¡®å®æ˜¯ä¸ªå®ç°æ€è·¯.ä½†è¿™ä¹ˆåšä¿®æ”¹äº†åŸæ¥çš„æ–‡ä»¶,å¾ˆä¸ä¼˜é›…,ä¸ç¬¦åˆå¼€é—­åŸåˆ™,è¿˜å¥½MySQLé•œåƒçš„è®¾è®¡è€…è€ƒè™‘åˆ°äº†è¿™ç‚¹,ç•™ä¸‹äº†ä¸ª<code>/docker-entrypoint-initdb.d</code>æ–‡ä»¶å¤¹<br>2021å¹´æ›´æ–°ï¼š<code>/docker-entrypoint-initdb.d</code>åªæœ‰åœ¨æ•°æ®åº“ç©ºç™½ï¼ˆå³ç¬¬ä¸€æ¬¡å¯åŠ¨ä¸”æŒ‚è½½ç›®å½•ä¸ºç©ºï¼‰çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œåˆå§‹åŒ–ã€‚å¦‚æœå°†æ‰§è¡Œè¯­å¥æ”¾è¿™é‡Œä¼šå¯¼è‡´å®¹å™¨é‡å¯åcronæ‰§è¡Œè¯­å¥å¤±æ•ˆï¼Œå‚è€ƒ <a href="https://github.com/linshenkx/mysql-cron/issues/1">https://github.com/linshenkx/mysql-cron/issues/1</a> ã€‚ç°å·²æ›´æ”¹ä¸ºä½¿ç”¨è‡ªå®šä¹‰ENTRYPOINTè„šæœ¬ï¼Œå†åœ¨è„šæœ¬çš„æœ€åè°ƒç”¨docker-entrypoint.shã€‚<br>docker-entrypointä¸­ç›¸å…³è¯­å¥å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for f in /docker-entrypoint-initdb.d/*; do</span><br><span class="line">process_init_file &quot;$f&quot; &quot;$&#123;mysql[@]&#125;&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Š,ä¼šéå†<code>/docker-entrypoint-initdb.d</code>ä¸­çš„æ¯ä¸ªæ–‡ä»¶ä½œä¸ºå‚æ•°è°ƒç”¨<code>process_init_file</code>æ–¹æ³•,è¯¥æ–¹æ³•å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> usage: process_init_file FILENAME MYSQLCOMMAND...</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    ie: process_init_file foo.sh mysql -uroot</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (process a single initializer file, based on its extension. we define this</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">function</span> here, so that initializer scripts (*.sh) can use the same logic,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> potentially recursively, or override the logic used <span class="keyword">in</span> subsequent calls)</span></span><br><span class="line">process_init_file() &#123;</span><br><span class="line">local f=&quot;$1&quot;; shift</span><br><span class="line">local mysql=( &quot;$@&quot; )</span><br><span class="line"></span><br><span class="line">case &quot;$f&quot; in</span><br><span class="line">*.sh)     echo &quot;$0: running $f&quot;; . &quot;$f&quot; ;;</span><br><span class="line">*.sql)    echo &quot;$0: running $f&quot;; &quot;$&#123;mysql[@]&#125;&quot; &lt; &quot;$f&quot;; echo ;;</span><br><span class="line">*.sql.gz) echo &quot;$0: running $f&quot;; gunzip -c &quot;$f&quot; | &quot;$&#123;mysql[@]&#125;&quot;; echo ;;</span><br><span class="line">*)        echo &quot;$0: ignoring $f&quot; ;;</span><br><span class="line">esac</span><br><span class="line">echo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Š,éœ€è¦æ‰§è¡Œçš„shellè„šæœ¬æˆ–è€…sqlè„šæœ¬,å¯æ”¾åˆ°/docker-entrypoint-initdb.d/ç›®å½•ä¸‹,å¦‚æœæ˜¯sql.gzçš„å‹ç¼©åŒ…,å®¹å™¨ä¼šè‡ªåŠ¨è§£å‹å†æ‰§è¡Œ.<br>éœ€è¦æ³¨æ„çš„æ˜¯,åªèƒ½ä¿è¯éå†å…¨éƒ¨æ‰§è¡Œè€Œä¸ä¿è¯é¡ºåº,æ‰€ä»¥æœ‰é¡ºåºéœ€æ±‚çš„éœ€è¦åˆ©ç”¨è„šæœ¬è‡ªå·±å®ç°.</p><p><del>å¾ˆæ˜æ˜¾,cronçš„å¯åŠ¨è„šæœ¬åº”è¯¥æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹</del></p><h4 id="2-shè„šæœ¬æ–‡ä»¶é¡»ä¸ºUnixæ ¼å¼-Windowsä¸‹é»˜è®¤ä¸ºdos-åŒæ—¶æ³¨æ„æä¾›å¯æ‰§è¡Œæƒé™"><a href="#2-shè„šæœ¬æ–‡ä»¶é¡»ä¸ºUnixæ ¼å¼-Windowsä¸‹é»˜è®¤ä¸ºdos-åŒæ—¶æ³¨æ„æä¾›å¯æ‰§è¡Œæƒé™" class="headerlink" title="(2) shè„šæœ¬æ–‡ä»¶é¡»ä¸ºUnixæ ¼å¼(Windowsä¸‹é»˜è®¤ä¸ºdos),åŒæ—¶æ³¨æ„æä¾›å¯æ‰§è¡Œæƒé™"></a>(2) shè„šæœ¬æ–‡ä»¶é¡»ä¸ºUnixæ ¼å¼(Windowsä¸‹é»˜è®¤ä¸ºdos),åŒæ—¶æ³¨æ„æä¾›å¯æ‰§è¡Œæƒé™</h4><p>dosè½¬unixæ ¼å¼é€šå¸¸æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼:</p><ol><li>windows:ä½¿ç”¨notepad++<br>ä¾æ¬¡ç‚¹å‡»â€ç¼–è¾‘â€-&gt;â€æ–‡æ¡£æ ¼å¼è½¬æ¢â€ -&gt;â€è½¬æ¢ä¸ºUNIXæ ¼å¼â€</li><li>linux:ä½¿ç”¨vim<br>åœ¨å‘½ä»¤æ¨¡å¼è¾“å…¥<strong>set ff=unix</strong>å›è½¦å³å¯,<strong>set ff</strong>å¯ä»¥æŸ¥çœ‹æ ¼å¼</li><li>linux:ä½¿ç”¨dos2unix<br>dos2unixåç›´æ¥åŠ æ–‡ä»¶åå³å¯</li></ol>]]></content>
      
      
      <categories>
          
          <category> åç«¯å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> mysql </tag>
            
            <tag> cron </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringSecurity5.0çš„DelegatingPasswordEncoderè¯¦è§£</title>
      <link href="//DelegatingPasswordEncoder/"/>
      <url>//DelegatingPasswordEncoder/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡å‚è€ƒè‡ªSpring Security 5.0.4.RELEASE  çš„å®˜æ–¹æ–‡æ¡£,ç»“åˆæºç ä»‹ç»äº†DelegatingPasswordEncoder,å¯¹å…¶å·¥ä½œè¿‡ç¨‹è¿›è¡Œåˆ†æå¹¶è§£å†³å…¶ä¸­é‡åˆ°çš„é—®é¢˜.åŒ…æ‹¬<code>There is no PasswordEncoder mapped for the id &quot;null&quot;</code>çš„éæ³•å‚æ•°å¼‚å¸¸çš„æ­£ç¡®å¤„ç†æ–¹æ³•</p><span id="more"></span><p>##PasswordEncoder<br>é¦–å…ˆè¦ç†è§£<strong>DelegatingPasswordEncoder</strong>çš„ä½œç”¨å’Œå­˜åœ¨æ„ä¹‰,æ˜ç™½å®˜æ–¹ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒæ¥å–ä»£åŸå…ˆçš„<strong>NoOpPasswordEncoder</strong></p><p><strong>DelegatingPasswordEncoder</strong>å’Œ<strong>NoOpPasswordEncoder</strong>éƒ½æ˜¯<code>PasswordEncoder</code>æ¥å£çš„å®ç°ç±»,æ ¹æ®å®˜æ–¹çš„å®šä¹‰,Spring Securityçš„<strong>PasswordEncoder</strong>æ¥å£ç”¨äºæ‰§è¡Œå¯†ç çš„å•å‘è½¬æ¢ï¼Œä»¥ä¾¿å®‰å…¨åœ°å­˜å‚¨å¯†ç ã€‚</p><p>å…³äºå¯†ç å­˜å‚¨çš„æ¼”å˜å†å²è¿™é‡Œæˆ‘ä¸å¤šåšä»‹ç»,ç®€å•æ¥è¯´å°±æ˜¯ç°åœ¨æ•°æ®åº“å­˜å‚¨çš„å¯†ç åŸºæœ¬éƒ½æ˜¯ç»è¿‡ç¼–ç çš„,è€Œ<strong>å†³å®šå¦‚ä½•ç¼–ç </strong>ä»¥åŠ<strong>åˆ¤æ–­æœªç¼–ç çš„å­—ç¬¦åºåˆ—å’Œç¼–ç åçš„å­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…</strong>å°±æ˜¯PassswordEncoderçš„è´£ä»».</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹PasswordEncoderæ¥å£çš„æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PasswordEncoder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Encode the raw password. Generally, a good encoding algorithm applies a SHA-1 or</span></span><br><span class="line"><span class="comment"> * greater hash combined with an 8-byte or greater randomly generated salt.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">encode</span><span class="params">(CharSequence rawPassword)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Verify the encoded password obtained from storage matches the submitted raw</span></span><br><span class="line"><span class="comment"> * password after it too is encoded. Returns true if the passwords match, false if</span></span><br><span class="line"><span class="comment"> * they do not. The stored password itself is never decoded.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rawPassword the raw password to encode and match</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> encodedPassword the encoded password from storage to compare with</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> true if the raw password, after encoding, matches the encoded password from</span></span><br><span class="line"><span class="comment"> * storage</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(CharSequence rawPassword, String encodedPassword)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®æºç ,æˆ‘ä»¬å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°,PassswordEncoderæ¥å£åªæœ‰ä¸¤ä¸ªæ–¹æ³•,ä¸€ä¸ªæ˜¯<code>String encode(CharSequence rawPassword);</code>,ç”¨äºå°†å­—ç¬¦åºåˆ—(å³åŸå¯†ç )è¿›è¡Œç¼–ç ,å¦ä¸€ä¸ªæ–¹æ³•æ˜¯<code>boolean matches(CharSequence rawPassword, String encodedPassword);</code>,ç”¨äºæ¯”è¾ƒå­—ç¬¦åºåˆ—å’Œç¼–ç åçš„å¯†ç æ˜¯å¦åŒ¹é….</p><p>ç†è§£äº†PasswordEncoderçš„ä½œç”¨åæˆ‘ä»¬æ¥Spring Security 5.0ä¹‹å‰é»˜è®¤çš„PasswordEncoderå®ç°ç±»<code>NoOpPasswordEncoder</code>,è¿™ä¸ªç±»å·²ç»è¢«æ ‡è®°ä¸ºè¿‡æ—¶äº†,å› ä¸ºä¸å®‰å…¨,ä¸‹é¢å°±è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•åœ°ä¸å®‰å…¨çš„</p><h3 id="1-NoOpPasswordEncoder"><a href="#1-NoOpPasswordEncoder" class="headerlink" title="1 NoOpPasswordEncoder"></a>1 NoOpPasswordEncoder</h3><p>äº‹å®ä¸Š,NoOpPasswordEncoderå°±æ˜¯æ²¡æœ‰ç¼–ç çš„ç¼–ç å™¨,æºç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NoOpPasswordEncoder</span> <span class="keyword">implements</span> <span class="title">PasswordEncoder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">encode</span><span class="params">(CharSequence rawPassword)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> rawPassword.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(CharSequence rawPassword, String encodedPassword)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> rawPassword.toString().equals(encodedPassword);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Get the singleton &#123;<span class="doctag">@link</span> NoOpPasswordEncoder&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PasswordEncoder <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> INSTANCE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> PasswordEncoder INSTANCE = <span class="keyword">new</span> NoOpPasswordEncoder();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">NoOpPasswordEncoder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°,<strong>NoOpPasswordEncoder</strong>çš„<strong>encode</strong>æ–¹æ³•å°±åªæ˜¯ç®€å•åœ°æŠŠå­—ç¬¦åºåˆ—è½¬æˆå­—ç¬¦ä¸²,ä¹Ÿå°±æ˜¯è¯´,ä½ è¾“å…¥çš„å¯†ç â€123456â€å­˜å‚¨åœ¨æ•°æ®åº“é‡Œä»ç„¶æ˜¯â€123456â€,è¿™æ ·å¦‚æœæ•°æ®åº“è¢«æ”»ç ´çš„è¯,å¯†ç å°±ç›´æ¥æ³„éœ²äº†,ååˆ†ä¸å®‰å…¨.è€Œä¸”,<strong>NoOpPasswordEncoder</strong>ä¹Ÿå°±å¤±å»äº†æ‰€è°“å¯†ç ç¼–ç å™¨çš„æ„ä¹‰äº†.</p><p>ä¸è¿‡,æ­£å› å…¶ååˆ†ç®€å•,æ‰€ä»¥åœ¨Spring Security 5.0 ä¹‹å‰<strong>NoOpPasswordEncoder</strong>æ˜¯ä½œä¸ºé»˜è®¤çš„å¯†ç ç¼–ç å™¨è€Œå­˜åœ¨åˆ°,å®ƒå¯ä»¥æ˜¯ä½ æ²¡æœ‰ä¸»åŠ¨åŠ å¯†æ—¶çš„ä¸€ä¸ªé»˜è®¤é€‰æ‹©.</p><p>å¦å¤–,<strong>NoOpPasswordEncoder</strong>çš„å®ç°æ˜¯ä¸€ä¸ªæ ‡å‡†çš„é¥¿æ±‰å•ä¾‹æ¨¡å¼,å…³äºå•ä¾‹æ¨¡å¼å¯ä»¥çœ‹è¿™ä¸€ç¯‡æ–‡ç« ,<a href="https://blog.csdn.net/alinyua/article/details/79776613">å•ä¾‹æ¨¡å¼åŠå…¶4ç§æ¨èå†™æ³•å’Œ3ç±»ä¿æŠ¤æ‰‹æ®µ</a></p><h3 id="2-DelegatingPasswordEncoder"><a href="#2-DelegatingPasswordEncoder" class="headerlink" title="2 DelegatingPasswordEncoder"></a>2 DelegatingPasswordEncoder</h3><p>é€šè¿‡ä¸Šé¢çš„å­¦ä¹ ,æˆ‘ä»¬å¯ä»¥çŸ¥é“éšç€å®‰å…¨è¦æ±‚çš„æé«˜,ä¹‹å‰çš„é»˜è®¤å¯†ç ç¼–ç å™¨<strong>NoOpPasswordEncoder</strong>å·²ç»è¢«â€ä¸æ¨èâ€äº†,é‚£æˆ‘ä»¬æœ‰ç†ç”±æ¨æµ‹ç°åœ¨çš„é»˜è®¤å¯†ç ç¼–ç å™¨æ¢æˆäº†ä½¿ç”¨æŸä¸€ç‰¹å®šç®—æ³•çš„ç¼–ç å™¨.å¯æ˜¯è¿™æ ·ä¾¿ä¼šå¸¦æ¥ä¸‰ä¸ªé—®é¢˜:</p><ul><li>æœ‰è®¸å¤šä½¿ç”¨æ—§å¯†ç ç¼–ç çš„åº”ç”¨ç¨‹åºæ— æ³•è½»æ¾è¿ç§»</li><li>å¯†ç å­˜å‚¨çš„æœ€ä½³åšæ³•(ç®—æ³•)å¯èƒ½ä¼šå†æ¬¡å‘ç”Ÿå˜åŒ–</li><li>ä½œä¸ºä¸€ä¸ªæ¡†æ¶ï¼ŒSpring Securityä¸èƒ½ç»å¸¸å‘ç”Ÿçªå˜</li></ul><p>ç®€å•æ¥è¯´,å°±æ˜¯æ–°çš„å¯†ç ç¼–ç å™¨å’Œæ—§å¯†ç çš„å…¼å®¹æ€§,ä»¥åŠè‡ªèº«çš„ç¨³å¥æ€§ä»¥åŠéœ€è¦ä¸€å®šçš„å¯å˜æ€§(åˆ‡æ¢åˆ°æ›´å¥½çš„ç®—æ³•).å¬èµ·æ¥æ˜¯ä¸æ˜¯ååˆ†çŸ›ç›¾?é‚£æˆ‘ä»¬å°±æ¥çœ‹çœ‹<strong>DelegatingPasswordEncoder</strong>æ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„,åœ¨çœ‹è§£å†³æ–¹æ³•ä¹‹å‰å…ˆçœ‹ä½¿ç”¨<strong>DelegatingPasswordEncoder</strong>æ‰€èƒ½è¾¾åˆ°çš„æ•ˆæœ:</p><ul><li>ç¡®ä¿ä½¿ç”¨å½“å‰å¯†ç å­˜å‚¨å»ºè®®å¯¹å¯†ç è¿›è¡Œç¼–ç </li><li>å…è®¸éªŒè¯ç°ä»£å’Œä¼ ç»Ÿæ ¼å¼çš„å¯†ç </li><li>å…è®¸å°†æ¥å‡çº§ç¼–ç ç®—æ³•</li></ul><p>æ˜¯ä¸æ˜¯å¾ˆç¥å¥‡?äº‹å®ä¸Š<strong>DelegatingPasswordEncoder</strong>å¹¶ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„ç¼–ç å™¨,å®ƒå¹¶ä¸ä½¿ç”¨æŸä¸€ç‰¹å®šç®—æ³•è¿›è¡Œç¼–ç ,é¡¾åæ€ä¹‰,å®ƒæ˜¯ä¸€ä¸ª<strong>å§”æ´¾å¯†ç ç¼–ç å™¨</strong>,å®ƒå°†å…·ä½“ç¼–ç çš„å®ç°æ ¹æ®è¦æ±‚å§”æ´¾ç»™ä¸åŒçš„ç®—æ³•,ä»¥æ­¤æ¥å®ç°ä¸åŒç¼–ç ç®—æ³•ä¹‹é—´çš„å…¼å®¹å’Œå˜åŒ–åè°ƒ.</p><h4 id="1-æ„é€ æ–¹æ³•"><a href="#1-æ„é€ æ–¹æ³•" class="headerlink" title="1 æ„é€ æ–¹æ³•"></a>1 æ„é€ æ–¹æ³•</h4><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹<strong>DelegatingPasswordEncoder</strong>çš„æ„é€ æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public DelegatingPasswordEncoder(String idForEncode,</span><br><span class="line">Map&lt;String, PasswordEncoder&gt; idToPasswordEncoder) &#123;</span><br><span class="line">if(idForEncode == null) &#123;</span><br><span class="line">throw new IllegalArgumentException(&quot;idForEncode cannot be null&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if(!idToPasswordEncoder.containsKey(idForEncode)) &#123;</span><br><span class="line">throw new IllegalArgumentException(&quot;idForEncode &quot; + idForEncode + &quot;is not found in idToPasswordEncoder &quot; + idToPasswordEncoder);</span><br><span class="line">&#125;</span><br><span class="line">for(String id : idToPasswordEncoder.keySet()) &#123;</span><br><span class="line">if(id == null) &#123;</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">if(id.contains(PREFIX)) &#123;</span><br><span class="line">throw new IllegalArgumentException(&quot;id &quot; + id + &quot; cannot contain &quot; + PREFIX);</span><br><span class="line">&#125;</span><br><span class="line">if(id.contains(SUFFIX)) &#123;</span><br><span class="line">throw new IllegalArgumentException(&quot;id &quot; + id + &quot; cannot contain &quot; + SUFFIX);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">this.idForEncode = idForEncode;</span><br><span class="line">this.passwordEncoderForEncode = idToPasswordEncoder.get(idForEncode);</span><br><span class="line">this.idToPasswordEncoder = new HashMap&lt;&gt;(idToPasswordEncoder);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>idForEncode</strong>å†³å®šå¯†ç ç¼–ç å™¨çš„ç±»å‹,<strong>idToPasswordEncoder</strong>å†³å®šåˆ¤æ–­åŒ¹é…æ—¶å…¼å®¹çš„ç±»å‹<br>è€Œä¸”<strong>idToPasswordEncoder</strong>å¿…é¡»åŒ…å«<strong>idForEncode</strong>(ä¸ç„¶åŠ å¯†åå°±æ— æ³•åŒ¹é…äº†)</p><p>å›´ç»•è¿™ä¸ªæ„é€ æ–¹æ³•é€šå¸¸æœ‰ä¸¤ç§åˆ›å»ºæ€è·¯,å¦‚ä¸‹:</p><h5 id="å·¥å‚æ„é€ "><a href="#å·¥å‚æ„é€ " class="headerlink" title="å·¥å‚æ„é€ "></a>å·¥å‚æ„é€ </h5><p>é¦–å…ˆæ˜¯å·¥å‚æ„é€ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PasswordEncoder passwordEncoder =</span><br><span class="line">    PasswordEncoderFactories.createDelegatingPasswordEncoder();</span><br></pre></td></tr></table></figure><p>å…¶å…·ä½“å®ç°å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PasswordEncoder <span class="title">createDelegatingPasswordEncoder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">String encodingId = <span class="string">&quot;bcrypt&quot;</span>;</span><br><span class="line">Map&lt;String, PasswordEncoder&gt; encoders = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">encoders.put(encodingId, <span class="keyword">new</span> BCryptPasswordEncoder());</span><br><span class="line">encoders.put(<span class="string">&quot;ldap&quot;</span>, <span class="keyword">new</span> LdapShaPasswordEncoder());</span><br><span class="line">encoders.put(<span class="string">&quot;MD4&quot;</span>, <span class="keyword">new</span> Md4PasswordEncoder());</span><br><span class="line">encoders.put(<span class="string">&quot;MD5&quot;</span>, <span class="keyword">new</span> MessageDigestPasswordEncoder(<span class="string">&quot;MD5&quot;</span>));</span><br><span class="line">encoders.put(<span class="string">&quot;noop&quot;</span>, NoOpPasswordEncoder.getInstance());</span><br><span class="line">encoders.put(<span class="string">&quot;pbkdf2&quot;</span>, <span class="keyword">new</span> Pbkdf2PasswordEncoder());</span><br><span class="line">encoders.put(<span class="string">&quot;scrypt&quot;</span>, <span class="keyword">new</span> SCryptPasswordEncoder());</span><br><span class="line">encoders.put(<span class="string">&quot;SHA-1&quot;</span>, <span class="keyword">new</span> MessageDigestPasswordEncoder(<span class="string">&quot;SHA-1&quot;</span>));</span><br><span class="line">encoders.put(<span class="string">&quot;SHA-256&quot;</span>, <span class="keyword">new</span> MessageDigestPasswordEncoder(<span class="string">&quot;SHA-256&quot;</span>));</span><br><span class="line">encoders.put(<span class="string">&quot;sha256&quot;</span>, <span class="keyword">new</span> StandardPasswordEncoder());</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> DelegatingPasswordEncoder(encodingId, encoders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¯ä»¥ç®€å•åœ°ç†è§£ä¸º,é‡åˆ°æ–°å¯†ç ,<strong>DelegatingPasswordEncoder</strong>ä¼šå§”æ‰˜ç»™<strong>BCryptPasswordEncoder</strong>(encodingIdä¸º<em>bcryp</em><em>)è¿›è¡ŒåŠ å¯†,åŒæ—¶,å¯¹å†å²ä¸Šä½¿ç”¨*<em>ldap</em></em>,<strong>MD4</strong>,<strong>MD5</strong>ç­‰ç­‰åŠ å¯†ç®—æ³•çš„å¯†ç è®¤è¯ä¿æŒå…¼å®¹(å¦‚æœæ•°æ®åº“é‡Œçš„å¯†ç ä½¿ç”¨çš„æ˜¯<strong>MD5</strong>ç®—æ³•,é‚£ä½¿ç”¨matchesæ–¹æ³•è®¤è¯ä»å¯ä»¥é€šè¿‡,ä½†æ–°å¯†ç ä¼šä½¿<strong>bcrypt</strong>è¿›è¡Œå‚¨å­˜),ååˆ†ç¥å¥‡,åŸç†åé¢ä¼šè®²</p><h5 id="å®šåˆ¶æ„é€ "><a href="#å®šåˆ¶æ„é€ " class="headerlink" title="å®šåˆ¶æ„é€ "></a>å®šåˆ¶æ„é€ </h5><p>æ¥ä¸‹æ¥æ˜¯å®šåˆ¶æ„é€ ,å…¶å®å’Œå·¥å‚æ–¹æ³•æ˜¯ä¸€æ ·çš„,ä¸€èˆ¬æƒ…å†µä¸‹æ¨èç›´æ¥ä½¿ç”¨å·¥å‚æ–¹æ³•,è¿™é‡Œç»™ä¸€ä¸ªå°ä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">String idForEncode = <span class="string">&quot;bcrypt&quot;</span>;</span><br><span class="line">Map encoders = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">encoders.put(idForEncode, <span class="keyword">new</span> BCryptPasswordEncoder());</span><br><span class="line">encoders.put(<span class="string">&quot;noop&quot;</span>, NoOpPasswordEncoder.getInstance());</span><br><span class="line">encoders.put(<span class="string">&quot;pbkdf2&quot;</span>, <span class="keyword">new</span> Pbkdf2PasswordEncoder());</span><br><span class="line">encoders.put(<span class="string">&quot;scrypt&quot;</span>, <span class="keyword">new</span> SCryptPasswordEncoder());</span><br><span class="line">encoders.put(<span class="string">&quot;sha256&quot;</span>, <span class="keyword">new</span> StandardPasswordEncoder());</span><br><span class="line"></span><br><span class="line">PasswordEncoder passwordEncoder =</span><br><span class="line">    <span class="keyword">new</span> DelegatingPasswordEncoder(idForEncode, encoders);</span><br></pre></td></tr></table></figure><h4 id="2-å¯†ç å­˜å‚¨æ ¼å¼"><a href="#2-å¯†ç å­˜å‚¨æ ¼å¼" class="headerlink" title="2 å¯†ç å­˜å‚¨æ ¼å¼"></a>2 å¯†ç å­˜å‚¨æ ¼å¼</h4><p>å¯†ç çš„æ ‡å‡†å­˜å‚¨æ ¼å¼æ˜¯:</p><blockquote><p>{id}encodedPassword</p></blockquote><p>å…¶ä¸­,<strong>id</strong>æ ‡è¯†ä½¿ç”¨<strong>PaswordEncoder</strong>çš„ç§ç±»<br><strong>encodedPassword</strong>æ˜¯åŸå¯†ç è¢«ç¼–ç åçš„å¯†ç </p><blockquote><p>æ³¨æ„:<br><strong>rawPassword</strong>,<strong>encodedPassword</strong>,<strong>å¯†ç å­˜å‚¨æ ¼å¼</strong>(<strong>prefixEncodedPassword</strong>),è¿™ä¸‰è€…æ˜¯ä¸åŒçš„æ¦‚å¿µ!<br><code>rawPassword</code>ç›¸å½“äºå­—ç¬¦åºåˆ—â€<code>123456</code>â€œ<br><code>encodedPassword</code>æ˜¯ä½¿ç”¨idä¸ºâ€mycryptâ€å¯¹åº”çš„å¯†ç ç¼–ç å™¨â€123456â€ç¼–ç åçš„å­—ç¬¦ä¸²,å‡è®¾ä¸ºâ€<code>qwertyuiop</code>â€œ<br><code>å­˜å‚¨çš„å¯†ç  prefixEncodedPassword</code>æ˜¯åœ¨æ•°æ®åº“ä¸­,æˆ‘ä»¬æ‰€èƒ½è§åˆ°çš„å½¢å¼,å¦‚â€<code>&#123;mycrypt&#125;qwertyuiop</code>â€œ<br>è¿™ä¸ªæ¦‚å¿µåœ¨åé¢è®²matchesæ–¹æ³•çš„æºç æ—¶ä¼šç”¨åˆ°,è¯·ç•™æ„</p></blockquote><p>ä¾‹å¦‚<strong>rawPassword</strong>ä¸º<strong>password</strong>åœ¨ä½¿ç”¨ä¸åŒç¼–ç ç®—æ³•çš„æƒ…å†µä¸‹åœ¨æ•°æ®åº“çš„å­˜å‚¨å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;bcrypt&#125;$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG </span><br><span class="line">&#123;noop&#125;password </span><br><span class="line">&#123;pbkdf2&#125;5d923b44a6d129f3ddf3e3c8d29412723dcbde72445e8ef6bf3b508fbf17fa4ed4d6b99ca763d8dc </span><br><span class="line">&#123;scrypt&#125;$e0801$8bWJaSu2IKSn9Z9kM+TPXfOc/9bdYSrN1oD9qfVThWEwdRTnO7re7Ei+fUZRJ68k9lTyuTeUp4of4g24hHnazw==$OAOec05+bXxvuu/1qZ6NUR+xQYvYv7BeL1QxwRpY5Pc=  </span><br><span class="line">&#123;sha256&#125;97cde38028ad898ebc02e690819fa220e88c62e0699403e94fff291cfffaf8410849f27605abcbc0 </span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œéœ€è¦æŒ‡æ˜,å¯†ç çš„å¯é æ€§å¹¶ä¸ä¾èµ–äºåŠ å¯†ç®—æ³•çš„ä¿å¯†,å³å¯†ç çš„å¯é åœ¨äºå°±ç®—ä½ çŸ¥é“æˆ‘ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç®—æ³•ä½ ä¹Ÿæ— æ³•è¿˜åŸå‡ºåŸå¯†ç (å½“ç„¶,å¯¹äºæœ¬èº«å°±å¯é€†çš„ç¼–ç ç®—æ³•æ¥è¯´å°±ä¸æ˜¯è¿™æ ·äº†,ä½†è¿™æ ·çš„ç®—æ³•æˆ‘ä»¬é€šå¸¸ä¸ä¼šè®¤ä¸ºæ˜¯å¯é çš„),è€Œä¸”,å³ä½¿æ²¡æœ‰æ ‡æ˜ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç®—æ³•,æ”»å‡»è€…ä¹Ÿå¾ˆå®¹æ˜“æ ¹æ®ä¸€äº›è§„å¾‹ä»ç¼–ç åçš„å¯†ç å­—ç¬¦ä¸²ä¸­æ¨æµ‹å‡ºç¼–ç ç®—æ³•,å¦‚bcryptç®—æ³•é€šå¸¸æ˜¯ä»¥<code>$2a$</code>å¼€å¤´çš„</p></blockquote><h4 id="3-å¯†ç ç¼–ç ä¸åŒ¹é…"><a href="#3-å¯†ç ç¼–ç ä¸åŒ¹é…" class="headerlink" title="3 å¯†ç ç¼–ç ä¸åŒ¹é…"></a>3 å¯†ç ç¼–ç ä¸åŒ¹é…</h4><p>ä»ä¸Šæ–‡å¯çŸ¥,<strong>idForEncode</strong>è¿™ä¸ªæ„é€ å‚æ•°å†³å®šä½¿ç”¨å“ªä¸ªPasswordEncoderè¿›è¡Œå¯†ç çš„ç¼–ç ,ç¼–ç çš„æ–¹æ³•å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PREFIX = <span class="string">&quot;&#123;&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUFFIX = <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">encode</span><span class="params">(CharSequence rawPassword)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> PREFIX + <span class="keyword">this</span>.idForEncode + SUFFIX + <span class="keyword">this</span>.passwordEncoderForEncode.encode(rawPassword);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ç”¨ä¸Šæ–‡æ„é€ çš„<strong>DelegatingPasswordEncoder</strong>é»˜è®¤ä½¿ç”¨<strong>BCryptPasswordEncoder</strong>,ç»“æœæ ¼å¼å¦‚</p><blockquote><p>{bcrypt}$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG</p></blockquote><p>å¯†ç ç¼–ç æ–¹æ³•æ¯”è¾ƒç®€å•,é‡ç‚¹åœ¨äºåŒ¹é….åŒ¹é…æ–¹æ³•æºç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(CharSequence rawPassword, String prefixEncodedPassword)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(rawPassword == <span class="keyword">null</span> &amp;&amp; prefixEncodedPassword == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å–å‡ºç¼–ç ç®—æ³•çš„id</span></span><br><span class="line">String id = extractId(prefixEncodedPassword);</span><br><span class="line"><span class="comment">//æ ¹æ®ç¼–ç ç®—æ³•çš„idä»æ”¯æŒçš„å¯†ç ç¼–ç å™¨Map(æ„é€ æ—¶ä¼ å…¥)ä¸­å–å‡ºå¯¹åº”ç¼–ç å™¨</span></span><br><span class="line">PasswordEncoder delegate = <span class="keyword">this</span>.idToPasswordEncoder.get(id);</span><br><span class="line"><span class="keyword">if</span>(delegate == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœæ‰¾ä¸åˆ°å¯¹åº”çš„å¯†ç ç¼–ç å™¨åˆ™ä½¿ç”¨é»˜è®¤å¯†ç ç¼–ç å™¨è¿›è¡ŒåŒ¹é…åˆ¤æ–­,æ­¤æ—¶æ¯”è¾ƒçš„å¯†ç å­—ç¬¦ä¸²æ˜¯ prefixEncodedPassword</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.defaultPasswordEncoderForMatches</span><br><span class="line">.matches(rawPassword, prefixEncodedPassword);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä» prefixEncodedPassword ä¸­æå–è·å¾— encodedPassword </span></span><br><span class="line">String encodedPassword = extractEncodedPassword(prefixEncodedPassword);</span><br><span class="line"><span class="comment">//ä½¿ç”¨å¯¹åº”ç¼–ç å™¨è¿›è¡ŒåŒ¹é…åˆ¤æ–­,æ­¤æ—¶æ¯”è¾ƒçš„å¯†ç å­—ç¬¦ä¸²æ˜¯ encodedPassword ,ä¸æºå¸¦ç¼–ç ç®—æ³•idå¤´</span></span><br><span class="line"><span class="keyword">return</span> delegate.matches(rawPassword, encodedPassword);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåŒ¹é…æ–¹æ³•å…¶å®ä¹ŸæŒºå¥½ç†è§£çš„,å”¯ä¸€éœ€è¦ç‰¹åˆ«æ³¨æ„çš„å°±æ˜¯æ‰¾ä¸åˆ°å¯¹åº”å¯†ç ç¼–ç å™¨æ—¶ä½¿ç”¨çš„é»˜è®¤å¯†ç ç¼–ç å™¨,</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹<strong>defaultPasswordEncoderForMatches</strong>æ˜¯ä¸€ä¸ªä»€ä¹ˆä¸œè¥¿</p><h4 id="4-defaultPasswordEncoderForMatchesåŠ-idä¸ºnullå¼‚å¸¸"><a href="#4-defaultPasswordEncoderForMatchesåŠ-idä¸ºnullå¼‚å¸¸" class="headerlink" title="4 defaultPasswordEncoderForMatchesåŠ idä¸ºnullå¼‚å¸¸"></a>4 defaultPasswordEncoderForMatchesåŠ idä¸ºnullå¼‚å¸¸</h4><p>åœ¨<strong>DelegatingPasswordEncoder</strong>çš„æºç é‡Œå¯¹åº”å†…å®¹å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PREFIX = <span class="string">&quot;&#123;&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUFFIX = <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> String idForEncode;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> PasswordEncoder passwordEncoderForEncode;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, PasswordEncoder&gt; idToPasswordEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> PasswordEncoder defaultPasswordEncoderForMatches = <span class="keyword">new</span> UnmappedIdPasswordEncoder();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDefaultPasswordEncoderForMatches</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">PasswordEncoder defaultPasswordEncoderForMatches)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(defaultPasswordEncoderForMatches == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;defaultPasswordEncoderForMatches cannot be null&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">this</span>.defaultPasswordEncoderForMatches = defaultPasswordEncoderForMatches;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">UnmappedIdPasswordEncoder</span> <span class="keyword">implements</span> <span class="title">PasswordEncoder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">encode</span><span class="params">(CharSequence rawPassword)</span> </span>&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">&quot;encode is not supported&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(CharSequence rawPassword,</span></span></span><br><span class="line"><span class="params"><span class="function">String prefixEncodedPassword)</span> </span>&#123;</span><br><span class="line">String id = extractId(prefixEncodedPassword);</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;There is no PasswordEncoder mapped for the id \&quot;&quot;</span> + id + <span class="string">&quot;\&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°,<strong>DelegatingPasswordEncoder</strong>é‡Œé¢,<br><strong>PREFIX <strong>å’Œ</strong>SUFFIX <strong>æ˜¯å¸¸é‡,<br><strong>idForEncode</strong>,<strong>passwordEncoderForEncode</strong>å’Œ</strong>idToPasswordEncoder</strong>æ˜¯åœ¨æ„é€ æ–¹æ³•ä¸­ä¼ å…¥å†³å®šå¹¶ä¸å¯ä¿®æ”¹çš„,<br>åªæœ‰<strong>defaultPasswordEncoderForMatches <strong>æ˜¯æœ‰ä¸€ä¸ª</strong>setDefaultPasswordEncoderForMatches</strong>æ–¹æ³•è¿›è¡Œè®¾ç½®çš„å¯å˜å¯¹è±¡.</p><p>è€Œä¸”,å®ƒæœ‰ä¸€ä¸ªç§æœ‰çš„é»˜è®¤å®ç°<code>UnmappedIdPasswordEncoder </code>,è¿™ä¸ªæ‰€è°“çš„é»˜è®¤å®ç°çš„å”¯ä¸€ä½œç”¨å°±æ˜¯<strong>æŠ›å‡ºå¼‚å¸¸æé†’ä½ è¦è‡ªå·±é€‰æ‹©ä¸€ä¸ªé»˜è®¤å¯†ç ç¼–ç å™¨æ¥å–ä»£å®ƒ</strong>,é€šå¸¸æˆ‘ä»¬åªä¼šå¯èƒ½ç”¨åˆ°å®ƒçš„matchesæ–¹æ³•,è¿™ä¸ªæ—¶å€™å°±ä¼šæŠ¥æŠ›å‡ºå¦‚ä¸‹å¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalArgumentException: There is no PasswordEncoder mapped <span class="keyword">for</span> the id <span class="string">&quot;null&quot;</span></span><br><span class="line">at org.springframework.security.crypto.password.DelegatingPasswordEncoder$UnmappedIdPasswordEncoder.matches(DelegatingPasswordEncoder.java:<span class="number">233</span>)</span><br><span class="line">at org.springframework.security.crypto.password.DelegatingPasswordEncoder.matches(DelegatingPasswordEncoder.java:<span class="number">196</span>)</span><br></pre></td></tr></table></figure><h4 id="5-è§£å†³æ–¹æ³•"><a href="#5-è§£å†³æ–¹æ³•" class="headerlink" title="5 è§£å†³æ–¹æ³•"></a>5 è§£å†³æ–¹æ³•</h4><p>é‡åˆ°è¿™ä¸ªå¼‚å¸¸,æœ€ç®€å•çš„åšæ³•å°±æ˜¯æ˜ç¡®æä¾›ä¸€ä¸ª<strong>PasswordEncoder</strong>å¯¹å¯†ç è¿›è¡Œç¼–ç ,å¦‚æœæ˜¯ä»Spring Security 5.0 ä¹‹å‰è¿ç§»è€Œæ¥çš„,ç”±äºä¹‹å‰é»˜è®¤ä½¿ç”¨çš„æ˜¯<strong>NoOpPasswordEncoder</strong>å¹¶ä¸”æ•°æ®åº“çš„å¯†ç ä¿å­˜æ ¼å¼ä¸å¸¦æœ‰åŠ å¯†ç®—æ³•idå¤´,ä¼šæŠ¥idä¸ºnullå¼‚å¸¸,æ‰€ä»¥åº”è¯¥æ˜ç¡®æä¾›ä¸€ä¸ª<strong>NoOpPasswordEncoder</strong>å¯†ç ç¼–ç å™¨.</p><p>è¿™é‡Œæœ‰ä¸¤ç§æ€è·¯,å…¶ä¸€å°±æ˜¯ä½¿ç”¨<strong>NoOpPasswordEncoder</strong>å–ä»£<strong>DelegatingPasswordEncoder</strong>,ä»¥æ¢å¤åˆ°ä¹‹å‰ç‰ˆæœ¬çš„çŠ¶æ€,è¿™ä¹Ÿæ˜¯ç¬”è€…åœ¨å…¶ä»–åšå®¢ä¸Šçœ‹å¾—æ¯”è¾ƒå¤šçš„ä¸€ç§è§£å†³æ–¹æ³•.å¦å¤–å°±æ˜¯ä½¿ç”¨<strong>DelegatingPasswordEncoder</strong>çš„<code>setDefaultPasswordEncoderForMatches</code>æ–¹æ³•æŒ‡å®šé»˜è®¤çš„å¯†ç ç¼–ç å™¨ä¸º<strong>NoOpPasswordEncoder</strong>,è¿™ä¸¤ç§æ–¹æ³•å­°ä¼˜å­°åŠ£è‡ªç„¶ä¸è¨€è€Œå–»,å®˜æ–¹æ–‡æ¡£æ˜¯è¿™ä¹ˆè¯´çš„</p><blockquote><p>Reverting to NoOpPasswordEncoder is not considered to be secure. You should instead migrate to using DelegatingPasswordEncoder to support secure password encoding.<br>æ¢å¤åˆ°NoOpPasswordEncoderä¸è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„ã€‚æ‚¨åº”è¯¥è½¬è€Œä½¿ç”¨DelegatingPasswordEncoderæ”¯æŒå®‰å…¨å¯†ç ç¼–ç </p></blockquote><p>å½“ç„¶,ä½ ä¹Ÿå¯ä»¥å°†æ•°æ®åº“ä¿å­˜çš„å¯†ç éƒ½åŠ ä¸Šä¸€ä¸ª<code>&#123;noop&#125;</code>å‰ç¼€,è¿™æ ·<strong>DelegatingPasswordEncoder</strong>å°±çŸ¥é“è¦ä½¿ç”¨<strong>NoOpPasswordEncoder</strong>äº†,è¿™ç¡®å®æ˜¯ä¸€ç§æ–¹æ³•,ä½†æ²¡å¿…è¦,è¿™é‡Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å‰é¢çš„ä¸¤ç§è§£å†³æ–¹æ³•çš„å®ç°</p><h5 id="1-ä½¿ç”¨NoOpPasswordEncoderå–ä»£DelegatingPasswordEncoder"><a href="#1-ä½¿ç”¨NoOpPasswordEncoderå–ä»£DelegatingPasswordEncoder" class="headerlink" title="1 ä½¿ç”¨NoOpPasswordEncoderå–ä»£DelegatingPasswordEncoder"></a>1 ä½¿ç”¨NoOpPasswordEncoderå–ä»£DelegatingPasswordEncoder</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"> <span class="keyword">public</span>  <span class="keyword">static</span> NoOpPasswordEncoder passwordEncoderï¼ˆï¼‰&#123;</span><br><span class="line">     <span class="keyword">return</span> NoOpPasswordEncoder.getInstanceï¼ˆï¼‰;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-ä½¿ç”¨DelegatingPasswordEncoderæŒ‡å®šdefaultPasswordEncoderForMatches"><a href="#2-ä½¿ç”¨DelegatingPasswordEncoderæŒ‡å®šdefaultPasswordEncoderForMatches" class="headerlink" title="2 ä½¿ç”¨DelegatingPasswordEncoderæŒ‡å®šdefaultPasswordEncoderForMatches"></a>2 ä½¿ç”¨DelegatingPasswordEncoderæŒ‡å®šdefaultPasswordEncoderForMatches</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    @Bean</span><br><span class="line">    public  static PasswordEncoder passwordEncoder( )&#123;</span><br><span class="line">        DelegatingPasswordEncoder delegatingPasswordEncoder =</span><br><span class="line">                (DelegatingPasswordEncoder) PasswordEncoderFactories.createDelegatingPasswordEncoder();</span><br><span class="line">//è®¾ç½®defaultPasswordEncoderForMatchesä¸ºNoOpPasswordEncoder</span><br><span class="line">        delegatingPasswordEncoder.setDefaultPasswordEncoderForMatches(NoOpPasswordEncoder.getInstance());</span><br><span class="line">        return  delegatingPasswordEncoder;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
